<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><title>MoeCTF2024|Reverse | 能打一辈子CTF吗？</title><meta name="author" content="wind_9233,1768765226@qq.com"><meta name="copyright" content="wind_9233"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="关于WPAuthor: 0xcafebabe第三方题目（非XDSEC成员）:1.xor(大嘘) (Author: 中国人民警察大学的：Chovy)2.Cython-Strike: Bomb Defusion (Author: 西安电子科技大学的：不玩逆向爱玩CS的同学) 入门指北下载PDF，了解里面关于XOR的讲解内容后，可以发现直接给出了解题代码。 12345678910111213141516"><meta property="og:type" content="article"><meta property="og:title" content="MoeCTF2024|Reverse"><meta property="og:url" content="https://github.com/xyy9233/xyy9233.github.io.git/2024/10/20/Moectf%202024%20%20Reverse/index.html"><meta property="og:site_name" content="能打一辈子CTF吗？"><meta property="og:description" content="关于WPAuthor: 0xcafebabe第三方题目（非XDSEC成员）:1.xor(大嘘) (Author: 中国人民警察大学的：Chovy)2.Cython-Strike: Bomb Defusion (Author: 西安电子科技大学的：不玩逆向爱玩CS的同学) 入门指北下载PDF，了解里面关于XOR的讲解内容后，可以发现直接给出了解题代码。 12345678910111213141516"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://images.dmzj.com/news/article/77394/row_6409512934343.jpg"><meta property="article:published_time" content="2024-10-19T16:00:00.000Z"><meta property="article:modified_time" content="2024-10-30T11:39:10.195Z"><meta property="article:author" content="wind_9233"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://images.dmzj.com/news/article/77394/row_6409512934343.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://github.com/xyy9233/xyy9233.github.io.git/2024/10/20/Moectf%202024%20%20Reverse/"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="preconnect" href="//busuanzi.ibruce.info"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload='this.media="all"'><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload='this.media="all"'><script>const GLOBAL_CONFIG={root:"/",algolia:void 0,localSearch:void 0,translate:void 0,noticeOutdate:void 0,highlight:{plugin:"highlighjs",highlightCopy:!0,highlightLang:!0,highlightHeightLimit:!1},copy:{success:"复制成功",error:"复制错误",noSupport:"浏览器不支持"},relativeDate:{homepage:!1,post:!1},runtime:"",date_suffix:{just:"刚刚",min:"分钟前",hour:"小时前",day:"天前",month:"个月前"},copyright:void 0,lightbox:"fancybox",Snackbar:void 0,source:{justifiedGallery:{js:"https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js",css:"https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css"}},isPhotoFigcaption:!1,islazyload:!1,isAnchor:!1}</script><script id="config-diff">var GLOBAL_CONFIG_SITE={title:"MoeCTF2024|Reverse",isPost:!0,isHome:!1,isHighlightShrink:!1,isToc:!0,postUpdate:"2024-10-30 19:39:10"}</script><noscript><style>#nav{opacity:1}.justified-gallery img{opacity:1}#post-meta time,#recent-posts time{display:inline!important}</style></noscript><script>(e=>{e.saveToLocal={set:function(e,t,a){0!==a&&(a=864e5*a,t={value:t,expiry:(new Date).getTime()+a},localStorage.setItem(e,JSON.stringify(t)))},get:function(e){var t=localStorage.getItem(e);if(t){t=JSON.parse(t);if(!((new Date).getTime()>t.expiry))return t.value;localStorage.removeItem(e)}}},e.getScript=o=>new Promise((t,e)=>{const a=document.createElement("script");a.src=o,a.async=!0,a.onerror=e,a.onload=a.onreadystatechange=function(){var e=this.readyState;e&&"loaded"!==e&&"complete"!==e||(a.onload=a.onreadystatechange=null,t())},document.head.appendChild(a)}),e.activateDarkMode=function(){document.documentElement.setAttribute("data-theme","dark"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#0d0d0d")},e.activateLightMode=function(){document.documentElement.setAttribute("data-theme","light"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#ffffff")};e=saveToLocal.get("theme"),"dark"===e?activateDarkMode():"light"===e&&activateLightMode(),e=saveToLocal.get("aside-status");void 0!==e&&("hide"===e?document.documentElement.classList.add("hide-aside"):document.documentElement.classList.remove("hide-aside"));/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)&&document.documentElement.classList.add("apple")})(window)</script><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="能打一辈子CTF吗？" type="application/atom+xml"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://img1.baidu.com/it/u=38471470,3942836709&amp;fm=253&amp;fmt=auto&amp;app=120&amp;f=JPEG?w=889&amp;h=500" onerror='onerror=null,src="/img/friend_404.gif"' alt="avatar"></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">51</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">31</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">0</div></a></div><hr></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image:url(https://images.dmzj.com/news/article/77394/row_6409512934343.jpg)"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">能打一辈子CTF吗？</a></span><div id="menus"><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">MoeCTF2024|Reverse</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2024-10-19T16:00:00.000Z" title="发表于 2024-10-20 00:00:00">2024-10-20</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-10-30T11:39:10.195Z" title="更新于 2024-10-30 19:39:10">2024-10-30</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" data-flag-title="MoeCTF2024|Reverse"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="关于WP"><a href="#关于WP" class="headerlink" title="关于WP"></a>关于WP</h1><p>Author: 0xcafebabe<br>第三方题目（非XDSEC成员）:<br>1.xor(大嘘) (Author: 中国人民警察大学的：Chovy)<br>2.Cython-Strike: Bomb Defusion (Author: 西安电子科技大学的：不玩逆向爱玩CS的同学)</p><h1 id="入门指北"><a href="#入门指北" class="headerlink" title="入门指北"></a>入门指北</h1><p>下载PDF，了解里面关于XOR的讲解内容后，可以发现直接给出了解题代码。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">char</span> password_enc[] = &#123; </span><br><span class="line">		<span class="number">123</span>, <span class="number">121</span>, <span class="number">115</span>, <span class="number">117</span>, <span class="number">98</span>, <span class="number">112</span>, <span class="number">109</span>, <span class="number">100</span>, <span class="number">37</span>, <span class="number">96</span>, <span class="number">37</span>, <span class="number">100</span>, <span class="number">101</span>, <span class="number">37</span>, <span class="number">73</span>, <span class="number">39</span>,</span><br><span class="line">		<span class="number">101</span>, <span class="number">73</span>, <span class="number">119</span>, <span class="number">73</span>, <span class="number">122</span>, <span class="number">121</span>, <span class="number">120</span>, <span class="number">113</span>, <span class="number">73</span>, <span class="number">122</span>, <span class="number">121</span>, <span class="number">120</span>, <span class="number">113</span>, <span class="number">73</span>, <span class="number">97</span>, <span class="number">119</span>, </span><br><span class="line">		<span class="number">111</span>, <span class="number">73</span>, <span class="number">98</span>, <span class="number">121</span>, <span class="number">73</span>, <span class="number">115</span>, <span class="number">110</span>, <span class="number">102</span>, <span class="number">122</span>, <span class="number">121</span>, <span class="number">100</span>, <span class="number">115</span>, <span class="number">107</span>, <span class="number">22</span> &#125;;</span><br><span class="line">	<span class="comment">// 因为a^b=c时, b^c=a, 所以我们可以这样还原数据:</span></span><br><span class="line">	<span class="type">char</span> password[<span class="number">47</span>];</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">46</span>; i++) &#123;</span><br><span class="line">		password[i] = password_enc[i] ^ <span class="number">22</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	password[<span class="number">46</span>] = <span class="number">0</span>; <span class="comment">// 使用0字符来截断掉%s的无尽输出..</span></span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;%s\n&quot;</span>, password); <span class="comment">// 哈哈，这就是本题的f l a g，自己运行一下交上去吧！</span></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>可以拿到flag<br><code>moectf&#123;r3v3rs3_1s_a_long_long_way_to_explore&#125;</code></p><h1 id="Xor"><a href="#Xor" class="headerlink" title="Xor"></a>Xor</h1><p>拿到附件后发现是Windows下的可执行文件(.exe)，我们载入IDA后可以观察到反编译的代码</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __fastcall <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  FILE *v3; <span class="comment">// rax</span></span><br><span class="line">  __int64 i; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">char</span> Buffer[<span class="number">16</span>]; <span class="comment">// [rsp+20h] [rbp-48h] BYREF</span></span><br><span class="line">  __int128 v7; <span class="comment">// [rsp+30h] [rbp-38h]</span></span><br><span class="line">  __int64 v8; <span class="comment">// [rsp+40h] [rbp-28h]</span></span><br><span class="line">  <span class="type">int</span> v9; <span class="comment">// [rsp+48h] [rbp-20h]</span></span><br><span class="line">  <span class="type">char</span> v10; <span class="comment">// [rsp+4Ch] [rbp-1Ch]</span></span><br><span class="line"></span><br><span class="line">  sub_140001010(<span class="string">&quot;Input Your Flag moectf&#123;xxx&#125; (len = 45) \n&quot;</span>);</span><br><span class="line">  v8 = <span class="number">0LL</span>;</span><br><span class="line">  *(_OWORD *)Buffer = <span class="number">0LL</span>;</span><br><span class="line">  v9 = <span class="number">0</span>;</span><br><span class="line">  v7 = <span class="number">0LL</span>;</span><br><span class="line">  v10 = <span class="number">0</span>;</span><br><span class="line">  v3 = _acrt_iob_func(<span class="number">0</span>);</span><br><span class="line">  fgets(Buffer, <span class="number">45</span>, v3);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0LL</span>; i &lt; <span class="number">44</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( ((<span class="type">unsigned</span> __int8)Buffer[i] ^ <span class="number">0x24</span>) != byte_1400022B8[i] )</span><br><span class="line">    &#123;</span><br><span class="line">      sub_140001010(<span class="string">&quot;FLAG is wrong!\n&quot;</span>);</span><br><span class="line">      system(<span class="string">&quot;pause&quot;</span>);</span><br><span class="line">      <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  sub_140001010(<span class="string">&quot;FLAG is RIGHT!\n&quot;</span>);</span><br><span class="line">  system(<span class="string">&quot;pause&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>我们注意到<code>char Buffer[16]; // [rsp+20h] [rbp-48h] BYREF</code>这个变量的大小是16，但是下面<code>fgets(Buffer, 45, v3);</code>的大小是45，可以推测这个变量的大小反编译错误了。我们按y改成45，再刷新看代码。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __fastcall <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  FILE *v3; <span class="comment">// rax</span></span><br><span class="line">  __int64 i; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">char</span> Buffer[<span class="number">48</span>]; <span class="comment">// [rsp+20h] [rbp-48h] BYREF</span></span><br><span class="line"></span><br><span class="line">  sub_140001010(<span class="string">&quot;Input Your Flag moectf&#123;xxx&#125; (len = 45) \n&quot;</span>);</span><br><span class="line">  <span class="built_in">memset</span>(Buffer, <span class="number">0</span>, <span class="number">45</span>);</span><br><span class="line">  v3 = _acrt_iob_func(<span class="number">0</span>);</span><br><span class="line">  fgets(Buffer, <span class="number">45</span>, v3);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0LL</span>; i &lt; <span class="number">44</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( ((<span class="type">unsigned</span> __int8)Buffer[i] ^ <span class="number">0x24</span>) != byte_1400022B8[i] )</span><br><span class="line">    &#123;</span><br><span class="line">      sub_140001010(<span class="string">&quot;FLAG is wrong!\n&quot;</span>);</span><br><span class="line">      system(<span class="string">&quot;pause&quot;</span>);</span><br><span class="line">      <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  sub_140001010(<span class="string">&quot;FLAG is RIGHT!\n&quot;</span>);</span><br><span class="line">  system(<span class="string">&quot;pause&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>可以发现，下面那些由于反编译错误的变量消失了，这时我们可以看到程序主逻辑是异或0x24并且逐个与<code>byte_1400022B8</code>进行比较，我们双击byte_1400022B8。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">.rdata:<span class="number">00000001400022B</span>8 ; _BYTE byte_1400022B8[<span class="number">56</span>]</span><br><span class="line">.rdata:<span class="number">00000001400022B</span>8 byte_1400022B8  db <span class="number">49</span>h, <span class="number">4B</span>h, <span class="number">41</span>h, <span class="number">47</span>h, <span class="number">50</span>h, <span class="number">42</span>h, <span class="number">5F</span>h, <span class="number">41</span>h, <span class="number">1</span>Ch, <span class="number">16</span>h, <span class="number">46</span>h</span><br><span class="line">.rdata:<span class="number">00000001400022B</span>8                                         ; DATA XREF: main+<span class="number">58</span>↑o</span><br><span class="line">.rdata:<span class="number">00000001400022</span>C3                 db <span class="number">10</span>h, <span class="number">13</span>h, <span class="number">1</span>Ch, <span class="number">40</span>h, <span class="number">9</span>, <span class="number">42</span>h, <span class="number">16</span>h, <span class="number">46</span>h, <span class="number">1</span>Ch, <span class="number">9</span>, <span class="number">2</span> dup(<span class="number">10</span>h)</span><br><span class="line">.rdata:<span class="number">00000001400022</span>CF                 db <span class="number">42</span>h, <span class="number">1</span>Dh, <span class="number">9</span>, <span class="number">46</span>h, <span class="number">15</span>h, <span class="number">2</span> dup(<span class="number">14</span>h), <span class="number">9</span>, <span class="number">17</span>h, <span class="number">16</span>h, <span class="number">14</span>h</span><br><span class="line">.rdata:<span class="number">00000001400022</span>DA                 db <span class="number">41</span>h, <span class="number">2</span> dup(<span class="number">40</span>h), <span class="number">16</span>h, <span class="number">14</span>h, <span class="number">47</span>h, <span class="number">12</span>h, <span class="number">40</span>h, <span class="number">14</span>h, <span class="number">59</span>h</span><br><span class="line">.rdata:<span class="number">00000001400022E4</span>                 db <span class="number">0</span>Ch <span class="title function_">dup</span><span class="params">(<span class="number">0</span>)</span></span><br></pre></td></tr></table></figure><p>发现这种形式，不方便抄出来，所以我们按U，他就会变成Undefined，再右键选中所有的，Convert拿出来成Python的List。<br>所以我们很容易写出EXP（解题脚本）。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">enc = [<span class="number">0x49</span>, <span class="number">0x4B</span>, <span class="number">0x41</span>, <span class="number">0x47</span>, <span class="number">0x50</span>, <span class="number">0x42</span>, <span class="number">0x5F</span>, <span class="number">0x41</span>, <span class="number">0x1C</span>, <span class="number">0x16</span>, <span class="number">0x46</span>, <span class="number">0x10</span>, <span class="number">0x13</span>, <span class="number">0x1C</span>, <span class="number">0x40</span>, <span class="number">0x09</span>, <span class="number">0x42</span>, <span class="number">0x16</span>, <span class="number">0x46</span>, <span class="number">0x1C</span>, <span class="number">0x09</span>, <span class="number">0x10</span>, <span class="number">0x10</span>, <span class="number">0x42</span>, <span class="number">0x1D</span>, <span class="number">0x09</span>, <span class="number">0x46</span>, <span class="number">0x15</span>, <span class="number">0x14</span>, <span class="number">0x14</span>, <span class="number">0x09</span>, <span class="number">0x17</span>, <span class="number">0x16</span>, <span class="number">0x14</span>, <span class="number">0x41</span>, <span class="number">0x40</span>, <span class="number">0x40</span>, <span class="number">0x16</span>, <span class="number">0x14</span>, <span class="number">0x47</span>, <span class="number">0x12</span>, <span class="number">0x40</span>, <span class="number">0x14</span>, <span class="number">0x59</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> enc:</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">chr</span>(i ^ <span class="number">0x24</span>), end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    <span class="comment"># moectf&#123;e82b478d-f2b8-44f9-b100-320edd20c6d0&#125;</span></span><br></pre></td></tr></table></figure><p>所以Flag：<code>moectf&#123;e82b478d-f2b8-44f9-b100-320edd20c6d0&#125;</code></p><h1 id="upx"><a href="#upx" class="headerlink" title="upx"></a>upx</h1><p>github下载UPX，然后用命令行启动，upx -d，就可以解压程序，再拖入IDA，即可查看正确的flag。<br><code>moectf&#123;ec5390dd-f8cf-4b02-bc29-3bb0c5604c29&#125;</code></p><h1 id="dynamic"><a href="#dynamic" class="headerlink" title="dynamic"></a>dynamic</h1><p>程序要求我们进行动态调试，我们先载入IDA进行分析。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __fastcall <span class="title function_">main_0</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> *v3; <span class="comment">// rdi</span></span><br><span class="line">  __int64 i; <span class="comment">// rcx</span></span><br><span class="line">  <span class="type">char</span> v6; <span class="comment">// [rsp+20h] [rbp+0h] BYREF</span></span><br><span class="line">  _BYTE v7[<span class="number">80</span>]; <span class="comment">// [rsp+28h] [rbp+8h] BYREF</span></span><br><span class="line">  _DWORD v8[<span class="number">56</span>]; <span class="comment">// [rsp+78h] [rbp+58h] BYREF</span></span><br><span class="line"></span><br><span class="line">  v3 = &amp;v6;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">34LL</span>; i; --i )</span><br><span class="line">  &#123;</span><br><span class="line">    *(_DWORD *)v3 = <span class="number">-858993460</span>;</span><br><span class="line">    v3 += <span class="number">4</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  j___CheckForDebuggerJustMyCode(&amp;unk_140022067, argv, envp);</span><br><span class="line">  v7[<span class="number">0</span>] = <span class="number">-94</span>;</span><br><span class="line">  v7[<span class="number">1</span>] = <span class="number">5</span>;</span><br><span class="line">  v7[<span class="number">2</span>] = <span class="number">105</span>;</span><br><span class="line">  v7[<span class="number">3</span>] = <span class="number">-117</span>;</span><br><span class="line">  v7[<span class="number">4</span>] = <span class="number">-38</span>;</span><br><span class="line">  v7[<span class="number">5</span>] = <span class="number">23</span>;</span><br><span class="line">  v7[<span class="number">6</span>] = <span class="number">5</span>;</span><br><span class="line">  v7[<span class="number">7</span>] = <span class="number">-31</span>;</span><br><span class="line">  v7[<span class="number">8</span>] = <span class="number">-36</span>;</span><br><span class="line">  v7[<span class="number">9</span>] = <span class="number">-52</span>;</span><br><span class="line">  v7[<span class="number">10</span>] = <span class="number">-52</span>;</span><br><span class="line">  v7[<span class="number">11</span>] = <span class="number">-63</span>;</span><br><span class="line">  v7[<span class="number">12</span>] = <span class="number">100</span>;</span><br><span class="line">  v7[<span class="number">13</span>] = <span class="number">116</span>;</span><br><span class="line">  v7[<span class="number">14</span>] = <span class="number">-6</span>;</span><br><span class="line">  v7[<span class="number">15</span>] = <span class="number">80</span>;</span><br><span class="line">  v7[<span class="number">16</span>] = <span class="number">-43</span>;</span><br><span class="line">  v7[<span class="number">17</span>] = <span class="number">-95</span>;</span><br><span class="line">  v7[<span class="number">18</span>] = <span class="number">-102</span>;</span><br><span class="line">  v7[<span class="number">19</span>] = <span class="number">-84</span>;</span><br><span class="line">  v7[<span class="number">20</span>] = <span class="number">-36</span>;</span><br><span class="line">  v7[<span class="number">21</span>] = <span class="number">-34</span>;</span><br><span class="line">  v7[<span class="number">22</span>] = <span class="number">100</span>;</span><br><span class="line">  v7[<span class="number">23</span>] = <span class="number">-65</span>;</span><br><span class="line">  v7[<span class="number">24</span>] = <span class="number">-108</span>;</span><br><span class="line">  v7[<span class="number">25</span>] = <span class="number">45</span>;</span><br><span class="line">  v7[<span class="number">26</span>] = <span class="number">35</span>;</span><br><span class="line">  v7[<span class="number">27</span>] = <span class="number">-13</span>;</span><br><span class="line">  v7[<span class="number">28</span>] = <span class="number">1</span>;</span><br><span class="line">  v7[<span class="number">29</span>] = <span class="number">-43</span>;</span><br><span class="line">  v7[<span class="number">30</span>] = <span class="number">98</span>;</span><br><span class="line">  v7[<span class="number">31</span>] = <span class="number">-56</span>;</span><br><span class="line">  v7[<span class="number">32</span>] = <span class="number">-22</span>;</span><br><span class="line">  v7[<span class="number">33</span>] = <span class="number">-83</span>;</span><br><span class="line">  v7[<span class="number">34</span>] = <span class="number">-46</span>;</span><br><span class="line">  v7[<span class="number">35</span>] = <span class="number">-42</span>;</span><br><span class="line">  v7[<span class="number">36</span>] = <span class="number">42</span>;</span><br><span class="line">  v7[<span class="number">37</span>] = <span class="number">80</span>;</span><br><span class="line">  v7[<span class="number">38</span>] = <span class="number">94</span>;</span><br><span class="line">  v7[<span class="number">39</span>] = <span class="number">107</span>;</span><br><span class="line">  v7[<span class="number">40</span>] = <span class="number">115</span>;</span><br><span class="line">  v7[<span class="number">41</span>] = <span class="number">12</span>;</span><br><span class="line">  v7[<span class="number">42</span>] = <span class="number">-3</span>;</span><br><span class="line">  v7[<span class="number">43</span>] = <span class="number">-116</span>;</span><br><span class="line">  v7[<span class="number">44</span>] = <span class="number">61</span>;</span><br><span class="line">  v7[<span class="number">45</span>] = <span class="number">56</span>;</span><br><span class="line">  v7[<span class="number">46</span>] = <span class="number">61</span>;</span><br><span class="line">  v7[<span class="number">47</span>] = <span class="number">-47</span>;</span><br><span class="line">  v8[<span class="number">0</span>] = <span class="number">-889275714</span>;</span><br><span class="line">  v8[<span class="number">1</span>] = <span class="number">-559038242</span>;</span><br><span class="line">  v8[<span class="number">2</span>] = <span class="number">866566</span>;</span><br><span class="line">  v8[<span class="number">3</span>] = <span class="number">1131796</span>;</span><br><span class="line">  sub_14001129E(v7, <span class="number">4294967284LL</span>, v8);</span><br><span class="line">  sub_1400113D4(<span class="string">&quot;What happened to my Flag?\n&quot;</span>);</span><br><span class="line">  sub_14001129E(v7, <span class="number">12LL</span>, v8);</span><br><span class="line">  sub_1400113D4(<span class="string">&quot;Your Flag has REencrypted.&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>可以发现，<code>What happened to my Flag?</code>上下都有一个sub_14001129E的函数，我们对4294967284LL进行分析，可以知道它其实是-12(<code>0xFFFFFFF4LL</code>)，再点进去，可以观察到如下代码</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">sub_140011820</span><span class="params">(<span class="type">int</span> *a1, __int64 a2, __int64 a3)</span></span><br><span class="line">&#123;</span><br><span class="line">  __int64 result; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v4; <span class="comment">// [rsp+24h] [rbp+4h]</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v5; <span class="comment">// [rsp+24h] [rbp+4h]</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v6; <span class="comment">// [rsp+44h] [rbp+24h]</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v7; <span class="comment">// [rsp+44h] [rbp+24h]</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v8; <span class="comment">// [rsp+44h] [rbp+24h]</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v9; <span class="comment">// [rsp+64h] [rbp+44h]</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v10; <span class="comment">// [rsp+64h] [rbp+44h]</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> j; <span class="comment">// [rsp+84h] [rbp+64h]</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+84h] [rbp+64h]</span></span><br><span class="line">  <span class="type">int</span> v13; <span class="comment">// [rsp+A4h] [rbp+84h]</span></span><br><span class="line">  <span class="type">int</span> v14; <span class="comment">// [rsp+A4h] [rbp+84h]</span></span><br><span class="line">  <span class="type">int</span> v15; <span class="comment">// [rsp+C4h] [rbp+A4h]</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v16; <span class="comment">// [rsp+C4h] [rbp+A4h]</span></span><br><span class="line">  <span class="type">int</span> v17; <span class="comment">// [rsp+194h] [rbp+174h]</span></span><br><span class="line">  <span class="type">int</span> v18; <span class="comment">// [rsp+194h] [rbp+174h]</span></span><br><span class="line">  <span class="type">int</span> v19; <span class="comment">// [rsp+194h] [rbp+174h]</span></span><br><span class="line">  <span class="type">int</span> v20; <span class="comment">// [rsp+194h] [rbp+174h]</span></span><br><span class="line">  <span class="type">int</span> v22; <span class="comment">// [rsp+1C8h] [rbp+1A8h]</span></span><br><span class="line">  <span class="type">int</span> v23; <span class="comment">// [rsp+1C8h] [rbp+1A8h]</span></span><br><span class="line"></span><br><span class="line">  v22 = a2;</span><br><span class="line">  result = j___CheckForDebuggerJustMyCode(&amp;unk_140022067, a2, a3);</span><br><span class="line">  <span class="keyword">if</span> ( v22 &lt;= <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( v22 &lt; <span class="number">-1</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      v23 = -v22;</span><br><span class="line">      v14 = <span class="number">52</span> / v23 + <span class="number">6</span>;</span><br><span class="line">      v10 = <span class="number">1131796</span> * v14;</span><br><span class="line">      v5 = *a1;</span><br><span class="line">      <span class="keyword">do</span></span><br><span class="line">      &#123;</span><br><span class="line">        v16 = (v10 &gt;&gt; <span class="number">2</span>) &amp; <span class="number">3</span>;</span><br><span class="line">        <span class="keyword">for</span> ( i = v23 - <span class="number">1</span>; i; --i )</span><br><span class="line">        &#123;</span><br><span class="line">          v7 = a1[i - <span class="number">1</span>];</span><br><span class="line">          v19 = a1[i]</span><br><span class="line">              - (((v7 ^ *(_DWORD *)(a3 + <span class="number">4LL</span> * (v16 ^ i &amp; <span class="number">3</span>))) + (v5 ^ v10)) ^ (((<span class="number">16</span> * v7) ^ (v5 &gt;&gt; <span class="number">3</span>))</span><br><span class="line">                                                                              + ((<span class="number">4</span> * v5) ^ (v7 &gt;&gt; <span class="number">5</span>))));</span><br><span class="line">          a1[i] = v19;</span><br><span class="line">          v5 = v19;</span><br><span class="line">        &#125;</span><br><span class="line">        v8 = a1[v23 - <span class="number">1</span>];</span><br><span class="line">        v20 = *a1</span><br><span class="line">            - (((v8 ^ *(_DWORD *)(a3 + <span class="number">4LL</span> * v16)) + (v5 ^ v10)) ^ (((<span class="number">16</span> * v8) ^ (v5 &gt;&gt; <span class="number">3</span>)) + ((<span class="number">4</span> * v5) ^ (v8 &gt;&gt; <span class="number">5</span>))));</span><br><span class="line">        *a1 = v20;</span><br><span class="line">        v5 = v20;</span><br><span class="line">        v10 -= <span class="number">1131796</span>;</span><br><span class="line">        result = (<span class="type">unsigned</span> <span class="type">int</span>)--v14;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">while</span> ( v14 );</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    v13 = <span class="number">52</span> / v22 + <span class="number">6</span>;</span><br><span class="line">    v9 = <span class="number">0</span>;</span><br><span class="line">    v6 = a1[v22 - <span class="number">1</span>];</span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">    &#123;</span><br><span class="line">      v9 += <span class="number">1131796</span>;</span><br><span class="line">      v15 = (v9 &gt;&gt; <span class="number">2</span>) &amp; <span class="number">3</span>;</span><br><span class="line">      <span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt; v22 - <span class="number">1</span>; ++j )</span><br><span class="line">      &#123;</span><br><span class="line">        v4 = a1[j + <span class="number">1</span>];</span><br><span class="line">        v17 = (((v6 ^ *(_DWORD *)(a3 + <span class="number">4LL</span> * (v15 ^ j &amp; <span class="number">3</span>))) + (v4 ^ v9)) ^ (((<span class="number">16</span> * v6) ^ (v4 &gt;&gt; <span class="number">3</span>))</span><br><span class="line">                                                                           + ((<span class="number">4</span> * v4) ^ (v6 &gt;&gt; <span class="number">5</span>))))</span><br><span class="line">            + a1[j];</span><br><span class="line">        a1[j] = v17;</span><br><span class="line">        v6 = v17;</span><br><span class="line">      &#125;</span><br><span class="line">      v18 = (((v6 ^ *(_DWORD *)(a3 + <span class="number">4LL</span> * (v15 ^ j &amp; <span class="number">3</span>))) + (*a1 ^ v9)) ^ (((<span class="number">16</span> * v6) ^ ((<span class="type">unsigned</span> <span class="type">int</span>)*a1 &gt;&gt; <span class="number">3</span>))</span><br><span class="line">                                                                          + ((<span class="number">4</span> * *a1) ^ (v6 &gt;&gt; <span class="number">5</span>))))</span><br><span class="line">          + a1[v22 - <span class="number">1</span>];</span><br><span class="line">      a1[v22 - <span class="number">1</span>] = v18;</span><br><span class="line">      v6 = v18;</span><br><span class="line">      result = (<span class="type">unsigned</span> <span class="type">int</span>)--v13;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> ( v13 );</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这其实是一个标准的XXTEA，当n&gt;1的时候（也就是+12）的时候，是加密，-12就是解密。<br>所以这个程序其实在做一个事情：把内置的flag进行解密后又马上加密回去，所以我们只需要动态调试，找到解密后的flag即可。<br>最后我们附上这个题目的c语言源码</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdint.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MX (((z&gt;&gt;5^y<span class="string">&lt;&lt;2) + (y&gt;</span>&gt;3^z&lt;&lt;4)) ^ ((sum^y) + (key[(p&amp;3)^e] ^ z)))</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DELTA 0x114514</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">ppp</span><span class="params">(<span class="type">uint32_t</span>* v, <span class="type">int</span> n, <span class="type">uint32_t</span> <span class="type">const</span> key[<span class="number">4</span>])</span></span><br><span class="line">&#123;</span><br><span class="line">        <span class="type">uint32_t</span> y, z, sum;</span><br><span class="line">        <span class="type">unsigned</span> p, rounds, e;</span><br><span class="line">        <span class="keyword">if</span> (n &gt; <span class="number">1</span>)            <span class="comment">/* Coding Part */</span></span><br><span class="line">        &#123;</span><br><span class="line">                rounds = <span class="number">6</span> + <span class="number">52</span> / n;</span><br><span class="line">                sum = <span class="number">0</span>;</span><br><span class="line">                z = v[n - <span class="number">1</span>];</span><br><span class="line">                <span class="keyword">do</span></span><br><span class="line">                &#123;</span><br><span class="line">                        sum += DELTA;</span><br><span class="line">                        e = (sum &gt;&gt; <span class="number">2</span>) &amp; <span class="number">3</span>;</span><br><span class="line">                        <span class="keyword">for</span> (p = <span class="number">0</span>; p &lt; n - <span class="number">1</span>; p++)</span><br><span class="line">                        &#123;</span><br><span class="line">                                y = v[p + <span class="number">1</span>];</span><br><span class="line">                                z = v[p] += MX;</span><br><span class="line">                        &#125;</span><br><span class="line">                        y = v[<span class="number">0</span>];</span><br><span class="line">                        z = v[n - <span class="number">1</span>] += MX;</span><br><span class="line">                &#125; <span class="keyword">while</span> (--rounds);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (n &lt; <span class="number">-1</span>)      <span class="comment">/* Decoding Part */</span></span><br><span class="line">        &#123;</span><br><span class="line">                n = -n;</span><br><span class="line">                rounds = <span class="number">6</span> + <span class="number">52</span> / n;</span><br><span class="line">                sum = rounds * DELTA;</span><br><span class="line">                y = v[<span class="number">0</span>];</span><br><span class="line">                <span class="keyword">do</span></span><br><span class="line">                &#123;</span><br><span class="line">                        e = (sum &gt;&gt; <span class="number">2</span>) &amp; <span class="number">3</span>;</span><br><span class="line">                        <span class="keyword">for</span> (p = n - <span class="number">1</span>; p &gt; <span class="number">0</span>; p--)</span><br><span class="line">                        &#123;</span><br><span class="line">                                z = v[p - <span class="number">1</span>];</span><br><span class="line">                                y = v[p] -= MX;</span><br><span class="line">                        &#125;</span><br><span class="line">                        z = v[n - <span class="number">1</span>];</span><br><span class="line">                        y = v[<span class="number">0</span>] -= MX;</span><br><span class="line">                        sum -= DELTA;</span><br><span class="line">                &#125; <span class="keyword">while</span> (--rounds);</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">        <span class="type">char</span> v[] = &#123; <span class="number">0xa2</span>,<span class="number">0x05</span>,<span class="number">0x69</span>,<span class="number">0x8b</span>,<span class="number">0xda</span>,<span class="number">0x17</span>,<span class="number">0x05</span>,<span class="number">0xe1</span>,<span class="number">0xdc</span>,<span class="number">0xcc</span>,<span class="number">0xcc</span>,<span class="number">0xc1</span>,<span class="number">0x64</span>,<span class="number">0x74</span>,<span class="number">0xfa</span>,<span class="number">0x50</span>,<span class="number">0xd5</span>,<span class="number">0xa1</span>,<span class="number">0x9a</span>,<span class="number">0xac</span>,<span class="number">0xdc</span>,<span class="number">0xde</span>,<span class="number">0x64</span>,<span class="number">0xbf</span>,<span class="number">0x94</span>,<span class="number">0x2d</span>,<span class="number">0x23</span>,<span class="number">0xf3</span>,<span class="number">0x01</span>,<span class="number">0xd5</span>,<span class="number">0x62</span>,<span class="number">0xc8</span>,<span class="number">0xea</span>,<span class="number">0xad</span>,<span class="number">0xd2</span>,<span class="number">0xd6</span>,<span class="number">0x2a</span>,<span class="number">0x50</span>,<span class="number">0x5e</span>,<span class="number">0x6b</span>,<span class="number">0x73</span>,<span class="number">0x0c</span>,<span class="number">0xfd</span>,<span class="number">0x8c</span>,<span class="number">0x3d</span>,<span class="number">0x38</span>,<span class="number">0x3d</span>,<span class="number">0xd1</span> &#125;;</span><br><span class="line">        <span class="type">uint32_t</span> k[] = &#123; <span class="number">0xcafebabe</span> , <span class="number">0xdeadc0de</span>, <span class="number">0xd3906</span>, <span class="number">0x114514</span> &#125;;</span><br><span class="line">        ppp((<span class="type">uint32_t</span>*)v, <span class="number">-12</span>, k);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;What happened to my Flag?&quot;</span>);</span><br><span class="line">        ppp((<span class="type">uint32_t</span>*)v, <span class="number">12</span>, k);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Your Flag has encrypted.&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><code>moectf&#123;18d4c944-947c-4808-9536-c7d34d6b3827&#125;</code></p><h1 id="Reverse-问卷-Bye-MoeCTF2024"><a href="#Reverse-问卷-Bye-MoeCTF2024" class="headerlink" title="Reverse 问卷: Bye, MoeCTF2024"></a>Reverse 问卷: Bye, MoeCTF2024</h1><p>填写问卷即可获得flag。<br><code>moectf&#123;Thank_You_FOR_Playing_Reverse_Challenges&#125;</code></p><h1 id="upx-revenge"><a href="#upx-revenge" class="headerlink" title="upx-revenge"></a>upx-revenge</h1><p>解法1：这个程序直接upx -d是显示无法进行解压的，原因是UPX解压的时候会检测程序段名称是否为UPX0\UPX1这类的，但是我改成了vmp0，导致无法直接解压，我们使用010Editor打开后更改这个字符串也就可以解密了。<br>解法2：直接拖入X64dbg进行动态调试，调试起来后直接搜索全局字符串，就可以找到flag。<br>解法3：CheatEngine进行字符串搜索。<br><code>moectf&#123;554ea35c-a1bb-4d8f-a323-bd697564bf27&#125;</code></p><h1 id="XTEA"><a href="#XTEA" class="headerlink" title="XTEA"></a>XTEA</h1><p>我们拿到文件后拖入IDA，可以获得以下代码</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> __fastcall <span class="title">main_0</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">char</span> *v3; <span class="comment">// rdi</span></span><br><span class="line">  __int64 i; <span class="comment">// rcx</span></span><br><span class="line">  __int64 v5; <span class="comment">// rax</span></span><br><span class="line">  __int64 v6; <span class="comment">// rax</span></span><br><span class="line">  __int64 v7; <span class="comment">// rax</span></span><br><span class="line">  __int64 v8; <span class="comment">// rax</span></span><br><span class="line">  __int64 v10; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">char</span> v11; <span class="comment">// [rsp+20h] [rbp+0h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v12; <span class="comment">// [rsp+24h] [rbp+4h]</span></span><br><span class="line">  <span class="type">char</span> Str[<span class="number">48</span>]; <span class="comment">// [rsp+48h] [rbp+28h] BYREF</span></span><br><span class="line">  _DWORD v14[<span class="number">12</span>]; <span class="comment">// [rsp+78h] [rbp+58h] BYREF</span></span><br><span class="line">  _BYTE Src[<span class="number">32</span>]; <span class="comment">// [rsp+A8h] [rbp+88h] BYREF</span></span><br><span class="line">  _BYTE v16[<span class="number">28</span>]; <span class="comment">// [rsp+C8h] [rbp+A8h] BYREF</span></span><br><span class="line">  <span class="type">int</span> j; <span class="comment">// [rsp+E4h] [rbp+C4h]</span></span><br><span class="line"></span><br><span class="line">  v3 = &amp;v11;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">58LL</span>; i; --i )</span><br><span class="line">  &#123;</span><br><span class="line">    *(_DWORD *)v3 = <span class="number">-858993460</span>;</span><br><span class="line">    v3 += <span class="number">4</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">j___CheckForDebuggerJustMyCode</span>(&amp;unk_140028066, argv, envp);</span><br><span class="line">  v12 = <span class="number">32</span>;</span><br><span class="line">  <span class="built_in">memset</span>(Str, <span class="number">0</span>, <span class="number">0xD</span>uLL);</span><br><span class="line">  v5 = <span class="built_in">sub_1400110AA</span>(std::cout, <span class="string">&quot;please input key:&quot;</span>);</span><br><span class="line">  std::ostream::<span class="keyword">operator</span>&lt;&lt;(v5, sub_140011046);</span><br><span class="line">  <span class="built_in">sub_14001153C</span>(std::cin, Str);</span><br><span class="line">  v14[<span class="number">0</span>] = <span class="number">2</span>;</span><br><span class="line">  v14[<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">  v14[<span class="number">2</span>] = <span class="number">2</span>;</span><br><span class="line">  v14[<span class="number">3</span>] = <span class="number">4</span>;</span><br><span class="line">  v6 = <span class="built_in">sub_1400110AA</span>(std::cout, <span class="string">&quot;let me check your key&quot;</span>);</span><br><span class="line">  std::ostream::<span class="keyword">operator</span>&lt;&lt;(v6, sub_140011046);</span><br><span class="line">  v7 = <span class="built_in">sub_1400110AA</span>(std::cout, <span class="string">&quot;emmm&quot;</span>);</span><br><span class="line">  std::ostream::<span class="keyword">operator</span>&lt;&lt;(v7, sub_140011046);</span><br><span class="line">  <span class="keyword">if</span> ( <span class="built_in">j_strlen</span>(Str) == <span class="number">12</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">memset</span>(v16, <span class="number">0</span>, <span class="number">8uLL</span>);</span><br><span class="line">    <span class="built_in">j_memcpy</span>(Src, Str, <span class="number">8uLL</span>);</span><br><span class="line">    <span class="built_in">sub_14001119F</span>(v12, Src, v14);</span><br><span class="line">    <span class="built_in">j_memcpy</span>(Str, Src, <span class="number">8uLL</span>);</span><br><span class="line">    <span class="built_in">j_memcpy</span>(v16, &amp;Str[<span class="number">4</span>], <span class="number">8uLL</span>);</span><br><span class="line">    <span class="built_in">sub_14001119F</span>(v12, v16, v14);</span><br><span class="line">    <span class="built_in">j_memcpy</span>(&amp;Str[<span class="number">4</span>], v16, <span class="number">8uLL</span>);</span><br><span class="line">    <span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt; <span class="number">12</span>; ++j )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( Str[j] != byte_140022000[j] )</span><br><span class="line">        <span class="keyword">goto</span> LABEL_5;</span><br><span class="line">    &#125;</span><br><span class="line">    v10 = <span class="built_in">sub_1400110AA</span>(std::cout, <span class="string">&quot;Correct key! Your flag is moectf&#123;your key&#125;&quot;</span>);</span><br><span class="line">    std::ostream::<span class="keyword">operator</span>&lt;&lt;(v10, sub_140011046);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">LABEL_5:</span><br><span class="line">    v8 = <span class="built_in">sub_1400110AA</span>(std::cout, <span class="string">&quot;XD,wrong!&quot;</span>);</span><br><span class="line">    std::ostream::<span class="keyword">operator</span>&lt;&lt;(v8, sub_140011046);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>可以观察到，<code>sub_14001119F</code>为加密函数，因为在memcpy之后进行的它，并且它的结果又覆盖回去了，最后与正确的结果进行对比。<br>以下是XTEA的加密</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">sub_1400148C0</span><span class="params">(<span class="type">unsigned</span> <span class="type">int</span> a1, <span class="type">unsigned</span> <span class="type">int</span> *a2, __int64 a3)</span></span><br><span class="line">&#123;</span><br><span class="line">  __int64 result; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> i; <span class="comment">// [rsp+24h] [rbp+4h]</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v5; <span class="comment">// [rsp+44h] [rbp+24h]</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v6; <span class="comment">// [rsp+64h] [rbp+44h]</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v7; <span class="comment">// [rsp+84h] [rbp+64h]</span></span><br><span class="line"></span><br><span class="line">  j___CheckForDebuggerJustMyCode(&amp;unk_140028066, a2, a3);</span><br><span class="line">  v5 = *a2;</span><br><span class="line">  v6 = a2[<span class="number">1</span>];</span><br><span class="line">  v7 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; a1; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    v5 += (*(_DWORD *)(a3 + <span class="number">4LL</span> * (v7 &amp; <span class="number">3</span>)) + v7) ^ (v6 + ((v6 &gt;&gt; <span class="number">5</span>) ^ (<span class="number">16</span> * v6)));</span><br><span class="line">    v7 -= <span class="number">855655493</span>;</span><br><span class="line">    v6 += (*(_DWORD *)(a3 + <span class="number">4LL</span> * ((v7 &gt;&gt; <span class="number">11</span>) &amp; <span class="number">3</span>)) + v7) ^ (v5 + ((v5 &gt;&gt; <span class="number">5</span>) ^ (<span class="number">16</span> * v5)));</span><br><span class="line">  &#125;</span><br><span class="line">  *a2 = v5;</span><br><span class="line">  result = <span class="number">4LL</span>;</span><br><span class="line">  a2[<span class="number">1</span>] = v6;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>我们可以观察到IDA存在一些反编译错误，比如a3是一个DWORD型的指针（在main函数中，这个数组被赋值为了2 0 2 4）。我们进行修改，并且我们发现第一个参数是rounds(循环次数)，第二个参数是Source，修改后的结果如下：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">sub_1400148C0</span><span class="params">(<span class="type">unsigned</span> <span class="type">int</span> rounds, <span class="type">unsigned</span> <span class="type">int</span> *source, _DWORD *key)</span></span><br><span class="line">&#123;</span><br><span class="line">  __int64 result; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> i; <span class="comment">// [rsp+24h] [rbp+4h]</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v5; <span class="comment">// [rsp+44h] [rbp+24h]</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v6; <span class="comment">// [rsp+64h] [rbp+44h]</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v7; <span class="comment">// [rsp+84h] [rbp+64h]</span></span><br><span class="line"></span><br><span class="line">  j___CheckForDebuggerJustMyCode(&amp;unk_140028066, source, key);</span><br><span class="line">  v5 = *source;</span><br><span class="line">  v6 = source[<span class="number">1</span>];</span><br><span class="line">  v7 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; rounds; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    v5 += (key[v7 &amp; <span class="number">3</span>] + v7) ^ (v6 + ((v6 &gt;&gt; <span class="number">5</span>) ^ (<span class="number">16</span> * v6)));</span><br><span class="line">    v7 -= <span class="number">855655493</span>;</span><br><span class="line">    v6 += (key[(v7 &gt;&gt; <span class="number">11</span>) &amp; <span class="number">3</span>] + v7) ^ (v5 + ((v5 &gt;&gt; <span class="number">5</span>) ^ (<span class="number">16</span> * v5)));</span><br><span class="line">  &#125;</span><br><span class="line">  *source = v5;</span><br><span class="line">  result = <span class="number">4LL</span>;</span><br><span class="line">  source[<span class="number">1</span>] = v6;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>于是，我们可以观察到这是一个魔改了Delta的XTEA。<br>我们再返回main函数进行观察</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ( j_strlen(Str) == <span class="number">12</span> )</span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">memset</span>(v16, <span class="number">0</span>, <span class="number">8uLL</span>);</span><br><span class="line">  j_memcpy(Src, Str, <span class="number">8uLL</span>);</span><br><span class="line">  xtea_encrypt(len, (__int64)Src, (__int64)key);</span><br><span class="line">  j_memcpy(Str, Src, <span class="number">8uLL</span>);</span><br><span class="line">  j_memcpy(v16, &amp;Str[<span class="number">4</span>], <span class="number">8uLL</span>);</span><br><span class="line">  xtea_encrypt(len, (__int64)v16, (__int64)key);</span><br><span class="line">  j_memcpy(&amp;Str[<span class="number">4</span>], v16, <span class="number">8uLL</span>);</span><br><span class="line">  <span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt; <span class="number">12</span>; ++j )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( Str[j] != byte_140022000[j] )</span><br><span class="line">      <span class="keyword">goto</span> LABEL_5;</span><br><span class="line">  &#125;</span><br><span class="line">  v10 = sub_1400110AA(<span class="built_in">std</span>::<span class="built_in">cout</span>, <span class="string">&quot;Correct key! Your flag is moectf&#123;your key&#125;&quot;</span>);</span><br><span class="line">  <span class="built_in">std</span>::ostream::operator&lt;&lt;(v10, sub_140011046);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>可以注意到，输入的数据是12字节，也就是flag长度是12字节，首先Str（输入的字符）前8个字节先拷贝到了Src里面，然后Src进行加密，加密了前8个字节（因为Xtea只加密8个字节），然后，memcpy把加密的8个字节再覆盖回Str里面，接下来，Memcpy对str+4拷贝（拷贝后8个字节）到v16中，然后对v16进行加密，所以上面的流程可以等效为：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">xtea_encrypt(len, (__int64)Src, (__int64)key);</span><br><span class="line">xtea_encrypt(len, (__int64)(Src + <span class="number">4</span>), (__int64)key);</span><br></pre></td></tr></table></figure><p>最后和标准结果进行对比。<br>我们写出最后的EXP *(由于Regadgets库暂时不公开，所以我只放出了部分使用到的函数的源码。)</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">enc = [<span class="number">0xA3</span>, <span class="number">0x69</span>, <span class="number">0x96</span>, <span class="number">0x26</span>, <span class="number">0xBD</span>, <span class="number">0x78</span>, <span class="number">0x0B</span>, <span class="number">0x3D</span>, <span class="number">0x9D</span>, <span class="number">0xA5</span>, <span class="number">0x28</span>, <span class="number">0x62</span>]</span><br><span class="line">key = [<span class="number">2</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">4</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 拆分成3个DWORD</span></span><br><span class="line">dw1, dw2, dw3 = byte2dword(enc)</span><br><span class="line"></span><br><span class="line">dw2, dw3 = xtea_decrypt((dw2, dw3), key=key, delta=-<span class="number">0x33004445</span>, rounds=<span class="number">32</span>)</span><br><span class="line">dw1, dw2 = xtea_decrypt((dw1, dw2), key=key, delta=-<span class="number">0x33004445</span>, rounds=<span class="number">32</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(dword2byte([dw1, dw2, dw3]))</span><br><span class="line"><span class="comment"># b&#x27;moectf2024!!&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">from regadgets import *</span></span><br><span class="line"><span class="string">Internal Functions Of Regadgets</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">List</span>, <span class="type">Tuple</span></span><br><span class="line"><span class="keyword">from</span> struct <span class="keyword">import</span> unpack</span><br><span class="line"><span class="keyword">from</span> ctypes <span class="keyword">import</span> c_uint32</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">byte2dword</span>(<span class="params">x: <span class="type">List</span>[<span class="built_in">int</span>]</span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(x) % <span class="number">4</span> != <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">type</span>(x) == <span class="built_in">bytes</span>:</span><br><span class="line">            x += <span class="string">b&#x27;\x00&#x27;</span> * (<span class="number">4</span> - (<span class="built_in">len</span>(x) % <span class="number">4</span>))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            x += [<span class="number">0</span>] * (<span class="number">4</span> - (<span class="built_in">len</span>(x) % <span class="number">4</span>))</span><br><span class="line">    <span class="keyword">return</span> [v[<span class="number">0</span>] <span class="keyword">for</span> v <span class="keyword">in</span> (unpack(<span class="string">&#x27;&lt;I&#x27;</span>, <span class="built_in">bytes</span>(x[i:i+<span class="number">4</span>])) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(x), <span class="number">4</span>))]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">xtea_decrypt</span>(<span class="params"></span></span><br><span class="line"><span class="params">    src: <span class="type">Tuple</span>[<span class="built_in">int</span>, <span class="built_in">int</span>], key: <span class="type">List</span>[<span class="built_in">int</span>], delta: <span class="built_in">int</span> = <span class="number">0x9E3779B9</span>, rounds: <span class="built_in">int</span> = <span class="number">32</span></span></span><br><span class="line"><span class="params"></span>):</span><br><span class="line">    l, r = c_uint32(src[<span class="number">0</span>]), c_uint32(src[<span class="number">1</span>])</span><br><span class="line">    <span class="built_in">sum</span> = c_uint32(delta * rounds)</span><br><span class="line">    k = [c_uint32(key[<span class="number">0</span>]), c_uint32(key[<span class="number">1</span>]), c_uint32(key[<span class="number">2</span>]), c_uint32(key[<span class="number">3</span>])]</span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(rounds):</span><br><span class="line">        r.value -= (((l.value &lt;&lt; <span class="number">4</span>) ^ (l.value &gt;&gt; <span class="number">5</span>)) + l.value) ^ (</span><br><span class="line">            <span class="built_in">sum</span>.value + k[(<span class="built_in">sum</span>.value &gt;&gt; <span class="number">11</span>) &amp; <span class="number">3</span>].value</span><br><span class="line">        )</span><br><span class="line">        <span class="built_in">sum</span>.value -= delta</span><br><span class="line">        l.value -= (((r.value &lt;&lt; <span class="number">4</span>) ^ (r.value &gt;&gt; <span class="number">5</span>)) + r.value) ^ (</span><br><span class="line">            <span class="built_in">sum</span>.value + k[<span class="built_in">sum</span>.value &amp; <span class="number">3</span>].value</span><br><span class="line">        )</span><br><span class="line">    <span class="keyword">return</span> (l.value, r.value)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">dword2byte</span>(<span class="params">x: <span class="type">List</span>[<span class="built_in">int</span>]</span>):</span><br><span class="line">    result = []</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">type</span>(x) == <span class="built_in">int</span>:</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">            result.append((x &gt;&gt; j*<span class="number">8</span>) &amp; <span class="number">0xff</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">bytes</span>(result)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(x)):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">            result.append((x[i] &gt;&gt; j*<span class="number">8</span>) &amp; <span class="number">0xff</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">bytes</span>(result)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">Internal Functions Of Regadgets</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><p>所以最后的flag是<code>moectf&#123;moectf2024!!&#125;</code></p><h1 id="dotNet-d0tN3t"><a href="#dotNet-d0tN3t" class="headerlink" title="dotNet(d0tN3t)"></a>dotNet(d0tN3t)</h1><p>dll（核心代码）拖入dnSpy进行分析</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.Runtime.CompilerServices;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Token: 0x02000002 RID: 2</span></span><br><span class="line">[<span class="meta">CompilerGenerated</span>]</span><br><span class="line"><span class="keyword">internal</span> <span class="keyword">class</span> <span class="title">Program</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// Token: 0x06000001 RID: 1 RVA: 0x00002050 File Offset: 0x00000250</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> &lt;Main&gt;$(<span class="built_in">string</span>[] args)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">byte</span>[] array = <span class="keyword">new</span> <span class="built_in">byte</span>[]</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="number">0xAD</span>,</span><br><span class="line">            .....</span><br><span class="line">            <span class="number">0xA4</span></span><br><span class="line">        &#125;;</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;Input Your Flag:&quot;</span>);</span><br><span class="line">        <span class="built_in">string</span> text = Console.ReadLine();</span><br><span class="line">        <span class="keyword">if</span> (text.Length != array.Length)</span><br><span class="line">        &#123;</span><br><span class="line">            Console.WriteLine(<span class="string">&quot;Flag is WRONG!!!&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">int</span> num = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; array.Length; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> ((<span class="built_in">byte</span>)((<span class="built_in">int</span>)((<span class="built_in">byte</span>)text[i] + <span class="number">0x72</span> ^ <span class="number">0x72</span>) ^ i * i) != array[i])</span><br><span class="line">            &#123;</span><br><span class="line">                num &amp;= <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (num == <span class="number">1</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            Console.WriteLine(<span class="string">&quot;Correct Flag!!!&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;Flag is WRONG!!!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>注意到flag的加密逻辑</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(<span class="built_in">byte</span>)((<span class="built_in">int</span>)((<span class="built_in">byte</span>)text[i] + <span class="number">0x72</span> ^ <span class="number">0x72</span>) ^ i * i)</span><br></pre></td></tr></table></figure><p>写出解密脚本即可</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">byte</span>[] s3cr3t = &#123;<span class="number">173</span>, <span class="number">146</span>, <span class="number">161</span>, <span class="number">174</span>, <span class="number">132</span>, <span class="number">179</span>, <span class="number">187</span>, <span class="number">234</span>, <span class="number">231</span>, <span class="number">244</span>, <span class="number">177</span>, <span class="number">161</span>, <span class="number">65</span>, <span class="number">13</span>, <span class="number">18</span>, <span class="number">12</span>, <span class="number">166</span>, <span class="number">247</span>, <span class="number">229</span>, <span class="number">207</span>, <span class="number">125</span>, <span class="number">109</span>, <span class="number">67</span>, <span class="number">180</span>, <span class="number">230</span>, <span class="number">156</span>, <span class="number">125</span>, <span class="number">127</span>, <span class="number">182</span>, <span class="number">236</span>, <span class="number">105</span>, <span class="number">21</span>, <span class="number">215</span>, <span class="number">148</span>, <span class="number">92</span>, <span class="number">18</span>, <span class="number">199</span>, <span class="number">137</span>, <span class="number">124</span>, <span class="number">38</span>, <span class="number">228</span>, <span class="number">55</span>, <span class="number">62</span>, <span class="number">164</span>&#125;;</span><br><span class="line"><span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; s3cr3t.Length; i++)</span><br><span class="line">&#123;</span><br><span class="line">    Console.Out.Write((<span class="built_in">char</span>)((<span class="built_in">byte</span>)(s3cr3t[i] ^ i*i ^ <span class="number">114</span>) - <span class="number">114</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>同时我们给出python的exp</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">enc = [<span class="number">173</span>, <span class="number">146</span>, <span class="number">161</span>, <span class="number">174</span>, <span class="number">132</span>, <span class="number">179</span>, <span class="number">187</span>, <span class="number">234</span>, <span class="number">231</span>, <span class="number">244</span>, <span class="number">177</span>, <span class="number">161</span>, <span class="number">65</span>, <span class="number">13</span>, <span class="number">18</span>, <span class="number">12</span>, <span class="number">166</span>, <span class="number">247</span>, <span class="number">229</span>, <span class="number">207</span>, <span class="number">125</span>, <span class="number">109</span>, <span class="number">67</span>, <span class="number">180</span>, <span class="number">230</span>, <span class="number">156</span>, <span class="number">125</span>, <span class="number">127</span>, <span class="number">182</span>, <span class="number">236</span>, <span class="number">105</span>, <span class="number">21</span>, <span class="number">215</span>, <span class="number">148</span>, <span class="number">92</span>, <span class="number">18</span>, <span class="number">199</span>, <span class="number">137</span>, <span class="number">124</span>, <span class="number">38</span>, <span class="number">228</span>, <span class="number">55</span>, <span class="number">62</span>, <span class="number">164</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(enc)):</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">chr</span>(((i*i ^ <span class="number">114</span> ^ enc[i]) - <span class="number">114</span>) &amp; <span class="number">0xff</span>), end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># moectf&#123;7ce581d2-b2ab-4ceb-9bbe-435873083db6&#125;</span></span><br></pre></td></tr></table></figure><p>由于很多人用Python写的，但是没有注意到Python的int是无限精度的，所以我们必须限制它在0xff(byte)的范围内，才可以解出flag，不然可能会出现负数的情况。<br>flag: <code>moectf&#123;7ce581d2-b2ab-4ceb-9bbe-435873083db6&#125;</code></p><h1 id="RC4"><a href="#RC4" class="headerlink" title="RC4"></a>RC4</h1><p>拖入IDA，我们发现ida没有找到main函数，这时按Shift+F12，定位String，然后对着String按X（交叉引用），就可以定位到main函数。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">sub_4013F0</span><span class="params">(__int64 a1, <span class="type">const</span> <span class="type">char</span> *a2)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">unsigned</span> __int64 v2; <span class="comment">// rax</span></span><br><span class="line">  __int64 v3; <span class="comment">// rax</span></span><br><span class="line">  __int64 v4; <span class="comment">// rax</span></span><br><span class="line">  __int64 v6; <span class="comment">// [rsp+18h] [rbp-88h]</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+24h] [rbp-7Ch]</span></span><br><span class="line">  __int64 v8; <span class="comment">// [rsp+28h] [rbp-78h]</span></span><br><span class="line">  _BYTE v9[<span class="number">72</span>]; <span class="comment">// [rsp+50h] [rbp-50h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v10; <span class="comment">// [rsp+98h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v10 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  v2 = sub_404748(<span class="string">&quot;A71A68ECD82711CC8C9B16155CD2673E82ADCE75D4BC5756C28A52B86BD6CCF8A4BA722FE05715B92411&quot;</span>);</span><br><span class="line">  v8 = sub_401B01(v2 &gt;&gt; <span class="number">1</span>);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>;</span><br><span class="line">        i &lt; (<span class="type">unsigned</span> __int64)sub_404748(<span class="string">&quot;A71A68ECD82711CC8C9B16155CD2673E82ADCE75D4BC5756C28A52B86BD6CCF8A4BA722FE05715B92411&quot;</span>) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">        ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    sub_40202D((__int64)&amp;aA71a68ecd82711[<span class="number">2</span> * i], (__int64)<span class="string">&quot;%02x&quot;</span>, i + v8);</span><br><span class="line">  &#125;</span><br><span class="line">  sub_401F8D(<span class="string">&quot;Welcome to MoeCTF 2024!&quot;</span>);</span><br><span class="line">  sub_401F8D(<span class="string">&quot;This is a simple RC4 challenge.&quot;</span>);</span><br><span class="line">  sub_401ECD((__int64)<span class="string">&quot;Enter your flag: &quot;</span>);</span><br><span class="line">  sub_401BCC(&amp;unk_40E120);</span><br><span class="line">  sub_401D17(v9, <span class="number">64LL</span>, &amp;unk_40E020);</span><br><span class="line">  v9[sub_40469F(v9, <span class="string">&quot;\n&quot;</span>)] = <span class="number">0</span>;</span><br><span class="line">  v3 = sub_404748(v9);</span><br><span class="line">  v6 = sub_401B01(<span class="number">4</span> * v3);</span><br><span class="line">  sub_401360(<span class="string">&quot;RC4_1s_4w3s0m3&quot;</span>, v9, v6);</span><br><span class="line">  v4 = sub_404748(v9);</span><br><span class="line">  <span class="keyword">if</span> ( (<span class="type">unsigned</span> <span class="type">int</span>)sub_404679(v6, v8, v4) )</span><br><span class="line">    sub_401F8D(<span class="string">&quot;Wrong!&quot;</span>);</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    sub_401F8D(<span class="string">&quot;Correct!&quot;</span>);</span><br><span class="line">  <span class="keyword">if</span> ( __readfsqword(<span class="number">0x28</span>u) != v10 )</span><br><span class="line">    sub_40183E();</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>显然题目说了是Rc4，并且<code>RC4_1s_4w3s0m3</code>很可能是密码，我们直接拿上面的HEX进行解密就出了。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(rc4_crypt(rc4_init(<span class="string">b&quot;RC4_1s_4w3s0m3&quot;</span>), <span class="built_in">bytes</span>.fromhex(<span class="string">&#x27;A71A68ECD82711CC8C9B16155CD2673E82ADCE75D4BC5756C28A52B86BD6CCF8A4BA722FE05715B92411&#x27;</span>)))</span><br><span class="line"><span class="comment"># b&#x27;moectf&#123;why_Rc4_haS_The_Rev32sabl3_pr0ceSS&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">from regadgets import *</span></span><br><span class="line"><span class="string">Internal Functions Of Regadgets</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">List</span>, Iterator</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rc4_init</span>(<span class="params">key: <span class="built_in">bytes</span>, box_size: <span class="built_in">int</span> = <span class="number">256</span></span>) -&gt; <span class="type">List</span>[<span class="built_in">int</span>]:</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">type</span>(key) == <span class="built_in">str</span>:</span><br><span class="line">        key = key.encode()</span><br><span class="line">    s = <span class="built_in">list</span>(<span class="built_in">range</span>(box_size))</span><br><span class="line">    j = <span class="number">0</span></span><br><span class="line">    key_length = <span class="built_in">len</span>(key)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Key scheduling algorithm (KSA)</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(box_size):</span><br><span class="line">        <span class="comment"># permit key is empty.</span></span><br><span class="line">        j = (j + s[i] + <span class="number">0</span> <span class="keyword">if</span> key_length == <span class="number">0</span> <span class="keyword">else</span> j + s[i] + key[i % key_length]) % box_size</span><br><span class="line">        <span class="comment"># Swap s[i], s[j]</span></span><br><span class="line">        s[i], s[j] = s[j], s[i]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> s</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rc4_crypt</span>(<span class="params">s: <span class="built_in">bytes</span>, data: <span class="built_in">bytes</span>, box_size: <span class="built_in">int</span> = <span class="number">256</span></span>) -&gt; <span class="built_in">bytes</span>:</span><br><span class="line">    i, j = <span class="number">0</span>, <span class="number">0</span></span><br><span class="line">    result = <span class="built_in">bytearray</span>()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Pseudo-random generation algorithm (PRGA)</span></span><br><span class="line">    <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(data)):</span><br><span class="line">        i = (i + <span class="number">1</span>) %  box_size</span><br><span class="line">        j = (j + s[i]) % box_size</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Swap s[i], s[j]</span></span><br><span class="line">        s[i], s[j] = s[j], s[i]</span><br><span class="line"></span><br><span class="line">        t = (s[i] + s[j]) % box_size</span><br><span class="line">        result.append(data[k] ^ s[t])</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">bytes</span>(result)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">Internal Functions Of Regadgets</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">```python</span><br><span class="line"></span><br><span class="line"><span class="comment"># xxtea</span></span><br><span class="line">给出题目源码</span><br><span class="line">```c</span><br><span class="line"><span class="comment">#include &lt;stdio.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;string.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;stdint.h&gt;</span></span><br><span class="line"><span class="comment">#define DELTA 0x9e3779b9</span></span><br><span class="line"><span class="comment">#define MX (((z&gt;&gt;5^y&lt;&lt;2) + (y&gt;&gt;3^z&lt;&lt;4)) ^ ((sum^y) + (key[((p&amp;3)^e)&amp;0xff] ^ z)))</span></span><br><span class="line"></span><br><span class="line">void btea(uint32_t* v, <span class="built_in">int</span> n, const uint32_t key[<span class="number">4</span>])</span><br><span class="line">&#123;</span><br><span class="line">    uint32_t y, z, <span class="built_in">sum</span>;</span><br><span class="line">    unsigned p, rounds, e;</span><br><span class="line">    <span class="keyword">if</span> (n &gt; <span class="number">1</span>)            /* Coding Part */</span><br><span class="line">    &#123;</span><br><span class="line">        rounds = <span class="number">6</span> + <span class="number">52</span> / n;</span><br><span class="line">        <span class="built_in">sum</span> = <span class="number">0</span>;</span><br><span class="line">        z = v[n - <span class="number">1</span>];</span><br><span class="line">        do</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">sum</span> += DELTA;</span><br><span class="line">            e = (<span class="built_in">sum</span> &gt;&gt; <span class="number">2</span>) &amp; <span class="number">3</span>;</span><br><span class="line">            <span class="keyword">for</span> (p = <span class="number">0</span>; p &lt; n - <span class="number">1</span>; p++)</span><br><span class="line">            &#123;</span><br><span class="line">                y = v[p + <span class="number">1</span>];</span><br><span class="line">                z = v[p] += MX;</span><br><span class="line">            &#125;</span><br><span class="line">            y = v[<span class="number">0</span>];</span><br><span class="line">            z = v[n - <span class="number">1</span>] += MX;</span><br><span class="line">        &#125; <span class="keyword">while</span> (--rounds);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (n &lt; -<span class="number">1</span>)      /* Decoding Part */</span><br><span class="line">    &#123;</span><br><span class="line">        n = -n;</span><br><span class="line">        rounds = <span class="number">6</span> + <span class="number">52</span> / n;</span><br><span class="line">        <span class="built_in">sum</span> = rounds * DELTA;</span><br><span class="line">        y = v[<span class="number">0</span>];</span><br><span class="line">        do</span><br><span class="line">        &#123;</span><br><span class="line">            e = (<span class="built_in">sum</span> &gt;&gt; <span class="number">2</span>) &amp; <span class="number">3</span>;</span><br><span class="line">            <span class="keyword">for</span> (p = n - <span class="number">1</span>; p &gt; <span class="number">0</span>; p--)</span><br><span class="line">            &#123;</span><br><span class="line">                z = v[p - <span class="number">1</span>];</span><br><span class="line">                y = v[p] -= MX;</span><br><span class="line">            &#125;</span><br><span class="line">            z = v[n - <span class="number">1</span>];</span><br><span class="line">            y = v[<span class="number">0</span>] -= MX;</span><br><span class="line">            <span class="built_in">sum</span> -= DELTA;</span><br><span class="line">        &#125; <span class="keyword">while</span> (--rounds);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">int</span> main() &#123;</span><br><span class="line">    unsigned char enc[] = &#123; <span class="number">0x64</span>,<span class="number">0xf5</span>,<span class="number">0xe1</span>,<span class="number">0x78</span>,<span class="number">0xe1</span>,<span class="number">0xf0</span>,</span><br><span class="line"><span class="number">0x35</span>,<span class="number">0xa8</span>,<span class="number">0x34</span>,<span class="number">0xff</span>,<span class="number">0x12</span>,<span class="number">0x05</span>,</span><br><span class="line"><span class="number">0xfb</span>,<span class="number">0x13</span>,<span class="number">0xe9</span>,<span class="number">0xb0</span>,<span class="number">0x50</span>,<span class="number">0xa3</span>,</span><br><span class="line"><span class="number">0xb9</span>,<span class="number">0x89</span>,<span class="number">0xb1</span>,<span class="number">0xda</span>,<span class="number">0x43</span>,<span class="number">0xc9</span>,</span><br><span class="line"><span class="number">0x4f</span>,<span class="number">0xc8</span>,<span class="number">0xdb</span>,<span class="number">0x01</span>,<span class="number">0x20</span>,<span class="number">0xdb</span>,</span><br><span class="line"><span class="number">0x16</span>,<span class="number">0xaf</span>,<span class="number">0xed</span>,<span class="number">0x67</span>,<span class="number">0x17</span>,<span class="number">0x96</span></span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="built_in">int</span> r = <span class="number">9</span>;</span><br><span class="line">    unsigned char input_key[<span class="number">13</span>] = <span class="string">&quot;moectf2024!!&quot;</span>; </span><br><span class="line">    const uint32_t k[<span class="number">4</span>] = &#123; *((uint32_t*)input_key),*((uint32_t*)(input_key + <span class="number">4</span>)), *((uint32_t*)(input_key + <span class="number">8</span>)),<span class="number">0xccffbbbb</span> &#125;;</span><br><span class="line">    btea(((uint32_t*)enc),-r,k);</span><br><span class="line">    //btea(((uint32_t*)<span class="built_in">input</span>), -r, ((uint32_t*)input_key));</span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; <span class="number">36</span>; i++) &#123;</span><br><span class="line">        printf(<span class="string">&quot;%c&quot;</span>,enc[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>EXP:</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdint.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DELTA 0x9e3779b9</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MX (((z&gt;&gt;5^y<span class="string">&lt;&lt;2) + (y&gt;</span>&gt;3^z&lt;&lt;4)) ^ ((sum^y) + (key[((p&amp;3)^e)&amp;0xff] ^ z)))</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">btea</span><span class="params">(<span class="type">uint32_t</span>* v, <span class="type">int</span> n, <span class="type">const</span> <span class="type">uint32_t</span> key[<span class="number">4</span>])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">uint32_t</span> y, z, sum;</span><br><span class="line">    <span class="type">unsigned</span> p, rounds, e;</span><br><span class="line">    <span class="keyword">if</span> (n &gt; <span class="number">1</span>)            <span class="comment">/* Coding Part */</span></span><br><span class="line">    &#123;</span><br><span class="line">        rounds = <span class="number">6</span> + <span class="number">52</span> / n;</span><br><span class="line">        sum = <span class="number">0</span>;</span><br><span class="line">        z = v[n - <span class="number">1</span>];</span><br><span class="line">        <span class="keyword">do</span></span><br><span class="line">        &#123;</span><br><span class="line">            sum += DELTA;</span><br><span class="line">            e = (sum &gt;&gt; <span class="number">2</span>) &amp; <span class="number">3</span>;</span><br><span class="line">            <span class="keyword">for</span> (p = <span class="number">0</span>; p &lt; n - <span class="number">1</span>; p++)</span><br><span class="line">            &#123;</span><br><span class="line">                y = v[p + <span class="number">1</span>];</span><br><span class="line">                z = v[p] += MX;</span><br><span class="line">            &#125;</span><br><span class="line">            y = v[<span class="number">0</span>];</span><br><span class="line">            z = v[n - <span class="number">1</span>] += MX;</span><br><span class="line">        &#125; <span class="keyword">while</span> (--rounds);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (n &lt; <span class="number">-1</span>)      <span class="comment">/* Decoding Part */</span></span><br><span class="line">    &#123;</span><br><span class="line">        n = -n;</span><br><span class="line">        rounds = <span class="number">6</span> + <span class="number">52</span> / n;</span><br><span class="line">        sum = rounds * DELTA;</span><br><span class="line">        y = v[<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">do</span></span><br><span class="line">        &#123;</span><br><span class="line">            e = (sum &gt;&gt; <span class="number">2</span>) &amp; <span class="number">3</span>;</span><br><span class="line">            <span class="keyword">for</span> (p = n - <span class="number">1</span>; p &gt; <span class="number">0</span>; p--)</span><br><span class="line">            &#123;</span><br><span class="line">                z = v[p - <span class="number">1</span>];</span><br><span class="line">                y = v[p] -= MX;</span><br><span class="line">            &#125;</span><br><span class="line">            z = v[n - <span class="number">1</span>];</span><br><span class="line">            y = v[<span class="number">0</span>] -= MX;</span><br><span class="line">            sum -= DELTA;</span><br><span class="line">        &#125; <span class="keyword">while</span> (--rounds);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> enc[] = &#123; <span class="number">0x64</span>,<span class="number">0xf5</span>,<span class="number">0xe1</span>,<span class="number">0x78</span>,<span class="number">0xe1</span>,<span class="number">0xf0</span>,</span><br><span class="line"><span class="number">0x35</span>,<span class="number">0xa8</span>,<span class="number">0x34</span>,<span class="number">0xff</span>,<span class="number">0x12</span>,<span class="number">0x05</span>,</span><br><span class="line"><span class="number">0xfb</span>,<span class="number">0x13</span>,<span class="number">0xe9</span>,<span class="number">0xb0</span>,<span class="number">0x50</span>,<span class="number">0xa3</span>,</span><br><span class="line"><span class="number">0xb9</span>,<span class="number">0x89</span>,<span class="number">0xb1</span>,<span class="number">0xda</span>,<span class="number">0x43</span>,<span class="number">0xc9</span>,</span><br><span class="line"><span class="number">0x4f</span>,<span class="number">0xc8</span>,<span class="number">0xdb</span>,<span class="number">0x01</span>,<span class="number">0x20</span>,<span class="number">0xdb</span>,</span><br><span class="line"><span class="number">0x16</span>,<span class="number">0xaf</span>,<span class="number">0xed</span>,<span class="number">0x67</span>,<span class="number">0x17</span>,<span class="number">0x96</span></span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="type">int</span> r = <span class="number">9</span>;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> input_key[<span class="number">13</span>] = <span class="string">&quot;moectf2024!!&quot;</span>; <span class="comment">// Adjusted size to fit 12 characters + null terminator</span></span><br><span class="line">    </span><br><span class="line">    <span class="type">const</span> <span class="type">uint32_t</span> k[<span class="number">4</span>] = &#123; *((<span class="type">uint32_t</span>*)input_key),*((<span class="type">uint32_t</span>*)(input_key + <span class="number">4</span>)), *((<span class="type">uint32_t</span>*)(input_key + <span class="number">8</span>)),<span class="number">0xccffbbbb</span> &#125;;</span><br><span class="line">    <span class="built_in">btea</span>(((<span class="type">uint32_t</span>*)enc),-r,k);</span><br><span class="line">    <span class="comment">//moectf&#123;j9h8hg75nky6vhkslh5v5awibr4i&#125;</span></span><br><span class="line">    <span class="comment">//btea(((uint32_t*)input), -r, ((uint32_t*)input_key));</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">36</span>; i++) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%c&quot;</span>,enc[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>选手只需要在网上找到xxtea实现并且对照逆向即可。<br><code>moectf&#123;j9h8hg75nky6vhkslh5v5awibr4i&#125;</code></p><h1 id="TEA"><a href="#TEA" class="headerlink" title="TEA"></a>TEA</h1><p>本题是标准的TEA（难度低于XTEA和XXTEA），选手只需要打开IDA找到v &#x3D; {0x284c2234, 0x3910c558}, k &#x3D; “base64xorteaxtea”，再通过观察，对比程序内TEA和正常TEA逻辑相同，故写出解密脚本：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdint.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">decrypt</span><span class="params">(<span class="type">uint32_t</span>* v, <span class="type">uint32_t</span>* k)</span> </span>&#123;</span><br><span class="line">        <span class="type">uint32_t</span> v0 = v[<span class="number">0</span>], v1 = v[<span class="number">1</span>];</span><br><span class="line">        <span class="type">uint32_t</span> delta = <span class="number">0x9e3779b9</span>;</span><br><span class="line">        <span class="type">uint32_t</span> sum = delta * <span class="number">32</span>;</span><br><span class="line">        <span class="type">uint32_t</span> k0 = k[<span class="number">0</span>], k1 = k[<span class="number">1</span>], k2 = k[<span class="number">2</span>], k3 = k[<span class="number">3</span>];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">32</span>; i++) &#123;</span><br><span class="line">                v1 -= ((v0 &lt;&lt; <span class="number">4</span>) + k2) ^ (v0 + sum) ^ ((v0 &gt;&gt; <span class="number">5</span>) + k3);</span><br><span class="line">                v0 -= ((v1 &lt;&lt; <span class="number">4</span>) + k0) ^ (v1 + sum) ^ ((v1 &gt;&gt; <span class="number">5</span>) + k1);</span><br><span class="line">                sum -= delta;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        v[<span class="number">0</span>] = v0;</span><br><span class="line">        v[<span class="number">1</span>] = v1;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">        <span class="type">uint32_t</span> v[<span class="number">2</span>]; <span class="type">uint32_t</span> v2;</span><br><span class="line">        v[<span class="number">0</span>] = <span class="number">0x284c2234</span>;</span><br><span class="line">        v[<span class="number">1</span>] = <span class="number">0x3910c558</span>;</span><br><span class="line">        <span class="built_in">decrypt</span>(v, (<span class="type">uint32_t</span>*)<span class="string">&quot;base64xorteaxtea&quot;</span>);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;moectf&#123;%x-&quot;</span>, v[<span class="number">0</span>]);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%x-&quot;</span>, v[<span class="number">1</span>] &gt;&gt; <span class="number">16</span> );</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%x-9c42-caf30620caaf&#125;&quot;</span>, v[<span class="number">1</span>] &amp; <span class="number">0xffff</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>moectf&#123;836153a5-8e00-49bd-9c42-caf30620caaf&#125;</code></p><h1 id="逆向工程进阶之北"><a href="#逆向工程进阶之北" class="headerlink" title="逆向工程进阶之北"></a>逆向工程进阶之北</h1><p>这个指北中的问题是，如何求解乘法逆元。<br>我们使用Python的库pycryptodome3</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>inverse(<span class="number">0xccffbbbb</span>, <span class="number">0xffffffff</span>+<span class="number">1</span>) </span><br><span class="line"><span class="number">2371998067</span></span><br></pre></td></tr></table></figure><p>很容易就可以求得乘法逆元，注意的是要+1，是因为0xffffffff范围内还有0，而模数（第二个参数）取决于有限域的大小而不是最大值。<br>EXP</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">flag_decryption</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">        DWORD flag[<span class="number">12</span>] = &#123; <span class="number">0xb5073388</span> , <span class="number">0xf58ea46f</span> , <span class="number">0x8cd2d760</span> , <span class="number">0x7fc56cda</span> , <span class="number">0x52bc07da</span> , <span class="number">0x29054b48</span> , <span class="number">0x42d74750</span> , <span class="number">0x11297e95</span> , <span class="number">0x5cf2821b</span> , <span class="number">0x747970da</span> , <span class="number">0x64793c81</span>, <span class="number">0x00000000</span> &#125;;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">11</span>; i++)</span><br><span class="line">        &#123;</span><br><span class="line">                *(flag + i) ^= <span class="number">0xdeadbeef</span> + <span class="number">0xd3906</span>;</span><br><span class="line">                *(flag + i) -= <span class="number">0xdeadc0de</span>;</span><br><span class="line">                *(flag + i) *= <span class="number">2371998067</span>; <span class="comment">// 0xccffbbbb 的乘法逆元（在mod 0xffffffff+1下） Ref: https://zh.planetcalc.com/3311/</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        std::cout &lt;&lt; (<span class="type">unsigned</span> <span class="type">char</span>*)flag &lt;&lt; std::endl;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// moectf&#123;c5f44c32-cbb9-444e-aef4-c0fa7c7a6b7a&#125;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>moectf&#123;c5f44c32-cbb9-444e-aef4-c0fa7c7a6b7a&#125;</code></p><h1 id="moedaily"><a href="#moedaily" class="headerlink" title="moedaily"></a>moedaily</h1><p>题目实现了一个Excel表格，利用其中的Function功能实现了一个TEA加密。<br>在表单可以发现有s3cr3t，进去后可以看到满屏的计算过程<br>进行分析，发现是密码为 114514 1919810 415144 19883<br>偏移为114514的标准TEA加密，而且加密了两次。<br>回到第一页，找到判断条件</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">=IF(LEN(D11)=48,IF(AND(AND(AND(AND(AND(AND(H14=1397140385,I14=2386659843),AND(H15=962571399,I15=3942687964)),AND(H16=3691974192,I16=863943258)),AND(H17=216887638,I17=3212824238)),AND(H18=3802077983,I18=1839161422)),AND(H19=1288683919,I19=3222915626)),&quot;恭喜你，拿到了真的FLAG&quot;,&quot;FLAG输入错了，再试试&quot;),&quot;flag长度不对&quot;)</span><br></pre></td></tr></table></figure><p>可以得到结论</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">H14=1397140385,I14=2386659843</span><br><span class="line">H15=962571399,I15=3942687964</span><br><span class="line">H16=3691974192,I16=863943258</span><br><span class="line">H17=216887638,I17=3212824238</span><br><span class="line">H18=3802077983,I18=1839161422</span><br><span class="line">H19=1288683919,I19=3222915626</span><br></pre></td></tr></table></figure><p>带入TEA可以得到（注意程序进行了两次TEA加密）<br><code>moectf&#123;3xC3l_1S_n0t_just_f0r_d41ly_w0rk_bu7_R3V&#125;</code></p><h1 id="moejvav"><a href="#moejvav" class="headerlink" title="moejvav"></a>moejvav</h1><p>题目是在Java下的简单虚拟机（vm）逆向工程。<br>稍微分析一下，得到下面的结论</p><table><thead><tr><th>Step</th><th>Instruction</th></tr></thead><tbody><tr><td>0</td><td>getByte</td></tr><tr><td>1</td><td>xor store, p1</td></tr><tr><td>2</td><td>add store, p1</td></tr><tr><td>3</td><td>sub store, p1</td></tr><tr><td>4</td><td>shl store, p1</td></tr><tr><td>5</td><td>or store, p1</td></tr><tr><td>6</td><td>check store, p1</td></tr><tr><td>7</td><td>Exit</td></tr><tr><td>把VM的Insn进行排列</td><td></td></tr></tbody></table><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">0 1 60 2 -20 6 -25</span><br><span class="line">0 1 60 2 -20 6 -27</span><br><span class="line">0 1 60 2 -20 6 -33</span><br><span class="line">0 1 60 2 -20 6 -31</span><br><span class="line">0 1 60 2 -20 6 -50</span><br><span class="line">0 1 60 2 -20 6 -36</span><br><span class="line">0 1 60 2 -20 6 -39</span><br><span class="line">0 1 60 2 -20 6 -24</span><br><span class="line">0 1 60 2 -20 6 -52</span><br><span class="line">0 1 60 2 -20 6 -29</span><br><span class="line">0 1 60 2 -20 6 -52</span><br><span class="line">0 1 14 2 5 6 -64</span><br><span class="line">0 1 14 2 5 6 -58</span><br><span class="line">0 1 14 2 5 6 -63</span><br><span class="line">0 1 14 2 5 6 -52</span><br><span class="line">0 1 14 2 5 6 -90</span><br><span class="line">0 1 14 2 5 6 -39</span><br><span class="line">0 1 14 2 5 6 -43</span><br><span class="line">0 1 14 2 5 6 26</span><br><span class="line">0 1 14 2 5 6 25</span><br><span class="line">0 1 14 2 5 6 -49</span><br><span class="line">0 1 14 2 5 6 -64</span><br><span class="line">0 1 10 2 5 6 -51</span><br><span class="line">0 1 10 2 5 6 25</span><br><span class="line">0 1 10 2 5 6 -45</span><br><span class="line">0 1 10 2 5 6 -55</span><br><span class="line">0 1 10 2 5 6 -47</span><br><span class="line">0 1 10 2 5 6 24</span><br><span class="line">0 1 10 2 5 6 -41</span><br><span class="line">0 1 10 2 5 6 -60</span><br><span class="line">0 1 10 2 5 6 22</span><br><span class="line">0 1 10 2 5 6 -40</span><br><span class="line">0 1 10 2 5 6 -60</span><br><span class="line">0 2 14 2 10 6 -15</span><br><span class="line">0 2 14 2 10 6 50</span><br><span class="line">0 2 14 2 10 6 -51</span><br><span class="line">0 2 14 2 10 6 -31</span><br><span class="line">0 2 14 2 10 6 50</span><br><span class="line">0 2 14 2 10 6 50</span><br><span class="line">0 2 14 2 10 6 -35</span><br><span class="line">0 2 14 2 10 6 50</span><br><span class="line">0 2 14 2 10 6 -35</span><br><span class="line">0 2 14 2 10 6 51</span><br><span class="line">0 2 14 2 10 6 -17</span><br></pre></td></tr></table></figure><p>这里我们使用Z3-Solver进行约束求解</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> z3 <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> copy</span><br><span class="line">x = [BitVec(<span class="string">f&quot;x<span class="subst">&#123;i&#125;</span>&quot;</span>, <span class="number">8</span>) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">44</span>)]</span><br><span class="line">y = copy.deepcopy(x)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(x)):</span><br><span class="line">   x[i] ^= <span class="number">0xca</span></span><br><span class="line">   x[i] += <span class="number">0x20</span></span><br><span class="line"></span><br><span class="line">s = Solver()</span><br><span class="line"></span><br><span class="line">ans1 = [-<span class="number">25</span>,-<span class="number">27</span>,-<span class="number">33</span>,-<span class="number">31</span>,-<span class="number">50</span>,-<span class="number">36</span>,-<span class="number">39</span>,-<span class="number">24</span>,-<span class="number">52</span>,-<span class="number">29</span>,-<span class="number">52</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">11</span>):</span><br><span class="line">   s.add((x[i] ^ <span class="number">60</span>) - <span class="number">20</span> == ans1[i]) </span><br><span class="line"></span><br><span class="line">ans2 = [-<span class="number">64</span>,-<span class="number">58</span>,-<span class="number">63</span>,-<span class="number">52</span>,-<span class="number">90</span>,-<span class="number">39</span>,-<span class="number">43</span>,<span class="number">26</span>,<span class="number">25</span>,-<span class="number">49</span>,-<span class="number">64</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">11</span>):</span><br><span class="line">   s.add((x[<span class="number">11</span> + i] ^ <span class="number">14</span>) + <span class="number">5</span> == ans2[i]) </span><br><span class="line"></span><br><span class="line">ans3 = [-<span class="number">51</span>,<span class="number">25</span>,-<span class="number">45</span>,-<span class="number">55</span>,-<span class="number">47</span>,<span class="number">24</span>,-<span class="number">41</span>,-<span class="number">60</span>,<span class="number">22</span>,-<span class="number">40</span>,-<span class="number">60</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">11</span>):</span><br><span class="line">   s.add((x[<span class="number">22</span> + i] ^ <span class="number">10</span>) + <span class="number">5</span> == ans3[i]) </span><br><span class="line"></span><br><span class="line">ans4 = [-<span class="number">15</span>,<span class="number">50</span>,-<span class="number">51</span>,-<span class="number">31</span>,<span class="number">50</span>,<span class="number">50</span>,-<span class="number">35</span>,<span class="number">50</span>,-<span class="number">35</span>,<span class="number">51</span>,-<span class="number">17</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">11</span>):</span><br><span class="line">   s.add((x[<span class="number">33</span> + i] + <span class="number">14</span>) + <span class="number">10</span> == ans4[i]) </span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(s.check())</span><br><span class="line">m = s.model()</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> y:</span><br><span class="line">   <span class="built_in">print</span>(<span class="built_in">chr</span>(m[i].as_long()), end=<span class="string">&#x27;&#x27;</span>) </span><br><span class="line"><span class="comment"># sat</span></span><br><span class="line"><span class="comment"># moectf&#123;jvav_eXcEpt10n_h4ndl3r_1s_s0_c00o0o1&#125;</span></span><br></pre></td></tr></table></figure><p><code>moectf&#123;jvav_eXcEpt10n_h4ndl3r_1s_s0_c00o0o1&#125;</code></p><h1 id="sm4"><a href="#sm4" class="headerlink" title="sm4"></a>sm4</h1><p>题目头文件</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifndef</span> _SM4_H_</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> _SM4_H_</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> u8 unsigned char</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> u32 unsigned long</span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">four_uCh2uLong</span><span class="params">(u8 *in, u32 *out)</span>;             <span class="comment">//四字节转换成u32</span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">uLong2four_uCh</span><span class="params">(u32 in, u8 *out)</span>;              <span class="comment">//u32转换成四字节</span></span><br><span class="line"></span><br><span class="line"><span class="type">unsigned</span> <span class="type">long</span> <span class="title function_">move</span><span class="params">(u32 data, <span class="type">int</span> length)</span>;          <span class="comment">//左移，保留丢弃位放置尾部</span></span><br><span class="line"></span><br><span class="line"><span class="type">unsigned</span> <span class="type">long</span> <span class="title function_">func_key</span><span class="params">(u32 input)</span>;                 <span class="comment">//先使用Sbox进行非线性变化，再将线性变换L置换为L&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="type">unsigned</span> <span class="type">long</span> <span class="title function_">func_data</span><span class="params">(u32 input)</span>;                <span class="comment">//先使用Sbox进行非线性变化，再进行线性变换L</span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">print_hex</span><span class="params">(u8 *data, <span class="type">int</span> len)</span>;                 <span class="comment">//无符号字符数组转16进制打印</span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">encode_fun</span><span class="params">(u8 len,u8 *key, u8 *input, u8 *output)</span>;   <span class="comment">//加密函数</span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">decode_fun</span><span class="params">(u8 len,u8 *key, u8 *input, u8 *output)</span>;   <span class="comment">//解密函数</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/******************************定义系统参数FK的取值****************************************/</span></span><br><span class="line"><span class="type">const</span> u32 TBL_SYS_PARAMS[<span class="number">4</span>] = &#123;</span><br><span class="line">        <span class="number">0xa3b1bac6</span>,</span><br><span class="line">        <span class="number">0x56aa3350</span>,</span><br><span class="line">        <span class="number">0x677d9197</span>,</span><br><span class="line">        <span class="number">0xb27022dc</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/******************************定义固定参数CK的取值****************************************/</span></span><br><span class="line"><span class="type">const</span> u32 TBL_FIX_PARAMS[<span class="number">32</span>] = &#123;</span><br><span class="line"></span><br><span class="line">    <span class="number">0x00070e15</span>,<span class="number">0x1c232a31</span>,<span class="number">0x383f464d</span>,<span class="number">0x545b6269</span>,</span><br><span class="line">        <span class="number">0x70777e85</span>,<span class="number">0x8c939aa1</span>,<span class="number">0xa8afb6bd</span>,<span class="number">0xc4cbd2d9</span>,</span><br><span class="line">        <span class="number">0xe0e7eef5</span>,<span class="number">0xfc030a11</span>,<span class="number">0x181f262d</span>,<span class="number">0x343b4249</span>,</span><br><span class="line">        <span class="number">0x50575e65</span>,<span class="number">0x6c737a81</span>,<span class="number">0x888f969d</span>,<span class="number">0xa4abb2b9</span>,</span><br><span class="line">        <span class="number">0xc0c7ced5</span>,<span class="number">0xdce3eaf1</span>,<span class="number">0xf8ff060d</span>,<span class="number">0x141b2229</span>,</span><br><span class="line">        <span class="number">0x30373e45</span>,<span class="number">0x4c535a61</span>,<span class="number">0x686f767d</span>,<span class="number">0x848b9299</span>,</span><br><span class="line">        <span class="number">0xa0a7aeb5</span>,<span class="number">0xbcc3cad1</span>,<span class="number">0xd8dfe6ed</span>,<span class="number">0xf4fb0209</span>,</span><br><span class="line">        <span class="number">0x10171e25</span>,<span class="number">0x2c333a41</span>,<span class="number">0x484f565d</span>,<span class="number">0x646b7279</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/******************************SBox参数列表****************************************/</span></span><br><span class="line"><span class="type">const</span> u8 TBL_SBOX[<span class="number">256</span>] = &#123;</span><br><span class="line"></span><br><span class="line">    <span class="number">0xd6</span>,<span class="number">0x90</span>,<span class="number">0xe9</span>,<span class="number">0xfe</span>,<span class="number">0xcc</span>,<span class="number">0xe1</span>,<span class="number">0x3d</span>,<span class="number">0xb7</span>,<span class="number">0x16</span>,<span class="number">0xb6</span>,<span class="number">0x14</span>,<span class="number">0xc2</span>,<span class="number">0x28</span>,<span class="number">0xfb</span>,<span class="number">0x2c</span>,<span class="number">0x05</span>,</span><br><span class="line">        <span class="number">0x2b</span>,<span class="number">0x67</span>,<span class="number">0x9a</span>,<span class="number">0x76</span>,<span class="number">0x2a</span>,<span class="number">0xbe</span>,<span class="number">0x04</span>,<span class="number">0xc3</span>,<span class="number">0xaa</span>,<span class="number">0x44</span>,<span class="number">0x13</span>,<span class="number">0x26</span>,<span class="number">0x49</span>,<span class="number">0x86</span>,<span class="number">0x06</span>,<span class="number">0x99</span>,</span><br><span class="line">        <span class="number">0x9c</span>,<span class="number">0x42</span>,<span class="number">0x50</span>,<span class="number">0xf4</span>,<span class="number">0x91</span>,<span class="number">0xef</span>,<span class="number">0x98</span>,<span class="number">0x7a</span>,<span class="number">0x33</span>,<span class="number">0x54</span>,<span class="number">0x0b</span>,<span class="number">0x43</span>,<span class="number">0xed</span>,<span class="number">0xcf</span>,<span class="number">0xac</span>,<span class="number">0x62</span>,</span><br><span class="line">        <span class="number">0xe4</span>,<span class="number">0xb3</span>,<span class="number">0x1c</span>,<span class="number">0xa9</span>,<span class="number">0xc9</span>,<span class="number">0x08</span>,<span class="number">0xe8</span>,<span class="number">0x95</span>,<span class="number">0x80</span>,<span class="number">0xdf</span>,<span class="number">0x94</span>,<span class="number">0xfa</span>,<span class="number">0x75</span>,<span class="number">0x8f</span>,<span class="number">0x3f</span>,<span class="number">0xa6</span>,</span><br><span class="line">        <span class="number">0x47</span>,<span class="number">0x07</span>,<span class="number">0xa7</span>,<span class="number">0xfc</span>,<span class="number">0xf3</span>,<span class="number">0x73</span>,<span class="number">0x17</span>,<span class="number">0xba</span>,<span class="number">0x83</span>,<span class="number">0x59</span>,<span class="number">0x3c</span>,<span class="number">0x19</span>,<span class="number">0xe6</span>,<span class="number">0x85</span>,<span class="number">0x4f</span>,<span class="number">0xa8</span>,</span><br><span class="line">        <span class="number">0x68</span>,<span class="number">0x6b</span>,<span class="number">0x81</span>,<span class="number">0xb2</span>,<span class="number">0x71</span>,<span class="number">0x64</span>,<span class="number">0xda</span>,<span class="number">0x8b</span>,<span class="number">0xf8</span>,<span class="number">0xeb</span>,<span class="number">0x0f</span>,<span class="number">0x4b</span>,<span class="number">0x70</span>,<span class="number">0x56</span>,<span class="number">0x9d</span>,<span class="number">0x35</span>,</span><br><span class="line">        <span class="number">0x1e</span>,<span class="number">0x24</span>,<span class="number">0x0e</span>,<span class="number">0x5e</span>,<span class="number">0x63</span>,<span class="number">0x58</span>,<span class="number">0xd1</span>,<span class="number">0xa2</span>,<span class="number">0x25</span>,<span class="number">0x22</span>,<span class="number">0x7c</span>,<span class="number">0x3b</span>,<span class="number">0x01</span>,<span class="number">0x21</span>,<span class="number">0x78</span>,<span class="number">0x87</span>,</span><br><span class="line">        <span class="number">0xd4</span>,<span class="number">0x00</span>,<span class="number">0x46</span>,<span class="number">0x57</span>,<span class="number">0x9f</span>,<span class="number">0xd3</span>,<span class="number">0x27</span>,<span class="number">0x52</span>,<span class="number">0x4c</span>,<span class="number">0x36</span>,<span class="number">0x02</span>,<span class="number">0xe7</span>,<span class="number">0xa0</span>,<span class="number">0xc4</span>,<span class="number">0xc8</span>,<span class="number">0x9e</span>,</span><br><span class="line">        <span class="number">0xea</span>,<span class="number">0xbf</span>,<span class="number">0x8a</span>,<span class="number">0xd2</span>,<span class="number">0x40</span>,<span class="number">0xc7</span>,<span class="number">0x38</span>,<span class="number">0xb5</span>,<span class="number">0xa3</span>,<span class="number">0xf7</span>,<span class="number">0xf2</span>,<span class="number">0xce</span>,<span class="number">0xf9</span>,<span class="number">0x61</span>,<span class="number">0x15</span>,<span class="number">0xa1</span>,</span><br><span class="line">        <span class="number">0xe0</span>,<span class="number">0xae</span>,<span class="number">0x5d</span>,<span class="number">0xa4</span>,<span class="number">0x9b</span>,<span class="number">0x34</span>,<span class="number">0x1a</span>,<span class="number">0x55</span>,<span class="number">0xad</span>,<span class="number">0x93</span>,<span class="number">0x32</span>,<span class="number">0x30</span>,<span class="number">0xf5</span>,<span class="number">0x8c</span>,<span class="number">0xb1</span>,<span class="number">0xe3</span>,</span><br><span class="line">        <span class="number">0x1d</span>,<span class="number">0xf6</span>,<span class="number">0xe2</span>,<span class="number">0x2e</span>,<span class="number">0x82</span>,<span class="number">0x66</span>,<span class="number">0xca</span>,<span class="number">0x60</span>,<span class="number">0xc0</span>,<span class="number">0x29</span>,<span class="number">0x23</span>,<span class="number">0xab</span>,<span class="number">0x0d</span>,<span class="number">0x53</span>,<span class="number">0x4e</span>,<span class="number">0x6f</span>,</span><br><span class="line">        <span class="number">0xd5</span>,<span class="number">0xdb</span>,<span class="number">0x37</span>,<span class="number">0x45</span>,<span class="number">0xde</span>,<span class="number">0xfd</span>,<span class="number">0x8e</span>,<span class="number">0x2f</span>,<span class="number">0x03</span>,<span class="number">0xff</span>,<span class="number">0x6a</span>,<span class="number">0x72</span>,<span class="number">0x6d</span>,<span class="number">0x6c</span>,<span class="number">0x5b</span>,<span class="number">0x51</span>,</span><br><span class="line">        <span class="number">0x8d</span>,<span class="number">0x1b</span>,<span class="number">0xaf</span>,<span class="number">0x92</span>,<span class="number">0xbb</span>,<span class="number">0xdd</span>,<span class="number">0xbc</span>,<span class="number">0x7f</span>,<span class="number">0x11</span>,<span class="number">0xd9</span>,<span class="number">0x5c</span>,<span class="number">0x41</span>,<span class="number">0x1f</span>,<span class="number">0x10</span>,<span class="number">0x5a</span>,<span class="number">0xd8</span>,</span><br><span class="line">        <span class="number">0x0a</span>,<span class="number">0xc1</span>,<span class="number">0x31</span>,<span class="number">0x88</span>,<span class="number">0xa5</span>,<span class="number">0xcd</span>,<span class="number">0x7b</span>,<span class="number">0xbd</span>,<span class="number">0x2d</span>,<span class="number">0x74</span>,<span class="number">0xd0</span>,<span class="number">0x12</span>,<span class="number">0xb8</span>,<span class="number">0xe5</span>,<span class="number">0xb4</span>,<span class="number">0xb0</span>,</span><br><span class="line">        <span class="number">0x89</span>,<span class="number">0x69</span>,<span class="number">0x97</span>,<span class="number">0x4a</span>,<span class="number">0x0c</span>,<span class="number">0x96</span>,<span class="number">0x77</span>,<span class="number">0x7e</span>,<span class="number">0x65</span>,<span class="number">0xb9</span>,<span class="number">0xf1</span>,<span class="number">0x09</span>,<span class="number">0xc5</span>,<span class="number">0x6e</span>,<span class="number">0xc6</span>,<span class="number">0x84</span>,</span><br><span class="line">        <span class="number">0x18</span>,<span class="number">0xf0</span>,<span class="number">0x7d</span>,<span class="number">0xec</span>,<span class="number">0x3a</span>,<span class="number">0xdc</span>,<span class="number">0x4d</span>,<span class="number">0x20</span>,<span class="number">0x79</span>,<span class="number">0xee</span>,<span class="number">0x5f</span>,<span class="number">0x3e</span>,<span class="number">0xd7</span>,<span class="number">0xcb</span>,<span class="number">0x39</span>,<span class="number">0x48</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br></pre></td></tr></table></figure><p>主程序</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;sm4.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//4字节无符号数组转无符号long型</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">four_uCh2uLong</span><span class="params">(u8 *in, u32 *out)</span></span><br><span class="line">&#123;</span><br><span class="line">        <span class="type">int</span> i = <span class="number">0</span>;</span><br><span class="line">        *out = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++)</span><br><span class="line">                *out = ((u32)in[i] &lt;&lt; (<span class="number">24</span> - i * <span class="number">8</span>)) ^ *out;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//无符号long型转4字节无符号数组</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">uLong2four_uCh</span><span class="params">(u32 in, u8 *out)</span></span><br><span class="line">&#123;</span><br><span class="line">        <span class="type">int</span> i = <span class="number">0</span>;</span><br><span class="line">        <span class="comment">//从32位unsigned long的高位开始取</span></span><br><span class="line">        <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++)</span><br><span class="line">                *(out + i) = (u32)(in &gt;&gt; (<span class="number">24</span> - i * <span class="number">8</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//左移，保留丢弃位放置尾部</span></span><br><span class="line">u32 <span class="title function_">move</span><span class="params">(u32 data, <span class="type">int</span> length)</span></span><br><span class="line">&#123;</span><br><span class="line">        u32 result = <span class="number">0</span>;</span><br><span class="line">        result = (data &lt;&lt; length) ^ (data &gt;&gt; (<span class="number">32</span> - length));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//秘钥处理函数,先使用Sbox进行非线性变化，再将线性变换L置换为L&#x27;</span></span><br><span class="line">u32 <span class="title function_">func_key</span><span class="params">(u32 input)</span></span><br><span class="line">&#123;</span><br><span class="line">        <span class="type">int</span> i = <span class="number">0</span>;</span><br><span class="line">        u32 ulTmp = <span class="number">0</span>;</span><br><span class="line">        u8 ucIndexList[<span class="number">4</span>] = &#123; <span class="number">0</span> &#125;;</span><br><span class="line">        u8 ucSboxValueList[<span class="number">4</span>] = &#123; <span class="number">0</span> &#125;;</span><br><span class="line">        uLong2four_uCh(input, ucIndexList);</span><br><span class="line">        <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++)</span><br><span class="line">        &#123;</span><br><span class="line">                ucSboxValueList[i] = TBL_SBOX[ucIndexList[i]];</span><br><span class="line">        &#125;</span><br><span class="line">        four_uCh2uLong(ucSboxValueList, &amp;ulTmp);</span><br><span class="line">        ulTmp = ulTmp ^ move(ulTmp, <span class="number">13</span>) ^ move(ulTmp, <span class="number">23</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> ulTmp;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//加解密数据处理函数,先使用Sbox进行非线性变化，再进行线性变换L</span></span><br><span class="line">u32 <span class="title function_">func_data</span><span class="params">(u32 input)</span></span><br><span class="line">&#123;</span><br><span class="line">        <span class="type">int</span> i = <span class="number">0</span>;</span><br><span class="line">        u32 ulTmp = <span class="number">0</span>;</span><br><span class="line">        u8 ucIndexList[<span class="number">4</span>] = &#123; <span class="number">0</span> &#125;;</span><br><span class="line">        u8 ucSboxValueList[<span class="number">4</span>] = &#123; <span class="number">0</span> &#125;;</span><br><span class="line">        uLong2four_uCh(input, ucIndexList);</span><br><span class="line">        <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++)</span><br><span class="line">        &#123;</span><br><span class="line">                ucSboxValueList[i] = TBL_SBOX[ucIndexList[i]];</span><br><span class="line">        &#125;</span><br><span class="line">        four_uCh2uLong(ucSboxValueList, &amp;ulTmp);</span><br><span class="line">        ulTmp = ulTmp ^ move(ulTmp, <span class="number">2</span>) ^ move(ulTmp, <span class="number">10</span>) ^ move(ulTmp, <span class="number">18</span>) ^ move(ulTmp, <span class="number">24</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> ulTmp;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//加密函数（可以加密任意长度数据，16字节为一次循环，不足部分补0凑齐16字节的整数倍）</span></span><br><span class="line"><span class="comment">//len:数据长度(任意长度数据) key:密钥（16字节） input:输入的原始数据 output:加密后输出数据</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">encode_fun</span><span class="params">(u8 len,u8 *key, u8 *input, u8 *output)</span></span><br><span class="line">&#123;</span><br><span class="line">        <span class="type">int</span> i = <span class="number">0</span>,j=<span class="number">0</span>; </span><br><span class="line">        u8 *p = (u8 *)<span class="built_in">malloc</span>(<span class="number">50</span>);      <span class="comment">//定义一个50字节缓存区</span></span><br><span class="line">        u32 ulKeyTmpList[<span class="number">4</span>] = &#123; <span class="number">0</span> &#125;;   <span class="comment">//存储密钥的u32数据</span></span><br><span class="line">        u32 ulKeyList[<span class="number">36</span>] = &#123; <span class="number">0</span> &#125;;     <span class="comment">//用于密钥扩展算法与系统参数FK运算后的结果存储</span></span><br><span class="line">        u32 ulDataList[<span class="number">36</span>] = &#123; <span class="number">0</span> &#125;;    <span class="comment">//用于存放加密数据</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">/***************************开始生成子秘钥********************************************/</span></span><br><span class="line">        four_uCh2uLong(key, &amp;(ulKeyTmpList[<span class="number">0</span>]));</span><br><span class="line">        four_uCh2uLong(key + <span class="number">4</span>, &amp;(ulKeyTmpList[<span class="number">1</span>]));</span><br><span class="line">        four_uCh2uLong(key + <span class="number">8</span>, &amp;(ulKeyTmpList[<span class="number">2</span>]));</span><br><span class="line">        four_uCh2uLong(key + <span class="number">12</span>, &amp;(ulKeyTmpList[<span class="number">3</span>]));</span><br><span class="line"></span><br><span class="line">        ulKeyList[<span class="number">0</span>] = ulKeyTmpList[<span class="number">0</span>] ^ TBL_SYS_PARAMS[<span class="number">0</span>];</span><br><span class="line">        ulKeyList[<span class="number">1</span>] = ulKeyTmpList[<span class="number">1</span>] ^ TBL_SYS_PARAMS[<span class="number">1</span>];</span><br><span class="line">        ulKeyList[<span class="number">2</span>] = ulKeyTmpList[<span class="number">2</span>] ^ TBL_SYS_PARAMS[<span class="number">2</span>];</span><br><span class="line">        ulKeyList[<span class="number">3</span>] = ulKeyTmpList[<span class="number">3</span>] ^ TBL_SYS_PARAMS[<span class="number">3</span>];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">32</span>; i++)             <span class="comment">//32次循环迭代运算</span></span><br><span class="line">        &#123;</span><br><span class="line">                <span class="comment">//5-36为32个子秘钥</span></span><br><span class="line">                ulKeyList[i + <span class="number">4</span>] = ulKeyList[i] ^ func_key(ulKeyList[i + <span class="number">1</span>] ^ ulKeyList[i + <span class="number">2</span>] ^ ulKeyList[i + <span class="number">3</span>] ^ TBL_FIX_PARAMS[i]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">/***********************************生成32轮32位长子秘钥结束**********************************/</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; len; i++)        <span class="comment">//将输入数据存放在p缓存区</span></span><br><span class="line">                *(p + i) = *(input + i);</span><br><span class="line">        <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">16</span>-len % <span class="number">16</span>; i++)<span class="comment">//将不足16位补0凑齐16的整数倍</span></span><br><span class="line">                *(p + len + i) = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; len / <span class="number">16</span> + ((len % <span class="number">16</span>) ? <span class="number">1</span>:<span class="number">0</span>); j++)  <span class="comment">//进行循环加密,并将加密后数据保存（可以看出此处是以16字节为一次加密，进行循环，即若16字节则进行一次，17字节补0至32字节后进行加密两次，以此类推）</span></span><br><span class="line">        &#123;</span><br><span class="line">                <span class="comment">/*开始处理加密数据*/</span></span><br><span class="line">                four_uCh2uLong(p + <span class="number">16</span> * j, &amp;(ulDataList[<span class="number">0</span>]));</span><br><span class="line">                four_uCh2uLong(p + <span class="number">16</span> * j + <span class="number">4</span>, &amp;(ulDataList[<span class="number">1</span>]));</span><br><span class="line">                four_uCh2uLong(p + <span class="number">16</span> * j + <span class="number">8</span>, &amp;(ulDataList[<span class="number">2</span>]));</span><br><span class="line">                four_uCh2uLong(p + <span class="number">16</span> * j + <span class="number">12</span>, &amp;(ulDataList[<span class="number">3</span>]));</span><br><span class="line">                <span class="comment">//加密</span></span><br><span class="line">                <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">32</span>; i++)</span><br><span class="line">                &#123;</span><br><span class="line">                        ulDataList[i + <span class="number">4</span>] = ulDataList[i] ^ func_data(ulDataList[i + <span class="number">1</span>] ^ ulDataList[i + <span class="number">2</span>] ^ ulDataList[i + <span class="number">3</span>] ^ ulKeyList[i + <span class="number">4</span>]);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">/*将加密后数据输出*/</span></span><br><span class="line">                uLong2four_uCh(ulDataList[<span class="number">35</span>], output + <span class="number">16</span> * j);</span><br><span class="line">                uLong2four_uCh(ulDataList[<span class="number">34</span>], output + <span class="number">16</span> * j + <span class="number">4</span>);</span><br><span class="line">                uLong2four_uCh(ulDataList[<span class="number">33</span>], output + <span class="number">16</span> * j + <span class="number">8</span>);</span><br><span class="line">                uLong2four_uCh(ulDataList[<span class="number">32</span>], output + <span class="number">16</span> * j + <span class="number">12</span>);</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//解密函数（与加密函数基本一致，只是秘钥使用的顺序不同，即把钥匙反着用就是解密）</span></span><br><span class="line"><span class="comment">//len:数据长度 key:密钥 input:输入的加密后数据 output:输出的解密后数据</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">decode_fun</span><span class="params">(u8 len,u8 *key, u8 *input, u8 *output)</span></span><br><span class="line">&#123;</span><br><span class="line">        <span class="type">int</span> i = <span class="number">0</span>,j=<span class="number">0</span>;</span><br><span class="line">        u32 ulKeyTmpList[<span class="number">4</span>] = &#123; <span class="number">0</span> &#125;;<span class="comment">//存储密钥的u32数据</span></span><br><span class="line">        u32 ulKeyList[<span class="number">36</span>] = &#123; <span class="number">0</span> &#125;;  <span class="comment">//用于密钥扩展算法与系统参数FK运算后的结果存储</span></span><br><span class="line">        u32 ulDataList[<span class="number">36</span>] = &#123; <span class="number">0</span> &#125;; <span class="comment">//用于存放加密数据</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">/*开始生成子秘钥*/</span></span><br><span class="line">        four_uCh2uLong(key, &amp;(ulKeyTmpList[<span class="number">0</span>]));</span><br><span class="line">        four_uCh2uLong(key + <span class="number">4</span>, &amp;(ulKeyTmpList[<span class="number">1</span>]));</span><br><span class="line">        four_uCh2uLong(key + <span class="number">8</span>, &amp;(ulKeyTmpList[<span class="number">2</span>]));</span><br><span class="line">        four_uCh2uLong(key + <span class="number">12</span>, &amp;(ulKeyTmpList[<span class="number">3</span>]));</span><br><span class="line"></span><br><span class="line">        ulKeyList[<span class="number">0</span>] = ulKeyTmpList[<span class="number">0</span>] ^ TBL_SYS_PARAMS[<span class="number">0</span>];</span><br><span class="line">        ulKeyList[<span class="number">1</span>] = ulKeyTmpList[<span class="number">1</span>] ^ TBL_SYS_PARAMS[<span class="number">1</span>];</span><br><span class="line">        ulKeyList[<span class="number">2</span>] = ulKeyTmpList[<span class="number">2</span>] ^ TBL_SYS_PARAMS[<span class="number">2</span>];</span><br><span class="line">        ulKeyList[<span class="number">3</span>] = ulKeyTmpList[<span class="number">3</span>] ^ TBL_SYS_PARAMS[<span class="number">3</span>];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">32</span>; i++)             <span class="comment">//32次循环迭代运算</span></span><br><span class="line">        &#123;</span><br><span class="line">                <span class="comment">//5-36为32个子秘钥</span></span><br><span class="line">                ulKeyList[i + <span class="number">4</span>] = ulKeyList[i] ^ func_key(ulKeyList[i + <span class="number">1</span>] ^ ulKeyList[i + <span class="number">2</span>] ^ ulKeyList[i + <span class="number">3</span>] ^ TBL_FIX_PARAMS[i]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">/*生成32轮32位长子秘钥结束*/</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; len / <span class="number">16</span>; j++)  <span class="comment">//进行循环加密,并将加密后数据保存</span></span><br><span class="line">        &#123;</span><br><span class="line">                <span class="comment">/*开始处理解密数据*/</span></span><br><span class="line">                four_uCh2uLong(input + <span class="number">16</span> * j, &amp;(ulDataList[<span class="number">0</span>]));</span><br><span class="line">                four_uCh2uLong(input + <span class="number">16</span> * j + <span class="number">4</span>, &amp;(ulDataList[<span class="number">1</span>]));</span><br><span class="line">                four_uCh2uLong(input + <span class="number">16</span> * j + <span class="number">8</span>, &amp;(ulDataList[<span class="number">2</span>]));</span><br><span class="line">                four_uCh2uLong(input + <span class="number">16</span> * j + <span class="number">12</span>, &amp;(ulDataList[<span class="number">3</span>]));</span><br><span class="line"></span><br><span class="line">                <span class="comment">//解密</span></span><br><span class="line">                <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">32</span>; i++)</span><br><span class="line">                &#123;</span><br><span class="line">                        ulDataList[i + <span class="number">4</span>] = ulDataList[i] ^ func_data(ulDataList[i + <span class="number">1</span>] ^ ulDataList[i + <span class="number">2</span>] ^ ulDataList[i + <span class="number">3</span>] ^ ulKeyList[<span class="number">35</span> - i]);<span class="comment">//与加密唯一不同的就是轮密钥的使用顺序</span></span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">/*将解密后数据输出*/</span></span><br><span class="line">                uLong2four_uCh(ulDataList[<span class="number">35</span>], output + <span class="number">16</span> * j);</span><br><span class="line">                uLong2four_uCh(ulDataList[<span class="number">34</span>], output + <span class="number">16</span> * j + <span class="number">4</span>);</span><br><span class="line">                uLong2four_uCh(ulDataList[<span class="number">33</span>], output + <span class="number">16</span> * j + <span class="number">8</span>);</span><br><span class="line">                uLong2four_uCh(ulDataList[<span class="number">32</span>], output + <span class="number">16</span> * j + <span class="number">12</span>);</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//无符号字符数组转16进制打印</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">print_hex</span><span class="params">(u8 *data, <span class="type">int</span> len)</span></span><br><span class="line">&#123;</span><br><span class="line">        <span class="type">int</span> i = <span class="number">0</span>;</span><br><span class="line">        <span class="type">char</span> alTmp[<span class="number">16</span>] = &#123; <span class="string">&#x27;0&#x27;</span>,<span class="string">&#x27;1&#x27;</span>,<span class="string">&#x27;2&#x27;</span>,<span class="string">&#x27;3&#x27;</span>,<span class="string">&#x27;4&#x27;</span>,<span class="string">&#x27;5&#x27;</span>,<span class="string">&#x27;6&#x27;</span>,<span class="string">&#x27;7&#x27;</span>,<span class="string">&#x27;8&#x27;</span>,<span class="string">&#x27;9&#x27;</span>,<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;b&#x27;</span>,<span class="string">&#x27;c&#x27;</span>,<span class="string">&#x27;d&#x27;</span>,<span class="string">&#x27;e&#x27;</span>,<span class="string">&#x27;f&#x27;</span> &#125;;</span><br><span class="line">        <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; len; i++)</span><br><span class="line">        &#123;</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;%c&quot;</span>, alTmp[data[i] / <span class="number">16</span>]);</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;%c&quot;</span>, alTmp[data[i] % <span class="number">16</span>]);</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="string">&#x27; &#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*在主函数中实现任意字节加密与解密，并且结果正确*/</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">        u8 i,len;</span><br><span class="line">        u8 encode_Result[<span class="number">50</span>] = &#123; <span class="number">0</span> &#125;;    <span class="comment">//定义加密输出缓存区</span></span><br><span class="line">        u8 decode_Result[<span class="number">50</span>] = &#123; <span class="number">0</span> &#125;;    <span class="comment">//定义解密输出缓存区</span></span><br><span class="line">        u8 key[<span class="number">16</span>] = &#123; <span class="number">0x74</span>,<span class="number">0x68</span>,<span class="number">0x65</span>,<span class="number">0x6b</span>,<span class="number">0x65</span>,<span class="number">0x79</span>,<span class="number">0x74</span>,<span class="number">0x6f</span>,<span class="number">0x73</span>,<span class="number">0x6f</span>,<span class="number">0x6d</span>,<span class="number">0x65</span>,<span class="number">0x74</span>,<span class="number">0x68</span>,<span class="number">0x69</span>,<span class="number">0x6e</span> &#125;;       <span class="comment">//定义16字节的密钥</span></span><br><span class="line">    <span class="comment">/*u8 Data_plain[45]=&#123;0x6d,0x6f,0x65,0x63,0x74,0x66,</span></span><br><span class="line"><span class="comment">                             0x7b,0x43,0x6f,0x6e,0x67,0x72,</span></span><br><span class="line"><span class="comment">                                                 0x61,0x74,0x75,0x6c,0x61,0x74,</span></span><br><span class="line"><span class="comment">                                                 0x69,0x6f,0x6e,0x73,0x5f,0x79,</span></span><br><span class="line"><span class="comment">                                                 0x6f,0x75,0x5f,0x61,0x72,0x65,</span></span><br><span class="line"><span class="comment">                                                 0x5f,0x61,0x6e,0x5f,0x53,0x4d,</span></span><br><span class="line"><span class="comment">                                                 0x34,0x5f,0x6d,0x61,0x73,0x74,</span></span><br><span class="line"><span class="comment">                                                 0x65,0x72,0x21,0x21,0x21,0x7d&#125;;//moectf&#123;Congratulations_you_are_an_SM4_master!!!&#125;*/</span></span><br><span class="line">        u8 Data_plain[<span class="number">48</span>]=&#123;<span class="number">0</span>&#125;;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;please input your flag:\n&quot;</span>);</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>,Data_plain);</span><br><span class="line">        len = <span class="number">16</span> * (<span class="keyword">sizeof</span>(Data_plain) / <span class="number">16</span>) + <span class="number">16</span> * ((<span class="keyword">sizeof</span>(Data_plain) % <span class="number">16</span>) ? <span class="number">1</span> : <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">        encode_fun(<span class="keyword">sizeof</span>(Data_plain),key, Data_plain, encode_Result);            <span class="comment">//数据加密</span></span><br><span class="line">        <span class="comment">//printf(&quot;加密后数据是：\n&quot;);</span></span><br><span class="line">        <span class="comment">//for (i = 0; i &lt; len ; i++)</span></span><br><span class="line">        <span class="comment">//        printf(&quot;0x%x,&quot;, *(encode_Result + i));</span></span><br><span class="line">        u8 enc[<span class="number">48</span>]=&#123;<span class="number">0xad</span>,<span class="number">0x6c</span>,<span class="number">0xcd</span>,<span class="number">0xc1</span>,<span class="number">0x9</span>,<span class="number">0xfc</span>,<span class="number">0xdd</span>,<span class="number">0xef</span>,<span class="number">0x83</span>,<span class="number">0xae</span>,<span class="number">0x93</span>,<span class="number">0x8</span>,<span class="number">0x53</span>,<span class="number">0x8e</span>,<span class="number">0xc5</span>,<span class="number">0x37</span>,<span class="number">0x5c</span>,<span class="number">0xdd</span>,<span class="number">0x1b</span>,<span class="number">0x4b</span>,<span class="number">0x3</span>,<span class="number">0x99</span>,<span class="number">0x19</span>,<span class="number">0xa2</span>,<span class="number">0x69</span>,<span class="number">0x24</span>,<span class="number">0x96</span>,<span class="number">0x42</span>,<span class="number">0x77</span>,<span class="number">0xc1</span>,<span class="number">0x27</span>,<span class="number">0x5f</span>,<span class="number">0x2d</span>,<span class="number">0xd4</span>,<span class="number">0x5d</span>,<span class="number">0xf5</span>,<span class="number">0x2b</span>,<span class="number">0xb0</span>,<span class="number">0x32</span>,<span class="number">0xf7</span>,<span class="number">0xa5</span>,<span class="number">0x97</span>,<span class="number">0xc6</span>,<span class="number">0x8a</span>,<span class="number">0xee</span>,<span class="number">0x48</span>,<span class="number">0xae</span>,<span class="number">0x93</span>&#125;;                </span><br><span class="line">        decode_fun(len,key, encode_Result, decode_Result);      <span class="comment">//数据解密</span></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;解密后数据是：\n&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; len; i++)</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%x &quot;</span>, *(decode_Result + i)); </span><br><span class="line">        <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;<span class="number">48</span>;i++)</span><br><span class="line">        &#123;</span><br><span class="line">                <span class="keyword">if</span>(enc[i]!=*(encode_Result+i))</span><br><span class="line">                &#123;</span><br><span class="line">                        <span class="built_in">printf</span>(<span class="string">&quot;Wrong!&quot;</span>);</span><br><span class="line">                        <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">                &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Congratulations&quot;</span>);</span><br><span class="line">        system(<span class="string">&quot;pause&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>是从网上找到的SM4加密实现，但是程序在输入的时候，使用了scanf并且当你输入正确的flag长度的时候，最后一个是0字符截断，他会覆盖下一个变量的首字节，刚好下一个变量是key，所以key的首字节变成了0，导致很多人解不出来，其实只要输入一个正确长度的flag就可以进行解密。<br><code>moectf&#123;Congratulations_you_are_an_SM4_master!!!&#125;</code></p><h1 id="ezMAZE"><a href="#ezMAZE" class="headerlink" title="ezMAZE"></a>ezMAZE</h1><p>题目使用了OI常用技巧——状态压缩来存储迷宫，使用二进制的1和0代表是否可以通过。<br>题目源码</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;memory.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">char</span> buf[<span class="number">1177</span>] = &#123; <span class="number">0</span> &#125;;</span><br><span class="line"><span class="type">unsigned</span> <span class="type">char</span> theMaze[<span class="number">56</span>][<span class="number">10</span>] = &#123;</span><br><span class="line">        <span class="number">0xff</span>,<span class="number">0xff</span>,<span class="number">0xff</span>,<span class="number">0xff</span>,<span class="number">0xff</span>,<span class="number">0xff</span>,<span class="number">0xff</span>,<span class="number">0xff</span>,<span class="number">0xff</span>,<span class="number">0xff</span>,</span><br><span class="line">        <span class="number">0xbf</span>,<span class="number">0xff</span>,<span class="number">0xea</span>,<span class="number">0xa8</span>,<span class="number">0xa4</span>,<span class="number">0x92</span>,<span class="number">0x4f</span>,<span class="number">0xff</span>,<span class="number">0xff</span>,<span class="number">0xff</span>,</span><br><span class="line">        <span class="number">0x80</span>,<span class="number">0x00</span>,<span class="number">0x3d</span>,<span class="number">0x14</span>,<span class="number">0x94</span>,<span class="number">0x92</span>,<span class="number">0xb8</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0xff</span>,</span><br><span class="line">        <span class="number">0xff</span>,<span class="number">0xff</span>,<span class="number">0xbb</span>,<span class="number">0xda</span>,<span class="number">0x1f</span>,<span class="number">0x29</span>,<span class="number">0x7b</span>,<span class="number">0xff</span>,<span class="number">0xfe</span>,<span class="number">0xff</span>,</span><br><span class="line">        <span class="number">0xc0</span>,<span class="number">0x00</span>,<span class="number">0x3b</span>,<span class="number">0xda</span>,<span class="number">0xdc</span>,<span class="number">0x00</span>,<span class="number">0x03</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0xff</span>,</span><br><span class="line">        <span class="number">0xdf</span>,<span class="number">0xff</span>,<span class="number">0xfb</span>,<span class="number">0xda</span>,<span class="number">0xdd</span>,<span class="number">0xff</span>,<span class="number">0xff</span>,<span class="number">0x7f</span>,<span class="number">0xff</span>,<span class="number">0xff</span>,</span><br><span class="line">        <span class="number">0xc0</span>,<span class="number">0x00</span>,<span class="number">0x3b</span>,<span class="number">0xda</span>,<span class="number">0xdc</span>,<span class="number">0x00</span>,<span class="number">0x03</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0xff</span>,</span><br><span class="line">        <span class="number">0xff</span>,<span class="number">0xff</span>,<span class="number">0xb8</span>,<span class="number">0x42</span>,<span class="number">0x1f</span>,<span class="number">0xff</span>,<span class="number">0xfb</span>,<span class="number">0xff</span>,<span class="number">0xfe</span>,<span class="number">0xff</span>,</span><br><span class="line">        <span class="number">0xc0</span>,<span class="number">0x00</span>,<span class="number">0x3f</span>,<span class="number">0xff</span>,<span class="number">0xfc</span>,<span class="number">0x00</span>,<span class="number">0x03</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0xff</span>,</span><br><span class="line">        <span class="number">0xdf</span>,<span class="number">0xff</span>,<span class="number">0xf8</span>,<span class="number">0x7c</span>,<span class="number">0x3d</span>,<span class="number">0xff</span>,<span class="number">0xff</span>,<span class="number">0x7f</span>,<span class="number">0xff</span>,<span class="number">0xff</span>,</span><br><span class="line">        <span class="number">0xc0</span>,<span class="number">0x00</span>,<span class="number">0x3b</span>,<span class="number">0xfd</span>,<span class="number">0xbc</span>,<span class="number">0x00</span>,<span class="number">0x03</span>,<span class="number">0x00</span>,<span class="number">0x3e</span>,<span class="number">0x1f</span>,</span><br><span class="line">        <span class="number">0xff</span>,<span class="number">0xff</span>,<span class="number">0xb8</span>,<span class="number">0x7c</span>,<span class="number">0x7f</span>,<span class="number">0xff</span>,<span class="number">0xfb</span>,<span class="number">0xff</span>,<span class="number">0xbe</span>,<span class="number">0xdf</span>,</span><br><span class="line">        <span class="number">0xff</span>,<span class="number">0xff</span>,<span class="number">0xbf</span>,<span class="number">0x7d</span>,<span class="number">0xbd</span>,<span class="number">0x29</span>,<span class="number">0x7b</span>,<span class="number">0xff</span>,<span class="number">0xbe</span>,<span class="number">0xdf</span>,</span><br><span class="line">        <span class="number">0xff</span>,<span class="number">0xff</span>,<span class="number">0x98</span>,<span class="number">0x7c</span>,<span class="number">0x3f</span>,<span class="number">0xff</span>,<span class="number">0xfb</span>,<span class="number">0xff</span>,<span class="number">0xbe</span>,<span class="number">0xdf</span>,</span><br><span class="line">        <span class="number">0x80</span>,<span class="number">0x00</span>,<span class="number">0x4f</span>,<span class="number">0xff</span>,<span class="number">0xf8</span>,<span class="number">0x00</span>,<span class="number">0x02</span>,<span class="number">0x00</span>,<span class="number">0x3e</span>,<span class="number">0xdf</span>,</span><br><span class="line">        <span class="number">0xbf</span>,<span class="number">0x7f</span>,<span class="number">0x6f</span>,<span class="number">0xff</span>,<span class="number">0xfb</span>,<span class="number">0xff</span>,<span class="number">0xfe</span>,<span class="number">0xff</span>,<span class="number">0xfe</span>,<span class="number">0xdf</span>,</span><br><span class="line">        <span class="number">0x96</span>,<span class="number">0xab</span>,<span class="number">0x60</span>,<span class="number">0x00</span>,<span class="number">0x08</span>,<span class="number">0x00</span>,<span class="number">0x02</span>,<span class="number">0x01</span>,<span class="number">0xfe</span>,<span class="number">0xdf</span>,</span><br><span class="line">        <span class="number">0x96</span>,<span class="number">0xab</span>,<span class="number">0x7f</span>,<span class="number">0xff</span>,<span class="number">0xef</span>,<span class="number">0xff</span>,<span class="number">0xfb</span>,<span class="number">0xfd</span>,<span class="number">0xfe</span>,<span class="number">0xdf</span>,</span><br><span class="line">        <span class="number">0x95</span>,<span class="number">0x4b</span>,<span class="number">0x70</span>,<span class="number">0x00</span>,<span class="number">0x0c</span>,<span class="number">0x00</span>,<span class="number">0x03</span>,<span class="number">0x01</span>,<span class="number">0xfe</span>,<span class="number">0xdf</span>,</span><br><span class="line">        <span class="number">0x95</span>,<span class="number">0x4b</span>,<span class="number">0x77</span>,<span class="number">0xff</span>,<span class="number">0xfd</span>,<span class="number">0xff</span>,<span class="number">0xff</span>,<span class="number">0x7f</span>,<span class="number">0xfe</span>,<span class="number">0xdf</span>,</span><br><span class="line">        <span class="number">0xaa</span>,<span class="number">0x96</span>,<span class="number">0x70</span>,<span class="number">0x00</span>,<span class="number">0x0c</span>,<span class="number">0x00</span>,<span class="number">0x03</span>,<span class="number">0x00</span>,<span class="number">0x06</span>,<span class="number">0xdf</span>,</span><br><span class="line">        <span class="number">0x92</span>,<span class="number">0x57</span>,<span class="number">0x7f</span>,<span class="number">0xff</span>,<span class="number">0xef</span>,<span class="number">0xff</span>,<span class="number">0xfb</span>,<span class="number">0xff</span>,<span class="number">0xf6</span>,<span class="number">0xdf</span>,</span><br><span class="line">        <span class="number">0x92</span>,<span class="number">0x94</span>,<span class="number">0x70</span>,<span class="number">0x00</span>,<span class="number">0x0c</span>,<span class="number">0x00</span>,<span class="number">0x03</span>,<span class="number">0x00</span>,<span class="number">0x06</span>,<span class="number">0xdf</span>,</span><br><span class="line">        <span class="number">0x8a</span>,<span class="number">0x4b</span>,<span class="number">0x77</span>,<span class="number">0xff</span>,<span class="number">0xfd</span>,<span class="number">0xff</span>,<span class="number">0xff</span>,<span class="number">0x7f</span>,<span class="number">0xfe</span>,<span class="number">0xdf</span>,</span><br><span class="line">        <span class="number">0xae</span>,<span class="number">0xd5</span>,<span class="number">0x70</span>,<span class="number">0x00</span>,<span class="number">0x0c</span>,<span class="number">0x00</span>,<span class="number">0x03</span>,<span class="number">0x00</span>,<span class="number">0x0e</span>,<span class="number">0xdf</span>,</span><br><span class="line">        <span class="number">0x95</span>,<span class="number">0x4a</span>,<span class="number">0xff</span>,<span class="number">0xff</span>,<span class="number">0xef</span>,<span class="number">0xff</span>,<span class="number">0xfb</span>,<span class="number">0xff</span>,<span class="number">0xee</span>,<span class="number">0xdf</span>,</span><br><span class="line">        <span class="number">0x8a</span>,<span class="number">0x4a</span>,<span class="number">0x4a</span>,<span class="number">0x50</span>,<span class="number">0xec</span>,<span class="number">0x00</span>,<span class="number">0x03</span>,<span class="number">0xff</span>,<span class="number">0xee</span>,<span class="number">0xdf</span>,</span><br><span class="line">        <span class="number">0xbf</span>,<span class="number">0x7f</span>,<span class="number">0x7f</span>,<span class="number">0xff</span>,<span class="number">0xe1</span>,<span class="number">0xff</span>,<span class="number">0xff</span>,<span class="number">0xff</span>,<span class="number">0xee</span>,<span class="number">0xdf</span>,</span><br><span class="line">        <span class="number">0xff</span>,<span class="number">0xff</span>,<span class="number">0xf5</span>,<span class="number">0x5d</span>,<span class="number">0x7f</span>,<span class="number">0xff</span>,<span class="number">0xff</span>,<span class="number">0xff</span>,<span class="number">0xee</span>,<span class="number">0xdf</span>,</span><br><span class="line">        <span class="number">0x80</span>,<span class="number">0x00</span>,<span class="number">0x38</span>,<span class="number">0xd5</span>,<span class="number">0x35</span>,<span class="number">0x2a</span>,<span class="number">0x98</span>,<span class="number">0x00</span>,<span class="number">0x0e</span>,<span class="number">0xdf</span>,</span><br><span class="line">        <span class="number">0xbf</span>,<span class="number">0xff</span>,<span class="number">0xbd</span>,<span class="number">0x51</span>,<span class="number">0x2f</span>,<span class="number">0xff</span>,<span class="number">0xfb</span>,<span class="number">0xff</span>,<span class="number">0xfe</span>,<span class="number">0xdf</span>,</span><br><span class="line">        <span class="number">0xa0</span>,<span class="number">0x00</span>,<span class="number">0x3f</span>,<span class="number">0xff</span>,<span class="number">0xfc</span>,<span class="number">0x00</span>,<span class="number">0x03</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0xdf</span>,</span><br><span class="line">        <span class="number">0xaf</span>,<span class="number">0xff</span>,<span class="number">0xff</span>,<span class="number">0xc0</span>,<span class="number">0x7d</span>,<span class="number">0xff</span>,<span class="number">0xff</span>,<span class="number">0x7f</span>,<span class="number">0xff</span>,<span class="number">0xdf</span>,</span><br><span class="line">        <span class="number">0xa0</span>,<span class="number">0x00</span>,<span class="number">0x3f</span>,<span class="number">0xdf</span>,<span class="number">0x7c</span>,<span class="number">0x00</span>,<span class="number">0x03</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0xdf</span>,</span><br><span class="line">        <span class="number">0xbf</span>,<span class="number">0xff</span>,<span class="number">0xbf</span>,<span class="number">0xdf</span>,<span class="number">0x7f</span>,<span class="number">0xff</span>,<span class="number">0xfb</span>,<span class="number">0xff</span>,<span class="number">0xfe</span>,<span class="number">0xdf</span>,</span><br><span class="line">        <span class="number">0xa0</span>,<span class="number">0x00</span>,<span class="number">0x3f</span>,<span class="number">0xdf</span>,<span class="number">0x7c</span>,<span class="number">0x00</span>,<span class="number">0x03</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0xdf</span>,</span><br><span class="line">        <span class="number">0xaf</span>,<span class="number">0xff</span>,<span class="number">0xff</span>,<span class="number">0xdf</span>,<span class="number">0x7d</span>,<span class="number">0xff</span>,<span class="number">0xff</span>,<span class="number">0x7f</span>,<span class="number">0xff</span>,<span class="number">0xdf</span>,</span><br><span class="line">        <span class="number">0xa0</span>,<span class="number">0x00</span>,<span class="number">0x3f</span>,<span class="number">0xdf</span>,<span class="number">0x7c</span>,<span class="number">0x00</span>,<span class="number">0x03</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0xdf</span>,</span><br><span class="line">        <span class="number">0xbf</span>,<span class="number">0xff</span>,<span class="number">0xbf</span>,<span class="number">0xdf</span>,<span class="number">0x7f</span>,<span class="number">0xff</span>,<span class="number">0xfb</span>,<span class="number">0xff</span>,<span class="number">0xfe</span>,<span class="number">0xdf</span>,</span><br><span class="line">        <span class="number">0xbc</span>,<span class="number">0x8b</span>,<span class="number">0xbf</span>,<span class="number">0xdf</span>,<span class="number">0x7f</span>,<span class="number">0xff</span>,<span class="number">0xfb</span>,<span class="number">0xff</span>,<span class="number">0xfe</span>,<span class="number">0xdf</span>,</span><br><span class="line">        <span class="number">0xa9</span>,<span class="number">0x24</span>,<span class="number">0x9f</span>,<span class="number">0xdf</span>,<span class="number">0x7f</span>,<span class="number">0xff</span>,<span class="number">0xfb</span>,<span class="number">0xff</span>,<span class="number">0xfe</span>,<span class="number">0x5f</span>,</span><br><span class="line">        <span class="number">0xb2</span>,<span class="number">0xa1</span>,<span class="number">0xcf</span>,<span class="number">0xdf</span>,<span class="number">0x78</span>,<span class="number">0x00</span>,<span class="number">0x02</span>,<span class="number">0x00</span>,<span class="number">0x03</span>,<span class="number">0x5f</span>,</span><br><span class="line">        <span class="number">0xb1</span>,<span class="number">0x52</span>,<span class="number">0xef</span>,<span class="number">0xdf</span>,<span class="number">0xfb</span>,<span class="number">0xff</span>,<span class="number">0xfe</span>,<span class="number">0xff</span>,<span class="number">0xfb</span>,<span class="number">0x5f</span>,</span><br><span class="line">        <span class="number">0xaa</span>,<span class="number">0x22</span>,<span class="number">0xe0</span>,<span class="number">0x00</span>,<span class="number">0x08</span>,<span class="number">0x00</span>,<span class="number">0x02</span>,<span class="number">0x01</span>,<span class="number">0xf8</span>,<span class="number">0x5f</span>,</span><br><span class="line">        <span class="number">0xbd</span>,<span class="number">0x29</span>,<span class="number">0xff</span>,<span class="number">0xff</span>,<span class="number">0xef</span>,<span class="number">0xff</span>,<span class="number">0xfb</span>,<span class="number">0xfd</span>,<span class="number">0xff</span>,<span class="number">0xdf</span>,</span><br><span class="line">        <span class="number">0xb2</span>,<span class="number">0x52</span>,<span class="number">0xb0</span>,<span class="number">0x00</span>,<span class="number">0x0c</span>,<span class="number">0x00</span>,<span class="number">0x03</span>,<span class="number">0x01</span>,<span class="number">0xff</span>,<span class="number">0xdf</span>,</span><br><span class="line">        <span class="number">0xb4</span>,<span class="number">0x94</span>,<span class="number">0xb7</span>,<span class="number">0xff</span>,<span class="number">0xfd</span>,<span class="number">0xff</span>,<span class="number">0xff</span>,<span class="number">0x7f</span>,<span class="number">0xff</span>,<span class="number">0xdf</span>,</span><br><span class="line">        <span class="number">0xb2</span>,<span class="number">0x4a</span>,<span class="number">0xb0</span>,<span class="number">0x00</span>,<span class="number">0x0c</span>,<span class="number">0x00</span>,<span class="number">0x03</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0xdf</span>,</span><br><span class="line">        <span class="number">0xb2</span>,<span class="number">0x52</span>,<span class="number">0x5f</span>,<span class="number">0xff</span>,<span class="number">0xef</span>,<span class="number">0xff</span>,<span class="number">0xfb</span>,<span class="number">0xff</span>,<span class="number">0xfe</span>,<span class="number">0xdf</span>,</span><br><span class="line">        <span class="number">0xb2</span>,<span class="number">0x54</span>,<span class="number">0xd0</span>,<span class="number">0x00</span>,<span class="number">0x0c</span>,<span class="number">0x00</span>,<span class="number">0x03</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0xdf</span>,</span><br><span class="line">        <span class="number">0xb2</span>,<span class="number">0x52</span>,<span class="number">0x57</span>,<span class="number">0xff</span>,<span class="number">0xfd</span>,<span class="number">0xff</span>,<span class="number">0xff</span>,<span class="number">0x7f</span>,<span class="number">0xff</span>,<span class="number">0xdf</span>,</span><br><span class="line">        <span class="number">0xb2</span>,<span class="number">0x91</span>,<span class="number">0x30</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x0f</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0xdf</span>,</span><br><span class="line">        <span class="number">0xb0</span>,<span class="number">0x89</span>,<span class="number">0x7f</span>,<span class="number">0xff</span>,<span class="number">0xff</span>,<span class="number">0xff</span>,<span class="number">0xf8</span>,<span class="number">0x7f</span>,<span class="number">0xfe</span>,<span class="number">0xdf</span>,</span><br><span class="line">        <span class="number">0xbc</span>,<span class="number">0x91</span>,<span class="number">0x10</span>,<span class="number">0xff</span>,<span class="number">0xe0</span>,<span class="number">0x00</span>,<span class="number">0x03</span>,<span class="number">0xff</span>,<span class="number">0xfe</span>,<span class="number">0xdf</span>,</span><br><span class="line">        <span class="number">0x80</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x0d</span>,<span class="number">0xff</span>,<span class="number">0xfe</span>,<span class="number">0x94</span>,<span class="number">0x8a</span>,<span class="number">0x5f</span>,</span><br><span class="line">        <span class="number">0xff</span>,<span class="number">0xff</span>,<span class="number">0xff</span>,<span class="number">0xff</span>,<span class="number">0xff</span>,<span class="number">0xff</span>,<span class="number">0xff</span>,<span class="number">0xff</span>,<span class="number">0xff</span>,<span class="number">0xff</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">checkForMaze</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span></span><br><span class="line">&#123;</span><br><span class="line">        <span class="type">unsigned</span> <span class="type">char</span> val;</span><br><span class="line">        <span class="comment">// 1 means cannot pass.</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (x &gt; <span class="number">10</span> * <span class="number">8</span> || y &gt; <span class="number">56</span> || x &lt; <span class="number">1</span> || y &lt; <span class="number">1</span>) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        val = theMaze[y - <span class="number">1</span>][(x - <span class="number">1</span>) / <span class="number">8</span>];</span><br><span class="line">        theMaze[y - <span class="number">1</span>][(x - <span class="number">1</span>) / <span class="number">8</span>] = val | (<span class="number">1</span> &lt;&lt; (<span class="number">7</span> - ((x - <span class="number">1</span>) % <span class="number">8</span>)));</span><br><span class="line">        <span class="keyword">return</span> ((val &gt;&gt; (<span class="number">7</span> - ((x - <span class="number">1</span>) % <span class="number">8</span>))) &amp; <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">char</span>* <span class="title function_">calculateFlag</span><span class="params">(<span class="type">char</span>* buf)</span></span><br><span class="line">&#123;</span><br><span class="line">        <span class="type">unsigned</span> <span class="type">long</span> <span class="type">long</span> sumOf;</span><br><span class="line">        <span class="type">char</span>* flag;</span><br><span class="line">        flag = (<span class="type">char</span>*)<span class="built_in">malloc</span>(<span class="number">128</span>);</span><br><span class="line">        memcpy_s(flag, <span class="number">40</span>, <span class="string">&quot;moectf&#123;&quot;</span>, <span class="number">7</span>);</span><br><span class="line">        sumOf = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">1176</span>; i++)</span><br><span class="line">        &#123;</span><br><span class="line">                sumOf += (buf[i] * <span class="number">3113131</span> * i + i * i + <span class="number">0x114514</span>) &amp; <span class="number">0xffffffffffffffff</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">snprintf</span>(flag + <span class="number">7</span>, <span class="number">128</span> - <span class="number">8</span>, <span class="string">&quot;the_%llu_amazing_maze!!&#125;&quot;</span>, sumOf);</span><br><span class="line">        <span class="keyword">return</span> flag;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">        <span class="type">char</span>* result;</span><br><span class="line">        <span class="type">int</span> x, y, i;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;M0EC7F-2024 ezMaze\n&quot;</span>);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;ohno I&#x27;v stuck in a M4Z3... h3lp me (use w,a,s,d)\n&quot;</span>);</span><br><span class="line">        x = <span class="number">2</span>;</span><br><span class="line">        y = <span class="number">2</span>;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;please input the path sequence...\n&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (!scanf_s(<span class="string">&quot;%1177s&quot;</span>, buf, <span class="number">1177</span>))</span><br><span class="line">        &#123;</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;input err.\n&quot;</span>);</span><br><span class="line">                <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        i = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">        &#123;</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;\rx =%3d, y =%3d&quot;</span>, x, y);</span><br><span class="line">                <span class="keyword">if</span> (x == <span class="number">75</span> &amp;&amp; y == <span class="number">55</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                        <span class="built_in">printf</span>(<span class="string">&quot;\n%s\n&quot;</span>, buf);</span><br><span class="line">                        result = calculateFlag(buf);</span><br><span class="line">                        <span class="built_in">printf</span>(<span class="string">&quot;\nYOU WIN!!! the flag is %s\n&quot;</span>, result);</span><br><span class="line">                        <span class="built_in">free</span>(result);</span><br><span class="line">                        system(<span class="string">&quot;pause&quot;</span>);</span><br><span class="line">                        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (!buf[i])</span><br><span class="line">                &#123;</span><br><span class="line">                        <span class="built_in">printf</span>(<span class="string">&quot;\nmission failed..\n&quot;</span>);</span><br><span class="line">                        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">switch</span> (buf[i++])</span><br><span class="line">                &#123;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&#x27;w&#x27;</span>:</span><br><span class="line">                        <span class="keyword">if</span> (y &gt; <span class="number">1</span> &amp;&amp; !checkForMaze(x, y - <span class="number">1</span>)) y -= <span class="number">1</span>;</span><br><span class="line">                        <span class="keyword">else</span> <span class="built_in">printf</span>(<span class="string">&quot;You cannot walk the same path!!\n&quot;</span>);</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&#x27;s&#x27;</span>:</span><br><span class="line">                        <span class="keyword">if</span> (y &lt; <span class="number">56</span> &amp;&amp; !checkForMaze(x, y + <span class="number">1</span>)) y += <span class="number">1</span>;</span><br><span class="line">                        <span class="keyword">else</span> <span class="built_in">printf</span>(<span class="string">&quot;You cannot walk the same path!!\n&quot;</span>);</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&#x27;a&#x27;</span>:</span><br><span class="line">                        <span class="keyword">if</span> (x &gt; <span class="number">1</span> &amp;&amp; !checkForMaze(x - <span class="number">1</span>, y)) x -= <span class="number">1</span>;</span><br><span class="line">                        <span class="keyword">else</span> <span class="built_in">printf</span>(<span class="string">&quot;You cannot walk the same path!!\n&quot;</span>);</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&#x27;d&#x27;</span>:</span><br><span class="line">                        <span class="keyword">if</span> (x &lt; <span class="number">10</span> * <span class="number">8</span> &amp;&amp; !checkForMaze(x + <span class="number">1</span>, y)) x += <span class="number">1</span>;</span><br><span class="line">                        <span class="keyword">else</span> <span class="built_in">printf</span>(<span class="string">&quot;You cannot walk the same path!!\n&quot;</span>);</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">default</span>:</span><br><span class="line">                        <span class="built_in">printf</span>(<span class="string">&quot;you can only input w,a,s,d\n&quot;</span>);</span><br><span class="line">                        <span class="keyword">continue</span>;</span><br><span class="line">                &#125;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>WP:<br>其一（抄出来，bfs）：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">using namespace <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">bool</span> <span class="title function_">is_wall</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="type">uint8_t</span> temp;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (x &gt; <span class="number">80</span> || y &gt; <span class="number">56</span> || x &lt; <span class="number">1</span> || y &lt; <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">temp = maze[<span class="number">10</span> * y - <span class="number">10</span> + (x - <span class="number">1</span>) / <span class="number">8</span>];</span><br><span class="line">maze[<span class="number">10</span> * y - <span class="number">10</span> + (x - <span class="number">1</span>) / <span class="number">8</span>] = (<span class="number">1</span> &lt;&lt; (<span class="number">7</span> - (x - <span class="number">1</span>) % <span class="number">8</span>)) | temp;</span><br><span class="line"><span class="keyword">return</span> ((<span class="type">int</span>)temp &gt;&gt; (<span class="number">7</span> - (x - <span class="number">1</span>) % <span class="number">8</span>)) &amp; <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">string</span> <span class="title function_">find_path</span><span class="params">(<span class="type">int</span> begin_x, <span class="type">int</span> begin_y, <span class="type">int</span> end_x, <span class="type">int</span> end_y)</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="built_in">vector</span>&lt;<span class="built_in">pair</span>&lt;<span class="type">int</span>, <span class="type">int</span>&gt;&gt; dirs = &#123;&#123;<span class="number">0</span>, <span class="number">-1</span>&#125;, &#123;<span class="number">0</span>, <span class="number">1</span>&#125;, &#123;<span class="number">-1</span>, <span class="number">0</span>&#125;, &#123;<span class="number">1</span>, <span class="number">0</span>&#125;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">vector</span></span><br><span class="line"></span><br><span class="line">&lt;<span class="type">char</span>&gt; dir_chars = &#123;<span class="string">&#x27;w&#x27;</span>, <span class="string">&#x27;s&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;d&#x27;</span>&#125;;&lt;/<span class="type">char</span>&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">queue</span>&lt;tuple&lt;<span class="type">int</span>, <span class="type">int</span>, <span class="built_in">string</span>&gt;&gt; q;</span><br><span class="line"><span class="built_in">set</span>&lt;<span class="built_in">pair</span>&lt;<span class="type">int</span>, <span class="type">int</span>&gt;&gt; visited;</span><br><span class="line"></span><br><span class="line">q.push(&#123;begin_x, begin_y, <span class="string">&quot;&quot;</span>&#125;);</span><br><span class="line">visited.insert(&#123;begin_x, begin_y&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> (!q.empty()) &#123;</span><br><span class="line">    <span class="keyword">auto</span> [x, y, path] = q.front();</span><br><span class="line">    q.pop();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (x == end_x &amp;&amp; y == end_y - <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> path;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; dirs.size(); ++i) &#123;</span><br><span class="line">        <span class="type">int</span> new_x = x + dirs[i].first;</span><br><span class="line">        <span class="type">int</span> new_y = y + dirs[i].second;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!is_wall(new_x, new_y) &amp;&amp; visited.find(&#123;new_x, new_y&#125;) == visited.end()) &#123;</span><br><span class="line">            visited.insert(&#123;new_x, new_y&#125;);</span><br><span class="line">            q.push(&#123;new_x, new_y, path + dir_chars[i]&#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> nullptr;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>因为那个函数其实就是判断(x,y)是否可通行，返回值也非常简单<br>其二（硬核爆破）</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">import subprocess</span><br><span class="line"></span><br><span class="line">directions = [<span class="string">&quot;w&quot;</span>, <span class="string">&quot;a&quot;</span>, <span class="string">&quot;s&quot;</span>, <span class="string">&quot;d&quot;</span>]</span><br><span class="line"></span><br><span class="line">def move(path) -&gt; str:</span><br><span class="line">    result = subprocess.run([<span class="string">&quot;echo&quot;</span>, path, <span class="string">&quot;|&quot;</span>, <span class="string">&quot;ezMaze.exe&quot;</span>], shell=True, capture_output=True, text=True)</span><br><span class="line">    <span class="keyword">return</span> result.<span class="built_in">stdout</span></span><br><span class="line"></span><br><span class="line">def main() -&gt; None:</span><br><span class="line">    <span class="built_in">stack</span> = [(<span class="string">&quot;&quot;</span>, (<span class="number">2</span>, <span class="number">2</span>))]</span><br><span class="line">    visited = <span class="built_in">set</span>()</span><br><span class="line">    visited.add((<span class="number">2</span>, <span class="number">2</span>))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> <span class="built_in">stack</span>:</span><br><span class="line">        path, (x, y) = <span class="built_in">stack</span>.pop()</span><br><span class="line">        result = move(path)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;YOU WIN!!! the flag is&quot;</span> in result:</span><br><span class="line">            print(path)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;You cannot walk the same path!!&quot;</span> in result:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> direction in directions:</span><br><span class="line">            new_path = path + direction</span><br><span class="line">            new_x, new_y = x, y</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> direction == <span class="string">&quot;w&quot;</span>:</span><br><span class="line">                new_y -= <span class="number">1</span></span><br><span class="line">            elif direction == <span class="string">&quot;a&quot;</span>:</span><br><span class="line">                new_x -= <span class="number">1</span></span><br><span class="line">            elif direction == <span class="string">&quot;s&quot;</span>:</span><br><span class="line">                new_y += <span class="number">1</span></span><br><span class="line">            elif direction == <span class="string">&quot;d&quot;</span>:</span><br><span class="line">                new_x += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (new_x, new_y) not in visited:</span><br><span class="line">                visited.add((new_x, new_y))</span><br><span class="line">                <span class="built_in">stack</span>.append((new_path, (new_x, new_y)))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>其三：<br>先用upx脱壳，本程序由于使用了x方向的状态压缩，把01的迷宫压缩成了一个数组，并且使用位运算进行读取。<br>所以把迷宫抄出来，用notepad++来显示路径，即可写出答案（或者使用bfs进行路径获取）</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sddddddddddddddddssaaaaaaaaaaaaaaassdddddddddddddddssaaaaaaaaaaaaaaassdddddddddddddddsssdsdssddddddddddddddddssaaaaaaaaaaaaaaassdddddddddddddddssaaaaaaaaaaaaaaassdddddddddddddddsssdddwdddddddddddddddwwaaaaaaaaaaaaaaawwdddddddddddddddwwaaaaaaaaaaaaaaawwdddddddddddddddwwaaaaaaaaaaaaaaaawwddddddddddddddddwwwwaaaaaaaaaaaaaaawwdddddddddddddddwwaaaaaaaaaaaaaaawwdddddddddddddddwwddddddddddddddddddssaaaaaaaaaaaaaaassdddddddddddddddssaaaaaaaaaaaaaaassdddddddddssssaaaaaaaaaassdddddddssaaaaaassddddddddddddssaaaaaaaaaaaassdddddddddddsssssaaaaaaaaaaaaaassaaaaaaaaaaaaaaassdddddddddddddddssaaaaaaaaaaaaaaassdddddddddddddddssssaaaaaaaaaaaaaaaassddddddddddddddddssaaaaaaaaaaaaaaassdddddddddddddddssaaaaaaaaaaaaaaassaaaaaaaaaaaaaaaaaawwdddddddddddddddwwaaaaaaaaaaaaaaawwdddddddddddddddwwaaaaaaaaaaaaaaaawwawawwwaaaaaaaaaaaaaawwddddddddddddddwwaaaaaaaaaaaaaawwddddddddddddddwwaaaaaaaaaaaaaaaasssssssssssssssssssssssssddddddddddddddddddddddddddddddddddwddddddddddddddddddwdddwwwdddddddddddddddwwaaaaaaaaaaaaaaawwddddddwwaaaaaaawwddddddddddddddssdddwwwawwwaaaaaaaaaaaaaaawwdddddddddddddddwwaaaaaaaaaaaaaaawwdddddddddddddddwwwwwwwwwwwwwwwwwwwwwdddssssssssssssssssssssssssssssssssssssssssssss</span><br></pre></td></tr></table></figure><p>路径是唯一解，因为不能往回走。（终点可以从程序里面拿到，是右下角最后一个0的位置）<br><code>moectf&#123;the_18446744024826406994_amazing_maze!!&#125;</code></p><h1 id="Just-Run-It"><a href="#Just-Run-It" class="headerlink" title="Just-Run-It"></a>Just-Run-It</h1><p>包含了四个可执行文件，这个题可以载入静态分析，获取flag，也可以仅仅RUN，获得flag<br>0x0 与 0x1均加了upx壳<br>0x0 windows下的x64执行文件，运行后</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">moectf2024@xdsec ~&gt; cat /flag.0</span><br><span class="line">6257396c5933526d657a55355a6d45</span><br></pre></td></tr></table></figure><p>0x1 linux下的x64执行文件，运行后</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">moectf2024@xdsec ~&gt; cat /flag.1</span><br><span class="line">324d444a6a4c5459794e4745744e44</span><br></pre></td></tr></table></figure><p>0x2 Android apk，安装并运行后</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">moectf2024@xdsec ~&gt; cat /flag.2</span><br><span class="line">42694e7930345954566a4c57557a4e</span><br></pre></td></tr></table></figure><p>APK源码</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.edu.xidian.myapplication</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.os.Bundle</span><br><span class="line"><span class="keyword">import</span> androidx.activity.ComponentActivity</span><br><span class="line"><span class="keyword">import</span> androidx.activity.compose.setContent</span><br><span class="line"><span class="keyword">import</span> androidx.compose.foundation.layout.Column</span><br><span class="line"><span class="keyword">import</span> androidx.compose.foundation.layout.fillMaxSize</span><br><span class="line"><span class="keyword">import</span> androidx.compose.material3.MaterialTheme</span><br><span class="line"><span class="keyword">import</span> androidx.compose.material3.Surface</span><br><span class="line"><span class="keyword">import</span> androidx.compose.material3.Text</span><br><span class="line"><span class="keyword">import</span> androidx.compose.runtime.Composable</span><br><span class="line"><span class="keyword">import</span> androidx.compose.runtime.remember</span><br><span class="line"><span class="keyword">import</span> androidx.compose.ui.Modifier</span><br><span class="line"><span class="keyword">import</span> androidx.compose.ui.tooling.preview.Preview</span><br><span class="line"><span class="keyword">import</span> cn.edu.xidian.myapplication.ui.theme.MyApplicationTheme</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MainActivity</span> : <span class="type">ComponentActivity</span>() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreate</span><span class="params">(savedInstanceState: <span class="type">Bundle</span>?)</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState)</span><br><span class="line">        setContent &#123;</span><br><span class="line">            MyApplicationTheme &#123;</span><br><span class="line">                <span class="comment">// A surface container using the &#x27;background&#x27; color from the theme</span></span><br><span class="line">                Surface(</span><br><span class="line">                    color = MaterialTheme.colorScheme.background</span><br><span class="line">                ) &#123;</span><br><span class="line">                    MyScreenContent()</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">MyScreenContent</span><span class="params">()</span></span> &#123;</span><br><span class="line">    Column(modifier = Modifier.fillMaxSize()) &#123;</span><br><span class="line">        Greeting(<span class="string">&quot;Android&quot;</span>)</span><br><span class="line">        render()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">Greeting</span><span class="params">(name: <span class="type">String</span>)</span></span> &#123;</span><br><span class="line">    Text(text = <span class="string">&quot;Hello moectf2024!&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">render</span><span class="params">()</span></span> &#123;</span><br><span class="line">    Column &#123;</span><br><span class="line">        Text(text = <span class="string">&quot;moectf2024@xdsec ~&gt; cat /flag.2&quot;</span>)</span><br><span class="line">        Text(text = <span class="string">&quot;42694e7930345954566a4c57557a4e&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Preview(showBackground = true)</span></span><br><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">DefaultPreview</span><span class="params">()</span></span> &#123;</span><br><span class="line">    MyApplicationTheme &#123;</span><br><span class="line">        MyScreenContent()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>0x3 riscv ELF64程序</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># Kali Linux 下</span><br><span class="line">sudo apt install qemu-user</span><br><span class="line">chmod +x ./0x3.riscv64.elf</span><br><span class="line">qemu-riscv64 ./0x3.riscv64.elf</span><br><span class="line"># [87, 85, 49, 78, 122, 82, 106, 90, 106, 108, 105, 79, 88, 48, 61]</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">a = [<span class="number">87</span>, <span class="number">85</span>, <span class="number">49</span>, <span class="number">78</span>, <span class="number">122</span>, <span class="number">82</span>, <span class="number">106</span>, <span class="number">90</span>, <span class="number">106</span>, <span class="number">108</span>, <span class="number">105</span>, <span class="number">79</span>, <span class="number">88</span>, <span class="number">48</span>, <span class="number">61</span>]</span><br><span class="line"><span class="string">&quot;&quot;</span>.join(<span class="built_in">map</span>(<span class="built_in">chr</span>,a))</span><br><span class="line"><span class="comment"># WU1NzRjZjliOX0=</span></span><br></pre></td></tr></table></figure><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">6257396c5933526d657a55355a6d45324d444a6a4c5459794e4745744e4442694e7930345954566a4c57557a4e</span><br><span class="line">bW9lY3RmezU5ZmE2MDJjLTYyNGEtNDBiNy04YTVjLWUzN</span><br><span class="line">再加上最后0x3的WU1NzRjZjliOX0=</span><br><span class="line">bW9lY3RmezU5ZmE2MDJjLTYyNGEtNDBiNy04YTVjLWUzNWU1NzRjZjliOX0=</span><br><span class="line">base64 decode</span><br><span class="line"># moectf&#123;59fa602c-624a-40b7-8a5c-e35e574cf9b9&#125;</span><br></pre></td></tr></table></figure><p><code>moectf&#123;59fa602c-624a-40b7-8a5c-e35e574cf9b9&#125;</code></p><h1 id="SecretModule"><a href="#SecretModule" class="headerlink" title="SecretModule"></a>SecretModule</h1><p>Magisk Module<br>Shell Script解密<br>然后是一点点Android知识<br>需要知道 getevent 命令</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">testk</span></span>() &#123;</span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;Welcome to the Secret module!But before you begin,you need to prove your self.&quot;</span></span><br><span class="line">  (/system/bin/getevent -lc 1 2&gt;&amp;1 | /system/bin/grep VOLUME | /system/bin/grep <span class="string">&quot; DOWN&quot;</span> &gt; <span class="variable">$MODPATH</span>/events) || <span class="built_in">return</span> 1</span><br><span class="line">  <span class="built_in">return</span> 0</span><br><span class="line">&#125;   </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">choose</span></span>() &#123;</span><br><span class="line">  <span class="keyword">while</span> <span class="literal">true</span>; <span class="keyword">do</span></span><br><span class="line">    /system/bin/getevent -lc 1 2&gt;&amp;1 | /system/bin/grep VOLUME | /system/bin/grep <span class="string">&quot; DOWN&quot;</span> &gt; <span class="variable">$MODPATH</span>/events</span><br><span class="line">    <span class="keyword">if</span> (`<span class="built_in">cat</span> <span class="variable">$MODPATH</span>/events 2&gt;/dev/null | /system/bin/grep VOLUME &gt;/dev/null`); <span class="keyword">then</span></span><br><span class="line">      <span class="built_in">break</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">  <span class="keyword">done</span></span><br><span class="line">  <span class="keyword">if</span> (`<span class="built_in">cat</span> <span class="variable">$MODPATH</span>/events 2&gt;/dev/null | /system/bin/grep VOLUMEUP &gt;/dev/null`); <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;114514&quot;</span></span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;1919810&quot;</span></span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> testk; <span class="keyword">then</span></span><br><span class="line">  ui_print <span class="string">&quot;Great! Now enter the secret.&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">  ui_print <span class="string">&quot;Legacy Device. Use a newer device to do this challenge&quot;</span></span><br><span class="line">  <span class="built_in">exit</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">concatenated=<span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> 1 2 3 4 5 6 7</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">  result=$(choose)</span><br><span class="line">  concatenated=<span class="string">&quot;<span class="variable">$&#123;concatenated&#125;</span><span class="variable">$&#123;result&#125;</span>&quot;</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">input_str=$(<span class="built_in">echo</span> -n <span class="variable">$concatenated</span> | <span class="built_in">md5sum</span> | awk <span class="string">&#x27;&#123;print $1&#125;&#x27;</span>)</span><br><span class="line">sec=<span class="string">&quot;77a58d62b2c0870132bfe8e8ea3ad7f1&quot;</span></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">test</span> <span class="variable">$input_str</span> = <span class="variable">$sec</span></span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">	<span class="built_in">echo</span> <span class="string">&#x27;You are right!Flag is&#x27;</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;moectf&#123;<span class="variable">$concatenated</span>&#125;&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&#x27;Wrong. Try again.&#x27;</span></span><br><span class="line">	<span class="built_in">exit</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>里面是一个MD5的选择爆破，用Python或者手动猜都可以。<br><code>114514114514191981011451411451419198101919810</code></p><h1 id="Cython-Strike-Bomb-Defusion"><a href="#Cython-Strike-Bomb-Defusion" class="headerlink" title="Cython-Strike: Bomb Defusion"></a>Cython-Strike: Bomb Defusion</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> bomb_defuse <span class="keyword">import</span> Bomb, DefuseKit</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">read_bombmemory</span>(<span class="params">kit</span>):</span><br><span class="line">    processed_data = []</span><br><span class="line">    <span class="keyword">for</span> address <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0x0</span>, <span class="number">0x400</span>):</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            data = kit.read_memory(address)</span><br><span class="line">            <span class="keyword">if</span> data != <span class="string">&#x27;0x0&#x27;</span>:</span><br><span class="line">                <span class="comment">#print(data)</span></span><br><span class="line">                processed_data.append(data)</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="comment">#print(e)</span></span><br><span class="line">            processed_data.append(<span class="string">&#x27;*&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> processed_data</span><br><span class="line"></span><br><span class="line">bomb = Bomb()</span><br><span class="line">kit = DefuseKit(bomb)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;Bomb State: <span class="subst">&#123;bomb.state&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;Bomb Mask: <span class="subst">&#123;bomb.mask&#125;</span>&quot;</span>)</span><br><span class="line">memory_data = read_bombmemory(kit)</span><br><span class="line">code = <span class="string">&#x27;&#x27;</span>.join(<span class="built_in">chr</span>(<span class="built_in">int</span>(data, <span class="number">16</span>)) <span class="keyword">if</span> data != <span class="string">&#x27;*&#x27;</span> <span class="keyword">else</span> <span class="string">&#x27;*&#x27;</span> <span class="keyword">for</span> data <span class="keyword">in</span> memory_data)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(code)</span><br><span class="line"></span><br><span class="line">password = <span class="number">3786171</span>  <span class="comment">#60578736 &gt;&gt; ((7355608 % 5) + 1)</span></span><br><span class="line">flag = bomb.enter_pwd(password)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;Bomb has been defused! Counter Terrorists Win! Flag: <span class="subst">&#123;flag&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#Your defusekit has successfully connected to the bomb! The wire are tangled, but you&#x27;ve found the bomb&#x27;s inst ram!</span></span><br><span class="line"><span class="comment">#Scanning through the inst ram...</span></span><br><span class="line"><span class="comment">#We&#x27;ve got access to some juicy data. Time to defuse!</span></span><br><span class="line"><span class="comment">#tip: use read_memory method to read data from the inst ram</span></span><br><span class="line"><span class="comment">#Bomb State: planted</span></span><br><span class="line"><span class="comment">#Bomb Mask: 7355608</span></span><br><span class="line"><span class="comment">#de*i*e MAX_*** 0xffffff***unsign*d int ma**;***int p*ant_b**b(unsigned int input)&#123;if *input &lt;= MAX_***) &#123;ma** = input;r**urn 0;&#125; e*se*&#123;***ret**n -1;&#125; &#125;***void expl*de_b*m***oid)*&#123;***void def**e_**mb(v*id)&#123;***&#125;***check_p**d(uns*gned*int in*u*)*&#123;if*(input*&gt; MAX_***)*&#123;***explode_b**b();***&#125;***if*((in**t ^ ma** == 114) &amp;&amp; (input &lt;&lt; (ma** % 5) + 1 == 60578736))*&#123;defuse_b**b();r**urn**&#125;***explode_b**b();***retu**;***&#125;</span></span><br><span class="line"><span class="comment">#Bomb defused! Flag: moectf&#123;CoUnter_TerR0rists_w1n&#125;</span></span><br></pre></td></tr></table></figure><p>找我们的gpt补一下源码：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> MAX_VAL 0xffffff</span></span><br><span class="line"><span class="type">unsigned</span> <span class="type">int</span> mask;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">plant_bomb</span><span class="params">(<span class="type">unsigned</span> <span class="type">int</span> input)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (input &lt;= MAX_VAL) &#123;</span><br><span class="line">        max = input;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">explode_bomb</span><span class="params">(<span class="type">void</span>)</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">defuse_bomb</span><span class="params">(<span class="type">void</span>)</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">check_pwd</span><span class="params">(<span class="type">unsigned</span> <span class="type">int</span> input)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (input &gt; MAX_VAL) &#123;</span><br><span class="line">        explode_bomb();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (input ^ mask == <span class="number">114</span> &amp;&amp; ((input &lt;&lt; ((mask % <span class="number">5</span>) + <span class="number">1</span>)) == <span class="number">60578736</span>)) &#123;</span><br><span class="line">        defuse_bomb();</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    explode_bomb();</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>值得注意的是 input ^ mask &#x3D;&#x3D; 114 ，其中由于运算符优先级，右边 mask &#x3D;&#x3D; 114 会被优先计算，很多选手都认为是题目的问题，而且python中，左边反而会被先计算…算是一个坑</li></ul><p><code>moectf&#123;CoUnter_TerR0rists_w1n&#125;</code></p><h1 id="SMCProMax"><a href="#SMCProMax" class="headerlink" title="SMCProMax"></a>SMCProMax</h1><p>SMC + 偷偷改东西 + z3使用<br>先动调，发现smc解密异或0x90，然后就可以patch，然后拖入IDA，可以抄出来一个类似hash的算法，但是这个算法是可以求解其输入的，我们就可以解了。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> z3 <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes <span class="keyword">as</span> l2b</span><br><span class="line"></span><br><span class="line">keys = [<span class="number">2053092702</span>,-<span class="number">490481854</span>,-<span class="number">1704322843</span>,-<span class="number">1418679088</span>,<span class="number">86802781</span>,<span class="number">987171458</span>,<span class="number">965631658</span>,<span class="number">264545711</span>,-<span class="number">1342106783</span>,-<span class="number">825370173</span>]</span><br><span class="line">x = [BitVec(<span class="string">f&quot;x<span class="subst">&#123;i&#125;</span>&quot;</span>, <span class="number">32</span>) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(keys))]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hash</span>(<span class="params">v</span>):</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">        <span class="comment"># 由于左移会变偶数，而xor后又会变成奇数，所以有唯一解</span></span><br><span class="line">        v = If(v &lt; <span class="number">0</span> , (v &lt;&lt; <span class="number">1</span>) ^ <span class="number">0xc4f3b4b3</span>, v &lt;&lt; <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">return</span> v</span><br><span class="line"></span><br><span class="line">s = Solver()</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(keys)):</span><br><span class="line">    s.add(<span class="built_in">hash</span>(x[i]) == keys[i])</span><br><span class="line">s.check()</span><br><span class="line">m = s.model()</span><br><span class="line"></span><br><span class="line">result = [<span class="number">0</span>] * <span class="built_in">len</span>(keys)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> p <span class="keyword">in</span> m.decls():</span><br><span class="line">    result[<span class="built_in">int</span>(p.name()[<span class="number">1</span>:])] = m[p].as_long()</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> result:</span><br><span class="line">    <span class="built_in">print</span>(l2b(i))</span><br><span class="line"></span><br><span class="line"><span class="comment"># moectf&#123;y0u_mu5t_know_vvHAt_1s__SMC__n0w&#125;</span></span><br></pre></td></tr></table></figure><p>但是要注意，这是程序在后面判断flag的逻辑<br>在此之前，程序偷偷修改了H字符，让它异或了0x12，所以正确的flag是</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">moectf&#123;y0u_mu5t_know_vvZAt_1s__SMC__n0w&#125;</span><br><span class="line">真不容易啊，终于对了！！这就是逆向，豪吃，多吃。</span><br><span class="line">Press any key to continue . . .</span><br></pre></td></tr></table></figure><p><code>moectf&#123;y0u_mu5t_know_vvZAt_1s__SMC__n0w&#125;</code></p><h1 id="ezMAZE-彩蛋"><a href="#ezMAZE-彩蛋" class="headerlink" title="ezMAZE-彩蛋"></a>ezMAZE-彩蛋</h1><p>接上文ezMAZE题目，在地图可以找到<br><code>moectf&#123;LUOSB&#125;</code></p><h1 id="xor-大嘘"><a href="#xor-大嘘" class="headerlink" title="xor(大嘘)"></a>xor(大嘘)</h1><p>XOR里面藏了一个TEA，并且有花指令，ida直接看不出来。<br>EXP</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">decrypt</span><span class="params">(<span class="type">uint32_t</span>* v, <span class="type">uint32_t</span>* k)</span> &#123;</span><br><span class="line">    <span class="type">uint32_t</span> v0 = v[<span class="number">0</span>], v1 = v[<span class="number">1</span>];</span><br><span class="line">    <span class="type">uint32_t</span> delta = <span class="number">0x9e3779b9</span>;</span><br><span class="line">    <span class="type">uint32_t</span> sum = delta * <span class="number">32</span>;</span><br><span class="line">    <span class="type">uint32_t</span> k0 = k[<span class="number">0</span>], k1 = k[<span class="number">1</span>], k2 = k[<span class="number">2</span>], k3 = k[<span class="number">3</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">32</span>; i++) &#123;</span><br><span class="line">        v1 -= ((v0 &lt;&lt; <span class="number">4</span>) + k2) ^ (v0 + sum) ^ ((v0 &gt;&gt; <span class="number">5</span>) + k3);</span><br><span class="line">        v0 -= ((v1 &lt;&lt; <span class="number">4</span>) + k0) ^ (v1 + sum) ^ ((v1 &gt;&gt; <span class="number">5</span>) + k1);</span><br><span class="line">        sum -= delta;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    v[<span class="number">0</span>] = v0;</span><br><span class="line">    v[<span class="number">1</span>] = v1;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> ans[] = &#123;</span><br><span class="line"><span class="number">0x2B</span>, <span class="number">0xF2</span>, <span class="number">0x82</span>, <span class="number">0x41</span>, <span class="number">0x48</span>, <span class="number">0x74</span>, <span class="number">0x9D</span>, <span class="number">0xAA</span>, <span class="number">0x7E</span>, <span class="number">0x4C</span>, <span class="number">0xDA</span>, <span class="number">0x04</span>, <span class="number">0x08</span>, <span class="number">0x2C</span>, <span class="number">0xA8</span>, <span class="number">0x52</span>,</span><br><span class="line"> <span class="number">0x97</span>, <span class="number">0x77</span>, <span class="number">0xB7</span>, <span class="number">0x3B</span>, <span class="number">0x16</span>, <span class="number">0x2D</span>, <span class="number">0xD4</span>, <span class="number">0xFC</span>, <span class="number">0x60</span>, <span class="number">0xBE</span>, <span class="number">0xC4</span>, <span class="number">0xB6</span>, <span class="number">0x73</span>, <span class="number">0x19</span>, <span class="number">0x94</span>, <span class="number">0x87</span></span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> axxxx[] = &#123;</span><br><span class="line"><span class="number">0x3C</span>, <span class="number">0x0D</span>, <span class="number">0x05</span>, <span class="number">0x1F</span>, <span class="number">0x30</span>, <span class="number">0x6E</span>, <span class="number">0x1E</span>, <span class="number">0x30</span>, <span class="number">0x04</span>, <span class="number">0x3C</span>, <span class="number">0x12</span>, <span class="number">0x52</span>, <span class="number">0x59</span>, <span class="number">0x03</span>, <span class="number">0x6D</span>, <span class="number">0x52</span>,</span><br><span class="line"> <span class="number">0x04</span>, <span class="number">0x04</span>, <span class="number">0x0B</span>, <span class="number">0x33</span>, <span class="number">0x1F</span>, <span class="number">0x33</span>, <span class="number">0x17</span>, <span class="number">0x3B</span>, <span class="number">0x17</span>, <span class="number">0x1A</span>, <span class="number">0x2B</span>, <span class="number">0x07</span>, <span class="number">0x55</span>, <span class="number">0x04</span>, <span class="number">0x5B</span>, <span class="number">0x5A</span></span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">32</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        axxxx[i] ^= ans[i];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">const</span> <span class="type">char</span>* xxx = <span class="string">&quot;hello_moectf2024&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">uint32_t</span>* v = (<span class="type">uint32_t</span>*)axxxx;</span><br><span class="line">    <span class="type">uint32_t</span>* k = (<span class="type">uint32_t</span>*)xxx;</span><br><span class="line">    decrypt(v, k);</span><br><span class="line">    decrypt(v+<span class="number">2</span>, k);</span><br><span class="line">    decrypt(v+<span class="number">4</span>, k);</span><br><span class="line">    decrypt(v+<span class="number">6</span>, k);</span><br><span class="line"></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span>* vv = (<span class="type">unsigned</span> <span class="type">char</span>*)v;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">32</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        vv[i] ^= xxx[i % <span class="number">16</span>];</span><br><span class="line">        <span class="built_in">putchar</span>(vv[i]);</span><br><span class="line">        <span class="comment">// moectf&#123;how_an_easy_junk_and_tea&#125;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><code>moectf&#123;how_an_easy_junk_and_tea&#125;</code></p><h1 id="babe-z3"><a href="#babe-z3" class="headerlink" title="babe-z3"></a>babe-z3</h1><p>src</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Windows.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;$ root@moectf2024 ~&gt; Welcome to moectf 2024!\n | 0xcafebabe encountered a difficult challenge!!!\n | He was lost in the z3-solver&#x27;s WORLD, Please Use Your MAGIC to help him.\n | input: moectf&#123;YOUR_INPUT&#125;&quot;</span>);</span><br><span class="line">        <span class="type">char</span> x[<span class="number">36</span>]; <span class="comment">//9c0525dcbadf4cbd9715067159453e74</span></span><br><span class="line">        <span class="built_in">fgets</span>(x, <span class="number">36</span>, stdin);</span><br><span class="line">        <span class="type">uint64_t</span> a1 = *(<span class="number">0</span> + (<span class="type">uint64_t</span>*)x);</span><br><span class="line">        <span class="type">uint64_t</span> a2 = *(<span class="number">1</span> + (<span class="type">uint64_t</span>*)x);</span><br><span class="line">        <span class="type">uint64_t</span> a3 = *(<span class="number">2</span> + (<span class="type">uint64_t</span>*)x);</span><br><span class="line">        <span class="type">uint64_t</span> a4 = *(<span class="number">3</span> + (<span class="type">uint64_t</span>*)x);</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        std::cout &lt;&lt; (a1 &amp; a2 &amp; (~(a1 | a2) | a3 &amp; a2 | a4 &amp; a1 &amp; ~a4) | a4 &amp; a1 &amp; a3) &lt;&lt; std::endl;</span></span><br><span class="line"><span class="comment">        std::cout &lt;&lt; ((a2 ^ (a4 &amp; ~a1 | a4 &amp; ~a3 | (a1 + a3) &amp; a3 | (a2 + a4) &amp; a2 &amp; ~a1))) &lt;&lt; std::endl;</span></span><br><span class="line"><span class="comment">        std::cout &lt;&lt; ((a1 - a2) ^ (a3 - a4)) &lt;&lt; std::endl;</span></span><br><span class="line"><span class="comment">        std::cout &lt;&lt; ((a4 + a2) ^ (a1 + a3)) &lt;&lt; std::endl;</span></span><br><span class="line"><span class="comment">        std::cout &lt;&lt; (a1 ^ a2 ^ a3 ^ a4) &lt;&lt; std::endl;</span></span><br><span class="line"><span class="comment">        std::cout &lt;&lt; (a1 &amp; a2 &amp; a3 &amp; a4) &lt;&lt; std::endl;</span></span><br><span class="line"><span class="comment">        std::cout &lt;&lt; (a1 + a2 - a3 + a4) * (a1 + a3 - a4 + a2) &lt;&lt; std::endl;</span></span><br><span class="line"><span class="comment">        std::cout &lt;&lt; (a1 + a2 +a3 + a4) % 114514 &lt;&lt; std::endl;</span></span><br><span class="line"><span class="comment">        std::cout &lt;&lt; (a1 * a2 * a3 * a4) % 1919810 &lt;&lt; std::endl;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">        <span class="type">uint64_t</span> switch_0 = <span class="number">0</span>;</span><br><span class="line">        <span class="type">uint64_t</span> switch_1 = <span class="number">0</span>;</span><br><span class="line">        <span class="type">uint64_t</span> switch_2 = <span class="number">0</span>;</span><br><span class="line">        <span class="type">uint64_t</span> switch_3 = <span class="number">0</span>;</span><br><span class="line">        <span class="type">uint64_t</span> switch_4 = <span class="number">0</span>;</span><br><span class="line">        <span class="type">uint64_t</span> switch_5 = <span class="number">0</span>;</span><br><span class="line">        <span class="type">uint64_t</span> switch_6 = <span class="number">0</span>;</span><br><span class="line">        <span class="type">uint64_t</span> switch_7 = <span class="number">0</span>;</span><br><span class="line">        <span class="type">uint64_t</span> switch_8 = <span class="number">0</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// FAKE CONDITION</span></span><br><span class="line">        <span class="keyword">if</span> ((a3 &amp; a1 &amp; (~(a4 + a2) | a2 &amp; a2 | a4 &amp; a1 &amp; ~a4) ^ a4 &amp; a3) == <span class="number">0xcafebabedeadc0de</span>) (switch_0 |= <span class="number">0x0000000010000000</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> ((a1 &amp; a2 &amp; (~(a1 | a2) | a3 &amp; a2 | a4 &amp; a1 &amp; ~a4) | a4 &amp; a1 &amp; a3) == <span class="number">2316015897844654385</span>) switch_0 = (switch_0 |= <span class="number">0x0000000100000000</span>);</span><br><span class="line">        <span class="keyword">if</span>(((a2 ^ (a4 &amp; ~a1 | a4 &amp; ~a3 | (a1 + a3) &amp; a3 | (a2 + a4) &amp; a2 &amp; ~a1))) == <span class="number">8102257287365753684</span>) switch_1 = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>(((a1 - a2) ^ (a3 - a4)) == <span class="number">287668530830180307</span>) switch_2 = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>(((a4 + a2) ^ (a1 + a3)) == <span class="number">865433324338348261</span>) switch_3 = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>((a1 ^ a2 ^ a3 ^ a4) == <span class="number">145809558366915671</span>) switch_4 = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>((a1 &amp; a2 &amp; a3 &amp; a4) == <span class="number">2314885599605039392</span>) switch_5 = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>(((a1 + a2 - a3 + a4) * (a1 + a3 - a4 + a2)) == <span class="number">1840182356754417097</span>) switch_6 = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>((a1 + a2 + a3 + a4) % <span class="number">114514</span> == <span class="number">21761</span>) switch_7 = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>((a1 * a2 * a3 * a4) % <span class="number">1919810</span> == <span class="number">827118</span>) switch_8 = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">        DWORD fake = (DWORD)switch_0;</span><br><span class="line">        <span class="keyword">if</span> (switch_0 &amp;&amp; switch_1 &amp;&amp; switch_2 &amp;&amp; switch_3 &amp;&amp; switch_4 &amp;&amp; switch_5 &amp;&amp; switch_6 &amp;&amp; switch_7 &amp;&amp; switch_8 &amp;&amp; !fake)</span><br><span class="line">        &#123;</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;Finally, You Win!!!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;NO!! Try Again. PLEASE&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这题主要的坑其实是一个64位的变量的高32位和低32位控制了两个不同的条件，最后检查的时候，分别进行了检查，致敬RCTF2024的 PPTT（同样的操作，当时被恶心了）<br>Exp</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> z3 <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">x = [BitVec(<span class="string">f&quot;x<span class="subst">&#123;i&#125;</span>&quot;</span>, <span class="number">64</span>) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>)]</span><br><span class="line">s = Solver()</span><br><span class="line"></span><br><span class="line">a1 = x[<span class="number">0</span>]</span><br><span class="line">a2 = x[<span class="number">1</span>]</span><br><span class="line">a3 = x[<span class="number">2</span>]</span><br><span class="line">a4 = x[<span class="number">3</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># This Condition Is Fake!(!=)</span></span><br><span class="line">s.add((a3 &amp; a1 &amp; (~(a4 + a2) | a2 &amp; a2 | a4 &amp; a1 &amp; ~a4) ^ a4 &amp; a3) != <span class="number">0xd81ac01fbba91837</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># These Are True.</span></span><br><span class="line">s.add((a1 &amp; a2 &amp; (~(a1 | a2) | a3 &amp; a2 | a4 &amp; a1 &amp; ~a4) | a4 &amp; a1 &amp; a3) == <span class="number">2316015897844654385</span>)</span><br><span class="line">s.add(((a2 ^ (a4 &amp; ~a1 | a4 &amp; ~a3 | (a1 + a3) &amp; a3 | (a2 + a4) &amp; a2 &amp; ~a1))) == <span class="number">8102257287365753684</span>)</span><br><span class="line">s.add(((a1 - a2) ^ (a3 - a4)) == <span class="number">287668530830180307</span>)</span><br><span class="line">s.add(((a1 + a2 - a3 + a4) * (a1 + a3 - a4 + a2)) == <span class="number">1840182356754417097</span>)</span><br><span class="line">s.add((a1 + a2 + a3 + a4) % <span class="number">114514</span> == <span class="number">21761</span>)</span><br><span class="line">s.add((a1 * a2 * a3 * a4) % <span class="number">1919810</span> == <span class="number">827118</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(s.check())</span><br><span class="line">m = s.model()</span><br><span class="line">result = <span class="string">b&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> x:</span><br><span class="line">    result += long_to_bytes(m[i].as_long())[::-<span class="number">1</span>]</span><br><span class="line"><span class="built_in">print</span>(result)</span><br><span class="line"><span class="comment"># b&#x27;9c0525dcbadf4cbd9715067159453e74&#x27;</span></span><br></pre></td></tr></table></figure><p><code>moectf&#123;9c0525dcbadf4cbd9715067159453e74&#125;</code></p><h1 id="BlackHole"><a href="#BlackHole" class="headerlink" title="BlackHole"></a>BlackHole</h1><p>根据纸条内容，我们采用LoadLibrary然后调用函数进行暴力破解即可。<br>这是源码</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> &#123;</span><br><span class="line">        __declspec(dllexport) <span class="type">int</span> <span class="title function_">checkMyFlag</span><span class="params">(<span class="type">char</span>* your_flag, <span class="type">size_t</span> length)</span></span><br><span class="line">        &#123;</span><br><span class="line">                <span class="keyword">if</span> (length != <span class="number">15</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (<span class="built_in">memcmp</span>(your_flag, <span class="string">&quot;moectf&#123;&quot;</span>, <span class="number">7</span>)) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">                <span class="keyword">if</span> (your_flag[<span class="number">14</span>] != <span class="string">&#x27;&#125;&#x27;</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">                <span class="keyword">if</span> (your_flag[<span class="number">7</span>] == <span class="string">&#x27;c&#x27;</span> &amp;&amp;</span><br><span class="line">                        your_flag[<span class="number">8</span>] == <span class="string">&#x27;r&#x27;</span> &amp;&amp;</span><br><span class="line">                        your_flag[<span class="number">9</span>] == <span class="string">&#x27;4&#x27;</span> &amp;&amp;</span><br><span class="line">                        your_flag[<span class="number">10</span>] == <span class="string">&#x27;c&#x27;</span> &amp;&amp;</span><br><span class="line">                        your_flag[<span class="number">11</span>] == <span class="string">&#x27;k&#x27;</span> &amp;&amp;</span><br><span class="line">                        your_flag[<span class="number">12</span>] == <span class="string">&#x27;m&#x27;</span> &amp;&amp;</span><br><span class="line">                        your_flag[<span class="number">13</span>] == <span class="string">&#x27;3&#x27;</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>EXP</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Windows.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">bruteForce</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">        HMODULE h = <span class="literal">NULL</span>;</span><br><span class="line">        h = LoadLibraryA(<span class="string">&quot;you_cannot_crack_me.vmp.dll&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (!h)</span><br><span class="line">        &#123;</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;failed to load dll...\n&quot;</span>);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">typedef</span> <span class="title function_">int</span><span class="params">(*checkFlag)</span><span class="params">(<span class="type">char</span>*, <span class="type">size_t</span>)</span>;</span><br><span class="line">        <span class="type">char</span>* cracking = (<span class="type">char</span>*)<span class="built_in">malloc</span>(<span class="number">16</span>);</span><br><span class="line">        <span class="keyword">if</span> (!cracking) <span class="keyword">return</span>;</span><br><span class="line">        cracking[<span class="number">0</span>] = <span class="string">&#x27;m&#x27;</span>;</span><br><span class="line">        cracking[<span class="number">1</span>] = <span class="string">&#x27;o&#x27;</span>;</span><br><span class="line">        cracking[<span class="number">2</span>] = <span class="string">&#x27;e&#x27;</span>;</span><br><span class="line">        cracking[<span class="number">3</span>] = <span class="string">&#x27;c&#x27;</span>;</span><br><span class="line">        cracking[<span class="number">4</span>] = <span class="string">&#x27;t&#x27;</span>;</span><br><span class="line">        cracking[<span class="number">5</span>] = <span class="string">&#x27;f&#x27;</span>;</span><br><span class="line">        cracking[<span class="number">6</span>] = <span class="string">&#x27;&#123;&#x27;</span>;</span><br><span class="line"></span><br><span class="line">        cracking[<span class="number">7</span>] = <span class="string">&#x27;c&#x27;</span>;</span><br><span class="line">        cracking[<span class="number">12</span>] = <span class="string">&#x27;m&#x27;</span>;</span><br><span class="line"></span><br><span class="line">        cracking[<span class="number">14</span>] = <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">        cracking[<span class="number">15</span>] = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line">        checkFlag check = (checkFlag)GetProcAddress(h, <span class="string">&quot;checkMyFlag&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">char</span> b = <span class="string">&#x27;a&#x27;</span>; b &lt;= <span class="string">&#x27;z&#x27;</span>; b++)</span><br><span class="line">        &#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="type">char</span> c = <span class="string">&#x27;0&#x27;</span>; c &lt;= <span class="string">&#x27;9&#x27;</span>; c++)</span><br><span class="line">                &#123;</span><br><span class="line">                        <span class="keyword">for</span> (<span class="type">char</span> d = <span class="string">&#x27;a&#x27;</span>; d &lt;= <span class="string">&#x27;z&#x27;</span>; d++)</span><br><span class="line">                        &#123;</span><br><span class="line">                                <span class="keyword">for</span> (<span class="type">char</span> e = <span class="string">&#x27;a&#x27;</span>; e &lt;= <span class="string">&#x27;z&#x27;</span>; e++)</span><br><span class="line">                                &#123;</span><br><span class="line">                                        <span class="keyword">for</span> (<span class="type">char</span> g = <span class="string">&#x27;0&#x27;</span>; g &lt;= <span class="string">&#x27;9&#x27;</span>; g++)</span><br><span class="line">                                        &#123;</span><br><span class="line">                                                cracking[<span class="number">8</span>] = b;</span><br><span class="line">                                                cracking[<span class="number">9</span>] = c;</span><br><span class="line">                                                cracking[<span class="number">10</span>] = d;</span><br><span class="line">                                                cracking[<span class="number">11</span>] = e;</span><br><span class="line">                                                cracking[<span class="number">13</span>] = g;</span><br><span class="line">                                                <span class="keyword">if</span> (check(cracking, <span class="number">15</span>))</span><br><span class="line">                                                &#123;</span><br><span class="line">                                                        <span class="built_in">printf</span>(<span class="string">&quot;found answer: %s\n&quot;</span>, cracking);</span><br><span class="line">                                                        <span class="keyword">return</span>;</span><br><span class="line">                                                &#125;</span><br><span class="line">                                        &#125;</span><br><span class="line">                                &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        CloseHandle(h);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">        bruteForce();</span><br><span class="line">        system(<span class="string">&quot;pause&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><code>moectf&#123;cr4ckm3&#125;</code></p><h1 id="moeprotector"><a href="#moeprotector" class="headerlink" title="moeprotector"></a>moeprotector</h1><p>考点SEH, 反调试<br>解法：挂上x64dbg+ScyllaHide(不要开TitanHide，有检测)，然后通过软件断点来不断追踪flag变化。<br>容易得到下面的伪代码</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">flag[0]^=0x31;</span><br><span class="line">flag[0]+=0x31;</span><br><span class="line">flag[0]-=0x31;</span><br><span class="line">flag[0]^=0x31;</span><br><span class="line">for(inti=0;i&lt;57;i++)</span><br><span class="line">&#123;</span><br><span class="line">        flag[i]^=21+i;</span><br><span class="line">        flag[i]+=20;</span><br><span class="line">&#125;</span><br><span class="line">for(inti=0;i&lt;57;i++)</span><br><span class="line">&#123;</span><br><span class="line">        flag[i]^=26+i;</span><br><span class="line">        flag[i]+=20;</span><br><span class="line">&#125;</span><br><span class="line">for(inti=0;i&lt;57;i++)</span><br><span class="line">&#123;</span><br><span class="line">        flag[i]^=25+i;</span><br><span class="line">        flag[i]+=20;</span><br><span class="line">&#125;</span><br><span class="line">for(inti=0;i&lt;57;i++)</span><br><span class="line">&#123;</span><br><span class="line">        if(hexData[i]!=flag[i])</span><br><span class="line">                die();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>找到hexData的值，写解密脚本就行了。<br><code>moectf&#123;w1Nd0Ws_S3H_15_A_g0oD_m37h0d_70_h4nd13_EXCEPTI0NS&#125;</code></p><h1 id="特工luo-闻风而动"><a href="#特工luo-闻风而动" class="headerlink" title="特工luo: 闻风而动"></a>特工luo: 闻风而动</h1><p>1.考察易语言程序的逆向分析，Keygen就不说了，一个简单的异或转换工具，cli在连接后会收到服务器发来的DES加密后flag，加密密码是WIFI密码走keygen，而客户端保存的时候再会走一次RC4加密，密码是 flag.fromserver 对没错 密码就是文件名<br>2.考察无线安全中对于无线握手包的密码破解。选手需要将cap文件转换为可以供hashcat读取的哈希，并使用hashcat结合题目提示来进行暴力破解（cap文件分析发现是WAP2类型，所以哈希类型是22000）跑出来就可以写解密脚本了（用易语言写最好）<br>3.值得注意的是，在爆破的时候，需要对密码keygen进行分析，可以从异或数字的大小来观察是数字还是字符，然后反异或过来，就可以缩减密码文本，从而降低爆破时间。<br>解密</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">输出调试文本(到文本(解密数据(解密数据(读取文件(&quot;flag.fromserver&quot;), &quot;flag.fromserver&quot;, #RC4加密), &quot;4g3n71u0&quot;, #DES加密)))</span><br></pre></td></tr></table></figure><p><code>moectf&#123;h4cker_Lu0Q1@n_is_trying_to_0p3n_your_r3g15t3r3d_res1denc3&#125;</code></p><h1 id="特工luo-深入敌营"><a href="#特工luo-深入敌营" class="headerlink" title="特工luo: 深入敌营"></a>特工luo: 深入敌营</h1><p>简单VM题目，拿去年 NCTF ezVM 的题改的简单版本，去掉了trash code，用z3-solver即可化简、求解。属于本比赛最难的逆向工程题目。<br>首先UPX -d 脱一下壳，放入ida分析一下</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __fastcall <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">unsigned</span> __int8 saver; <span class="comment">// r15</span></span><br><span class="line">  __int64 _code; <span class="comment">// rdi</span></span><br><span class="line">  __int64 _rsp; <span class="comment">// rax</span></span><br><span class="line">  __int64 _rip; <span class="comment">// rcx</span></span><br><span class="line">  <span class="type">unsigned</span> __int8 v7; <span class="comment">// cl</span></span><br><span class="line">  __int16 v8; <span class="comment">// cx</span></span><br><span class="line">  <span class="type">int</span> v9; <span class="comment">// ecx</span></span><br><span class="line">  __int64 v10; <span class="comment">// rcx</span></span><br><span class="line">  <span class="type">int</span> v11; <span class="comment">// ebp</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v12; <span class="comment">// rbx</span></span><br><span class="line">  <span class="type">unsigned</span> __int8 v13; <span class="comment">// r14</span></span><br><span class="line">  <span class="type">rsize_t</span> v14; <span class="comment">// rdx</span></span><br><span class="line">  __int64 v15; <span class="comment">// rax</span></span><br><span class="line">  __int64 v16; <span class="comment">// rdx</span></span><br><span class="line">  __int64 v17; <span class="comment">// rcx</span></span><br><span class="line"></span><br><span class="line">  saver = <span class="number">0</span>;</span><br><span class="line">  LODWORD(_code) = <span class="number">0</span>;</span><br><span class="line">LABEL_2:</span><br><span class="line">  _rsp = (<span class="type">unsigned</span> <span class="type">int</span>)save;</span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    _rip = (<span class="type">unsigned</span> <span class="type">int</span>)_code;</span><br><span class="line">    _code = (<span class="type">unsigned</span> <span class="type">int</span>)(_code + <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">switch</span> ( insn[_rip] )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">0xB</span>u:                                <span class="comment">// v_add_rsp_8</span></span><br><span class="line">        _rsp = (<span class="type">unsigned</span> <span class="type">int</span>)(_rsp + <span class="number">8</span>);</span><br><span class="line">        save = _rsp;</span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">0xC</span>u:</span><br><span class="line">        _rsp = (<span class="type">unsigned</span> <span class="type">int</span>)(_rsp - <span class="number">2</span>);        <span class="comment">// v_push_word</span></span><br><span class="line">        save = _rsp;</span><br><span class="line">        <span class="built_in">stack</span>[_rsp + <span class="number">1</span>] = <span class="built_in">stack</span>[(<span class="type">unsigned</span> <span class="type">int</span>)(_rsp + <span class="number">2</span>) + <span class="number">1</span>];</span><br><span class="line">        <span class="built_in">stack</span>[(<span class="type">unsigned</span> <span class="type">int</span>)(_rsp + <span class="number">1</span>) + <span class="number">1</span>] = <span class="built_in">stack</span>[(<span class="type">unsigned</span> <span class="type">int</span>)(_rsp + <span class="number">3</span>) + <span class="number">1</span>];</span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">0xE</span>u:                                <span class="comment">// v_notSelf</span></span><br><span class="line">        <span class="built_in">stack</span>[(<span class="type">unsigned</span> <span class="type">int</span>)(_rsp + <span class="number">1</span>) + <span class="number">1</span>] = ~<span class="built_in">stack</span>[(<span class="type">unsigned</span> <span class="type">int</span>)(_rsp + <span class="number">1</span>) + <span class="number">1</span>];</span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">0x14</span>u:                               <span class="comment">// v_and</span></span><br><span class="line">        v16 = (<span class="type">unsigned</span> <span class="type">int</span>)(_rsp + <span class="number">1</span>);</span><br><span class="line">        <span class="built_in">stack</span>[v16 + <span class="number">1</span>] &amp;= <span class="built_in">stack</span>[_rsp + <span class="number">1</span>];</span><br><span class="line">        _rsp = (<span class="type">unsigned</span> <span class="type">int</span>)v16;</span><br><span class="line">        save = v16;</span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">0x19</span>u:                               <span class="comment">// v_exit</span></span><br><span class="line">        <span class="keyword">return</span> *(_DWORD *)&amp;insn[_code];</span><br><span class="line">      <span class="keyword">case</span> <span class="number">0x32</span>u:</span><br><span class="line">        v7 = insn[_code];                       <span class="comment">// v_push_byte</span></span><br><span class="line">        _rsp = (<span class="type">unsigned</span> <span class="type">int</span>)(_rsp - <span class="number">1</span>);</span><br><span class="line">        save = _rsp;</span><br><span class="line">        LODWORD(_code) = _code + <span class="number">1</span>;</span><br><span class="line">        <span class="built_in">stack</span>[_rsp + <span class="number">1</span>] = v7;</span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">0x49</span>u:                               <span class="comment">// v_dup</span></span><br><span class="line">        _rsp = (<span class="type">unsigned</span> <span class="type">int</span>)(_rsp - <span class="number">1</span>);</span><br><span class="line">        save = _rsp;</span><br><span class="line">        <span class="built_in">stack</span>[(<span class="type">unsigned</span> <span class="type">int</span>)_rsp + <span class="number">1</span>] = <span class="built_in">stack</span>[(<span class="type">unsigned</span> <span class="type">int</span>)(_rsp + <span class="number">1</span>) + <span class="number">1</span>];</span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">0x72</span>u:                               <span class="comment">// v_not</span></span><br><span class="line">        <span class="built_in">stack</span>[_rsp + <span class="number">1</span>] = ~<span class="built_in">stack</span>[_rsp + <span class="number">1</span>];</span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">0x7B</span>u:                               <span class="comment">// v_read_chr</span></span><br><span class="line">        v14 = (<span class="type">char</span>)<span class="built_in">stack</span>[_rsp + <span class="number">1</span>];</span><br><span class="line">        v15 = (<span class="type">unsigned</span> <span class="type">int</span>)(_rsp - <span class="number">7</span>);</span><br><span class="line">        save = v15;</span><br><span class="line">        *(_QWORD *)&amp;<span class="built_in">stack</span>[v15 + <span class="number">1</span>] = Buffer;</span><br><span class="line">        gets_s(Buffer, v14);</span><br><span class="line">        <span class="keyword">goto</span> LABEL_2;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">0x7C</span>u:</span><br><span class="line">        saver = <span class="built_in">stack</span>[_rsp + <span class="number">1</span>];                <span class="comment">// v_save</span></span><br><span class="line">        <span class="keyword">goto</span> LABEL_9;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">0x8D</span>u:</span><br><span class="line">        <span class="keyword">if</span> ( !<span class="built_in">stack</span>[_rsp + <span class="number">1</span>] )</span><br><span class="line">          LODWORD(_code) = *(_DWORD *)&amp;<span class="built_in">stack</span>[_rsp + <span class="number">2</span>];</span><br><span class="line">        _rsp = (<span class="type">unsigned</span> <span class="type">int</span>)(_rsp + <span class="number">5</span>);</span><br><span class="line">        save = _rsp;</span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">0x8E</span>u:                               <span class="comment">// v_print</span></span><br><span class="line">        v11 = insn[_code];</span><br><span class="line">        v12 = <span class="number">0LL</span>;</span><br><span class="line">        _code = (<span class="type">unsigned</span> <span class="type">int</span>)(_code + <span class="number">1</span>);</span><br><span class="line">        v13 = insn[_code] ^ v11;</span><br><span class="line">        LODWORD(_code) = _code + <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> ( v13 )</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="keyword">do</span></span><br><span class="line">          &#123;</span><br><span class="line">            <span class="built_in">putchar</span>(v11 ^ <span class="built_in">stack</span>[v13 + (<span class="type">unsigned</span> <span class="type">int</span>)_rsp - v12]);</span><br><span class="line">            LODWORD(_rsp) = save;</span><br><span class="line">            ++v12;</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">while</span> ( v12 &lt; v13 );</span><br><span class="line">        &#125;</span><br><span class="line">        save = v13 + (_DWORD)_rsp;</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="number">10</span>);</span><br><span class="line">        <span class="keyword">goto</span> LABEL_2;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">0x91</span>u:                               <span class="comment">// v_push_dword</span></span><br><span class="line">        v9 = *(_DWORD *)&amp;insn[_code];</span><br><span class="line">        _rsp = (<span class="type">unsigned</span> <span class="type">int</span>)(_rsp - <span class="number">4</span>);</span><br><span class="line">        save = _rsp;</span><br><span class="line">        LODWORD(_code) = _code + <span class="number">4</span>;</span><br><span class="line">        *(_DWORD *)&amp;<span class="built_in">stack</span>[_rsp + <span class="number">1</span>] = v9;</span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">0x99</span>u:</span><br><span class="line">        _rsp = (<span class="type">unsigned</span> <span class="type">int</span>)(_rsp + <span class="number">4</span>);        <span class="comment">// v_add_rsp_4</span></span><br><span class="line">        save = _rsp;</span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">0xAD</span>u:</span><br><span class="line">        _rsp = (<span class="type">unsigned</span> <span class="type">int</span>)(_rsp - <span class="number">1</span>);        <span class="comment">// v_push_saver</span></span><br><span class="line">        save = _rsp;</span><br><span class="line">        <span class="built_in">stack</span>[(<span class="type">unsigned</span> <span class="type">int</span>)_rsp + <span class="number">1</span>] = saver;</span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">0xB5</span>u:</span><br><span class="line">        _rsp = (<span class="type">unsigned</span> <span class="type">int</span>)(_rsp + <span class="number">2</span>);        <span class="comment">// v_add_rsp_2</span></span><br><span class="line">        save = _rsp;</span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">0xB7</span>u:</span><br><span class="line">        v8 = *(_WORD *)&amp;insn[_code];            <span class="comment">// v_push_word</span></span><br><span class="line">        _rsp = (<span class="type">unsigned</span> <span class="type">int</span>)(_rsp - <span class="number">2</span>);</span><br><span class="line">        save = _rsp;</span><br><span class="line">        LODWORD(_code) = _code + <span class="number">2</span>;</span><br><span class="line">        *(_WORD *)&amp;<span class="built_in">stack</span>[_rsp + <span class="number">1</span>] = v8;</span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">0xB8</span>u:</span><br><span class="line">        <span class="built_in">stack</span>[_rsp + <span class="number">1</span>] = *(_BYTE *)(<span class="built_in">stack</span>[_rsp + <span class="number">1</span>] + *(_QWORD *)&amp;<span class="built_in">stack</span>[_rsp + <span class="number">2</span>]);<span class="comment">// v_add</span></span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">0xD3</span>u:</span><br><span class="line">LABEL_9:</span><br><span class="line">        _rsp = (<span class="type">unsigned</span> <span class="type">int</span>)(_rsp + <span class="number">1</span>);        <span class="comment">// v_add_rsp_1</span></span><br><span class="line">        save = _rsp;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">0xEA</span>u:</span><br><span class="line">        v10 = *(_QWORD *)&amp;insn[_code];          <span class="comment">// v_push_qword</span></span><br><span class="line">        _rsp = (<span class="type">unsigned</span> <span class="type">int</span>)(_rsp - <span class="number">8</span>);</span><br><span class="line">        save = _rsp;</span><br><span class="line">        LODWORD(_code) = _code + <span class="number">8</span>;</span><br><span class="line">        *(_QWORD *)&amp;<span class="built_in">stack</span>[_rsp + <span class="number">1</span>] = v10;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">0xFB</span>u:</span><br><span class="line">        <span class="keyword">if</span> ( <span class="built_in">stack</span>[_rsp + <span class="number">1</span>] )                  <span class="comment">// v_not_not</span></span><br><span class="line">          <span class="built_in">stack</span>[_rsp + <span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">0xFF</span>u:</span><br><span class="line">        v17 = <span class="built_in">stack</span>[_rsp + <span class="number">1</span>];                  <span class="comment">// v_not</span></span><br><span class="line">        <span class="keyword">if</span> ( (_BYTE)v17 )</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="keyword">if</span> ( (_BYTE)v17 == <span class="number">1</span> )</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="keyword">if</span> ( (<span class="type">unsigned</span> <span class="type">int</span>)_rsp &gt;= <span class="number">0x100</span>uLL )</span><br><span class="line">              _report_rangecheckfailure(v17, (<span class="type">unsigned</span> <span class="type">int</span>)_rsp, envp);</span><br><span class="line">            <span class="built_in">stack</span>[_rsp + <span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">          <span class="built_in">stack</span>[_rsp + <span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">default</span>:</span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>可以看到是一个标准化的VM，我们可以写出z3-solver解题脚本。<br><code>moectf&#123;vv1ii?AGENT+1U0_-*7_$[TH/./e]+$_FinAL_v!c70Ry?&#125;</code></p></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="https://github.com/xyy9233/xyy9233.github.io.git">wind_9233</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://github.com/xyy9233/xyy9233.github.io.git/2024/10/20/Moectf%202024%20%20Reverse/">https://github.com/xyy9233/xyy9233.github.io.git/2024/10/20/Moectf%202024%20%20Reverse/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://github.com/xyy9233/xyy9233.github.io.git" target="_blank">能打一辈子CTF吗？</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"></div><div class="post_share"><div class="social-share" data-image="https://images.dmzj.com/news/article/77394/row_6409512934343.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload='this.media="all"'><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2024/10/20/Newstar%EF%BC%81/"><img class="prev-cover" src="https://images.dmzj.com/news/article/77394/row_6409512934343.jpg" onerror='onerror=null,src="/img/404.jpg"' alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Newstar2024 | Reverse &amp; 别的方向入门题</div></div></a></div><div class="next-post pull-right"><a href="/2024/10/20/XYCTF2024%E5%A4%8D%E7%8E%B0Reverse/"><img class="next-cover" src="https://images.dmzj.com/news/article/77394/row_6409512934343.jpg" onerror='onerror=null,src="/img/404.jpg"' alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">XYCTF2024复现|Reverse</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://img1.baidu.com/it/u=38471470,3942836709&amp;fm=253&amp;fmt=auto&amp;app=120&amp;f=JPEG?w=889&amp;h=500" onerror='this.onerror=null,this.src="/img/friend_404.gif"' alt="avatar"></div><div class="author-info__name">wind_9233</div><div class="author-info__description">网安逆向</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">51</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">31</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">0</div></a></div><a id="card-info-btn" href="https://github.com/xyy9233"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%85%B3%E4%BA%8EWP"><span class="toc-number">1.</span> <span class="toc-text">关于WP</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%85%A5%E9%97%A8%E6%8C%87%E5%8C%97"><span class="toc-number">2.</span> <span class="toc-text">入门指北</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Xor"><span class="toc-number">3.</span> <span class="toc-text">Xor</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#upx"><span class="toc-number">4.</span> <span class="toc-text">upx</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#dynamic"><span class="toc-number">5.</span> <span class="toc-text">dynamic</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Reverse-%E9%97%AE%E5%8D%B7-Bye-MoeCTF2024"><span class="toc-number">6.</span> <span class="toc-text">Reverse 问卷: Bye, MoeCTF2024</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#upx-revenge"><span class="toc-number">7.</span> <span class="toc-text">upx-revenge</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#XTEA"><span class="toc-number">8.</span> <span class="toc-text">XTEA</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#dotNet-d0tN3t"><span class="toc-number">9.</span> <span class="toc-text">dotNet(d0tN3t)</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#RC4"><span class="toc-number">10.</span> <span class="toc-text">RC4</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#TEA"><span class="toc-number">11.</span> <span class="toc-text">TEA</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B%E8%BF%9B%E9%98%B6%E4%B9%8B%E5%8C%97"><span class="toc-number">12.</span> <span class="toc-text">逆向工程进阶之北</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#moedaily"><span class="toc-number">13.</span> <span class="toc-text">moedaily</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#moejvav"><span class="toc-number">14.</span> <span class="toc-text">moejvav</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#sm4"><span class="toc-number">15.</span> <span class="toc-text">sm4</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#ezMAZE"><span class="toc-number">16.</span> <span class="toc-text">ezMAZE</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Just-Run-It"><span class="toc-number">17.</span> <span class="toc-text">Just-Run-It</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#SecretModule"><span class="toc-number">18.</span> <span class="toc-text">SecretModule</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Cython-Strike-Bomb-Defusion"><span class="toc-number">19.</span> <span class="toc-text">Cython-Strike: Bomb Defusion</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#SMCProMax"><span class="toc-number">20.</span> <span class="toc-text">SMCProMax</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#ezMAZE-%E5%BD%A9%E8%9B%8B"><span class="toc-number">21.</span> <span class="toc-text">ezMAZE-彩蛋</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#xor-%E5%A4%A7%E5%98%98"><span class="toc-number">22.</span> <span class="toc-text">xor(大嘘)</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#babe-z3"><span class="toc-number">23.</span> <span class="toc-text">babe-z3</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#BlackHole"><span class="toc-number">24.</span> <span class="toc-text">BlackHole</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#moeprotector"><span class="toc-number">25.</span> <span class="toc-text">moeprotector</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%89%B9%E5%B7%A5luo-%E9%97%BB%E9%A3%8E%E8%80%8C%E5%8A%A8"><span class="toc-number">26.</span> <span class="toc-text">特工luo: 闻风而动</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%89%B9%E5%B7%A5luo-%E6%B7%B1%E5%85%A5%E6%95%8C%E8%90%A5"><span class="toc-number">27.</span> <span class="toc-text">特工luo: 深入敌营</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2024/10/30/%E9%85%8D%E7%BD%AEcuckoo%E8%B8%A9%E7%9A%84%E5%9D%91%E2%80%94%E2%80%94/" title="配置cuckoo踩的坑——"><img src="https://images.dmzj.com/news/article/77394/row_6409512934343.jpg" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="配置cuckoo踩的坑——"></a><div class="content"><a class="title" href="/2024/10/30/%E9%85%8D%E7%BD%AEcuckoo%E8%B8%A9%E7%9A%84%E5%9D%91%E2%80%94%E2%80%94/" title="配置cuckoo踩的坑——">配置cuckoo踩的坑——</a><time datetime="2024-10-29T16:00:00.000Z" title="发表于 2024-10-30 00:00:00">2024-10-30</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/10/28/ISITDTU%20CTF%202024%20%20Reverse/" title="ISITDTU CTF 2024 | Reverse"><img src="https://images.dmzj.com/news/article/77394/row_6409512934343.jpg" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="ISITDTU CTF 2024 | Reverse"></a><div class="content"><a class="title" href="/2024/10/28/ISITDTU%20CTF%202024%20%20Reverse/" title="ISITDTU CTF 2024 | Reverse">ISITDTU CTF 2024 | Reverse</a><time datetime="2024-10-27T16:00:00.000Z" title="发表于 2024-10-28 00:00:00">2024-10-28</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/10/22/pwn%E2%9C%8C%E7%9A%84%E5%85%A8%E6%A0%88%E5%B0%8F%E6%B8%B8%E6%88%8F/" title="DIE-AIO"><img src="https://images.dmzj.com/news/article/77394/row_6409512934343.jpg" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="DIE-AIO"></a><div class="content"><a class="title" href="/2024/10/22/pwn%E2%9C%8C%E7%9A%84%E5%85%A8%E6%A0%88%E5%B0%8F%E6%B8%B8%E6%88%8F/" title="DIE-AIO">DIE-AIO</a><time datetime="2024-10-21T16:00:00.000Z" title="发表于 2024-10-22 00:00:00">2024-10-22</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/10/20/Newstar%EF%BC%81/" title="Newstar2024 | Reverse &amp; 别的方向入门题"><img src="https://images.dmzj.com/news/article/77394/row_6409512934343.jpg" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="Newstar2024 | Reverse &amp; 别的方向入门题"></a><div class="content"><a class="title" href="/2024/10/20/Newstar%EF%BC%81/" title="Newstar2024 | Reverse &amp; 别的方向入门题">Newstar2024 | Reverse &amp; 别的方向入门题</a><time datetime="2024-10-19T16:00:00.000Z" title="发表于 2024-10-20 00:00:00">2024-10-20</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/10/20/Moectf%202024%20%20Reverse/" title="MoeCTF2024|Reverse"><img src="https://images.dmzj.com/news/article/77394/row_6409512934343.jpg" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="MoeCTF2024|Reverse"></a><div class="content"><a class="title" href="/2024/10/20/Moectf%202024%20%20Reverse/" title="MoeCTF2024|Reverse">MoeCTF2024|Reverse</a><time datetime="2024-10-19T16:00:00.000Z" title="发表于 2024-10-20 00:00:00">2024-10-20</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2024 By wind_9233</div><div class="framework-info"><span>框架 </span><a href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>