<!DOCTYPE HTML><html lang="zh-CN"><head><meta charset="utf-8"><meta name="keywords" content="è½¯ä»¶å®‰å…¨å®éªŒ1-6è¯¦è§£, æ±‚çŸ¥æ¬²ï¼Œå¥½å¥‡å¿ƒï¼Œå‹‡æ¯…å‰è¡Œ"><meta name="description" content="è½¯ä»¶å®‰å…¨å®éªŒ1-6è¯¦è§£æˆ–è®¸ä¹Ÿæ˜¯æƒ³ç»™å­¦å¼Ÿå­¦å¦¹ç•™ä¸‹ç‚¹ä»€ä¹ˆï¼Œå°±ç»“åˆäº†ä¸€äº›ç­é‡ŒåŒå­¦é—®è¿‡æˆ‘çš„ä¸€äº›é—®é¢˜æˆ–è€…å¯èƒ½ä¼šå‡ºé—®é¢˜çš„ç‚¹ï¼Œæ‰“ç®—è¯¦ç»†çš„æŠŠè¿™ä¸ªå®éªŒ æ˜¯ä»€ä¹ˆã€ä¸ºä»€ä¹ˆã€æ€ä¹ˆåšå‘Šè¯‰å¤§å®¶ã€‚
åŒæ—¶ä¹Ÿå¸Œæœ›å¤§å®¶åœ¨å®éªŒè¿‡ç¨‹ä¸­æœ‰ä¸€äº›è‡ªå·±çš„æ€è€ƒå’Œæ„Ÿæ‚Ÿï¼Œæ¬¢è¿æ‰¹è¯„æŒ‡æ­£ã€‚
å®éªŒä¸€"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no"><meta name="renderer" content="webkit|ie-stand|ie-comp"><meta name="mobile-web-app-capable" content="yes"><meta name="format-detection" content="telephone=no"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="referrer" content="no-referrer-when-downgrade"><title>è½¯ä»¶å®‰å…¨å®éªŒ1-6è¯¦è§£ | æ±‚çŸ¥æ¬²ï¼Œå¥½å¥‡å¿ƒï¼Œå‹‡æ¯…å‰è¡Œ</title><link rel="icon" type="image/png" href="/favicon.png"><link rel="stylesheet" href="/libs/awesome/css/all.min.css"><link rel="stylesheet" href="/libs/materialize/materialize.min.css"><link rel="stylesheet" href="/libs/aos/aos.css"><link rel="stylesheet" href="/libs/animate/animate.min.css"><link rel="stylesheet" href="/libs/lightGallery/css/lightgallery.min.css"><link rel="stylesheet" href="/css/matery.css"><link rel="stylesheet" href="/css/my.css"><link rel="stylesheet" href="/css/dark.css" media="none" onload='"all"!=media&&(media="all")'><link rel="stylesheet" href="/libs/tocbot/tocbot.css"><link rel="stylesheet" href="/css/post.css"><script src="/libs/jquery/jquery-3.6.0.min.js"></script><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="æ±‚çŸ¥æ¬²ï¼Œå¥½å¥‡å¿ƒï¼Œå‹‡æ¯…å‰è¡Œ" type="application/atom+xml"></head><body><header class="navbar-fixed"><nav id="headNav" class="bg-color nav-transparent"><div id="navContainer" class="nav-wrapper container"><div class="brand-logo"><a href="/" class="waves-effect waves-light"><img src="/medias/logo.png" class="logo-img" alt="LOGO"> <span class="logo-span">æ±‚çŸ¥æ¬²ï¼Œå¥½å¥‡å¿ƒï¼Œå‹‡æ¯…å‰è¡Œ</span></a></div><a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a><ul class="right nav-menu"><li class="hide-on-med-and-down nav-item"><a href="/" class="waves-effect waves-light"><i class="fas fa-home" style="zoom:.6"></i> <span>é¦–é¡µ</span></a></li><li class="hide-on-med-and-down nav-item"><a href="/archives" class="waves-effect waves-light"><i class="fas fa-archive" style="zoom:.6"></i> <span>å½’æ¡£</span></a></li><li class="hide-on-med-and-down nav-item"><a href="/about" class="waves-effect waves-light"><i class="fas fa-user-circle" style="zoom:.6"></i> <span>å…³äº</span></a></li><li class="hide-on-med-and-down nav-item"><a href="/contact" class="waves-effect waves-light"><i class="fas fa-comments" style="zoom:.6"></i> <span>ç•™è¨€æ¿</span></a></li><li class="hide-on-med-and-down nav-item"><a href="/friends" class="waves-effect waves-light"><i class="fas fa-address-book" style="zoom:.6"></i> <span>å‹æƒ…é“¾æ¥</span></a></li><li><a href="#searchModal" class="modal-trigger waves-effect waves-light"><i id="searchIcon" class="fas fa-search" title="æœç´¢" style="zoom:.85"></i></a></li><li><a href="javascript:;" class="waves-effect waves-light" onclick="switchNightMode()" title="æ·±è‰²/æµ…è‰²æ¨¡å¼"><i id="sum-moon-icon" class="fas fa-sun" style="zoom:.85"></i></a></li></ul><div id="mobile-nav" class="side-nav sidenav"><div class="mobile-head bg-color"><img src="/medias/logo.png" class="logo-img circle responsive-img"><div class="logo-name">æ±‚çŸ¥æ¬²ï¼Œå¥½å¥‡å¿ƒï¼Œå‹‡æ¯…å‰è¡Œ</div><div class="logo-desc">ç½‘å®‰é€†å‘</div></div><ul class="menu-list mobile-menu-list"><li class="m-nav-item"><a href="/" class="waves-effect waves-light"><i class="fa-fw fas fa-home"></i> é¦–é¡µ</a></li><li class="m-nav-item"><a href="/archives" class="waves-effect waves-light"><i class="fa-fw fas fa-archive"></i> å½’æ¡£</a></li><li class="m-nav-item"><a href="/about" class="waves-effect waves-light"><i class="fa-fw fas fa-user-circle"></i> å…³äº</a></li><li class="m-nav-item"><a href="/contact" class="waves-effect waves-light"><i class="fa-fw fas fa-comments"></i> ç•™è¨€æ¿</a></li><li class="m-nav-item"><a href="/friends" class="waves-effect waves-light"><i class="fa-fw fas fa-address-book"></i> å‹æƒ…é“¾æ¥</a></li><li><div class="divider"></div></li><li><a href="https://github.com/blinkfox/hexo-theme-matery" class="waves-effect waves-light" target="_blank"><i class="fab fa-github-square fa-fw"></i>Fork Me</a></li></ul></div></div><style>.nav-transparent .github-corner{display:none!important}.github-corner{position:absolute;z-index:10;top:0;right:0;border:0;transform:scale(1.1)}.github-corner svg{color:#0f9d58;fill:#fff;height:64px;width:64px}.github-corner:hover .octo-arm{animation:a .56s ease-in-out}.github-corner .octo-arm{animation:none}@keyframes a{0%,to{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}</style><a href="https://github.com/blinkfox/hexo-theme-matery" class="github-corner tooltipped hide-on-med-and-down" target="_blank" data-tooltip="Fork Me" data-position="left" data-delay="50"><svg viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a></nav></header><div class="bg-cover pd-header post-cover" style="background-image:url(/medias/featureimages/13.jpg)"><div class="container" style="right:0;left:0"><div class="row"><div class="col s12 m12 l12"><div class="brand"><h1 class="description center-align post-title">è½¯ä»¶å®‰å…¨å®éªŒ1-6è¯¦è§£</h1></div></div></div></div></div><main class="post-container content"><div class="row"><div id="main-content" class="col s12 m12 l9"><div id="artDetail"><div class="card"><div class="card-content article-info"><div class="row tag-cate"><div class="col s7"><div class="article-tag"><span class="chip bg-color">æ— æ ‡ç­¾</span></div></div><div class="col s5 right-align"></div></div><div class="post-info"><div class="post-date info-break-policy"><i class="far fa-calendar-minus fa-fw"></i>å‘å¸ƒæ—¥æœŸ:&nbsp;&nbsp; 2024-12-23</div></div></div><hr class="clearfix"><div class="card-content article-card-content"><div id="articleContent"><h1 id="è½¯ä»¶å®‰å…¨å®éªŒ1-6è¯¦è§£"><a href="#è½¯ä»¶å®‰å…¨å®éªŒ1-6è¯¦è§£" class="headerlink" title="è½¯ä»¶å®‰å…¨å®éªŒ1-6è¯¦è§£"></a>è½¯ä»¶å®‰å…¨å®éªŒ1-6è¯¦è§£</h1><p>æˆ–è®¸ä¹Ÿæ˜¯æƒ³ç»™å­¦å¼Ÿå­¦å¦¹ç•™ä¸‹ç‚¹ä»€ä¹ˆï¼Œå°±ç»“åˆäº†ä¸€äº›ç­é‡ŒåŒå­¦é—®è¿‡æˆ‘çš„ä¸€äº›é—®é¢˜æˆ–è€…å¯èƒ½ä¼šå‡ºé—®é¢˜çš„ç‚¹ï¼Œæ‰“ç®—è¯¦ç»†çš„æŠŠè¿™ä¸ªå®éªŒ æ˜¯ä»€ä¹ˆã€ä¸ºä»€ä¹ˆã€æ€ä¹ˆåšå‘Šè¯‰å¤§å®¶ã€‚</p><p>åŒæ—¶ä¹Ÿå¸Œæœ›å¤§å®¶åœ¨å®éªŒè¿‡ç¨‹ä¸­æœ‰ä¸€äº›è‡ªå·±çš„æ€è€ƒå’Œæ„Ÿæ‚Ÿï¼Œæ¬¢è¿æ‰¹è¯„æŒ‡æ­£ã€‚</p><h2 id="å®éªŒä¸€ï¼šPEæ–‡ä»¶ä»£ç æ³¨å…¥å®éªŒï¼ˆwinmineï¼‰"><a href="#å®éªŒä¸€ï¼šPEæ–‡ä»¶ä»£ç æ³¨å…¥å®éªŒï¼ˆwinmineï¼‰" class="headerlink" title="å®éªŒä¸€ï¼šPEæ–‡ä»¶ä»£ç æ³¨å…¥å®éªŒï¼ˆwinmineï¼‰"></a>å®éªŒä¸€ï¼š<strong>PE</strong>æ–‡ä»¶ä»£ç æ³¨å…¥å®éªŒï¼ˆwinmineï¼‰</h2><blockquote><p>é€šè¿‡æœ¬å®éªŒï¼Œé¢„æœŸè¾¾åˆ°ä»¥ä¸‹å®éªŒç›®çš„ï¼š</p><ol><li><p>ç†Ÿæ‚‰PEæ–‡ä»¶æ ¼å¼ã€‚</p></li><li><p>å¤ä¹ æ±‡ç¼–è¯­è¨€å¸¸è§æŒ‡ä»¤ã€‚</p></li><li><p>å­¦ä¹ æŸ¥çœ‹ï¼Œç¼–è¾‘ï¼Œä¿å­˜PEæ–‡ä»¶ã€‚</p></li><li><p>ç†Ÿç»ƒä½¿ç”¨LoadPEå’ŒOllyDbgè°ƒè¯•å·¥å…·ã€‚</p></li></ol></blockquote><p>â€“ã€‹<strong>äº†è§£ç¨‹åºè¿è¡Œé¡ºåºã€å­¦ä¹ ä½¿ç”¨ollygdbæˆ–idaç­‰ç¨‹åºä¿®æ”¹å·¥å…·</strong></p><p>å®éªŒè·Ÿç€è€å¸ˆpptä¸Šçš„æ­¥éª¤èµ°åŸºæœ¬éƒ½å¯ä»¥é¡ºåˆ©å®Œæˆ</p><p>ä»¥ä¸‹æ˜¯ä¸€äº›å®éªŒä¸­éœ€è¦æ³¨æ„çš„ç‚¹ï¼š</p><p>æ‹–å…¥åæ±‡ç¼–å·¥å…·ååœæ­¢çš„ç‚¹å°±æ˜¯<strong>å…¥å£ç‚¹</strong>ï¼Œè¿™é‡Œæ˜¯<strong>0x01003E21</strong></p><p><img src="https://xyy9233.oss-cn-beijing.aliyuncs.com/hexoblog/image-20241127134610708.png" alt="image-20241127134610708"></p><p>åœ¨ä»£ç åŒºå¾€ä¸‹æ‹‰å¯ä»¥æ‰¾åˆ°å¤§é‡çš„<strong>ç©ºç™½</strong>ä»£ç  åŒºåŸŸï¼Œå¦‚æœæˆ‘ä»¬å¾€è¿™é‡Œæ¤å…¥ä»£ç ï¼Œç›´æ¥ä¿®æ”¹PEæ–‡ä»¶ç›¸å…³è·³è½¬åœ°å€ï¼ˆå…¥å£ç‚¹æˆ–ç‰¹å®š å‡½æ•°çš„è·³è½¬åœ°å€ï¼‰ï¼Œå°±å¯ä»¥å®ç°ç›¸å…³çš„æ¤å…¥ä»£ç çš„æ‰§è¡Œã€‚</p><p>å³é”®patch bytesï¼Œå†™å…¥ä»£ç çš„16è¿›åˆ¶æ ¼å¼</p><p>å¦‚æœ<strong>ç”¨ollygdbï¼Œå–æ¶ˆä¸‹æ–¹é€‰é¡¹æ¡†å¯¹â€ä¿æŒå­—èŠ‚å¤§å°</strong>â€œå¯ä»¥ä¸€æ¬¡æ€§å¤šè¾“å…¥å‡ ä¸ªå­—èŠ‚</p><p><img src="https://xyy9233.oss-cn-beijing.aliyuncs.com/hexoblog/image-20241127122616098.png" alt="image-20241127122616098"></p><p><img src="https://xyy9233.oss-cn-beijing.aliyuncs.com/hexoblog/image-20241127122644425.png" alt="image-20241127122644425"></p><p><img src="https://xyy9233.oss-cn-beijing.aliyuncs.com/hexoblog/image-20241127122827411.png" alt="image-20241127122827411"></p><p><img src="https://xyy9233.oss-cn-beijing.aliyuncs.com/hexoblog/image-20241127140034399.png" alt="image-20241127140034399"></p><p>åœ¨å®Œæˆpatchåè®°å¾—å·¦ä¸ŠEditâ€“é€‰æ‹© â€apply patchesâ€œ</p><p><img src="https://xyy9233.oss-cn-beijing.aliyuncs.com/hexoblog/image-20241222183113390.png" alt="image-20241222183113390"></p><p><img src="https://xyy9233.oss-cn-beijing.aliyuncs.com/hexoblog/image-20241127140100901.png" alt="image-20241127140100901"></p><p>ï¼ˆPEditorä¿®æ”¹å…¥å£åœ°å€æ—¶å€™å¯ä»¥æŠŠæ€æ¯’è½¯ä»¶ä¼‘çœ ä¸€ä¼šï¼ˆæ€»æ€æˆ‘ä½œä¸šï¼ˆğŸ¤œğŸ˜«</p><p><img src="https://xyy9233.oss-cn-beijing.aliyuncs.com/hexoblog/image-20241127144029111.png" alt="image-20241127144029111"></p><p><img src="https://xyy9233.oss-cn-beijing.aliyuncs.com/hexoblog/image-20241127144234624.png" alt="image-20241127144234624"></p><h2 id="å®éªŒäºŒï¼šåŸºäºUAFæ¼æ´æ³„æ¼glibcåŸºåœ°å€å®éªŒ"><a href="#å®éªŒäºŒï¼šåŸºäºUAFæ¼æ´æ³„æ¼glibcåŸºåœ°å€å®éªŒ" class="headerlink" title="å®éªŒäºŒï¼šåŸºäºUAFæ¼æ´æ³„æ¼glibcåŸºåœ°å€å®éªŒ"></a><strong>å®éªŒäºŒï¼šåŸºäºUAFæ¼æ´æ³„æ¼glibcåŸºåœ°å€å®éªŒ</strong></h2><blockquote><p>ç¨‹åºç¼–è¯‘å¼€å¯äº†éšå³åœ°å€ä¿æŠ¤ï¼Œä¸ºäº†ä½¿å‰åä¸€è‡´ï¼Œéƒ½ä½¿ç”¨çš„åŒä¸€æ¬¡å®éªŒæˆªå›¾</p></blockquote><p>è¿™é‡Œæ˜¯è¿è¡Œæºä»£ç ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span>&#123;</span><br><span class="line"><span class="type">char</span> *p = <span class="built_in">malloc</span>(<span class="number">0x80</span>); <span class="comment">//è¿™é‡Œ*pæ˜¯ç”³è¯·çš„å †çš„åœ°å€ çš„åœ°å€</span></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;p = %p\n&quot;</span>, p); <span class="comment">//printç”³è¯·çš„å †åœ°å€ çš„åœ°å€</span></span><br><span class="line"><span class="built_in">free</span>(p);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;*p = %p\n&quot;</span>,*(<span class="type">void</span> **)p); <span class="comment">//print ç”³è¯·çš„å †åœ°å€çš„åœ°å€</span></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;main_arena=%p\n&quot;</span>,*(<span class="type">void</span> **)p<span class="number">-88</span>); </span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;libc base=%p\n&quot;</span>,*(<span class="type">void</span> **)pâ€“<span class="number">88</span>â€“<span class="number">0x3c4b20</span>);</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿è¡Œå³å¯å¾—åˆ°ï¼š</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">p = <span class="number">0</span>x1b5b010 </span><br><span class="line">*p = <span class="number">0</span>x7f5a925c4b78</span><br><span class="line">main_arena = <span class="number">0</span>x7f5a925c4b20</span><br><span class="line">libc base = <span class="number">0</span>x7f5a92200000</span><br></pre></td></tr></table></figure><h3 id="å¦‚ä½•æ­£ç¡®è¿è¡Œï¼š"><a href="#å¦‚ä½•æ­£ç¡®è¿è¡Œï¼š" class="headerlink" title="å¦‚ä½•æ­£ç¡®è¿è¡Œï¼š"></a>å¦‚ä½•æ­£ç¡®è¿è¡Œï¼š</h3><p>å®éªŒè¦æ±‚ï¼š64ä½Ubuntu 16.04æ“ä½œç³»ç»Ÿï¼Œglibc-2.23.</p><p>å› ä¸ºä¸åŒçš„å¯æ‰§è¡Œæ–‡ä»¶å¯¹äºlibcç‰ˆæœ¬æœ‰ä¸åŒçš„è¦æ±‚ï¼Œä¸ºäº†ä¸ç”¨é‡åˆ°ä¸€ä¸ªç±»å‹çš„libcè£…ä¸€ä¸ªç±»å‹çš„libcï¼Œè¿™é‡Œç”¨glibc-all-in-oneå·¥å…·è¿›è¡Œç‰ˆæœ¬ç®¡ç†<br>ï¼ˆå¦‚æœåªåšè¿™ä¸€æ¬¡å®éªŒï¼Œæ¨èæ˜¯ç›´æ¥è£…glibc2.23ï¼‰</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">â”Œâ”€â”€(kaliã‰¿kali)-[~/glibc-all-<span class="keyword">in</span>-one]</span><br><span class="line">â””â”€$ cat list                  </span><br><span class="line"><span class="number">2</span>.<span class="number">23</span>-<span class="number">0</span>ubuntu11.<span class="number">3</span>_amd64</span><br><span class="line"><span class="number">2</span>.<span class="number">23</span>-<span class="number">0</span>ubuntu11.<span class="number">3</span>_i386</span><br><span class="line"><span class="number">2</span>.<span class="number">23</span>-<span class="number">0</span>ubuntu3_amd64</span><br><span class="line"><span class="number">2</span>.<span class="number">23</span>-<span class="number">0</span>ubuntu3_i386</span><br><span class="line"><span class="number">2</span>.<span class="number">27</span>-<span class="number">3</span>ubuntu1.<span class="number">5</span>_amd64</span><br><span class="line"><span class="number">2</span>.<span class="number">27</span>-<span class="number">3</span>ubuntu1.<span class="number">5</span>_i386</span><br><span class="line"><span class="number">2</span>.<span class="number">27</span>-<span class="number">3</span>ubuntu1.<span class="number">6</span>_amd64</span><br><span class="line"><span class="number">2</span>.<span class="number">27</span>-<span class="number">3</span>ubuntu1.<span class="number">6</span>_i386</span><br><span class="line"><span class="number">2</span>.<span class="number">27</span>-<span class="number">3</span>ubuntu1_amd64</span><br><span class="line"><span class="number">2</span>.<span class="number">27</span>-<span class="number">3</span>ubuntu1_i386</span><br><span class="line"><span class="number">2</span>.<span class="number">31</span>-<span class="number">0</span>ubuntu9.<span class="number">16</span>_amd64</span><br><span class="line"><span class="number">2</span>.<span class="number">31</span>-<span class="number">0</span>ubuntu9.<span class="number">16</span>_i386</span><br><span class="line"><span class="number">2</span>.<span class="number">31</span>-<span class="number">0</span>ubuntu9_amd64</span><br><span class="line"><span class="number">2</span>.<span class="number">31</span>-<span class="number">0</span>ubuntu9_i386</span><br><span class="line"><span class="number">2</span>.<span class="number">35</span>-<span class="number">0</span>ubuntu3.<span class="number">8</span>_amd64</span><br><span class="line"><span class="number">2</span>.<span class="number">35</span>-<span class="number">0</span>ubuntu3.<span class="number">8</span>_i386</span><br><span class="line"><span class="number">2</span>.<span class="number">35</span>-<span class="number">0</span>ubuntu3_amd64</span><br><span class="line"><span class="number">2</span>.<span class="number">35</span>-<span class="number">0</span>ubuntu3_i386</span><br><span class="line"><span class="number">2</span>.<span class="number">37</span>-<span class="number">0</span>ubuntu2.<span class="number">2</span>_amd64</span><br><span class="line"><span class="number">2</span>.<span class="number">37</span>-<span class="number">0</span>ubuntu2.<span class="number">2</span>_i386</span><br><span class="line"><span class="number">2</span>.<span class="number">37</span>-<span class="number">0</span>ubuntu2_amd64</span><br><span class="line"><span class="number">2</span>.<span class="number">37</span>-<span class="number">0</span>ubuntu2_i386</span><br><span class="line"><span class="number">2</span>.<span class="number">38</span>-<span class="number">1</span>ubuntu6.<span class="number">3</span>_amd64</span><br><span class="line"><span class="number">2</span>.<span class="number">38</span>-<span class="number">1</span>ubuntu6.<span class="number">3</span>_i386</span><br><span class="line"><span class="number">2</span>.<span class="number">38</span>-<span class="number">1</span>ubuntu6_amd64</span><br><span class="line"><span class="number">2</span>.<span class="number">38</span>-<span class="number">1</span>ubuntu6_i386</span><br><span class="line"><span class="number">2</span>.<span class="number">39</span>-<span class="number">0</span>ubuntu8.<span class="number">3</span>_amd64</span><br><span class="line"><span class="number">2</span>.<span class="number">39</span>-<span class="number">0</span>ubuntu8.<span class="number">3</span>_i386</span><br><span class="line"><span class="number">2</span>.<span class="number">39</span>-<span class="number">0</span>ubuntu8_amd64</span><br><span class="line"><span class="number">2</span>.<span class="number">39</span>-<span class="number">0</span>ubuntu8_i386</span><br><span class="line"><span class="number">2</span>.<span class="number">40</span>-<span class="number">1</span>ubuntu1_amd64</span><br><span class="line"><span class="number">2</span>.<span class="number">40</span>-<span class="number">1</span>ubuntu1_i386</span><br><span class="line">                                                                                                                                           </span><br><span class="line">â”Œâ”€â”€(kaliã‰¿kali)-[~/glibc-all-<span class="keyword">in</span>-one]</span><br><span class="line">â””â”€$ ./download <span class="number">2</span>.<span class="number">23</span>-<span class="number">0</span>ubuntu11.<span class="number">3</span>_amd64 </span><br><span class="line">Getting <span class="number">2</span>.<span class="number">23</span>-<span class="number">0</span>ubuntu11.<span class="number">3</span>_amd64</span><br><span class="line">--&gt; Downloaded before. Remove it to download again.</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æ¥ç€ç”¨patchelfä¿®æ”¹æœ¬åœ°ç¨‹åºé“¾æ¥libcç‰ˆæœ¬ï¼š</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">â”Œâ”€â”€(kaliã‰¿kali)-[~/Desktop]</span><br><span class="line">â””â”€$ patchelf --<span class="built_in">set</span>-rpath /home/kali/glibc-all-<span class="keyword">in</span>-one/libs/<span class="number">2</span>.<span class="number">23</span>-<span class="number">0</span>ubuntu11.<span class="number">3</span>_amd64/ test  </span><br><span class="line">                                                                                                                                           </span><br><span class="line">â”Œâ”€â”€(kaliã‰¿kali)-[~/Desktop]</span><br><span class="line">â””â”€$ patchelf --<span class="built_in">set</span>-interpreter /home/kali/glibc-all-<span class="keyword">in</span>-one/libs/<span class="number">2</span>.<span class="number">23</span>-<span class="number">0</span>ubuntu11.<span class="number">3</span>_amd64/ld-<span class="number">2</span>.<span class="number">23</span>.so  test </span><br><span class="line">                                                                                                                                           </span><br><span class="line">â”Œâ”€â”€(kaliã‰¿kali)-[~/Desktop]</span><br><span class="line">â””â”€$ ./test                            </span><br><span class="line">p = <span class="number">0</span>x1b5b010 </span><br><span class="line">*p = <span class="number">0</span>x7f5a925c4b78</span><br><span class="line">main_arena = <span class="number">0</span>x7f5a925c4b20</span><br><span class="line">libc base = <span class="number">0</span>x7f5a92200000</span><br></pre></td></tr></table></figure><h3 id="å¦‚ä½•å¿«é€Ÿè¯æ˜main-arenaå’Œlibc-baseè¾“å‡ºæ˜¯æ­£ç¡®çš„ä½ç½®ï¼š"><a href="#å¦‚ä½•å¿«é€Ÿè¯æ˜main-arenaå’Œlibc-baseè¾“å‡ºæ˜¯æ­£ç¡®çš„ä½ç½®ï¼š" class="headerlink" title="å¦‚ä½•å¿«é€Ÿè¯æ˜main_arenaå’Œlibc_baseè¾“å‡ºæ˜¯æ­£ç¡®çš„ä½ç½®ï¼š"></a>å¦‚ä½•å¿«é€Ÿè¯æ˜main_arenaå’Œlibc_baseè¾“å‡ºæ˜¯æ­£ç¡®çš„ä½ç½®ï¼š</h3><h4 id="libc-base"><a href="#libc-base" class="headerlink" title="libc_base:"></a>libc_base:</h4><p>è¿™é‡Œæˆ‘æ˜¯ç”¨IDAè¿œç¨‹è¿æ¥kaliåŠ¨æ€è°ƒè¯•ï¼š</p><p>æ­¤æ—¶æˆ‘ä»¬ç‚¹å‡»mallocå‡½æ•° è·³å…¥å‡½æ•°è°ƒç”¨è¡¨ å†ç‚¹å‡»è¿›å…¥libcå‡½æ•° æœ€åç‚¹å‡»å°±æ˜¯mallocå‡½æ•°çš„ä½ç½®</p><p><img src="https://xyy9233.oss-cn-beijing.aliyuncs.com/hexoblog/image-20241222191930083.png" alt="image-20241222191930083"></p><p>å¾€ä¸Šç¿»å¯ä»¥çœ‹åˆ°libc_baseåœ°å€ 0x7f5a92200000</p><p><img src="https://xyy9233.oss-cn-beijing.aliyuncs.com/hexoblog/image-20241222192014019.png" alt="image-20241222192014019"></p><h4 id="main-arena"><a href="#main-arena" class="headerlink" title="main_arena:"></a>main_arena:</h4><p>main_arenaä¸­å¸ƒå±€ä¸º 88ä½ ï¼Œç¬¬ä¸€ä¸ªç”³è¯·çš„unsortedçš„å †çš„ä½ç½®-0x88å°±æ˜¯main_arenaä½ç½®</p><hr><h3 id="å¯¹æ¯ä¸€å—çš„è§£é‡Š"><a href="#å¯¹æ¯ä¸€å—çš„è§£é‡Š" class="headerlink" title="å¯¹æ¯ä¸€å—çš„è§£é‡Š"></a>å¯¹æ¯ä¸€å—çš„è§£é‡Š</h3><p>ä»¥ä¸‹æ˜¯å¯¹æ¯ä¸€å—ä¸ç†è§£çš„ä¸œè¥¿çš„ä¸€äº›è§£é‡Šï¼Œæ¢ç´¢è¿‡ç¨‹æ˜¯ä»åå¾€å‰çš„ï¼Œä½†æ˜¯è§£é‡Šæ˜¯ä»å‰å¾€åçš„ï¼Œæ‰€ä»¥æœ€åä¸€å—å†™äº†å¾ˆå¤šå¤šä½™çš„ä¸œè¥¿ï¼Œæ‰¾åˆ°è‡ªå·±æƒ³çŸ¥é“çš„å°±è¡Œã€‚</p><h3 id="ä¸ºä»€ä¹ˆè¦ç”³è¯·0x80å¤§å°çš„mallocï¼š"><a href="#ä¸ºä»€ä¹ˆè¦ç”³è¯·0x80å¤§å°çš„mallocï¼š" class="headerlink" title="ä¸ºä»€ä¹ˆè¦ç”³è¯·0x80å¤§å°çš„mallocï¼š"></a>ä¸ºä»€ä¹ˆè¦ç”³è¯·0x80å¤§å°çš„mallocï¼š</h3><p>ä¸€ä¸ªå¿«é€Ÿçš„äº†è§£å †ï¼š<a href="https://blog.csdn.net/qq_41453285/article/details/96865321">å †æ¼æ´æŒ–æ˜ä¸­çš„binsåˆ†ç±»(fastbinã€unsorted binã€small binã€large bin)</a></p><p>ä¸€ä¸ªæè‡´è¯¦ç»†çš„äº†è§£å †ï¼š[glibc heapâ€”â€”ä»å…¥é—¨åˆ°å…¥åœŸ ](<a href="http://jmpcliff.top/2124/04/21/Blog/Pwn/pwn">http://jmpcliff.top/2124/04/21/Blog/Pwn/pwn</a> note&#x2F;glibc-heap&#x2F;glibc heapä»å…¥é—¨åˆ°å…¥åœŸ&#x2F;)</p><p>fastbinsä¸ºå•é“¾è¡¨å­˜å‚¨ã€‚unsortedbinã€smallbinsã€largebinséƒ½æ˜¯åŒå‘å¾ªç¯é“¾è¡¨å­˜å‚¨ã€‚</p><p>freeæ‰çš„chunkï¼Œå¦‚æœå¤§å°åœ¨0x20~0x80ä¹‹é—´ä¼šç›´æ¥æ”¾åˆ°fastbinsä¸Šå»ï¼Œå¤§äº0x80çš„ä¼šæ”¾åˆ°unsortedbinä¸Šï¼Œç„¶åè¿›è¡Œæ•´ç†ã€‚</p><p>æˆ‘ä»¬è¦åˆ©ç”¨è¿™ä¸ªåŒå‘å¾ªç¯åˆ—è¡¨çš„unsortedç‰¹æ€§ï¼Œæ¥å¯¹UAFè¿›è¡Œå®éªŒï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆé€‰æ‹©ç”³è¯·0x80çš„å¤§å°</p><h3 id="ä¸ºä»€ä¹ˆè¦æ‰¾main-arenaçš„ä½ç½®"><a href="#ä¸ºä»€ä¹ˆè¦æ‰¾main-arenaçš„ä½ç½®" class="headerlink" title="ä¸ºä»€ä¹ˆè¦æ‰¾main_arenaçš„ä½ç½®"></a>ä¸ºä»€ä¹ˆè¦æ‰¾main_arenaçš„ä½ç½®</h3><p>UAFâ€”â€”Use after free(<a href="https://ctf-wiki.org/pwn/linux/user-mode/heap/ptmalloc2/use-after-free/">Use After Free - CTF Wiki</a>)</p><p>ç¨‹åºåœ¨åˆ›å»ºå †çš„æ—¶å€™æ˜¯ä¼šè°ƒç”¨__malloc_hookçš„ï¼Œè¿™é‡Œå¦‚æœæˆ‘ä»¬å°†è¿™ä¸ªhookçš„æŒ‡å‘åœ°å€æ›¿æ¢ä¸ºå¯æ§åˆ¶çš„ç¨‹åºå‡½æ•°åœ°å€å°±å¯ä»¥æ‰§è¡Œæˆ‘ä»¬éœ€è¦çš„shellcodeï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å®šä½__malloc_hookï¼Œè€Œåœ¨libc-2.23ä¸­ï¼Œhookçš„ä½ç½®æ˜¯main_arenaçš„ä½ç½®å‡0x10</p><h3 id="æ€ä¹ˆæ‰¾åˆ°Main-arenaä½ç½®å‘¢-ä¸ºä»€ä¹ˆ-88ï¼Ÿ"><a href="#æ€ä¹ˆæ‰¾åˆ°Main-arenaä½ç½®å‘¢-ä¸ºä»€ä¹ˆ-88ï¼Ÿ" class="headerlink" title="æ€ä¹ˆæ‰¾åˆ°Main_arenaä½ç½®å‘¢&#x2F;ä¸ºä»€ä¹ˆ-88ï¼Ÿ"></a>æ€ä¹ˆæ‰¾åˆ°Main_arenaä½ç½®å‘¢&#x2F;ä¸ºä»€ä¹ˆ-88ï¼Ÿ</h3><h5 id="é¦–å…ˆæˆ‘ä»¬éœ€è¦çŸ¥é“ä»€ä¹ˆæ˜¯arena"><a href="#é¦–å…ˆæˆ‘ä»¬éœ€è¦çŸ¥é“ä»€ä¹ˆæ˜¯arena" class="headerlink" title="é¦–å…ˆæˆ‘ä»¬éœ€è¦çŸ¥é“ä»€ä¹ˆæ˜¯arena:"></a>é¦–å…ˆæˆ‘ä»¬éœ€è¦çŸ¥é“ä»€ä¹ˆæ˜¯arena:</h5><p>è¿™ç¯‡åšå®¢å†™çš„å¾ˆæ¸…æ¥šï¼š<a href="https://dongshao.blog.csdn.net/article/details/96846067?fromshare=blogdetail&sharetype=blogdetail&sharerId=96846067&sharerefer=PC&sharesource=diaoqi599&sharefrom=from_link">ä»€ä¹ˆæ˜¯Arena</a></p><p>ç®¡ç†å †çš„éƒ¨åˆ†ç¨‹åºç§°ä¸º<strong>å †ç®¡ç†å™¨</strong>ï¼Œå †ç®¡ç†å™¨å¤„äºç”¨æˆ·ç¨‹åºä¸å†…æ ¸ä¸­é—´ï¼Œå…¶å·¥ä½œä¸ºmallocå’Œfreeï¼ˆåˆ†é…å’Œå›æ”¶å †ç©ºé—´ï¼‰</p><p>å †çš„glibcå®ç°åŒ…æ‹¬struct _heap_infoï¼Œstruct malloc_stateï¼Œstruct malloc_chunkè¿™3ä¸ªç»“æ„ä½“ã€‚</p><p><strong>Arenaå°±æ˜¯æ¥ç®¡ç†çº¿ç¨‹ä¸­è¿™äº›å †çš„ä¿¡æ¯</strong></p><p>ä¸€ä¸ªçº¿ç¨‹åªæœ‰ä¸€ä¸ªarenaï¼Œå¹¶ä¸”è¿™äº›çº¿ç¨‹çš„arneaéƒ½æ˜¯ç‹¬ç«‹çš„ä¸æ˜¯ç›¸åŒçš„ã€‚<strong>ä¸»çº¿ç¨‹çš„arneaç§°ä¸ºmain_arena</strong>ï¼Œç›¸å¯¹å­çº¿ç¨‹ä¸ºthread_arena</p><h5 id="Arenaå®ç°çš„struct-malloc-state"><a href="#Arenaå®ç°çš„struct-malloc-state" class="headerlink" title="Arenaå®ç°çš„struct malloc_state:"></a>Arenaå®ç°çš„struct malloc_state:</h5><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">malloc_state</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">  <span class="comment">/* Serialize access.  */</span></span><br><span class="line">  __libc_lock_define (, mutex);  <span class="comment">//mutexé” //4å­—èŠ‚</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">/* Flags (formerly in max_fast).  */</span></span><br><span class="line">  <span class="type">int</span> flags;  <span class="comment">//4å­—èŠ‚</span></span><br><span class="line"><span class="comment">//##########8å­—èŠ‚############</span></span><br><span class="line">  <span class="comment">/* Set if the fastbin chunks contain recently inserted free blocks.  */</span></span><br><span class="line">  <span class="comment">/* Note this is a bool but not all targets support atomics on booleans.  */</span></span><br><span class="line">  <span class="type">int</span> have_fastchunks;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/* Fastbins */</span></span><br><span class="line">  mfastbinptr fastbinsY[NFASTBINS];<span class="comment">// çœ‹ä»£ç ä¸‹é¢çš„è§£é‡Š1  ä¸€å…±80å­—èŠ‚</span></span><br><span class="line"><span class="comment">//##########88å­—èŠ‚############</span></span><br><span class="line">  <span class="comment">/* Base of the topmost chunk -- not otherwise kept in a bin */</span></span><br><span class="line">  mchunkptr top;  <span class="comment">//8å­—èŠ‚</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">/* The remainder from the most recent split of a small request */</span></span><br><span class="line">  mchunkptr last_remainder;<span class="comment">//8å­—èŠ‚</span></span><br><span class="line"><span class="comment">//##########96å­—èŠ‚############</span></span><br><span class="line">  <span class="comment">/* Normal bins packed as described above */</span></span><br><span class="line">  mchunkptr bins[NBINS * <span class="number">2</span> - <span class="number">2</span>];  <span class="comment">//&lt;---è¿™é‡Œæ˜¯æˆ‘ä»¬å­˜å…¥çš„ç‚¹ //çœ‹ä¸‹é¢è§£é‡Š2</span></span><br><span class="line">    </span><br><span class="line">  <span class="comment">/* Bitmap of bins */</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> binmap[BINMAPSIZE];</span><br><span class="line"></span><br><span class="line">  <span class="comment">/* Linked list */</span></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">malloc_state</span> *<span class="title">next</span>;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">/* Linked list for free arenas.  Access to this field is serialized</span></span><br><span class="line"><span class="comment">     by free_list_lock in arena.c.  */</span></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">malloc_state</span> *<span class="title">next_free</span>;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">/* Number of threads attached to this arena.  0 if the arena is on</span></span><br><span class="line"><span class="comment">     the free list.  Access to this field is serialized by</span></span><br><span class="line"><span class="comment">     free_list_lock in arena.c.  */</span></span><br><span class="line">  INTERNAL_SIZE_T attached_threads;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/* Memory allocated from the system in this arena.  */</span></span><br><span class="line">  INTERNAL_SIZE_T system_mem;</span><br><span class="line">  INTERNAL_SIZE_T max_system_mem;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h6 id="è§£é‡Š1"><a href="#è§£é‡Š1" class="headerlink" title="è§£é‡Š1"></a><strong>è§£é‡Š1</strong></h6><p>è¦æ±‚<strong>mfastbinptr fastbinsY[NFASTBINS];</strong></p><p><img src="https://xyy9233.oss-cn-beijing.aliyuncs.com/hexoblog/image-20241222231212774.png" alt="image-20241222231212774"></p><p>å…ˆæ±‚MAX_FAST_SIZEï¼Œè¿›å…¥SIZE_SZ</p><p><img src="https://xyy9233.oss-cn-beijing.aliyuncs.com/hexoblog/image-20241222231144255.png" alt="image-20241222231144255"></p><p>SIZE_SZä¸º8å­—èŠ‚ï¼Œæ‰€ä»¥è¿™æ—¶å€™MAX_FAST_SIZEå°±æ˜¯0xA0</p><p><img src="https://xyy9233.oss-cn-beijing.aliyuncs.com/hexoblog/image-20241222231026224.png" alt="image-20241222231026224"></p><p>request2size(0xA0)&#x2F;&#x2F;å°†éœ€æ±‚sizeè½¬æ¢ä¸ºç”³è¯·çš„chunk_sizeâ€“&gt; 0xB0</p><p>fastbin_index(0xB0)+1 â€”&gt; 0xB-2+1&#x3D;0xA</p><p><img src="https://xyy9233.oss-cn-beijing.aliyuncs.com/hexoblog/image-20241222231454155.png" alt="image-20241222231454155"></p><p>ä¸€ä¸ªint8å­—èŠ‚ï¼Œ0xA*8 &#x3D; 0x50</p><p><img src="https://xyy9233.oss-cn-beijing.aliyuncs.com/hexoblog/image-20241222231722937.png" alt="image-20241222231722937"></p><h6 id="è§£é‡Š2"><a href="#è§£é‡Š2" class="headerlink" title="è§£é‡Š2"></a>è§£é‡Š2</h6><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">  <span class="comment">/* Base of the topmost chunk -- not otherwise kept in a bin */</span></span><br><span class="line">  mchunkptr top;  <span class="comment">//8å­—èŠ‚</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">/* The remainder from the most recent split of a small request */</span></span><br><span class="line">  mchunkptr last_remainder;<span class="comment">//8å­—èŠ‚</span></span><br><span class="line"><span class="comment">//##########96å­—èŠ‚############</span></span><br><span class="line">  <span class="comment">/* Normal bins packed as described above */</span></span><br><span class="line">  mchunkptr bins[NBINS * <span class="number">2</span> - <span class="number">2</span>]; </span><br></pre></td></tr></table></figure><p>[å…³äºbinsä¸­çš„1molä¸œè¥¿](<a href="http://jmpcliff.top/2124/04/21/Blog/Pwn/pwn">http://jmpcliff.top/2124/04/21/Blog/Pwn/pwn</a> note&#x2F;glibc-heap&#x2F;glibc heapä»å…¥é—¨åˆ°å…¥åœŸ&#x2F;#binsæ•°ç»„)</p><h3 id="ä¸ºä»€ä¹ˆå‡0x3c4b20ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆå‡0x3c4b20ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆå‡0x3c4b20ï¼Ÿ"></a>ä¸ºä»€ä¹ˆå‡0x3c4b20ï¼Ÿ</h3><p>çŸ¥é“äº†åˆšåˆšé‚£äº›å¥‡å¥‡æ€ªæ€ªçš„ä¸œè¥¿ï¼Œè‡ªç„¶ä¹Ÿå°±çŸ¥é“ä¸ºä»€ä¹ˆäº†ã€‚</p><p>ä»¥ä¸‹æ˜¯åˆšæ‹¿åˆ°è¿™ä¸ªä»£ç æ—¶æå‡ºçš„é—®é¢˜ï¼Œåœ¨é€†å‘æ¢ç©¶æ—¶å€™ï¼Œéƒ¨åˆ†è§£é‡Šæ ¹æ®é€»è¾‘é¡ºåºæ”¾åˆ°äº†ä¸Šé¢ã€‚</p><p>å…ˆå®šä½libc-2.23ä¸­çš„0x3C4B20ä½ç½®ï¼Œçœ‹çœ‹æœ‰ä»€ä¹ˆï¼š</p><p><img src="https://xyy9233.oss-cn-beijing.aliyuncs.com/hexoblog/image-20241222202458997.png" alt="image-20241222202458997"></p><p>æ¬¸ï¼Ÿä¸Šé¢æ€ä¹ˆæ˜¯malloc_hookå‘¢ï¼Ÿè€Œä¸”åªå·®äº†0x10çš„åç§»ï¼Œæœæœ<a href="https://blog.csdn.net/hejinjing_tom_com/article/details/124007460?fromshare=blogdetail&sharetype=blogdetail&sharerId=124007460&sharerefer=PC&sharesource=diaoqi599&sharefrom=from_link">malloc_hook ç ”ç©¶.</a></p><p>æ–‡ä¸­æŒ‡å‡ºï¼Œ__malloc_hookæ˜¯glibcå®šä¹‰çš„ä¸€ç»„å˜é‡ï¼Œå³å‡½æ•°æŒ‡é’ˆï¼Œç”±æ­¤å»è°ƒç”¨å¯¹åº”çš„å‡½æ•°ï¼Œæ‰€ä»¥ç§°ä¸ºhookï¼Œåœ¨è¿è¡Œçš„ç¨‹åºä¸­ï¼ˆä¹Ÿåªæœ‰è¿è¡Œä¸­çš„ç¨‹åºæ‰èƒ½çœ‹åˆ°ï¼Œå› ä¸ºå †æ˜¯åŠ¨æ€åˆ†é…ï¼‰ä¹Ÿèƒ½çœ‹åˆ°ï¼Œ</p><p><img src="https://xyy9233.oss-cn-beijing.aliyuncs.com/hexoblog/image-20241222202727214.png" alt="image-20241222202727214"></p><p>æˆ‘ä»¬åç¼–è¯‘libc-2.23.soæ–‡ä»¶ï¼Œå¯¹ç…§ç€çœ‹ï¼š</p><p>å…ˆæ¥åˆ°*pçš„åœ°å€ï¼Œå› ä¸ºæˆ‘ä»¬å¼€è¾Ÿäº†0x80å¤§å°çš„ä½ç½®ï¼Œæ‰€ä»¥ä¸ä¼šåœ¨fastbinä¸­åˆ†é…ï¼ˆfastbinå¤§å°ä¸º0x58ï¼Œä¹Ÿå°±æ˜¯80ï¼‰</p><p><code>char *p = malloc(0x80);</code></p><p><a href="https://ctf-wiki.org/pwn/linux/user-mode/heap/ptmalloc2/heap-overview/?h=malloc#malloc">mallocçš„è¡Œä¸º</a>â€”â€”malloc å‡½æ•°è¿”å›å¯¹åº”å¤§å°å­—èŠ‚çš„å†…å­˜å—çš„æŒ‡é’ˆï¼Œæ‰€ä»¥*pæ˜¯è¿™ä¸ªå †çš„åœ°å€</p><p><img src="https://xyy9233.oss-cn-beijing.aliyuncs.com/hexoblog/image-20241222201326842.png" alt="image-20241222201326842"></p><h3 id="åè¯"><a href="#åè¯" class="headerlink" title="åè¯"></a>åè¯</h3><p>ç»“æŸï¼çˆ½äº†ï¼å½»åº•ææ¸…æ¥šäº†ï¼ï¼ï¼ï¼ï¼ä»åƒé¥­å›æ¥åˆ°0ç‚¹ï¼</p><p>ï¼ˆé èº¬ï¼</p><p>æ„Ÿè°¢Jmp.Cliffå¸ˆå‚…å¯¹struct malloc_stateçš„è¶…è¯¦ç»†è§£è¯»å’Œé˜Ÿå‹å¯¹äºæˆ‘å„ç§å¥‡æ€ªçš„é—®é¢˜çš„è§£ç­”ï¼‰</p><h2 id="shellcodeï¼"><a href="#shellcodeï¼" class="headerlink" title="shellcodeï¼"></a>shellcodeï¼</h2><h2 id="APIè‡ªæœç´¢"><a href="#APIè‡ªæœç´¢" class="headerlink" title="APIè‡ªæœç´¢"></a>APIè‡ªæœç´¢</h2><p><img src="https://xyy9233.oss-cn-beijing.aliyuncs.com/hexoblog/image-20241213110212389.png" alt="image-20241213110212389"></p><h3 id="ç¬¬ä¸€æ­¥ï¼š"><a href="#ç¬¬ä¸€æ­¥ï¼š" class="headerlink" title="ç¬¬ä¸€æ­¥ï¼š"></a>ç¬¬ä¸€æ­¥ï¼š</h3><p><img src="https://xyy9233.oss-cn-beijing.aliyuncs.com/hexoblog/image-20241213111055636.png" alt="image-20241213111055636"></p><p>è·å¾—kernel32.dllçš„åŸºåœ°å€ï¼š0x76530000</p><h3 id="ç¬¬äºŒæ­¥ï¼š"><a href="#ç¬¬äºŒæ­¥ï¼š" class="headerlink" title="ç¬¬äºŒæ­¥ï¼š"></a>ç¬¬äºŒæ­¥ï¼š</h3><p><img src="https://xyy9233.oss-cn-beijing.aliyuncs.com/hexoblog/image-20241213111443659.png" alt="image-20241213111443659"></p><p>dllçš„PEå¤´çš„æŒ‡é’ˆï¼ˆç›¸å¯¹åœ°å€ï¼‰ï¼šEAX &#x3D; 000000F0</p><p>å¯¼å‡ºè¡¨çš„æŒ‡é’ˆï¼ˆç›¸å¯¹åœ°å€ï¼‰ï¼šECX &#x3D; 0022D3E0 &#x2F;&#x2F;å¯¼å‡ºè¡¨</p><p>å¯¼å‡ºè¡¨çš„<strong>å†…å­˜</strong>åœ°å€ï¼šECX &#x3D; 7675D3E0</p><p>RVAåˆ—è¡¨ï¼š0x0022D408<img src="https://xyy9233.oss-cn-beijing.aliyuncs.com/hexoblog/image-20241213113128982.png" alt="image-20241213113128982"></p><p>å¯¼å‡ºå‡½æ•°ååˆ—è¡¨æŒ‡é’ˆï¼š<strong>EBX &#x3D; 0022F32C</strong></p><p><img src="https://xyy9233.oss-cn-beijing.aliyuncs.com/hexoblog/image-20241213113225955.png" alt="image-20241213113225955"></p><p>å¯¼å‡ºå‡½æ•°ååˆ—è¡¨æŒ‡é’ˆçš„åŸºåœ°å€ï¼šEBX &#x3D; 7675F32C</p><p><img src="https://xyy9233.oss-cn-beijing.aliyuncs.com/hexoblog/image-20241213113339650.png" alt="image-20241213113339650"></p><h3 id="ç¬¬ä¸‰æ­¥"><a href="#ç¬¬ä¸‰æ­¥" class="headerlink" title="ç¬¬ä¸‰æ­¥"></a>ç¬¬ä¸‰æ­¥</h3><p>kernel32.dllåŸºåœ°å€0x76530000 +</p><p>å‡½æ•°åœ°å€åç§»é‡0x001c9298 &#x3D;</p><p>LoadLibraryAå‡½æ•°åœ°å€0x766F9298</p><p><img src="https://xyy9233.oss-cn-beijing.aliyuncs.com/hexoblog/image-20241219211152654.png" alt="image-20241219211152654"></p><h2 id="afl"><a href="#afl" class="headerlink" title="afl"></a>afl</h2><p><img src="https://xyy9233.oss-cn-beijing.aliyuncs.com/hexoblog/image-20241218155852036.png" alt="image-20241218155852036"></p><p>crashï¼ï¼ï¼</p><p><img src="https://xyy9233.oss-cn-beijing.aliyuncs.com/hexoblog/image-20241218155844028.png" alt="image-20241218155844028"></p></div><hr><div class="reprint" id="reprint-statement"><div class="reprint__author"><span class="reprint-meta" style="font-weight:700"><i class="fas fa-user">æ–‡ç« ä½œè€…: </i></span><span class="reprint-info"><a href="/about" rel="external nofollow noreferrer">W3nL0u</a></span></div><div class="reprint__type"><span class="reprint-meta" style="font-weight:700"><i class="fas fa-link">æ–‡ç« é“¾æ¥: </i></span><span class="reprint-info"><a href="https://github.com/xyy9233/xyy9233.github.io.git/2024/12/23/ruan-jian-an-quan/">https://github.com/xyy9233/xyy9233.github.io.git/2024/12/23/ruan-jian-an-quan/</a></span></div><div class="reprint__notice"><span class="reprint-meta" style="font-weight:700"><i class="fas fa-copyright">ç‰ˆæƒå£°æ˜: </i></span><span class="reprint-info">æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ¥å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜æ¥æº <a href="/about" target="_blank">W3nL0u</a> !</span></div></div><script async defer>function navToReprintStatement(){$("html, body").animate({scrollTop:$("#reprint-statement").offset().top-80},800)}document.addEventListener("copy",function(t){M.toast({html:'<span>å¤åˆ¶æˆåŠŸï¼Œè¯·éµå¾ªæœ¬æ–‡çš„è½¬è½½è§„åˆ™</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">æŸ¥çœ‹</a>'})})</script><div class="tag_share" style="display:block"><div class="post-meta__tag-list" style="display:inline-block"><div class="article-tag"><span class="chip bg-color">æ— æ ‡ç­¾</span></div></div><div class="post_share" style="zoom:80%;width:fit-content;display:inline-block;float:right;margin:-.15rem 0"><link rel="stylesheet" href="/libs/share/css/share.min.css"><div id="article-share"><div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>å¾®ä¿¡æ‰«ä¸€æ‰«å³å¯åˆ†äº«ï¼</p>"></div><script src="/libs/share/js/social-share.min.js"></script></div></div></div></div></div><article id="prenext-posts" class="prev-next articles"><div class="row article-row"><div class="article col s12 m6" data-aos="fade-up" data-aos="fade-up"><div class="article-badge left-badge text-color"><i class="far fa-dot-circle"></i>&nbsp;æœ¬ç¯‡</div><div class="card"><a href="/2024/12/23/ruan-jian-an-quan/"><div class="card-image"><img src="/medias/featureimages/13.jpg" class="responsive-img" alt="è½¯ä»¶å®‰å…¨å®éªŒ1-6è¯¦è§£"> <span class="card-title">è½¯ä»¶å®‰å…¨å®éªŒ1-6è¯¦è§£</span></div></a><div class="card-content article-content"><div class="summary block-with-text"></div><div class="publish-info"><span class="publish-date"><i class="far fa-clock fa-fw icon-date"></i>2024-12-23 </span><span class="publish-author"><i class="fas fa-user fa-fw"></i> W3nL0u</span></div></div></div></div><div class="article col s12 m6" data-aos="fade-up"><div class="article-badge right-badge text-color">ä¸‹ä¸€ç¯‡&nbsp;<i class="fas fa-chevron-right"></i></div><div class="card"><a href="/2024/12/21/0ctf-2024-reverse/"><div class="card-image"><img src="/medias/featureimages/0.jpg" class="responsive-img" alt=""> <span class="card-title"></span></div></a><div class="card-content article-content"><div class="summary block-with-text"></div><div class="publish-info"><span class="publish-date"><i class="far fa-clock fa-fw icon-date"></i>2024-12-21 </span><span class="publish-author"><i class="fas fa-user fa-fw"></i> W3nL0u</span></div></div></div></div></div></article></div><script src="/libs/codeBlock/codeBlockFuction.js"></script><script src="/libs/codeBlock/codeLang.js"></script><script src="/libs/codeBlock/codeCopy.js"></script><script src="/libs/codeBlock/codeShrink.js"></script></div><div id="toc-aside" class="expanded col l3 hide-on-med-and-down"><div class="toc-widget card" style="background-color:#fff"><div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;ç›®å½•</div><div id="toc-content"></div></div></div></div><div id="floating-toc-btn" class="hide-on-med-and-down"><a class="btn-floating btn-large bg-color"><i class="fas fa-list-ul"></i></a></div><script src="/libs/tocbot/tocbot.min.js"></script><script>$(function(){tocbot.init({tocSelector:"#toc-content",contentSelector:"#articleContent",headingsOffset:-(.4*$(window).height()-45),collapseDepth:Number("0"),headingSelector:"h2, h3, h4"});let t=parseInt(.4*$(window).height()-64),e=$(".toc-widget"),n=($(window).scroll(function(){$(window).scrollTop()>t?e.addClass("toc-fixed"):e.removeClass("toc-fixed")}),"expanded"),i=$("#toc-aside"),l=$("#main-content");$("#floating-toc-btn .btn-floating").click(function(){i.hasClass(n)?(i.removeClass(n).hide(),l.removeClass("l9")):(i.addClass(n).show(),l.addClass("l9"));var e="artDetail",o="prenext-posts";if(0!==(e=$("#"+e)).length){let t=e.width();450<=t?t+=21:350<=t&&t<450?t+=18:300<=t&&t<350?t+=16:t+=14,$("#"+o).width(t)}})})</script></main><footer class="page-footer bg-color"><div class="container row center-align" style="margin-bottom:0!important"><div class="col s12 m8 l8 copy-right">Copyright&nbsp;&copy; <span id="year">2023-2024</span> <a href="/about" target="_blank">W3nL0u</a> |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a> |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a><br><span id="busuanzi_container_site_pv">&nbsp;|&nbsp;<i class="far fa-eye"></i>&nbsp;æ€»è®¿é—®é‡:&nbsp; <span id="busuanzi_value_site_pv" class="white-color"></span> </span><span id="busuanzi_container_site_uv">&nbsp;|&nbsp;<i class="fas fa-users"></i>&nbsp;æ€»è®¿é—®äººæ•°:&nbsp; <span id="busuanzi_value_site_uv" class="white-color"></span></span><br><br></div><div class="col s12 m4 l4 social-link social-statis"><a href="https://github.com/xyy9233" class="tooltipped" target="_blank" data-tooltip="è®¿é—®æˆ‘çš„GitHub" data-position="top" data-delay="50"><i class="fab fa-github"></i> </a><a href="mailto:1768765226@qq.com" class="tooltipped" target="_blank" data-tooltip="é‚®ä»¶è”ç³»æˆ‘" data-position="top" data-delay="50"><i class="fas fa-envelope-open"></i> </a><a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=1768765226" class="tooltipped" target="_blank" data-tooltip="QQè”ç³»æˆ‘: 1768765226" data-position="top" data-delay="50"><i class="fab fa-qq"></i> </a><a href="https://www.zhihu.com/people/hen-lan-de-xue-ba" class="tooltipped" target="_blank" data-tooltip="å…³æ³¨æˆ‘çš„çŸ¥ä¹: https://www.zhihu.com/people/hen-lan-de-xue-ba" data-position="top" data-delay="50"><i class="fab fa-zhihu1">çŸ¥</i> </a><a href="/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS è®¢é˜…" data-position="top" data-delay="50"><i class="fas fa-rss"></i></a></div></div></footer><div class="progress-bar"></div><div id="searchModal" class="modal"><div class="modal-content"><div class="search-header"><span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;æœç´¢</span> <input type="search" id="searchInput" name="s" placeholder="è¯·è¾“å…¥æœç´¢çš„å…³é”®å­—" class="search-input"></div><div id="searchResult"></div></div></div><script>$(function(){var e,r,s;e="/search.xml",r="searchInput",s="searchResult",$.ajax({url:e,dataType:"xml",success:function(e){var t=$("entry",e).map(function(){return{title:$("title",this).text(),content:$("content",this).text(),url:$("url",this).text()}}).get(),e=document.getElementById(r),n=document.getElementById(s);e.addEventListener("input",function(){var o='<ul class="search-result-list">',h=this.value.trim().toLowerCase().split(/[\s\-]+/);n.innerHTML="",this.value.trim().length<=0||(t.forEach(function(e){var n,t,r,s=!0,a=e.title.trim().toLowerCase(),l=e.content.trim().replace(/<[^>]+>/g,"").toLowerCase(),i=0===(i=e.url).indexOf("/")?e.url:"/"+i,c=-1,u=-1;""!==a&&""!==l&&h.forEach(function(e,t){n=a.indexOf(e),c=l.indexOf(e),n<0&&c<0?s=!1:(c<0&&(c=0),0===t&&(u=c))}),s&&(o+="<li><a href='"+i+"' class='search-result-title'>"+a+"</a>",i=e.content.trim().replace(/<[^>]+>/g,""),0<=u&&(e=u+80,(e=0===(t=(t=u-20)<0?0:t)?100:e)>i.length&&(e=i.length),r=i.substr(t,e),h.forEach(function(e){var t=new RegExp(e,"gi");r=r.replace(t,'<em class="search-keyword">'+e+"</em>")}),o+='<p class="search-result">'+r+"...</p>"),o+="</li>")}),o+="</ul>",n.innerHTML=o)})}})})</script><div class="stars-con"><div id="stars"></div><div id="stars2"></div><div id="stars3"></div></div><script>function switchNightMode(){$('<div class="Cuteen_DarkSky"><div class="Cuteen_DarkPlanet"></div></div>').appendTo($("body")),setTimeout(function(){$("body").hasClass("DarkMode")?($("body").removeClass("DarkMode"),localStorage.setItem("isDark","0"),$("#sum-moon-icon").removeClass("fa-sun").addClass("fa-moon")):($("body").addClass("DarkMode"),localStorage.setItem("isDark","1"),$("#sum-moon-icon").addClass("fa-sun").removeClass("fa-moon")),setTimeout(function(){$(".Cuteen_DarkSky").fadeOut(1e3,function(){$(this).remove()})},2e3)})}</script><div id="backTop" class="top-scroll"><a class="btn-floating btn-large waves-effect waves-light" href="#!"><i class="fas fa-arrow-up"></i></a></div><script src="/libs/materialize/materialize.min.js"></script><script src="/libs/masonry/masonry.pkgd.min.js"></script><script src="/libs/aos/aos.js"></script><script src="/libs/scrollprogress/scrollProgress.min.js"></script><script src="/libs/lightGallery/js/lightgallery-all.min.js"></script><script src="/js/matery.js"></script><script>var windowWidth=$(window).width();768<windowWidth&&document.write('<script type="text/javascript" src="/libs/others/star.js"><\/script>')</script><script src="https://ssl.captcha.qq.com/TCaptcha.js"></script><script src="/libs/others/TencentCaptcha.js"></script><button id="TencentCaptcha" data-appid="xxxxxxxxxx" data-cbfn="callback" type="button" hidden></button><script>(()=>{var t=document.createElement("script"),e=window.location.protocol.split(":")[0];t.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js",(e=document.getElementsByTagName("script")[0]).parentNode.insertBefore(t,e)})()</script><script src="/libs/others/clicklove.js" async></script><script async src="/libs/others/busuanzi.pure.mini.js"></script><script src="/libs/instantpage/instantpage.js" type="module"></script></body></html>